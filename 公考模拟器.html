<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä»•é€”æ¨¡æ‹Ÿå™¨ï¼šæˆ‘çš„å…¬ä»†ç”Ÿæ¶¯</title>
    <style>
        /* 1. å…¨å±€æ ·å¼ä¸ä¸»é¢˜ - åƒç´ é£æ ¼ */
        :root {
            --primary-color: #1a1a2e;
            --secondary-color: #16213e;
            --accent-color: #0f3460;
            --background-color: #0f0f0f;
            --text-color: #e0e0e0;
            --success-color: #00ff41;
            --warning-color: #ffb000;
            --danger-color: #ff073a;
            --light-gray: #404040;
            --pixel-blue: #007acc;
            --pixel-green: #228b22;
            --pixel-red: #dc143c;
            --pixel-yellow: #ffd700;
            --font-family: 'Courier New', 'Monaco', 'Menlo', monospace;
            --border-radius: 0px;
            --box-shadow: 0 0 0 2px #333, 0 0 0 4px #666;
            --pixel-border: 2px solid #666;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: var(--font-family);
            background: linear-gradient(45deg, #000 25%, #111 25%, #111 50%, #000 50%, #000 75%, #111 75%);
            background-size: 20px 20px;
            color: var(--text-color);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            overflow: hidden;
            image-rendering: pixelated;
            image-rendering: -moz-crisp-edges;
            image-rendering: crisp-edges;
        }

        #game-container {
            width: 100%;
            max-width: 1000px;
            height: 100vh;
            max-height: 800px;
            background: var(--primary-color);
            border: var(--pixel-border);
            box-shadow: var(--box-shadow);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            position: relative;
        }

        #game-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                repeating-linear-gradient(
                    0deg,
                    transparent,
                    transparent 2px,
                    rgba(0, 255, 65, 0.03) 2px,
                    rgba(0, 255, 65, 0.03) 4px
                );
            pointer-events: none;
            z-index: 1000;
        }

        /* 2. æ¸¸æˆå±å¹•åˆ‡æ¢ */
        .screen {
            display: none;
            flex-grow: 1;
            animation: fadeIn 0.5s ease-in-out;
        }

        .screen.active {
            display: flex;
            flex-direction: column;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: scale(0.98); }
            to { opacity: 1; transform: scale(1); }
        }
        
        /* 3. å¼€å§‹å±å¹• (è§’è‰²åˆ›å»º) */
        #start-screen {
            justify-content: center;
            align-items: center;
            text-align: center;
            padding: 2rem;
            background: var(--primary-color);
            color: var(--text-color);
        }
        #start-screen h1 {
            color: var(--success-color);
            margin-bottom: 1rem;
            font-family: var(--font-family);
            text-transform: uppercase;
            letter-spacing: 2px;
            text-shadow: 0 0 10px var(--success-color);
        }
        #start-screen p {
            margin-bottom: 2rem;
            max-width: 500px;
            color: var(--text-color);
            font-family: var(--font-family);
        }
        .input-group {
            margin-bottom: 1.5rem;
        }
        .input-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: bold;
            color: var(--text-color);
            font-family: var(--font-family);
            text-transform: uppercase;
        }
        #player-name-input {
            width: 100%;
            max-width: 300px;
            padding: 0.8rem;
            border-radius: var(--border-radius);
            border: var(--pixel-border);
            font-size: 1rem;
            font-family: var(--font-family);
            background: linear-gradient(180deg, #222 0%, #111 100%);
            color: var(--text-color);
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.5);
        }
        
        #player-name-input:focus {
            outline: none;
            border-color: var(--success-color);
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.5), 0 0 10px var(--success-color);
        }
        .btn {
            padding: 0.8rem 1.5rem;
            border: 2px solid var(--text-color);
            border-radius: var(--border-radius);
            background: linear-gradient(180deg, var(--pixel-blue) 0%, var(--secondary-color) 100%);
            color: var(--text-color);
            font-size: 1rem;
            font-family: var(--font-family);
            font-weight: bold;
            cursor: pointer;
            transition: all 0.1s;
            text-transform: uppercase;
            letter-spacing: 1px;
            position: relative;
            box-shadow: inset 0 1px 0 rgba(255,255,255,0.2), 
                        inset 0 -1px 0 rgba(0,0,0,0.2),
                        0 2px 4px rgba(0,0,0,0.3);
        }
        .btn:hover {
            background: linear-gradient(180deg, var(--accent-color) 0%, var(--pixel-blue) 100%);
            transform: translateY(-1px);
            box-shadow: inset 0 1px 0 rgba(255,255,255,0.3), 
                        inset 0 -1px 0 rgba(0,0,0,0.3),
                        0 4px 8px rgba(0,0,0,0.4);
        }
        .btn:active {
            transform: translateY(1px);
            box-shadow: inset 0 1px 0 rgba(0,0,0,0.2), 
                        inset 0 -1px 0 rgba(255,255,255,0.1),
                        0 1px 2px rgba(0,0,0,0.2);
        }
        .btn-success { 
            background: linear-gradient(180deg, var(--pixel-green) 0%, var(--success-color) 100%);
            border-color: var(--success-color);
        }
        .btn-success:hover { 
            background: linear-gradient(180deg, var(--success-color) 0%, var(--pixel-green) 100%);
        }
        .btn-danger { 
            background: linear-gradient(180deg, var(--pixel-red) 0%, var(--danger-color) 100%);
            border-color: var(--danger-color);
        }
        .btn-danger:hover { 
            background: linear-gradient(180deg, var(--danger-color) 0%, var(--pixel-red) 100%);
        }

        /* 4. ä¸»æ¸¸æˆç•Œé¢ */
        #main-game-screen {
            flex-direction: column;
        }
        
        .game-header {
            background: linear-gradient(90deg, var(--secondary-color) 0%, var(--accent-color) 50%, var(--secondary-color) 100%);
            color: var(--text-color);
            padding: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: var(--pixel-border);
            position: relative;
            font-family: var(--font-family);
            text-transform: uppercase;
            letter-spacing: 2px;
            box-shadow: inset 0 2px 4px rgba(255,255,255,0.1), 
                        inset 0 -2px 4px rgba(0,0,0,0.2);
        }
        
        .game-header::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: repeating-linear-gradient(
                90deg,
                var(--success-color) 0px,
                var(--success-color) 4px,
                transparent 4px,
                transparent 8px
            );
        }
        
        .header-left h2 {
            margin: 0;
            font-size: 1.5rem;
            font-weight: bold;
        }
        
        .player-basic-info {
            margin-top: 0.5rem;
            font-size: 0.9rem;
        }
        
        .player-basic-info span {
            margin-right: 1rem;
            padding: 0.25rem 0.5rem;
            background: rgba(255,255,255,0.2);
            border-radius: 15px;
        }
        
        .calendar-widget {
            background: rgba(255,255,255,0.1);
            padding: 1rem;
            border-radius: 10px;
            text-align: center;
            min-width: 200px;
        }
        
        .calendar-date {
            font-size: 1.2rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
        }
        
        .calendar-days {
            font-size: 0.9rem;
            opacity: 0.8;
            margin-bottom: 0.5rem;
        }
        
        .auto-progress {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }
        
        .progress-indicator {
            font-size: 0.8rem;
            opacity: 0.9;
        }
        
        .pause-btn {
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            padding: 0.25rem 0.5rem;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.8rem;
        }
        
        .pause-btn:hover {
            background: rgba(255,255,255,0.3);
        }
        
        .game-main {
            flex: 1;
            display: flex;
            overflow: hidden;
        }
        .left-panel {
            width: 280px;
            background: linear-gradient(180deg, var(--secondary-color) 0%, var(--primary-color) 100%);
            color: var(--text-color);
            padding: 1.5rem;
            padding-bottom: 2rem;
            border-right: var(--pixel-border);
            display: flex;
            flex-direction: column;
            overflow-y: auto;
            overflow-x: hidden;
            max-height: calc(100vh - 120px);
        }
        .character-panel h3 {
            color: var(--success-color);
            border-bottom: 2px solid var(--success-color);
            padding-bottom: 0.5rem;
            margin-bottom: 1rem;
            font-family: var(--font-family);
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        .stat-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.8rem;
            font-size: 0.9rem;
            color: var(--text-color);
            font-family: var(--font-family);
        }
        .stat-item .progress-bar {
            width: 120px;
            height: 16px;
            background: linear-gradient(180deg, #222 0%, #111 100%);
            border: 1px solid var(--light-gray);
            border-radius: var(--border-radius);
            overflow: hidden;
            margin-top: 4px;
            position: relative;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.5);
        }
        .stat-item .progress {
            height: 100%;
            background: linear-gradient(180deg, var(--pixel-green) 0%, var(--success-color) 50%, var(--pixel-green) 100%);
            transition: width 0.3s ease;
            position: relative;
            box-shadow: inset 0 1px 2px rgba(255,255,255,0.3);
        }
        .stat-item .progress::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: repeating-linear-gradient(
                90deg,
                transparent 0px,
                transparent 2px,
                rgba(255,255,255,0.1) 2px,
                rgba(255,255,255,0.1) 4px
            );
        }
        .game-info {
            margin-top: auto;
            font-size: 0.9rem;
            padding-bottom: 1rem;
            margin-bottom: 0.5rem;
        }
        .right-panel {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            padding: 1.5rem;
            background: var(--primary-color);
            color: var(--text-color);
        }
        .game-log-container {
            flex-grow: 1;
            border: var(--pixel-border);
            border-radius: var(--border-radius);
            padding: 1rem;
            overflow-y: auto;
            margin-bottom: 1rem;
            background: linear-gradient(180deg, #111 0%, #000 100%);
            height: 400px;
            scroll-behavior: smooth;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.5);
        }
        .log-entry {
            margin-bottom: 0.75rem;
            padding-bottom: 0.75rem;
            border-bottom: 1px dashed var(--success-color);
            animation: logFadeIn 0.3s;
            color: var(--text-color);
            font-family: var(--font-family);
            font-size: 0.85rem;
        }
        .log-entry:last-child {
            border-bottom: none;
        }
        @keyframes logFadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .log-time {
            font-weight: bold;
            color: var(--pixel-yellow);
            margin-right: 10px;
            font-family: var(--font-family);
        }
        .actions-panel {
            background: linear-gradient(180deg, var(--secondary-color) 0%, var(--accent-color) 100%);
            color: var(--text-color);
            border: var(--pixel-border);
            border-radius: var(--border-radius);
            padding: 1rem;
            box-shadow: var(--box-shadow);
            margin-top: auto;
            flex-shrink: 0;
        }
        
        .btn-group {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 0.5rem;
        }
        
        .btn-group:last-child {
            margin-bottom: 0;
        }
        
        .btn-group .btn {
            flex: 1;
        }

        /* 5. æ¨¡æ€æ¡† (äº‹ä»¶, æŠ€èƒ½, æˆå°±) */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at center, rgba(0,0,0,0.8) 0%, rgba(0,0,0,0.9) 100%),
                repeating-linear-gradient(
                    45deg,
                    transparent,
                    transparent 2px,
                    rgba(0,255,65,0.05) 2px,
                    rgba(0,255,65,0.05) 4px
                );
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        .modal.active {
            display: flex;
            animation: pixelFadeIn 0.4s;
        }
        .modal-content {
            background: var(--primary-color);
            color: var(--text-color);
            padding: 2rem;
            border: var(--pixel-border);
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow),
                        0 0 20px rgba(0,255,65,0.3);
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            animation: pixelSlideIn 0.4s ease-out;
            position: relative;
        }
        
        .modal-content::before {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            background: linear-gradient(45deg, var(--success-color), var(--pixel-blue), var(--warning-color), var(--success-color));
            border-radius: var(--border-radius);
            z-index: -1;
            animation: borderGlow 2s linear infinite;
        }
        
        @keyframes borderGlow {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        @keyframes pixelFadeIn {
            0% { opacity: 0; }
            100% { opacity: 1; }
        }
        @keyframes pixelSlideIn {
            0% { 
                opacity: 0; 
                transform: translateY(-30px) scale(0.8); 
                filter: blur(2px);
            }
            50% {
                opacity: 0.7;
                transform: translateY(-10px) scale(1.05);
                filter: blur(1px);
            }
            100% { 
                opacity: 1; 
                transform: translateY(0) scale(1);
                filter: blur(0px);
            }
        }
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--light-gray);
            padding-bottom: 1rem;
            margin-bottom: 1rem;
        }
        .modal-header h2 {
            color: var(--primary-color);
        }
        .modal-body {
            line-height: 1.6;
        }
        .modal-footer {
            margin-top: 1.5rem;
            text-align: right;
            border-top: 1px solid var(--light-gray);
            padding-top: 1rem;
        }
        #event-choices {
            margin-top: 1.5rem;
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }
        #event-choices button {
            width: 100%;
            text-align: left;
            padding: 1rem;
        }
        #skills-list .skill-item, #achievements-list .achievement-item {
            display: flex;
            align-items: center;
            padding: 1.2rem;
            border-radius: 12px;
            margin-bottom: 1rem;
            background: linear-gradient(135deg, #f8f9fa, rgba(255, 255, 255, 0.9));
            border: 2px solid #dee2e6;
            transition: all 0.3s ease;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        
        #skills-list .skill-item:hover, #achievements-list .achievement-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
            border-color: var(--pixel-yellow);
        }
        
        .skill-item .skill-info {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }
        
        .skill-item .skill-name {
            font-weight: bold;
            color: var(--primary-color);
            font-size: 1.1rem;
        }
        
        .skill-item .skill-bar {
            width: 100%;
            height: 8px;
            background: rgba(0, 0, 0, 0.1);
            border-radius: 4px;
            overflow: hidden;
        }
        
        .skill-item .skill-progress {
            height: 100%;
            background: linear-gradient(90deg, var(--pixel-green), var(--pixel-yellow));
            border-radius: 4px;
            transition: width 0.5s ease;
        }
        
        .skill-item .skill-value {
            color: var(--pixel-green);
            font-weight: bold;
            font-size: 1.1rem;
            margin-left: 1rem;
            min-width: 60px;
            text-align: right;
        }
        
        #achievements-list .achievement-item.unlocked {
            background: linear-gradient(135deg, var(--pixel-yellow), var(--pixel-green));
            border-color: var(--pixel-yellow);
            animation: glow 2s ease-in-out infinite alternate;
        }
        
        .achievement-icon {
            font-size: 2rem;
            margin-right: 1rem;
        }
        
        .achievement-info {
            flex: 1;
        }
        
        .achievement-title {
            font-weight: bold;
            font-size: 1.1rem;
            margin-bottom: 0.3rem;
            color: var(--primary-color);
        }
        
        .achievement-desc {
            font-size: 0.9rem;
            opacity: 0.8;
            line-height: 1.4;
        }
        
        @keyframes glow {
            from { box-shadow: 0 4px 8px rgba(255, 215, 0, 0.3); }
            to { box-shadow: 0 6px 20px rgba(255, 215, 0, 0.6); }
        }
        
        /* 6. å¡é€šå°äººåŠ¨ç”»åŒºåŸŸ */
        .character-animation-area {
            width: 200px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background: linear-gradient(180deg, var(--secondary-color) 0%, var(--primary-color) 100%);
            border-left: var(--pixel-border);
            border-right: var(--pixel-border);
            position: relative;
            overflow: hidden;
        }
        
        .animated-character {
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
            z-index: 10;
        }
        
        .character-body {
            display: flex;
            flex-direction: column;
            align-items: center;
            animation: idle 3s ease-in-out infinite;
        }
        
        .character-head {
            font-size: 3rem;
            margin-bottom: 0.5rem;
            animation: headBob 2s ease-in-out infinite;
        }
        
        .character-torso {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
        }
        
        .character-legs {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }
        
        .leg {
            width: 8px;
            height: 30px;
            background: var(--text-color);
            border-radius: 4px;
        }
        
        .activity-indicator {
            background: rgba(0, 0, 0, 0.8);
            color: var(--pixel-yellow);
            padding: 0.5rem 1rem;
            border-radius: var(--border-radius);
            font-size: 0.8rem;
            font-family: var(--font-family);
            text-align: center;
            margin-top: 1rem;
            border: 1px solid var(--pixel-yellow);
            box-shadow: 0 0 10px rgba(255, 215, 0, 0.3);
        }
        
        /* åŠ¨ç”»å…³é”®å¸§ */
        @keyframes idle {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-5px); }
        }
        
        @keyframes headBob {
            0%, 100% { transform: rotate(-2deg); }
            50% { transform: rotate(2deg); }
        }
        
        @keyframes running {
            0%, 100% { transform: translateX(0px) scale(1); }
            25% { transform: translateX(-3px) scale(1.05); }
            75% { transform: translateX(3px) scale(0.95); }
        }
        
        @keyframes studying {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            50% { transform: translateY(-2px) rotate(-1deg); }
        }
        
        @keyframes working {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.02); }
        }
        
        @keyframes celebrating {
            0%, 100% { transform: translateY(0px) rotate(0deg) scale(1); }
            25% { transform: translateY(-10px) rotate(-5deg) scale(1.1); }
            75% { transform: translateY(-5px) rotate(5deg) scale(1.05); }
        }
        
        /* ä¸åŒé˜¶æ®µçš„åŠ¨ç”»çŠ¶æ€ */
        .character-body.running {
            animation: running 0.8s ease-in-out infinite;
        }
        
        .character-body.studying {
            animation: studying 2s ease-in-out infinite;
        }
        
        .character-body.studying .character-head {
            animation: none;
            transform: rotate(-10deg);
        }
        
        .character-body.working {
            animation: working 1.5s ease-in-out infinite;
        }
        
        .character-body.celebrating {
            animation: celebrating 1s ease-in-out infinite;
        }
        
        .character-body.celebrating .character-head {
            animation: none;
        }
        
        /* 7. é€šçŸ¥æç¤º */
        #notification {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background-color: var(--success-color);
            color: white;
            padding: 1rem 2rem;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            z-index: 2000;
            opacity: 0;
            transition: opacity 0.5s, top 0.5s;
            pointer-events: none;
        }
        #notification.show {
            opacity: 1;
            top: 40px;
        }
        
        /* è®¾ç½®ç›¸å…³æ ·å¼ */
        .setting-item {
            margin-bottom: 1.5rem;
            padding: 1rem;
            background: rgba(255, 255, 255, 0.05);
            border-radius: var(--border-radius);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .setting-label {
            display: flex;
            align-items: center;
            cursor: pointer;
            font-weight: bold;
            margin-bottom: 0.5rem;
        }
        
        .setting-label input[type="checkbox"] {
            margin-right: 0.8rem;
            transform: scale(1.2);
        }
        
        .setting-desc {
            font-size: 0.85rem;
            color: var(--text-color);
            opacity: 0.8;
            margin: 0;
            line-height: 1.4;
        }
        
        /* 7. å“åº”å¼å¸ƒå±€ */
        @media (max-width: 768px) {
            #game-container {
                height: 100vh;
                max-height: none;
                border-radius: 0;
            }
            #main-game-screen {
                flex-direction: column;
            }
            .character-animation-area {
                width: 100%;
                height: 120px;
                flex-direction: row;
                justify-content: center;
                border-left: none;
                border-right: none;
                border-top: var(--pixel-border);
                border-bottom: var(--pixel-border);
            }
            .animated-character {
                flex-direction: row;
                align-items: center;
                gap: 1rem;
            }
            .character-body {
                transform: scale(0.8);
            }
            .activity-indicator {
                margin-top: 0;
                margin-left: 1rem;
            }
            .left-panel {
                width: 100%;
                border-right: none;
                border-bottom: 1px solid #dee2e6;
                height: auto;
                max-height: 40vh;
                padding: 1rem;
                padding-bottom: 1.5rem;
            }
            .right-panel {
                padding: 1rem;
                flex-grow: 1;
                min-height: 0;
            }
            .game-log-container {
                height: 300px;
            }
            .actions-panel {
                position: sticky;
                bottom: 0;
                z-index: 10;
                margin-top: 0.5rem;
            }
            .btn {
                font-size: 0.9rem;
            }
            .btn-group {
                flex-wrap: wrap;
            }
        }
        
        @media (max-width: 480px) {
            .left-panel {
                max-height: 35vh;
                padding: 0.8rem;
            }
            .right-panel {
                padding: 0.8rem;
            }
            .game-log-container {
                height: 250px;
            }
            .btn {
                font-size: 0.8rem;
                padding: 0.6rem 1rem;
            }
        }

    </style>
</head>
<body>

    <div id="game-container">
        <!-- å±å¹•1: è§’è‰²åˆ›å»º -->
        <div id="start-screen" class="screen active">
            <h1>å…¬è€ƒæ¨¡æ‹Ÿå™¨ï¼šæˆ‘çš„å…¬ä»†ç”Ÿæ¶¯</h1>
            <p>ä»ä¸€åæ™®é€šé’å¹´å¼€å§‹ï¼Œä½“éªŒå¤‡è€ƒã€å·¥ä½œã€æˆé•¿çš„å®Œæ•´å…¬èŒå†ç¨‹ã€‚ä½ çš„æ¯ä¸€ä¸ªé€‰æ‹©ï¼Œéƒ½å°†å¡‘é€ ä½ çš„äººç”Ÿé“è·¯ã€‚å‡†å¤‡å¥½äº†å—ï¼Ÿ</p>
            <div class="input-group">
                <label for="player-name-input">è¯·è¾“å…¥ä½ çš„åå­—ï¼š</label>
                <input type="text" id="player-name-input" placeholder="ä¾‹å¦‚ï¼šæå" maxlength="10">
            </div>
            <button id="start-game-btn" class="btn btn-success">å¼€å¯å…¬ä»†ç”Ÿæ¶¯</button>
        </div>

        <!-- å±å¹•2: ä¸»æ¸¸æˆç•Œé¢ -->
        <div id="main-game-screen" class="screen">
            <!-- æ¸¸æˆå¤´éƒ¨ -->
            <div class="game-header">
                <div class="header-left">
                    <h2>ä»•é€”æ¨¡æ‹Ÿå™¨</h2>
                    <div class="player-basic-info">
                        <span id="player-name-display"></span>
                        <span id="player-stage-display"></span>
                    </div>
                </div>
                <div class="calendar-widget">
                    <div class="calendar-date">
                        <span id="calendar-year">2024</span>å¹´
                        <span id="calendar-month">1</span>æœˆ
                        <span id="calendar-day">1</span>æ—¥
                    </div>
                    <div class="calendar-days">ç¬¬<span id="calendar-total-days">1</span>å¤©</div>
                    <div class="auto-progress">
                        <span class="progress-indicator" id="progress-status">â° è‡ªåŠ¨æ¨è¿›ä¸­...</span>
                        <button id="pause-btn" class="pause-btn">â¸ï¸ æš‚åœ</button>
                    </div>
                </div>
            </div>
            
            <div class="game-main">
            <div class="left-panel">
                <div class="character-panel">
                    <h3>è§’è‰²å±æ€§</h3>
                    
                    <div class="stat-item">
                        <span><i class="icon">ğŸ’¡</i> ä¸“ä¸šèƒ½åŠ›</span>
                        <div class="progress-bar"><div id="stat-professional" class="progress"></div></div>
                    </div>
                    <div class="stat-item">
                        <span><i class="icon">ğŸ’¬</i> æ²Ÿé€šæŠ€å·§</span>
                        <div class="progress-bar"><div id="stat-communication" class="progress"></div></div>
                    </div>
                    <div class="stat-item">
                        <span><i class="icon">ğŸ§ </i> å†³ç­–æ™ºæ…§</span>
                        <div class="progress-bar"><div id="stat-decision" class="progress"></div></div>
                    </div>
                    <div class="stat-item">
                        <span><i class="icon">â¤ï¸</i> æŠ—å‹èƒ½åŠ›</span>
                        <div class="progress-bar"><div id="stat-resilience" class="progress"></div></div>
                    </div>
                    <div class="stat-item">
                        <span><i class="icon">ğŸ“š</i> å­¦ä¹ èƒ½åŠ›</span>
                        <div class="progress-bar"><div id="stat-learning" class="progress"></div></div>
                    </div>
                </div>

                <div class="goals-panel" style="margin-bottom: 1rem;">
                    <h4 style="color: var(--pixel-yellow); margin-bottom: 0.5rem; font-size: 0.9rem; font-family: var(--font-family); text-transform: uppercase;">ğŸ“‹ å½“å‰ç›®æ ‡</h4>
                    <div id="goals-list" style="font-size: 0.8rem;">
                        <!-- ç›®æ ‡åˆ—è¡¨ä¼šåŠ¨æ€æ·»åŠ åˆ°è¿™é‡Œ -->
                    </div>
                </div>

                <div class="effects-panel" style="margin-bottom: 1rem;">
                    <h4 style="color: var(--success-color); margin-bottom: 0.5rem; font-size: 0.9rem; font-family: var(--font-family);">âœ¨ å¢ç›Šæ•ˆæœ</h4>
                    <div id="active-buffs" style="font-size: 0.8rem; min-height: 20px;">
                        <span style="opacity: 0.6;">æš‚æ— å¢ç›Šæ•ˆæœ</span>
                    </div>
                    <h4 style="color: var(--danger-color); margin-bottom: 0.5rem; font-size: 0.9rem; font-family: var(--font-family); margin-top: 0.8rem;">ğŸ’” è´Ÿé¢æ•ˆæœ</h4>
                    <div id="active-debuffs" style="font-size: 0.8rem; min-height: 20px;">
                        <span style="opacity: 0.6;">æš‚æ— è´Ÿé¢æ•ˆæœ</span>
                    </div>
                </div>

                <div class="game-info">
                    <p><strong>å½“å‰æ—¶é—´:</strong> <span id="game-time"></span></p>
                    <p><strong>é€‰æ‹©è·¯å¾„:</strong> <span id="selected-path">æœªé€‰æ‹©</span></p>
                    <p><strong>å½±å“åŠ›:</strong> <span id="influence-display">0</span></p>
                    <p><strong>è€ƒè¯•è¿›åº¦:</strong> 
                        <span id="exam-progress">ç¬”è¯•: 0æ¬¡ | é¢è¯•: 0æ¬¡</span>
                    </p>
                    <div style="margin-top: 0.5rem;">
                        <details>
                            <summary style="cursor: pointer; font-size: 0.8rem;">æ€§æ ¼ç‰¹å¾ â–¼</summary>
                            <div id="personality-display" style="font-size: 0.7rem; margin-top: 0.3rem;">
                                <div>ğŸŒŸ åˆ›æ–°: <span id="personality-innovative">0</span></div>
                                <div>ğŸ¤ ç¤¾äº¤: <span id="personality-social">0</span></div>
                                <div>ğŸ“š å­¦ä¹ : <span id="personality-studious">0</span></div>
                                <div>âš–ï¸ è°¨æ…: <span id="personality-cautious">0</span></div>
                                <div>âš¡ å›é€†: <span id="personality-rebellious">0</span></div>
                                <div>ğŸ›ï¸ ä¼ ç»Ÿ: <span id="personality-traditional">0</span></div>
                            </div>
                        </details>
                    </div>
                </div>
            </div>
            
            <!-- å¡é€šå°äººåŠ¨ç”»åŒºåŸŸ -->
            <div class="character-animation-area">
                <div id="animated-character" class="animated-character">
                    <div class="character-body">
                        <div class="character-head">ğŸ˜Š</div>
                        <div class="character-torso">ğŸ‘”</div>
                        <div class="character-legs">
                            <div class="leg left-leg"></div>
                            <div class="leg right-leg"></div>
                        </div>
                    </div>
                    <div class="activity-indicator" id="activity-text">å‡†å¤‡ä¸­...</div>
                </div>
            </div>
            
            <div class="right-panel">
                <h3 style="color: var(--success-color); font-family: var(--font-family); text-transform: uppercase; border-bottom: 2px solid var(--success-color); padding-bottom: 0.5rem; margin-bottom: 1rem;">å·¥ä½œæ—¥å¿—</h3>
                <div id="game-log" class="game-log-container">
                    <!-- æ—¥å¿—æ¡ç›®ä¼šåŠ¨æ€æ·»åŠ åˆ°è¿™é‡Œ -->
                </div>
                <div class="actions-panel">
                    <div class="btn-group">
                        <button id="skills-btn" class="btn">æŸ¥çœ‹èƒ½åŠ›</button>
                        <button id="achievements-btn" class="btn">æˆ‘çš„æˆå°±</button>
                        <button id="settings-btn" class="btn">âš™ï¸ è®¾ç½®</button>
                    </div>
                    <div class="btn-group">
                        <button id="share-btn" class="btn" style="background: linear-gradient(45deg, #ff6b6b, #ffa500);">ğŸ”¥ åˆ†äº«è¿›åº¦</button>
                        <button id="reset-btn" class="btn btn-danger">é‡ç½®æ¸¸æˆ</button>
                    </div>
                </div>
            </div>
            </div>
        </div>

    </div>

    <!-- æ¨¡æ€æ¡†: äº‹ä»¶å¤„ç† -->
    <div id="event-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="event-title"></h2>
            </div>
            <div class="modal-body">
                <p id="event-description"></p>
                <div id="event-choices">
                    <!-- é€‰é¡¹æŒ‰é’®ä¼šåŠ¨æ€æ·»åŠ åˆ°è¿™é‡Œ -->
                </div>
            </div>
        </div>
    </div>

    <!-- æ¨¡æ€æ¡†: æŠ€èƒ½ç³»ç»Ÿ -->
    <div id="skills-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>èƒ½åŠ›è¯¦æƒ…</h2>
            </div>
            <div class="modal-body">
                <div id="skills-list"></div>
                <p style="margin-top: 1rem; text-align: center; color: var(--text-color);">èƒ½åŠ›ç‚¹ä¼šé€šè¿‡å®Œæˆé‡è¦äº‹ä»¶å’Œæ™‹å‡è·å¾—ã€‚</p>
            </div>
            <div class="modal-footer">
                <button id="close-skills-btn" class="btn">å…³é—­</button>
            </div>
        </div>
    </div>
    
    <!-- æ¨¡æ€æ¡†: æˆå°±ç³»ç»Ÿ -->
    <div id="achievements-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>æˆ‘çš„æˆå°±</h2>
            </div>
            <div class="modal-body">
                <div id="achievements-list"></div>
            </div>
            <div class="modal-footer">
                <button id="close-achievements-btn" class="btn">å…³é—­</button>
            </div>
        </div>
    </div>
    
    <!-- æ¨¡æ€æ¡†: æ¸¸æˆè®¾ç½® -->
    <div id="settings-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>âš™ï¸ æ¸¸æˆè®¾ç½®</h2>
            </div>
            <div class="modal-body">
                <div class="setting-item">
                    <label class="setting-label">
                        <input type="checkbox" id="auto-random-choice" checked>
                        <span>æ™®é€šäº‹ä»¶è‡ªåŠ¨éšæœºé€‰æ‹©</span>
                    </label>
                    <p class="setting-desc">å¼€å¯åï¼Œæ™®é€šäº‹ä»¶å°†è‡ªåŠ¨éšæœºé€‰æ‹©ï¼Œé‡è¦äº‹ä»¶ä»éœ€æ‰‹åŠ¨é€‰æ‹©</p>
                </div>
                <div class="setting-item">
                    <label class="setting-label">
                        <input type="checkbox" id="show-event-hints" checked>
                        <span>æ˜¾ç¤ºäº‹ä»¶æç¤º</span>
                    </label>
                    <p class="setting-desc">æ˜¾ç¤ºäº‹ä»¶çš„é‡è¦æ€§å’Œå½±å“æç¤º</p>
                </div>
                <div class="setting-item">
                    <label class="setting-label">
                        <input type="checkbox" id="debug-mode">
                        <span>å¼€å‘è€…è°ƒè¯•æ¨¡å¼</span>
                    </label>
                    <p class="setting-desc">æ˜¾ç¤ºäº‹ä»¶ç³»ç»Ÿè°ƒè¯•ä¿¡æ¯ï¼ˆå¼€å‘è€…é€‰é¡¹ï¼‰</p>
                </div>
            </div>
            <div class="modal-footer">
                <button id="save-settings-btn" class="btn">ä¿å­˜è®¾ç½®</button>
                <button id="close-settings-btn" class="btn">å…³é—­</button>
            </div>
        </div>
    </div>
    
    <!-- é€šçŸ¥ -->
    <div id="notification"></div>

    <script>
    document.addEventListener('DOMContentLoaded', () => {

        // ----------------------------------------------------
        // 1. DOM å…ƒç´ è·å–
        // ----------------------------------------------------
        const screens = {
            start: document.getElementById('start-screen'),
            main: document.getElementById('main-game-screen'),
        };
        const modals = {
            event: document.getElementById('event-modal'),
            skills: document.getElementById('skills-modal'),
            achievements: document.getElementById('achievements-modal'),
            settings: document.getElementById('settings-modal'),
        };
        const inputs = {
            playerName: document.getElementById('player-name-input'),
        };
        const displays = {
            playerName: document.getElementById('player-name-display'),
            playerStage: document.getElementById('player-stage-display'),
            gameTime: document.getElementById('game-time'),
            influence: document.getElementById('influence-display'),
            log: document.getElementById('game-log'),
            notification: document.getElementById('notification'),
        };
        const statsBars = {
            professional: document.getElementById('stat-professional'),
            communication: document.getElementById('stat-communication'),
            decision: document.getElementById('stat-decision'),
            resilience: document.getElementById('stat-resilience'),
            learning: document.getElementById('stat-learning'),
        };
        const eventElements = {
            title: document.getElementById('event-title'),
            description: document.getElementById('event-description'),
            choices: document.getElementById('event-choices'),
        };
        const lists = {
            skills: document.getElementById('skills-list'),
            achievements: document.getElementById('achievements-list'),
        };
        const buttons = {
            start: document.getElementById('start-game-btn'),
            pause: document.getElementById('pause-btn'),
            showSkills: document.getElementById('skills-btn'),
            closeSkills: document.getElementById('close-skills-btn'),
            showAchievements: document.getElementById('achievements-btn'),
            closeAchievements: document.getElementById('close-achievements-btn'),
            share: document.getElementById('share-btn'),
            reset: document.getElementById('reset-btn'),
            settings: document.getElementById('settings-btn'),
            closeSettings: document.getElementById('close-settings-btn'),
        };
        const calendar = {
            year: document.getElementById('calendar-year'),
            month: document.getElementById('calendar-month'),
            day: document.getElementById('calendar-day'),
            totalDays: document.getElementById('calendar-total-days'),
            progressStatus: document.getElementById('progress-status')
        };

        // ----------------------------------------------------
        // 2. æ¸¸æˆæ ¸å¿ƒæ•°æ®ç»“æ„
        // ----------------------------------------------------
        
        // æ¸¸æˆçŠ¶æ€å¯¹è±¡ (ç©å®¶æ•°æ®å’Œæ¸¸æˆè¿›ç¨‹)
        let gameState = {};

        // æ¸¸æˆè®¾ç½®
        let gameSettings = {
            autoRandomChoice: false,  // æ™®é€šäº‹ä»¶è‡ªåŠ¨éšæœºé€‰æ‹©
            showEventHints: true,     // æ˜¾ç¤ºäº‹ä»¶æç¤º
            debugMode: false          // å¼€å‘è€…è°ƒè¯•æ¨¡å¼
        };

        // æ¸¸æˆé™æ€æ•°æ® (æŠ€èƒ½ã€äº‹ä»¶ã€æˆå°±å®šä¹‰)
        const gameData = {
            skills: {
                professional: { name: 'ä¸“ä¸šèƒ½åŠ›', description: 'å¤„ç†æœ¬èŒå·¥ä½œçš„æ ¸å¿ƒæŠ€èƒ½ï¼Œå½±å“å·¥ä½œæ•ˆç‡å’Œè´¨é‡ã€‚' },
                communication: { name: 'æ²Ÿé€šæŠ€å·§', description: 'ä¸åŒäº‹ã€é¢†å¯¼ã€ç¾¤ä¼—æ²Ÿé€šçš„èƒ½åŠ›ï¼Œå†³å®šäººé™…å…³ç³»å’Œåä½œæ•ˆæœã€‚' },
                decision: { name: 'å†³ç­–æ™ºæ…§', description: 'åœ¨å¤æ‚æƒ…å†µä¸­åˆ†æåˆ©å¼Šï¼Œåšå‡ºæ­£ç¡®åˆ¤æ–­çš„èƒ½åŠ›ã€‚' },
                resilience: { name: 'æŠ—å‹èƒ½åŠ›', description: 'é¢å¯¹å‹åŠ›ã€æŒ«æŠ˜å’Œé«˜å¼ºåº¦å·¥ä½œæ—¶çš„å¿ƒç†æ‰¿å—åŠ›ã€‚' },
                learning: { name: 'å­¦ä¹ èƒ½åŠ›', description: 'å¿«é€ŸæŒæ¡æ–°çŸ¥è¯†ã€æ–°æ”¿ç­–ã€æ–°æŠ€èƒ½çš„èƒ½åŠ›ã€‚' },
            },
            achievements: {
                'FIRST_STEP': { name: 'è¿ˆå‡ºç¬¬ä¸€æ­¥', description: 'æˆåŠŸæŠ¥åå…¬èŒè€ƒè¯•ï¼Œè¸ä¸Šè¿½æ¢¦ä¹‹æ—…ã€‚', unlocked: false },
                'PASS_WRITTEN_TEST': { name: 'ç¬”è¯•è¿‡å…³', description: 'é€šè¿‡æ¿€çƒˆçš„ç¬”è¯•ï¼Œè¯æ˜äº†ä½ çš„çŸ¥è¯†å‚¨å¤‡ã€‚', unlocked: false },
                'ACE_INTERVIEW': { name: 'é¢è¯•ä¹‹ç‹', description: 'åœ¨é¢è¯•ä¸­è„±é¢–è€Œå‡ºï¼Œå±•ç°äº†ä½ çš„ç»¼åˆç´ å…»ã€‚', unlocked: false },
                'NEWBIE_ONBOARD': { name: 'æ–°äººæŠ¥åˆ°', description: 'æˆåŠŸå…¥èŒï¼Œæˆä¸ºä¸€åå…‰è£çš„å…¬èŒäººå‘˜ã€‚', unlocked: false },
                'FIRST_PRAISE': { name: 'åˆè·èµæ‰¬', description: 'ç¬¬ä¸€æ¬¡å› å·¥ä½œå‡ºè‰²å—åˆ°é¢†å¯¼æˆ–åŒäº‹çš„è¡¨æ‰¬ã€‚', unlocked: false },
                'CRISIS_HANDLER': { name: 'å±æœºå¤„ç†è€…', description: 'æˆåŠŸå¤„ç†ä¸€æ¬¡çªå‘äº‹ä»¶ï¼ŒåŒ–è§£å±æœºã€‚', unlocked: false },
                'TEAM_PLAYER': { name: 'å›¢é˜Ÿåˆä½œè€…', description: 'åœ¨å›¢é˜Ÿåˆä½œä¸­è¡¨ç°å‡ºè‰²ï¼Œè·å¾—åŒäº‹è®¤å¯ã€‚', unlocked: false },
                'INNOVATOR': { name: 'åˆ›æ–°å…ˆé”‹', description: 'æå‡ºåˆ›æ–°å»ºè®®å¹¶è¢«é‡‡çº³ï¼Œæ¨åŠ¨å·¥ä½œæ”¹è¿›ã€‚', unlocked: false },
                'MEDIA_STAR': { name: 'åª’ä½“ä¹‹æ˜Ÿ', description: 'æˆåŠŸæ¥å—åª’ä½“é‡‡è®¿ï¼Œå±•ç¤ºè‰¯å¥½çš„æ”¿åºœå½¢è±¡ã€‚', unlocked: false },
                'EXPERT': { name: 'ä¸šåŠ¡ä¸“å®¶', description: 'åœ¨ä¸“ä¸šé¢†åŸŸè¾¾åˆ°å¾ˆé«˜æ°´å¹³ï¼Œæˆä¸ºä¸šåŠ¡éª¨å¹²ã€‚', unlocked: false },
                'LEADER': { name: 'é¢†å¯¼æ½œè´¨', description: 'å±•ç°å‡ºä¼˜ç§€çš„é¢†å¯¼èƒ½åŠ›å’Œç®¡ç†æ½œè´¨ã€‚', unlocked: false },
                'PEOPLE_SERVANT': { name: 'äººæ°‘å…¬ä»†', description: 'å§‹ç»ˆåšæŒä¸ºäººæ°‘æœåŠ¡çš„ç†å¿µï¼Œè·å¾—ç¾¤ä¼—å¥½è¯„ã€‚', unlocked: false },
                'SOCIAL_MEDIA_HERO': { name: 'ç½‘ç»œçº¢äºº', description: 'åœ¨ç¤¾äº¤åª’ä½“ä¸Šè·å¾—å¤§é‡å…³æ³¨å’Œå¥½è¯„ã€‚', unlocked: false },
                'CONTROVERSIAL_CHOICE': { name: 'äº‰è®®é€‰æ‹©', description: 'åšå‡ºäº†ä¸€ä¸ªå¼•å‘çƒ­è®®çš„å†³å®šï¼Œä½†åšæŒäº†è‡ªå·±çš„åŸåˆ™ã€‚', unlocked: false },
                'MEME_MASTER': { name: 'è¡¨æƒ…åŒ…è¾¾äºº', description: 'å› ä¸ºæŸä¸ªç¬é—´æˆä¸ºç½‘ç»œè¡¨æƒ…åŒ…ï¼Œæ„å¤–èµ°çº¢ã€‚', unlocked: false },
                'YOUNG_ICON': { name: 'å¹´è½»å¶åƒ', description: 'æˆä¸ºå¹´è½»äººå¿ƒç›®ä¸­çš„å…¬èŒäººå‘˜å…¸å‹ä»£è¡¨ã€‚', unlocked: false },
                'BALANCE_MASTER': { name: 'å¹³è¡¡å¤§å¸ˆ', description: 'åœ¨å·¥ä½œä¸ç”Ÿæ´»é—´æ‰¾åˆ°å®Œç¾å¹³è¡¡ï¼Œæˆä¸ºåŒé¾„äººæ¦œæ ·ã€‚', unlocked: false },
                'TREND_SETTER': { name: 'æ½®æµå¼•é¢†è€…', description: 'åœ¨æ”¿åºœå·¥ä½œä¸­å¼•å…¥æ–°æ½®ç†å¿µï¼Œè·å¾—å¹´è½»ç¾¤ä½“è®¤å¯ã€‚', unlocked: false },
                'HUATU_STUDENT': { name: 'åå›¾å­¦éœ¸', description: 'æˆä¸ºåå›¾æ•™è‚²å¿ å®å­¦å‘˜ï¼ŒæŒæ¡äº†æ ¸å¿ƒå­¦ä¹ æ–¹æ³•ã€‚', unlocked: false },
                'HUATU_FAN': { name: 'åå›¾é“ç²‰', description: 'æ·±åº¦å…³æ³¨åå›¾æ•™è‚²å†…å®¹ï¼Œå¿ƒæ€å’ŒæŠ€èƒ½åŒæå‡ã€‚', unlocked: false },
                'GROUP_STAR': { name: 'å­¦ä¹ ç¾¤æ˜æ˜Ÿ', description: 'åœ¨åå›¾å­¦ä¹ ç¾¤ä¸­æˆä¸ºæ´»è·ƒåˆ†äº«è€…ï¼Œå¸®åŠ©ä»–äººæˆé•¿ã€‚', unlocked: false },
                'CAREER_FOCUSED': { name: 'äº‹ä¸šå‹é€‰æ‰‹', description: 'é€‰æ‹©æŒ‘æˆ˜é«˜éš¾åº¦å·¥ä½œï¼Œä¸“æ³¨äº‹ä¸šå‘å±•ã€‚', unlocked: false },
                'FAMILY_FIRST': { name: 'é¡¾å®¶æš–ç”·/å¥³', description: 'å°†å®¶åº­æ”¾åœ¨é¦–ä½ï¼Œåšå‡ºæ¸©æš–çš„äººç”Ÿé€‰æ‹©ã€‚', unlocked: false },
            },
            // ç¬”è¯•é¢˜åº“
            writtenTestQuestions: [
                {
                    id: 'Q001', type: 'è¡Œæµ‹', category: 'æ•°é‡å…³ç³»',
                    question: 'å°æ˜ä»å®¶åˆ°å­¦æ ¡çš„è·ç¦»æ˜¯1200ç±³ï¼Œä»–ä»¥æ¯åˆ†é’Ÿ60ç±³çš„é€Ÿåº¦æ­¥è¡Œï¼Œèµ°äº†8åˆ†é’Ÿåå‘ç°å¿˜è®°å¸¦ä½œä¸šæœ¬ï¼Œç«‹å³åŸè·¯è¿”å›å®¶ä¸­å–ä½œä¸šæœ¬ï¼Œç„¶åä»¥æ¯åˆ†é’Ÿ80ç±³çš„é€Ÿåº¦å‰å¾€å­¦æ ¡ã€‚é—®å°æ˜ä»å®¶å‡ºå‘åˆ°åˆ°è¾¾å­¦æ ¡æ€»å…±ç”¨äº†å¤šå°‘åˆ†é’Ÿï¼Ÿ',
                    options: ['A. 35åˆ†é’Ÿ', 'B. 38åˆ†é’Ÿ', 'C. 41åˆ†é’Ÿ', 'D. 44åˆ†é’Ÿ'],
                    correct: 2,
                    explanation: 'å°æ˜å…ˆèµ°äº†8åˆ†é’Ÿ480ç±³ï¼Œè¿”å›å®¶ç”¨æ—¶8åˆ†é’Ÿï¼Œç„¶åä»¥80ç±³/åˆ†é’Ÿèµ°1200ç±³ç”¨æ—¶15åˆ†é’Ÿï¼Œæ€»è®¡8+8+15=31åˆ†é’Ÿã€‚'
                },
                {
                    id: 'Q002', type: 'ç”³è®º', category: 'ç»¼åˆåˆ†æ',
                    question: 'è¯·ç»“åˆææ–™ï¼Œåˆ†æå½“å‰"èººå¹³"ç°è±¡å¯¹é’å¹´å‘å±•çš„å½±å“ï¼Œå¹¶æå‡ºè§£å†³å»ºè®®ã€‚',
                    options: ['A. å®Œå…¨æ”¯æŒèººå¹³ï¼Œè®¤ä¸ºæ˜¯ç†æ€§é€‰æ‹©', 'B. ç†è§£ä½†ä¸è®¤åŒï¼Œæå‡ºç§¯æå»ºè®®', 'C. ä¸¥å‰æ‰¹è¯„ï¼Œè¦æ±‚ç«‹å³æ”¹æ­£', 'D. å›é¿é—®é¢˜ï¼Œä¸åšè¯„ä»·'],
                    correct: 1,
                    explanation: 'éœ€è¦ç†è§£å¹´è½»äººé¢ä¸´çš„å‹åŠ›ï¼Œä½†ä¹Ÿè¦å¼•å¯¼ç§¯æå‘ä¸Šçš„äººç”Ÿæ€åº¦ã€‚'
                },
                {
                    id: 'Q003', type: 'è¡Œæµ‹', category: 'è¨€è¯­ç†è§£',
                    question: 'äº’è”ç½‘æ—¶ä»£ï¼Œä¿¡æ¯ä¼ æ’­é€Ÿåº¦æå¿«ï¼Œä½†ä¹Ÿå®¹æ˜“äº§ç”Ÿ________ã€‚æˆ‘ä»¬è¦å­¦ä¼šåœ¨æµ·é‡ä¿¡æ¯ä¸­________çœŸç›¸ï¼Œä¸èƒ½è¢«è™šå‡ä¿¡æ¯æ‰€________ã€‚',
                    options: ['A. è¯¯è§£ å¯»æ‰¾ è¿·æƒ‘', 'B. åå·® è¯†åˆ« è¯¯å¯¼', 'C. åˆ†æ­§ å‘ç° æ¬ºéª—', 'D. æ··ä¹± è¾¨åˆ« è’™è”½'],
                    correct: 1,
                    explanation: 'ä¿¡æ¯ä¼ æ’­å®¹æ˜“äº§ç”Ÿåå·®ï¼Œéœ€è¦è¯†åˆ«çœŸç›¸ï¼Œé¿å…è¢«è¯¯å¯¼ã€‚'
                },
                {
                    id: 'Q004', type: 'è¡Œæµ‹', category: 'é€»è¾‘åˆ¤æ–­',
                    question: 'æŸå•ä½è¦åœ¨ç”²ã€ä¹™ã€ä¸™ã€ä¸å››äººä¸­é€‰ä¸¤äººå»å‚åŠ åŸ¹è®­ã€‚å·²çŸ¥ï¼š(1)å¦‚æœç”²å»ï¼Œé‚£ä¹ˆä¹™ä¹Ÿå»ï¼›(2)å¦‚æœä¹™å»ï¼Œé‚£ä¹ˆä¸™ä¸å»ï¼›(3)å¦‚æœä¸™ä¸å»ï¼Œé‚£ä¹ˆä¸å»ï¼›(4)ä¸ä¸å»ã€‚æ ¹æ®ä»¥ä¸Šæ¡ä»¶ï¼Œå¯ä»¥ç¡®å®šå»å‚åŠ åŸ¹è®­çš„æ˜¯ï¼š',
                    options: ['A. ç”²å’Œä¹™', 'B. ç”²å’Œä¸™', 'C. ä¹™å’Œä¸', 'D. ä¸™å’Œä¸'],
                    correct: 1,
                    explanation: 'ç”±æ¡ä»¶(4)ä¸ä¸å»ï¼Œç»“åˆ(3)å¯å¾—ä¸™å»ï¼›ç”±ä¸™å»å’Œ(2)å¯å¾—ä¹™ä¸å»ï¼›ç”±ä¹™ä¸å»å’Œ(1)å¯å¾—ç”²ä¸å»ã€‚ä½†é¢˜ç›®è¦æ±‚é€‰ä¸¤äººï¼Œæ‰€ä»¥åº”è¯¥æ˜¯ç”²å’Œä¸™ã€‚'
                },
                {
                    id: 'Q005', type: 'è¡Œæµ‹', category: 'èµ„æ–™åˆ†æ',
                    question: '2023å¹´æŸå¸‚GDPä¸º5000äº¿å…ƒï¼Œæ¯”ä¸Šå¹´å¢é•¿8.5%ã€‚å…¶ä¸­ç¬¬ä¸‰äº§ä¸šå¢åŠ å€¼ä¸º2800äº¿å…ƒï¼Œå GDPçš„æ¯”é‡æ¯”ä¸Šå¹´æé«˜äº†1.2ä¸ªç™¾åˆ†ç‚¹ã€‚é—®2022å¹´è¯¥å¸‚ç¬¬ä¸‰äº§ä¸šå¢åŠ å€¼çº¦ä¸ºå¤šå°‘äº¿å…ƒï¼Ÿ',
                    options: ['A. 2180', 'B. 2280', 'C. 2380', 'D. 2480'],
                    correct: 1,
                    explanation: '2022å¹´GDP=5000Ã·1.085â‰ˆ4608äº¿å…ƒï¼›2023å¹´ç¬¬ä¸‰äº§ä¸šå æ¯”=2800Ã·5000=56%ï¼›2022å¹´å æ¯”=56%-1.2%=54.8%ï¼›2022å¹´ç¬¬ä¸‰äº§ä¸š=4608Ã—54.8%â‰ˆ2525äº¿å…ƒï¼Œæœ€æ¥è¿‘Bé€‰é¡¹ã€‚'
                },
                {
                    id: 'Q006', type: 'ç”³è®º', category: 'è´¯å½»æ‰§è¡Œ',
                    question: 'å‡å¦‚ä½ æ˜¯æŸè¡—é“åŠäº‹å¤„å·¥ä½œäººå‘˜ï¼Œéœ€è¦èµ·è‰ä¸€ä»½å…³äº"åƒåœ¾åˆ†ç±»å®£ä¼ æ´»åŠ¨"çš„é€šçŸ¥ï¼Œä½ è®¤ä¸ºæœ€é‡è¦çš„è¦ç´ æ˜¯ï¼š',
                    options: ['A. æ´»åŠ¨æ—¶é—´ã€åœ°ç‚¹ã€å‚ä¸äººå‘˜', 'B. æ´»åŠ¨èƒŒæ™¯ã€æ„ä¹‰ã€é¢„æœŸæ•ˆæœ', 'C. æ´»åŠ¨å†…å®¹ã€æ–¹å¼ã€æ³¨æ„äº‹é¡¹', 'D. ä»¥ä¸Šéƒ½å¾ˆé‡è¦ï¼Œéœ€è¦å…¨é¢è€ƒè™‘'],
                    correct: 3,
                    explanation: 'å…¬æ–‡å†™ä½œéœ€è¦è¦ç´ é½å…¨ï¼Œæ—¶é—´åœ°ç‚¹ã€èƒŒæ™¯æ„ä¹‰ã€å†…å®¹æ–¹å¼ç­‰éƒ½æ˜¯å¿…è¦ç»„æˆéƒ¨åˆ†ã€‚'
                },
                {
                    id: 'Q007', type: 'è¡Œæµ‹', category: 'å¸¸è¯†åˆ¤æ–­',
                    question: 'ä¸‹åˆ—å…³äºæˆ‘å›½åŸºæœ¬å›½æƒ…çš„è¡¨è¿°ï¼Œæ­£ç¡®çš„æ˜¯ï¼š',
                    options: ['A. æˆ‘å›½æ˜¯ä¸–ç•Œä¸Šæœ€å¤§çš„å‘å±•ä¸­å›½å®¶', 'B. æˆ‘å›½å·²ç»è¿›å…¥å‘è¾¾å›½å®¶è¡Œåˆ—', 'C. æˆ‘å›½äººå‡GDPå·²è¶…è¿‡ç¾å›½', 'D. æˆ‘å›½åŸé•‡åŒ–ç‡å·²è¾¾åˆ°90%'],
                    correct: 0,
                    explanation: 'æˆ‘å›½ä»ç„¶æ˜¯ä¸–ç•Œä¸Šæœ€å¤§çš„å‘å±•ä¸­å›½å®¶ï¼Œè¿™æ˜¯æˆ‘å›½çš„åŸºæœ¬å›½æƒ…ã€‚'
                },
                {
                    id: 'Q008', type: 'è¡Œæµ‹', category: 'æ•°é‡å…³ç³»',
                    question: 'ä¸€ä¸ªæ­£æ–¹å½¢çš„è¾¹é•¿å¢åŠ 20%ï¼Œé‚£ä¹ˆå®ƒçš„é¢ç§¯å¢åŠ äº†ï¼š',
                    options: ['A. 20%', 'B. 40%', 'C. 44%', 'D. 48%'],
                    correct: 2,
                    explanation: 'è®¾åŸè¾¹é•¿ä¸ºaï¼Œé¢ç§¯ä¸ºaÂ²ï¼›æ–°è¾¹é•¿ä¸º1.2aï¼Œé¢ç§¯ä¸º(1.2a)Â²=1.44aÂ²ï¼›é¢ç§¯å¢åŠ 44%ã€‚'
                }
            ],
            // é¢è¯•é¢˜åº“
            interviewQuestions: [
                {
                    id: 'I001', type: 'ç»¼åˆåˆ†æ',
                    question: 'æœ‰äººè¯´"90åã€95åæ˜¯å®æ‰çš„ä¸€ä»£"ï¼Œä¹Ÿæœ‰äººè¯´"90åã€95åæ˜¯æœ€æœ‰å¸Œæœ›çš„ä¸€ä»£"ã€‚ä½ æ€ä¹ˆçœ‹ï¼Ÿ',
                    keyPoints: ['å®¢è§‚åˆ†æ', 'ç»“åˆå®é™…', 'ä½“ç°ä»·å€¼è§‚', 'é€»è¾‘æ¸…æ™°'],
                    difficulty: 2
                },
                {
                    id: 'I002', type: 'è®¡åˆ’ç»„ç»‡',
                    question: 'å•ä½è¦ç»„ç»‡ä¸€æ¬¡"é’å¹´å¹²éƒ¨åº§è°ˆä¼š"ï¼Œå¦‚æœè®©ä½ è´Ÿè´£ç­¹å¤‡å·¥ä½œï¼Œä½ ä¼šæ€ä¹ˆåšï¼Ÿ',
                    keyPoints: ['å‰æœŸè°ƒç ”', 'æ–¹æ¡ˆåˆ¶å®š', 'ç»„ç»‡å®æ–½', 'æ€»ç»“åé¦ˆ'],
                    difficulty: 1
                },
                {
                    id: 'I003', type: 'åº”æ€¥åº”å˜',
                    question: 'ä½ åœ¨çª—å£æœåŠ¡æ—¶ï¼Œé‡åˆ°ä¸€ä½è€äººä¸ä¼šä½¿ç”¨æ™ºèƒ½æ‰‹æœºåŠç†ä¸šåŠ¡ï¼Œéå¸¸ç€æ€¥ï¼Œç°åœºè¿˜æœ‰å¾ˆå¤šäººæ’é˜Ÿç­‰å€™ã€‚ä½ æ€ä¹ˆåŠï¼Ÿ',
                    keyPoints: ['å®‰æŠšæƒ…ç»ª', 'æä¾›å¸®åŠ©', 'å…¼é¡¾æ•ˆç‡', 'é•¿è¿œè€ƒè™‘'],
                    difficulty: 2
                },
                {
                    id: 'I004', type: 'äººé™…æ²Ÿé€š',
                    question: 'ä½ æ˜¯æ–°å…¥èŒçš„å…¬åŠ¡å‘˜ï¼Œå‘ç°åŒäº‹å·¥ä½œæ–¹å¼æ¯”è¾ƒä¼ ç»Ÿï¼Œè€Œä½ æƒ³æ¨è¿›ä¸€äº›æ–°çš„å·¥ä½œæ–¹æ³•ï¼Œä½†é­åˆ°äº†ä¸€äº›é˜»åŠ›ã€‚ä½ ä¼šæ€ä¹ˆå¤„ç†ï¼Ÿ',
                    keyPoints: ['ç†è§£åŒ…å®¹', 'æ²Ÿé€šåè°ƒ', 'å¾ªåºæ¸è¿›', 'æ±‚åŒå­˜å¼‚'],
                    difficulty: 3
                },
                {
                    id: 'I005', type: 'ç»¼åˆåˆ†æ',
                    question: 'å½“å‰"å†…å·"ç°è±¡åœ¨èŒåœºä¸­æ¯”è¾ƒæ™®éï¼Œæœ‰äººè®¤ä¸ºè¿™æ˜¯ç«äº‰æ¿€çƒˆçš„è¡¨ç°ï¼Œä¹Ÿæœ‰äººè®¤ä¸ºè¿™æ˜¯ä¸€ç§æ¶æ€§ç«äº‰ã€‚ä½ æ€ä¹ˆçœ‹ï¼Ÿ',
                    keyPoints: ['ç†è§£å†…å·å«ä¹‰', 'åˆ†æäº§ç”ŸåŸå› ', 'å®¢è§‚è¯„ä»·å½±å“', 'æå‡ºåº”å¯¹å»ºè®®'],
                    difficulty: 3
                },
                {
                    id: 'I006', type: 'è®¡åˆ’ç»„ç»‡',
                    question: 'ä½ æ‰€åœ¨çš„ç¤¾åŒºè¦å¼€å±•"åƒåœ¾åˆ†ç±»"å®£ä¼ æ´»åŠ¨ï¼Œä½†å±…æ°‘å‚ä¸åº¦ä¸é«˜ï¼Œé¢†å¯¼å®‰æ’ä½ é‡æ–°ç­–åˆ’ï¼Œä½ ä¼šæ€ä¹ˆåšï¼Ÿ',
                    keyPoints: ['åˆ†æé—®é¢˜åŸå› ', 'åˆ›æ–°å®£ä¼ æ–¹å¼', 'æé«˜å‚ä¸åº¦', 'ç¡®ä¿æ´»åŠ¨æ•ˆæœ'],
                    difficulty: 2
                },
                {
                    id: 'I007', type: 'åº”æ€¥åº”å˜',
                    question: 'ä½ åœ¨çª—å£æœåŠ¡æ—¶ï¼Œé‡åˆ°ä¸€ä½è€äººå› ä¸ºä¸ä¼šä½¿ç”¨æ™ºèƒ½æ‰‹æœºåŠç†ä¸šåŠ¡è€Œæƒ…ç»ªæ¿€åŠ¨ï¼Œå¤§å£°æŠ±æ€¨ç°åœ¨åŠäº‹å¤ªå¤æ‚ï¼Œå‘¨å›´ç¾¤ä¼—å¼€å§‹å›´è§‚ã€‚ä½ ä¼šæ€ä¹ˆå¤„ç†ï¼Ÿ',
                    keyPoints: ['å®‰æŠšæƒ…ç»ª', 'è€å¿ƒè§£é‡Š', 'æä¾›å¸®åŠ©', 'ç»´æŠ¤ç§©åº'],
                    difficulty: 2
                },
                {
                    id: 'I008', type: 'å²—ä½åŒ¹é…',
                    question: 'å…¬åŠ¡å‘˜å·¥ä½œç›¸å¯¹ç¨³å®šï¼Œä½†æ”¶å…¥ä¸å¦‚ä¸€äº›ä¼ä¸šé«˜ï¼Œä½ ä¸ºä»€ä¹ˆè¿˜è¦é€‰æ‹©å…¬åŠ¡å‘˜è¿™ä¸ªèŒä¸šï¼Ÿ',
                    keyPoints: ['æ˜ç¡®èŒä¸šç†æƒ³', 'ä½“ç°ä»·å€¼è¿½æ±‚', 'å±•ç°æœåŠ¡æ„è¯†', 'è¡¨è¾¾åšå®šå†³å¿ƒ'],
                    difficulty: 1
                },
                {
                    id: 'I009', type: 'ç»¼åˆåˆ†æ',
                    question: 'è¿‘å¹´æ¥ï¼Œä¸€äº›åœ°æ–¹å‡ºç°äº†"èººå¹³å¼"å¹²éƒ¨ï¼Œå·¥ä½œä¸ä¸»åŠ¨ã€ä¸ä½œä¸ºã€‚ä½ è®¤ä¸ºåº”è¯¥å¦‚ä½•è§£å†³è¿™ä¸ªé—®é¢˜ï¼Ÿ',
                    keyPoints: ['åˆ†æé—®é¢˜æ ¹æº', 'æå‡ºè§£å†³æªæ–½', 'å®Œå–„åˆ¶åº¦æœºåˆ¶', 'åŠ å¼ºç›‘ç£ç®¡ç†'],
                    difficulty: 3
                },
                {
                    id: 'I010', type: 'äººé™…æ²Ÿé€š',
                    question: 'ä½ åˆšåˆ°æ–°å•ä½å·¥ä½œï¼Œå‘ç°åŒäº‹å°ç‹æ€»æ˜¯å¯¹ä½ çˆ±ç†ä¸ç†ï¼Œç”šè‡³åœ¨å·¥ä½œä¸Šä¸é…åˆã€‚ä½ è®¤ä¸ºå¯èƒ½æ˜¯ä»€ä¹ˆåŸå› ï¼Ÿä½ ä¼šæ€ä¹ˆå¤„ç†ï¼Ÿ',
                    keyPoints: ['åˆ†æåŸå› ', 'ä¸»åŠ¨æ²Ÿé€š', 'æ¢ä½æ€è€ƒ', 'å»ºç«‹å…³ç³»'],
                    difficulty: 2
                }
            ],
            // äº‹ä»¶åº“ï¼šè¿™æ˜¯æ¸¸æˆçš„æ ¸å¿ƒé©±åŠ¨åŠ›
            events: [
                // ========== å¤‡è€ƒé˜¶æ®µ ==========
                {
                    id: 'E001', stage: 'ç¬”è¯•å¤‡è€ƒ', trigger: () => true, unique: true, important: true,
                    title: 'é€‰å²—çš„ç»ˆæçº ç»“',
                    description: 'ç½‘ä¸Šé“ºå¤©ç›–åœ°çš„ä¿¡æ¯è®©ä½ çœ¼èŠ±ç¼­ä¹±ï¼šå›½è€ƒéš¾åº¦å¤§ä½†å²—ä½å¥½ã€çœè€ƒç›¸å¯¹ç®€å•ã€äº‹ä¸šå•ä½ç¨³å®šã€ä¸‰æ”¯ä¸€æ‰¶èƒ½åŠ åˆ†...æœ‹å‹åœˆé‡Œæœ‰äººæ™’ä¸Šå²¸ï¼Œæœ‰äººåæ§½996ã€‚ä½ çš„å†…å¿ƒå¼€å§‹äº†æ¿€çƒˆçš„æ–—äº‰ã€‚',
                    choices: [
                        { 
                            text: 'å›½è€ƒï¼ä¸€æ­¥åˆ°ä½ï¼ŒæŒ‘æˆ˜æœ€é«˜éš¾åº¦', 
                            personality: { innovative: 2, studious: 1 },
                            consequence: { 
                                stats: { decision: 2, resilience: 1 }, 
                                log: 'ä½ é€‰æ‹©äº†å›½è€ƒï¼è™½ç„¶ç«äº‰æ¿€çƒˆï¼Œä½†ä¸­å¤®éƒ¨é—¨çš„å¸å¼•åŠ›è®©ä½ å†³å¿ƒä¸€æã€‚',
                                selectedPath: 'nationalExam'
                            }
                        },
                        { 
                            text: 'çœè€ƒæ¯”è¾ƒç¨³å¦¥ï¼Œç¦»å®¶è¿‘å‘å±•ä¹Ÿä¸é”™', 
                            personality: { cautious: 2, traditional: 1 },
                            consequence: { 
                                stats: { resilience: 2, communication: 1 }, 
                                log: 'ä½ é€‰æ‹©äº†çœè€ƒã€‚åœ¨å®¶ä¹¡å·¥ä½œï¼Œæ—¢èƒ½ç…§é¡¾å®¶äººï¼Œå‘å±•å‰æ™¯ä¹Ÿå¾ˆå¥½ã€‚',
                                selectedPath: 'provincialExam'
                            }
                        },
                        { 
                            text: 'äº‹ä¸šå•ä½å·¥ä½œç”Ÿæ´»å¹³è¡¡ï¼Œé€‚åˆæˆ‘', 
                            personality: { cautious: 1, social: 1 },
                            consequence: { 
                                stats: { resilience: 3 }, 
                                log: 'ä½ é€‰æ‹©äº†äº‹ä¸šå•ä½è€ƒè¯•ã€‚ç›¸å¯¹è½»æ¾çš„å·¥ä½œèŠ‚å¥å¾ˆé€‚åˆä½ çš„äººç”Ÿè§„åˆ’ã€‚',
                                selectedPath: 'institutionExam'
                            }
                        },
                        { 
                            text: 'å…ˆè€ƒä¸‰æ”¯ä¸€æ‰¶ç§¯ç´¯ç»éªŒï¼Œå†è€ƒå…¬åŠ¡å‘˜', 
                            personality: { innovative: 1, social: 2 },
                            consequence: { 
                                stats: { learning: 2, communication: 2 }, 
                                log: 'ä½ é€‰æ‹©äº†ä¸‰æ”¯ä¸€æ‰¶é¡¹ç›®ã€‚è™½ç„¶è¾›è‹¦ï¼Œä½†åŸºå±‚ç»éªŒå¯¹æœªæ¥å¾ˆæœ‰å¸®åŠ©ã€‚',
                                selectedPath: 'grassrootsProgram'
                            }
                        }
                    ]
                },
                // é€‰å…·ä½“èŒä½äº‹ä»¶
                {
                    id: 'E001_FOLLOW', stage: 'ç¬”è¯•å¤‡è€ƒ', trigger: (gs) => gs.selectedPath && !gs.jobLocation && gs.time.days > 5, unique: true, important: true,
                    title: 'å…·ä½“èŒä½çš„é€‰æ‹©å›°éš¾ç—‡',
                    description: 'ç¡®å®šäº†è€ƒè¯•ç±»å‹åï¼Œç°åœ¨è¦é€‰å…·ä½“èŒä½äº†ã€‚æ‰“å¼€èŒä½è¡¨ï¼Œå¯†å¯†éº»éº»çš„ä¿¡æ¯è®©ä½ çœ¼èŠ±ç¼­ä¹±ï¼šæœ‰çš„åœ¨åŒ—äº¬ä½†è¦æ±‚å·¥ä½œç»éªŒï¼Œæœ‰çš„åœ¨è€å®¶ä½†æ˜¯å†·é—¨éƒ¨é—¨ï¼Œæœ‰çš„è–ªèµ„é«˜ä½†åœ¨è¥¿éƒ¨åè¿œåœ°åŒº...',
                    choices: [
                        {
                            text: 'é€‰æ‹©åŒ—äº¬/ä¸€çº¿åŸå¸‚å²—ä½ï¼Œæ‹¼ä¸€æŠŠ',
                            personality: { innovative: 2, rebellious: 1 },
                            consequence: {
                                stats: { decision: 2, resilience: -1 },
                                influence: 5,
                                log: 'ä½ é€‰æ‹©äº†åŒ—äº¬çš„æŸéƒ¨å§”å²—ä½ã€‚è™½ç„¶ç«äº‰æ¿€çƒˆï¼Œä½†ä¸€çº¿åŸå¸‚çš„å‘å±•æœºä¼šæ›´å¤šã€‚',
                                jobLocation: 'first_tier',
                                permanentChoices: { locationPreference: 'first_tier' }
                            }
                        },
                        {
                            text: 'å›è€å®¶å·¥ä½œï¼Œç¦»çˆ¶æ¯è¿‘ä¸€äº›',
                            personality: { traditional: 2, cautious: 1 },
                            consequence: {
                                stats: { resilience: 2, communication: 1 },
                                influence: 3,
                                log: 'ä½ é€‰æ‹©äº†å®¶ä¹¡çš„æ”¿åºœéƒ¨é—¨ã€‚è™½ç„¶å‘å±•ç©ºé—´æœ‰é™ï¼Œä½†èƒ½ç…§é¡¾å®¶äººã€‚',
                                jobLocation: 'hometown',
                                permanentChoices: { locationPreference: 'hometown' }
                            }
                        },
                        {
                            text: 'é€‰æ‹©è¥¿éƒ¨åœ°åŒºï¼Œæœ‰åœ°åŸŸåŠ åˆ†',
                            personality: { innovative: 1, social: 2 },
                            consequence: {
                                stats: { learning: 2, resilience: 2 },
                                influence: 8,
                                log: 'ä½ é€‰æ‹©äº†è¥¿éƒ¨æŸçœçš„èŒä½ã€‚è™½ç„¶æ¡ä»¶è‰°è‹¦ï¼Œä½†æœ‰åŠ åˆ†æ”¿ç­–å’Œå¿«é€Ÿæ™‹å‡æœºä¼šã€‚',
                                jobLocation: 'western',
                                permanentChoices: { locationPreference: 'western' }
                            }
                        },
                        {
                            text: 'ä¸“æŒ‘é—¨æ§›ä½çš„å²—ä½ï¼Œå…ˆä¸Šå²¸å†è¯´',
                            personality: { cautious: 2 },
                            consequence: {
                                stats: { decision: -1, resilience: 1 },
                                influence: 2,
                                log: 'ä½ é€‰æ‹©äº†è¦æ±‚ç›¸å¯¹è¾ƒä½çš„å²—ä½ã€‚è™½ç„¶ä¸æ˜¯ç†æƒ³é€‰æ‹©ï¼Œä½†ä¸Šå²¸æ¦‚ç‡æ›´å¤§ã€‚',
                                jobLocation: 'conservative',
                                permanentChoices: { locationPreference: 'conservative' }
                            }
                        }
                    ]
                },
                // è¯¦ç»†èŒä½é€‰æ‹©çš„ç°å®å›°å¢ƒ
                {
                    id: 'E001_DETAIL', stage: 'ç¬”è¯•å¤‡è€ƒ', trigger: (gs) => gs.jobLocation && !gs.jobType && gs.time.days > 20, unique: true, important: true,
                    title: 'èŒä½ç»†èŠ‚çš„è‰°éš¾æŠ‰æ‹©',
                    description: 'ä½ çœ‹ä¸­äº†å‡ ä¸ªå…·ä½“èŒä½ï¼Œä½†æ¯ä¸ªéƒ½æœ‰è®©äººçº ç»“çš„åœ°æ–¹ã€‚è¿™ä¸ªé€‰æ‹©å°†å½±å“ä½ æœªæ¥å‡ å¹´ç”šè‡³ä¸€ç”Ÿçš„è½¨è¿¹...',
                    choices: [
                        {
                            text: 'ç¨åŠ¡å±€ï¼šè–ªèµ„é«˜ä½†å·¥ä½œå‹åŠ›å¤§ï¼Œç»å¸¸åŠ ç­',
                            personality: { studious: 1, resilience: 1 },
                            consequence: {
                                stats: { professional: 2, resilience: -1 },
                                influence: 6,
                                log: 'ç¨åŠ¡å·¥ä½œè™½ç„¶è¾›è‹¦ï¼Œä½†æ”¶å…¥ç¨³å®šï¼Œä¸“ä¸šæ€§å¼ºã€‚ä½ å†³å®šæŒ‘æˆ˜é«˜å¼ºåº¦å·¥ä½œã€‚',
                                jobType: 'tax_bureau',
                                permanentChoices: { jobType: 'tax_bureau' },
                                triggerEvent: 'TAX_FOLLOW'
                            }
                        },
                        {
                            text: 'æ•™è‚²å±€ï¼šå·¥ä½œç¨³å®šä½†è–ªèµ„ä¸€èˆ¬ï¼Œå‡æœŸå¤š',
                            personality: { social: 2, traditional: 1 },
                            consequence: {
                                stats: { communication: 2, resilience: 2 },
                                influence: 4,
                                log: 'æ•™è‚²ç³»ç»Ÿå·¥ä½œè§„å¾‹ï¼Œå‡æœŸå……è¶³ï¼Œé€‚åˆå¹³è¡¡å·¥ä½œç”Ÿæ´»ã€‚',
                                jobType: 'education_bureau',
                                permanentChoices: { jobType: 'education_bureau' }
                            }
                        },
                        {
                            text: 'åº”æ€¥ç®¡ç†å±€ï¼šæ–°å…´éƒ¨é—¨å‘å±•å¿«ï¼Œä½†é£é™©å¤§',
                            personality: { innovative: 2, rebellious: 1 },
                            consequence: {
                                stats: { decision: 3, learning: 2 },
                                influence: 8,
                                log: 'æ–°éƒ¨é—¨æ„å‘³ç€æ›´å¤šæœºä¼šï¼Œä½†ä¹Ÿé¢ä¸´æ›´å¤šä¸ç¡®å®šæ€§ã€‚ä½ é€‰æ‹©æ‹¥æŠ±å˜åŒ–ã€‚',
                                jobType: 'emergency_mgmt',
                                permanentChoices: { jobType: 'emergency_mgmt' }
                            }
                        },
                        {
                            text: 'è¡—é“åŠï¼šåŸºå±‚å·¥ä½œæ¥åœ°æ°”ï¼Œä½†æ™‹å‡ç©ºé—´æœ‰é™',
                            personality: { social: 3, traditional: 1 },
                            consequence: {
                                stats: { communication: 3, resilience: 1 },
                                influence: 3,
                                log: 'åŸºå±‚å·¥ä½œè®©ä½ ç›´æ¥æœåŠ¡ç¾¤ä¼—ï¼Œè™½ç„¶è¾›è‹¦ä½†å¾ˆæœ‰æ„ä¹‰ã€‚',
                                jobType: 'subdistrict_office',
                                permanentChoices: { jobType: 'subdistrict_office' }
                            }
                        }
                    ]
                },
                {
                    id: 'TAX_FOLLOW', stage: 'ç¬”è¯•å¤‡è€ƒ', trigger: (gs) => gs.jobType === 'tax_bureau' && !gs.eventHistory.includes('TAX_FOLLOW'), unique: true, important: true,
                    title: 'ç¨åŠ¡å±€çš„é¢å¤–æŒ‘æˆ˜',
                    description: 'é€‰æ‹©ç¨åŠ¡å±€åï¼Œä½ äº†è§£åˆ°æ›´å¤šå†…æƒ…ï¼šè¿™ä¸ªå²—ä½éœ€è¦ç»å¸¸å‡ºå·®æ£€æŸ¥ä¼ä¸šï¼Œå·¥ä½œå¼ºåº¦å¾ˆå¤§ï¼Œä½†ä¸“ä¸šèƒ½åŠ›æå‡å¾ˆå¿«ï¼Œè€Œä¸”æœ‰ä¸å°‘åŒé¾„äºº...',
                    choices: [
                        {
                            text: 'æ¥å—æŒ‘æˆ˜ï¼Œæ‹¼äº‹ä¸šå‘å±•',
                            personality: { studious: 2, innovative: 1 },
                            consequence: {
                                stats: { professional: 3, learning: 2, resilience: -1 },
                                influence: 10,
                                log: 'ä½ å†³å¿ƒåœ¨ç¨åŠ¡é¢†åŸŸæ·±è€•ï¼Œè™½ç„¶å‹åŠ›å¤§ä½†æˆé•¿ç©ºé—´å¹¿é˜”ã€‚',
                                achievement: 'CAREER_FOCUSED'
                            }
                        },
                        {
                            text: 'é‡æ–°è€ƒè™‘ï¼Œæ¢ä¸ªè½»æ¾çš„å²—ä½',
                            personality: { cautious: 2 },
                            consequence: {
                                stats: { decision: -1, resilience: 2 },
                                influence: 2,
                                log: 'ä½ è§‰å¾—ç”Ÿæ´»è´¨é‡æ›´é‡è¦ï¼Œå†³å®šé‡æ–°é€‰æ‹©ç›¸å¯¹è½»æ¾çš„å²—ä½ã€‚',
                                jobType: 'education_bureau'
                            }
                        }
                    ]
                },
                // è–ªèµ„vså‘å±•çš„å…·ä½“å†²çª
                {
                    id: 'SALARY_DILEMMA', stage: 'ç¬”è¯•å¤‡è€ƒ', trigger: (gs) => gs.jobType && gs.time.days > 35, unique: true, important: true,
                    title: 'è–ªèµ„ä¸å‘å±•çš„ä¸¤éš¾é€‰æ‹©',
                    description: 'ä½ åŒæ—¶æ”¶åˆ°äº†ä¸¤ä¸ªå²—ä½çš„æ„å‘ï¼šä¸€ä¸ªæ˜¯å¸‚ä¸­å¿ƒæŸå§”åŠå±€çš„ç§‘å‘˜ï¼Œè–ªèµ„é«˜ä½†æ™‹å‡æ…¢ï¼›å¦ä¸€ä¸ªæ˜¯æ–°åŒºç®¡å§”ä¼šçš„ä¸»ä»»ç§‘å‘˜ï¼Œè–ªèµ„ä¸€èˆ¬ä½†å‘å±•å‰æ™¯å¥½ã€‚æœ‹å‹ä»¬æ„è§ä¸ä¸€...',
                    choices: [
                        {
                            text: 'é€‰é«˜è–ªå²—ä½ï¼Œå…ˆè§£å†³ç”Ÿæ´»é—®é¢˜',
                            personality: { cautious: 2, traditional: 1 },
                            consequence: {
                                stats: { resilience: 2, professional: 1 },
                                influence: 5,
                                log: 'ä½ è§‰å¾—ç»æµåŸºç¡€å†³å®šä¸Šå±‚å»ºç­‘ï¼Œå…ˆæœ‰ç¨³å®šæ”¶å…¥å†è°ˆå‘å±•ã€‚',
                                jobSalary: 'high',
                                buff: { name: 'ç»æµç¨³å®š', duration: 15, effect: 'financial_stability' }
                            }
                        },
                        {
                            text: 'é€‰å‘å±•å²—ä½ï¼Œç€çœ¼é•¿è¿œæœªæ¥',
                            personality: { innovative: 2, rebellious: 1 },
                            consequence: {
                                stats: { decision: 3, learning: 2 },
                                influence: 8,
                                log: 'ä½ é€‰æ‹©æŠ•èµ„æœªæ¥ï¼Œç›¸ä¿¡æ–°åŒºçš„å‘å±•æ½œåŠ›å’Œæ™‹å‡æœºä¼šã€‚',
                                jobProspects: 'high',
                                buff: { name: 'å‘å±•æ½œåŠ›', duration: 20, effect: 'career_growth' }
                            }
                        },
                        {
                            text: 'ç»§ç»­è§‚æœ›ï¼Œå¯»æ‰¾æ›´å¥½æœºä¼š',
                            personality: { cautious: 1 },
                            consequence: {
                                stats: { decision: -1, resilience: -1 },
                                influence: 1,
                                log: 'ä½ å†³å®šå†ç­‰ç­‰ï¼Œä½†æœºä¼šç¨çºµå³é€ï¼Œå¯èƒ½ä¼šé”™è¿‡å¥½å²—ä½ã€‚',
                                debuff: { name: 'æœºä¼šæˆæœ¬', duration: 10, effect: 'opportunity_cost' }
                            }
                        }
                    ]
                },
                // å·¥ä½œåœ°ç‚¹çš„å®¶åº­è€ƒé‡
                {
                    id: 'FAMILY_LOCATION', stage: 'ç¬”è¯•å¤‡è€ƒ', trigger: (gs) => gs.time.days > 50 && !gs.eventHistory.includes('FAMILY_LOCATION'), unique: true, important: true,
                    title: 'å®¶åº­å› ç´ çš„ç°å®è€ƒé‡',
                    description: 'å°±åœ¨ä½ å‡†å¤‡æœ€ç»ˆç¡®å®šèŒä½æ—¶ï¼Œå®¶é‡Œä¼ æ¥æ¶ˆæ¯ï¼šå¥¶å¥¶èº«ä½“ä¸å¥½éœ€è¦äººç…§é¡¾ï¼Œå¥³æœ‹å‹ä¹Ÿå¸Œæœ›ä½ ç•™åœ¨æœ¬åœ°å‘å±•ã€‚ä½†ä½ å¿ƒä»ªçš„å²—ä½åœ¨å¤–åœ°ï¼Œè¿™è®©ä½ é™·å…¥æ·±æ·±çš„çº ç»“...',
                    choices: [
                        {
                            text: 'ç•™åœ¨æœ¬åœ°ï¼Œç…§é¡¾å®¶åº­',
                            personality: { traditional: 3, social: 2 },
                            consequence: {
                                stats: { communication: 3, resilience: 1 },
                                influence: 4,
                                log: 'å®¶äººæœ€é‡è¦ï¼Œä½ å†³å®šç•™åœ¨æœ¬åœ°ï¼Œæ‰¿æ‹…èµ·å®¶åº­è´£ä»»ã€‚',
                                familyChoice: 'local',
                                achievement: 'FAMILY_FIRST'
                            }
                        },
                        {
                            text: 'è¿½æ±‚æ¢¦æƒ³ï¼Œå¼‚åœ°å‘å±•',
                            personality: { innovative: 2, rebellious: 2 },
                            consequence: {
                                stats: { decision: 3, resilience: -2 },
                                influence: 10,
                                log: 'ä½ é€‰æ‹©è¿½æ±‚äº‹ä¸šç†æƒ³ï¼Œè™½ç„¶ç¦»å®¶è¿œä½†æœºä¼šæ›´å¥½ã€‚',
                                familyChoice: 'distant',
                                debuff: { name: 'æ€ä¹¡ä¹‹è‹¦', duration: 12, effect: 'homesickness' }
                            }
                        },
                        {
                            text: 'å¯»æ±‚å¹³è¡¡ï¼Œå°±è¿‘é€‰æ‹©ç¨å¥½çš„å²—ä½',
                            personality: { cautious: 2, social: 1 },
                            consequence: {
                                stats: { decision: 1, communication: 2 },
                                influence: 6,
                                log: 'ä½ åœ¨å®¶åº­å’Œäº‹ä¸šé—´æ‰¾åˆ°å¹³è¡¡ç‚¹ï¼Œé€‰æ‹©äº†è·ç¦»é€‚ä¸­çš„å²—ä½ã€‚',
                                familyChoice: 'balanced'
                            }
                        }
                    ]
                },
                {
                    id: 'E002', stage: 'ç¬”è¯•å¤‡è€ƒ', trigger: (gs) => gs.selectedPath, unique: true,
                    title: 'åˆ¶å®šå­¦ä¹ è®¡åˆ’',
                    description: 'è·ç¦»ç¬”è¯•è¿˜æœ‰3ä¸ªæœˆï¼Œæ—¶é—´ç´§è¿«ã€‚é¢å¯¹åšåšçš„å¤ä¹ èµ„æ–™ï¼Œä½ å†³å®šåˆ¶å®šä¸€ä¸ªå­¦ä¹ è®¡åˆ’ã€‚',
                    choices: [
                        { text: 'ç§‘å­¦è§„åˆ’ï¼ŒåŠ³é€¸ç»“åˆ', consequence: { stats: { learning: 3, resilience: 2 }, log: 'ä½ åˆ¶å®šäº†è¯¦ç»†çš„è®¡åˆ’ï¼Œå¹¶åšæŒæ‰§è¡Œï¼Œæ„Ÿè§‰å¾ˆæœ‰æ¡ç†ã€‚' } },
                        { text: 'é¢˜æµ·æˆ˜æœ¯ï¼Œæ‹¼å‘½åˆ·é¢˜', consequence: { stats: { professional: 3, resilience: -1 }, log: 'ä½ ç–¯ç‹‚åˆ·é¢˜ï¼Œè™½ç„¶å¾ˆç´¯ï¼Œä½†æ„Ÿè§‰ä¸“ä¸šçŸ¥è¯†æ›´æ‰å®äº†ã€‚' } },
                        { text: 'éšç¼˜å¤ä¹ ï¼Œé‡åœ¨å‚ä¸', consequence: { stats: { resilience: 3, professional: -2 }, log: 'ä½ å¿ƒæ€å¾ˆå¥½ï¼Œå†³å®šä½›ç³»å¤‡è€ƒï¼Œå‹åŠ›å°äº†å¾ˆå¤šã€‚' } }
                    ]
                },
                {
                    id: 'E012', stage: 'ç¬”è¯•å¤‡è€ƒ', trigger: (gs) => gs.time.days > 15, unique: true,
                    title: 'å¿ƒæ€æ³¢åŠ¨',
                    description: 'å¤ä¹ é‡åˆ°äº†ç“¶é¢ˆï¼Œä¸€é“éš¾é¢˜è®©ä½ ç™¾æ€ä¸å¾—å…¶è§£ï¼Œä½ æ„Ÿåˆ°æœ‰äº›ç„¦è™‘ã€‚',
                    choices: [
                        { text: 'å‘è®ºå›å¤§ç¥è¯·æ•™', consequence: { stats: { communication: 2, professional: 2 }, log: 'ä½ åœ¨è®ºå›å‘å¸–æ±‚åŠ©ï¼Œå¾ˆå¿«å¾—åˆ°äº†è§£ç­”ï¼ŒèŒ…å¡é¡¿å¼€ã€‚' } },
                        { text: 'å‡ºå»è¿åŠ¨ï¼Œæ”¾æ¾ä¸€ä¸‹', consequence: { stats: { resilience: 2 }, log: 'ä½ é€‰æ‹©å»è·‘æ­¥ï¼Œå¤§æ±—æ·‹æ¼“åï¼Œå¿ƒæƒ…èˆ’ç•…å¤šäº†ã€‚' } },
                        { text: 'ç¡¬ç€å¤´çš®ç»§ç»­é’»ç ”', consequence: { stats: { learning: 2, resilience: -1 }, log: 'ä½ èŠ±äº†å¾ˆé•¿æ—¶é—´ç»ˆäºææ‡‚äº†ï¼Œä½†æ„Ÿè§‰èº«å¿ƒä¿±ç–²ã€‚' } }
                    ]
                },
                {
                    id: 'E003', stage: 'ç¬”è¯•å¤‡è€ƒ', trigger: (gs) => gs.time.days > 30, unique: true,
                    title: 'æ¨¡æ‹Ÿè€ƒè¯•',
                    description: 'åŸ¹è®­æœºæ„ç»„ç»‡äº†ä¸€æ¬¡æ¨¡æ‹Ÿè€ƒè¯•ï¼Œä½ çš„æˆç»©ä¸å¤ªç†æƒ³ï¼Œæ’åé åã€‚',
                    choices: [
                        { text: 'åˆ†æé”™é¢˜ï¼ŒæŸ¥æ¼è¡¥ç¼º', consequence: { stats: { professional: 2, learning: 1 }, log: 'ä½ ä»”ç»†åˆ†æäº†æ¯é“é”™é¢˜ï¼Œå‘ç°äº†è‡ªå·±çš„è–„å¼±ç¯èŠ‚ã€‚' } },
                        { text: 'è°ƒæ•´å¿ƒæ€ï¼Œç»§ç»­åŠªåŠ›', consequence: { stats: { resilience: 2 }, log: 'ä½ å‘Šè¯‰è‡ªå·±è¿™åªæ˜¯æ¨¡æ‹Ÿè€ƒè¯•ï¼ŒçœŸæ­£çš„è€ƒè¯•è¿˜æ²¡åˆ°ã€‚' } },
                        { text: 'æ€€ç–‘è‡ªå·±ï¼Œè€ƒè™‘æ”¾å¼ƒ', consequence: { stats: { resilience: -2, professional: -1 }, log: 'ä½ å¼€å§‹æ€€ç–‘è‡ªå·±çš„èƒ½åŠ›ï¼Œäº§ç”Ÿäº†æ”¾å¼ƒçš„å¿µå¤´ã€‚' } }
                    ]
                },
                {
                    id: 'E004', stage: 'ç¬”è¯•å¤‡è€ƒ', trigger: (gs) => gs.time.days > 45, unique: true,
                    title: 'å®¶äººçš„å…³å¿ƒ',
                    description: 'å®¶äººçœ‹åˆ°ä½ æ¯å¤©åŸ‹å¤´è‹¦è¯»ï¼Œæ—¢å¿ƒç–¼åˆæ‹…å¿ƒï¼ŒåŠä½ è¦æ³¨æ„èº«ä½“ã€‚',
                    choices: [
                        { text: 'æ„Ÿè°¢å®¶äººï¼Œè°ƒæ•´ä½œæ¯', consequence: { stats: { resilience: 2, communication: 1 }, log: 'ä½ æ„Ÿè°¢å®¶äººçš„å…³å¿ƒï¼Œå¼€å§‹æ›´æ³¨æ„åŠ³é€¸ç»“åˆã€‚' } },
                        { text: 'è¡¨ç¤ºç†è§£ï¼Œä½†åšæŒç°çŠ¶', consequence: { stats: { professional: 1, resilience: -1 }, log: 'ä½ ç†è§£å®¶äººçš„æ‹…å¿ƒï¼Œä½†è§‰å¾—ç°åœ¨ä¸èƒ½æ¾æ‡ˆã€‚' } },
                        { text: 'æœ‰äº›çƒ¦èºï¼Œå¸Œæœ›ä»–ä»¬åˆ«ç®¡', consequence: { stats: { communication: -2 }, log: 'ä½ è§‰å¾—å®¶äººä¸ç†è§£ä½ çš„å‹åŠ›ï¼Œæœ‰äº›çƒ¦èºã€‚' } }
                    ]
                },
                {
                    id: 'E005', stage: 'ç¬”è¯•å¤‡è€ƒ', trigger: (gs) => gs.time.days > 60, unique: true,
                    title: 'æœ‹å‹çš„èšä¼š',
                    description: 'è€åŒå­¦ç»„ç»‡èšä¼šï¼Œé‚€è¯·ä½ å‚åŠ ã€‚ä½ å·²ç»å¾ˆä¹…æ²¡æœ‰æ”¾æ¾è¿‡äº†ã€‚',
                    choices: [
                        { text: 'å‚åŠ èšä¼šï¼Œæ”¾æ¾å¿ƒæƒ…', consequence: { stats: { resilience: 2, communication: 2 }, log: 'ä½ å’Œè€æœ‹å‹ä»¬èŠå¤©ï¼Œå¿ƒæƒ…è½»æ¾äº†å¾ˆå¤šã€‚' } },
                        { text: 'å©‰æ‹’é‚€è¯·ï¼Œç»§ç»­å¤ä¹ ', consequence: { stats: { professional: 2, communication: -1 }, log: 'ä½ è§‰å¾—æ—¶é—´å®è´µï¼Œé€‰æ‹©ç»§ç»­å¤ä¹ ã€‚' } },
                        { text: 'çº ç»“çŠ¹è±«ï¼Œæœ€åæ²¡å»', consequence: { stats: { resilience: -1 }, log: 'ä½ çº ç»“äº†å¾ˆä¹…ï¼Œæœ€åè¿˜æ˜¯æ²¡å»ï¼Œä½†å¿ƒé‡Œæœ‰äº›é—æ†¾ã€‚' } }
                    ]
                },
                {
                    id: 'E006', stage: 'ç¬”è¯•å¤‡è€ƒ', trigger: (gs) => gs.time.days > 25, unique: true,
                    title: 'ğŸ”¥ åå›¾ç›´æ’­é—´çš„è¶…ç¥çº§è®²å¸ˆ',
                    description: 'åå›¾åœ¨çº¿APPæ¨é€ï¼šä»Šæ™š8ç‚¹åå›¾æ•™è‚²é‡‘ç‰Œè®²å¸ˆç›´æ’­ã€Šç”³è®ºé«˜åˆ†ç§˜ç±ã€‹ï¼ä½ çš„å®¤å‹ç–¯ç‹‚æ¨èï¼š"å…„å¼Ÿï¼Œåå›¾è¿™ä¸ªè€å¸ˆå¤ªå¼ºäº†ï¼å»å¹´æˆ‘æœ‹å‹å°±æ˜¯çœ‹ä»–çš„è¯¾ä¸Šå²¸çš„ï¼"å¼¹å¹•å·²ç»æ²¸è…¾äº†...',
                    choices: [
                        { 
                            text: 'ğŸ¯ å†²è¿›ç›´æ’­é—´ï¼Œå‡†å¤‡åšç¬”è®°ï¼', 
                            personality: { studious: 2, innovative: 1 },
                            consequence: { 
                                stats: { learning: 4, professional: 3, communication: 1 }, 
                                examProgress: { practiceTests: 1 },
                                log: 'åå›¾è®²å¸ˆçš„"ä¸‡èƒ½æ¨¡æ¿æ³•"è®©ä½ é†é†çŒé¡¶ï¼ç›´æ’­é—´å­¦åˆ°çš„æŠ€å·§å¤ªå®ç”¨äº†ï¼',
                                achievement: 'HUATU_STUDENT'
                            } 
                        },
                        { 
                            text: 'ğŸ“± å…ˆå…³æ³¨åå›¾è§†é¢‘å·ï¼Œçœ‹å›æ”¾', 
                            personality: { cautious: 1 },
                            consequence: { 
                                stats: { learning: 2, decision: 1 }, 
                                log: 'ä½ å…³æ³¨äº†åå›¾æ•™è‚²è§†é¢‘å·ï¼Œè¯¾ç¨‹å›æ”¾è®©ä½ å¯ä»¥åå¤å­¦ä¹ é‡ç‚¹å†…å®¹ã€‚' 
                            } 
                        },
                        { 
                            text: 'ğŸ˜ ç½‘è¯¾éƒ½æ˜¯å‰²éŸ­èœï¼Œè‡ªå­¦æ›´é¦™', 
                            personality: { rebellious: 2 },
                            consequence: { 
                                stats: { decision: 1, resilience: -1 }, 
                                log: 'ä½ åšæŒè‡ªå­¦ï¼Œä½†åæ¥å‘ç°åå›¾è®²å¸ˆæåˆ°çš„è€ƒç‚¹çœŸçš„è€ƒäº†...æœ‰ç‚¹åæ‚”ã€‚' 
                            } 
                        }
                    ]
                },
                {
                    id: 'E007', stage: 'ç¬”è¯•å¤‡è€ƒ', trigger: (gs) => gs.time.days > 40, unique: true,
                    title: 'ğŸ’¬ åå›¾å­¦ä¹ ç¾¤çš„ç¥ä»™æ‰“æ¶',
                    description: 'åå›¾æ•™è‚²å®˜æ–¹å­¦ä¹ ç¾¤é‡Œç‚¸äº†ï¼æœ‰å­¦éœ¸æ¯å¤©æ™’è¿›åº¦æ¡"ä»Šæ—¥åˆ·é¢˜200é“âœ…"ï¼Œæœ‰äººå“­è¯‰"ç”³è®ºæ°¸è¿œ40+æ€ä¹ˆç ´ğŸ˜­"ï¼Œè¿˜æœ‰å¤§ç¥åœ¨åˆ†äº«"æˆ‘æ˜¯è¿™æ ·ä»30åˆ†é€†è¢­åˆ°70åˆ†çš„..."ç¾¤æ¶ˆæ¯99+åœä¸ä¸‹æ¥ï¼',
                    choices: [
                        { 
                            text: 'ğŸ¤“ åŒ–èº«æŠ€æœ¯æµï¼Œåˆ†äº«å­¦ä¹ æ–¹æ³•', 
                            personality: { social: 2, studious: 1 },
                            consequence: { 
                                stats: { communication: 4, professional: 2, learning: 1 }, 
                                influence: 15,
                                log: 'ä½ çš„"åå›¾è¯¾ç¨‹+é”™é¢˜æœ¬"å­¦ä¹ æ³•è¢«ç¾¤å‹ç–¯ç‹‚ç‚¹èµï¼Œè¿˜æœ‰äººç§èŠè¦ç¬”è®°ï¼',
                                achievement: 'GROUP_STAR'
                            } 
                        },
                        { 
                            text: 'ğŸ”¥ å½“æƒ…ç»ªå®‰æ…°å¸ˆï¼Œé¸¡æ±¤èµ°èµ·', 
                            personality: { social: 3 },
                            consequence: { 
                                stats: { communication: 3, resilience: 2 }, 
                                log: 'ä½ çš„åŠ±å¿—å°ä½œæ–‡è®©ç¾¤é‡ŒèŒæ–°é‡ç‡ƒæ–—å¿—ï¼Œç¾¤ä¸»éƒ½ç»™ä½ ç‚¹èµäº†ï¼' 
                            } 
                        },
                        { 
                            text: 'ğŸ‘€ é»˜é»˜æ½œæ°´ï¼Œå·å­¦å¤§ç¥ç»éªŒ', 
                            personality: { cautious: 1 },
                            consequence: { 
                                stats: { learning: 2, resilience: -1 }, 
                                log: 'ä½ æ‚„æ‚„æ”¶è—äº†å¤§ç¥çš„å¤ä¹ è®¡åˆ’ï¼Œä½†ç¾¤é‡Œçš„ç„¦è™‘æ°›å›´è¿˜æ˜¯æœ‰ç‚¹å½±å“å¿ƒæƒ…ã€‚' 
                            } 
                        }
                    ]
                },
                {
                    id: 'E008', stage: 'ç¬”è¯•å¤‡è€ƒ', trigger: (gs) => gs.time.days > 50, unique: true,
                    title: 'ğŸ“º åå›¾æ•™è‚²ç›´æ’­é—´ï¼šä»Šå¤œæ— çœ åˆ·é¢˜å¤§ä¼š',
                    description: 'åå›¾æ•™è‚²è§†é¢‘å·ç–¯äº†ï¼ä»Šæ™šæ·±å¤œç›´æ’­"100é“è¡Œæµ‹ç§’æ€æŠ€å·§"ï¼Œä¸»æ’­æ˜¯åå›¾ç‹ç‰Œè®²å¸ˆï¼Œå¼¹å¹•å…¨æ˜¯"è€å¸ˆç‰›é€¼ï¼""è¿™ä¸ªæ–¹æ³•ç»äº†ï¼"ä½ å®¤å‹æ¿€åŠ¨åœ°æ‘‡ä½ ï¼š"å¿«èµ·æ¥ï¼åå›¾è€å¸ˆåœ¨æ•™ç¥ä»™è§£é¢˜æ³•ï¼"',
                    choices: [
                        { 
                            text: 'ğŸŒ™ ç†¬å¤œä¹Ÿè¦å­¦ï¼å†²è¿›ç›´æ’­é—´', 
                            personality: { social: 2, innovative: 1, studious: 2 },
                            consequence: { 
                                stats: { learning: 4, communication: 2, resilience: -1, professional: 3 }, 
                                examProgress: { practiceTests: 2 },
                                log: 'åå›¾è€å¸ˆçš„"ç§’æ€å…¬å¼"å¤ªå¼ºäº†ï¼ä½ ç–¯ç‹‚åšç¬”è®°åˆ°å‡Œæ™¨2ç‚¹ï¼Œè™½ç„¶å›°ä½†è¶…å€¼ï¼',
                                buff: { name: 'åå›¾ç§˜æŠ€', duration: 5, effect: 'exam_skills' }
                            } 
                        },
                        { 
                            text: 'ğŸ“± å…ˆå…³æ³¨ï¼Œæ˜å¤©çœ‹å›æ”¾', 
                            personality: { cautious: 2 },
                            consequence: { 
                                stats: { decision: 2, learning: 1 }, 
                                log: 'ä½ ç†æ™ºåœ°é€‰æ‹©çœ‹å›æ”¾ï¼Œåå›¾çš„è¯¾ç¨‹å›æ”¾åŠŸèƒ½è®©ä½ å¯ä»¥æ…¢æ…¢æ¶ˆåŒ–ã€‚' 
                            } 
                        },
                        { 
                            text: 'ğŸ˜´ å¤ªæ™šäº†ï¼Œæ˜å¤©ä¸“å¿ƒåˆ·é¢˜', 
                            personality: { traditional: 2, cautious: 1 },
                            consequence: { 
                                stats: { resilience: 2, professional: 1 }, 
                                examProgress: { practiceTests: 1 },
                                log: 'ä½ åšæŒæ—©ç¡æ—©èµ·ï¼Œä½†ç¬¬äºŒå¤©å¬è¯´é”™è¿‡äº†è¶…å®ç”¨çš„æŠ€å·§ï¼Œæœ‰ç‚¹å°é—æ†¾ã€‚' 
                            } 
                        }
                    ]
                },
                {
                    id: 'E009', stage: 'ç¬”è¯•å¤‡è€ƒ', trigger: (gs) => gs.time.days > 30 && gs.examProgress.practiceTests < 2, unique: true,
                    title: 'ç¬¬ä¸€æ¬¡æ¨¡æ‹Ÿè€ƒè¯•',
                    description: 'ä½ æŠ¥åå‚åŠ äº†ç¬¬ä¸€æ¬¡æ¨¡æ‹Ÿè€ƒè¯•ã€‚è¿™æ˜¯æ£€éªŒå­¦ä¹ æˆæœçš„é‡è¦æœºä¼šï¼Œä½†ä¹Ÿå¾ˆç´§å¼ ã€‚',
                    choices: [
                        { text: 'å…¨åŠ›ä»¥èµ´ï¼Œå½“ä½œçœŸè€ƒè¯•', 
                          personality: { studious: 2, cautious: 1 },
                          consequence: (gs) => {
                            const score = Math.floor(Math.random() * 30) + 60 + gs.player.stats.professional / 2;
                            return { 
                                stats: { resilience: 1, professional: 2 }, 
                                examProgress: { practiceTests: 1, writtenTestScore: score },
                                log: `ä½ è®¤çœŸå¯¹å¾…æ¨¡æ‹Ÿè€ƒè¯•ï¼Œè·å¾—äº†${score}åˆ†çš„æˆç»©ã€‚è¿™æ¬¡ä½“éªŒè®©ä½ æ›´äº†è§£è€ƒè¯•èŠ‚å¥ã€‚` 
                            };
                          }},
                        { text: 'éšä¾¿åšåšï¼Œæ„Ÿå—ä¸€ä¸‹', 
                          personality: { cautious: -1 },
                          consequence: { stats: { resilience: -1 }, examProgress: { practiceTests: 1 }, log: 'ä½ æ²¡æœ‰è®¤çœŸå¯¹å¾…è¿™æ¬¡æ¨¡æ‹Ÿè€ƒè¯•ï¼Œæ„Ÿè§‰æœ‰äº›æµªè´¹äº†æœºä¼šã€‚' } },
                        { text: 'ç´§å¼ åˆ°å‘æŒ¥å¤±å¸¸', 
                          consequence: { stats: { resilience: -2, professional: 1 }, examProgress: { practiceTests: 1 }, log: 'ç´§å¼ è®©ä½ å‘æŒ¥å¤±å¸¸ï¼Œä½†è¿™æ¬¡ç»å†è®©ä½ æ˜ç™½äº†å¿ƒæ€è°ƒæ•´çš„é‡è¦æ€§ã€‚' } }
                    ]
                },
                {
                    id: 'E010', stage: 'ç¬”è¯•å¤‡è€ƒ', trigger: (gs) => gs.time.month === 2 && gs.time.day > 20, unique: true,
                    title: 'è·ç¦»æŠ¥ååªæœ‰ä¸€å‘¨ï¼',
                    description: 'çœ‹ç€æ—¥å†ä¸Šåœˆå‡ºçš„æŠ¥åæ—¥æœŸï¼Œä½ çªç„¶æ„è¯†åˆ°åªå‰©ä¸€å‘¨æ—¶é—´äº†ï¼æœ‹å‹åœˆé‡Œå·²ç»æœ‰äººåœ¨è®¨è®ºèŒä½é€‰æ‹©ï¼Œä½ æ„Ÿåˆ°äº†å‰æ‰€æœªæœ‰çš„ç´§è¿«æ„Ÿã€‚',
                    choices: [
                        { text: 'æŠ“ç´§æ—¶é—´å†²åˆºå¤ä¹ ', 
                          personality: { studious: 2 },
                          consequence: { stats: { professional: 3, resilience: -1 }, log: 'ä½ å¼€å§‹äº†ç–¯ç‹‚çš„å†²åˆºå¤ä¹ ï¼Œæ¯å¤©å­¦ä¹ åˆ°æ·±å¤œã€‚' } },
                        { text: 'å…ˆç ”ç©¶èŒä½è¡¨ï¼Œé€‰å¥½å²—ä½', 
                          personality: { cautious: 2 },
                          consequence: { stats: { decision: 2 }, log: 'ä½ èŠ±äº†ä¸€å¤©æ—¶é—´ä»”ç»†ç ”ç©¶èŒä½è¡¨ï¼Œé€‰å®šäº†å‡ ä¸ªå¿ƒä»ªçš„å²—ä½ã€‚' } },
                        { text: 'ä¿æŒèŠ‚å¥ï¼Œç›¸ä¿¡è‡ªå·±', 
                          personality: { cautious: 1 },
                          consequence: { stats: { resilience: 2 }, log: 'ä½ æ²¡æœ‰è¢«ç´§è¿«æ„Ÿå†²æ˜å¤´è„‘ï¼Œä¿æŒäº†ç¨³å®šçš„å­¦ä¹ èŠ‚å¥ã€‚' } }
                    ]
                },
                {
                    id: 'E011', stage: 'ç¬”è¯•å¤‡è€ƒ', trigger: (gs) => gs.time.days > 70, unique: true,
                    title: 'ğŸ†š åå›¾åœ¨çº¿APP vs å…¶ä»–åˆ·é¢˜è½¯ä»¶å¤§æˆ˜',
                    description: 'å¾®åšä¸Š#åˆ·é¢˜è½¯ä»¶å“ªå®¶å¼º#è¯é¢˜å†²ä¸Šçƒ­æœï¼ç½‘å‹åˆ†æˆå‡ æ´¾ï¼šåå›¾æ´¾è¯´"åå›¾åœ¨çº¿çš„è§£ææœ€è¯¦ç»†"ï¼Œç²‰ç¬”æ´¾åå‡»"ç²‰ç¬”é¢˜ç›®æœ€æ–°"ï¼Œä¸­å…¬æ´¾åšæŒ"ä¸­å…¬æœ€å…¨é¢"...ä½ çš„é€‰æ‹©ææƒ§ç—‡çŠ¯äº†ï¼',
                    choices: [
                        { 
                            text: 'ğŸ¯ åå›¾åœ¨çº¿ä¸€æŠŠæ¢­ï¼ç›¸ä¿¡è€ç‰Œæœºæ„', 
                            personality: { traditional: 1, studious: 2 },
                            consequence: { 
                                stats: { professional: 3, learning: 2, decision: 1 }, 
                                examProgress: { practiceTests: 2 },
                                log: 'åå›¾åœ¨çº¿çš„ç³»ç»Ÿæ€§è¯¾ç¨‹ä½“ç³»è®©ä½ å—ç›ŠåŒªæµ…ï¼Œè§£æç¡®å®å¾ˆè¯¦ç»†ï¼',
                                achievement: 'HUATU_STUDENT'
                            } 
                        },
                        { 
                            text: 'ğŸ”„ éƒ½ä¸‹è½½ï¼Œå„å®¶å–é•¿è¡¥çŸ­', 
                            personality: { innovative: 2 },
                            consequence: { 
                                stats: { learning: 2, communication: 1, decision: -1 }, 
                                log: 'ä½ æˆäº†åˆ·é¢˜è½¯ä»¶æ”¶é›†å®¶ï¼Œè™½ç„¶æœ‰ç‚¹ä¹±ä½†ç¡®å®å­¦åˆ°äº†å„å®¶çš„ç²¾åã€‚' 
                            } 
                        },
                        { 
                            text: 'ğŸ“Š åšè°ƒç ”ï¼Œçœ‹è¯„åˆ†å’Œå£ç¢‘', 
                            personality: { cautious: 2, innovative: 1 },
                            consequence: { 
                                stats: { decision: 3, learning: 1 }, 
                                log: 'ä½ èŠ±äº†ä¸€å¤©æ—¶é—´ç ”ç©¶å„ç§æµ‹è¯„ï¼Œæœ€ç»ˆåšå‡ºäº†ç†æ€§é€‰æ‹©ã€‚' 
                            } 
                        }
                    ]
                },
                // ========== ç‰¹æ®ŠBUFFäº‹ä»¶ ==========
                {
                    id: 'BUFF001', stage: 'ç¬”è¯•å¤‡è€ƒ', trigger: (gs) => Math.random() < 0.1 && gs.time.days > 20 && !gs.eventHistory.includes('BUFF001'), unique: true,
                    title: 'ğŸ’« ä»Šæ—¥è¿åŠ¿ï¼šå­¦ä¹ æ•ˆç‡çˆ†è¡¨',
                    description: 'ä»Šå¤©ä¸çŸ¥é“æ€ä¹ˆå›äº‹ï¼Œæ³¨æ„åŠ›ç‰¹åˆ«é›†ä¸­ï¼Œç†è§£åŠ›ä¹Ÿå¾ˆå¼ºã€‚è¿å¹³æ—¶æœ€éš¾çš„é¢˜ç›®éƒ½èƒ½è½»æ¾æå®šï¼',
                    special: 'buff',
                    choices: [
                        { 
                            text: 'æŠŠæ¡æœºä¼šï¼Œç–¯ç‹‚å­¦ä¹ ï¼', 
                            consequence: { 
                                stats: { professional: 5, learning: 3 }, 
                                examProgress: { practiceTests: 1 },
                                log: 'ä½ æŠ“ä½äº†è¿™ä¸ªç»ä½³æœºä¼šï¼Œä»Šå¤©çš„å­¦ä¹ æ•ˆæœé¡¶å¹³æ—¶ä¸‰å¤©ï¼',
                                buff: { name: 'å­¦ä¹ æ•ˆç‡æå‡', duration: 3, effect: 'learning_boost' }
                            } 
                        }
                    ]
                },
                {
                    id: 'BUFF002', stage: 'ç¬”è¯•å¤‡è€ƒ', trigger: (gs) => Math.random() < 0.08 && gs.time.days > 30 && !gs.eventHistory.includes('BUFF002'), unique: true,
                    title: 'ğŸ‰ åå›¾æ•™è‚²æŠ¼é¢˜ç¥è¯ï¼šè€å¸ˆåˆé¢„æµ‹ä¸­äº†ï¼',
                    description: 'åå›¾æ•™è‚²å…¬ä¼—å·ç‚¸äº†ï¼ä»Šå¹´æ¨¡æ‹Ÿè€ƒçš„é¢˜ç›®ç«Ÿç„¶å’Œåå›¾è®²å¸ˆé¢„æµ‹çš„80%é‡åˆï¼ç½‘å‹ç–¯ç‹‚è½¬å‘ï¼š"åå›¾è€å¸ˆæ˜¯ä¸æ˜¯è€ƒè¯•å‡ºé¢˜äººçš„äº²æˆšï¼Ÿ""è¿™é¢„æµ‹å‡†å¾—ç¦»è°±ï¼"ä½ èµ¶ç´§ç¿»å‡ºåå›¾çš„æŠ¼é¢˜èµ„æ–™...',
                    special: 'buff',
                    choices: [
                        { 
                            text: 'ğŸ”¥ ç«‹åˆ»å…³æ³¨åå›¾å…¨å¹³å°ï¼ŒæŠ±ç´§å¤§è…¿ï¼', 
                            personality: { studious: 2, innovative: 1 },
                            consequence: { 
                                stats: { professional: 5, learning: 3, decision: 2 }, 
                                examProgress: { practiceTests: 2 },
                                log: 'ä½ ç«é€Ÿå…³æ³¨äº†åå›¾çš„å…¬ä¼—å·ã€è§†é¢‘å·ã€APPï¼ŒæŠ¼é¢˜èµ„æ–™è®©ä½ ä¿¡å¿ƒçˆ†æ£šï¼',
                                buff: { name: 'åå›¾æŠ¼é¢˜åŠ æŒ', duration: 8, effect: 'huatu_prediction' },
                                achievement: 'HUATU_FAN'
                            } 
                        },
                        { 
                            text: 'ğŸ“ ç†æ€§å¯¹å¾…ï¼Œå‚è€ƒä½†ä¸ä¾èµ–', 
                            personality: { cautious: 2 },
                            consequence: { 
                                stats: { professional: 3, decision: 2 }, 
                                log: 'ä½ ä¿æŒç†æ€§ï¼ŒæŠŠåå›¾çš„é¢„æµ‹ä½œä¸ºé‡è¦å‚è€ƒï¼Œä½†è¿˜æ˜¯ä»¥å…¨é¢å¤ä¹ ä¸ºä¸»ã€‚',
                                buff: { name: 'ç†æ€§å¤‡è€ƒ', duration: 3, effect: 'rational_study' }
                            } 
                        },
                        { 
                            text: 'ğŸ˜¤ ä¸ä¿¡é‚ªï¼ŒåšæŒè‡ªå·±çš„è®¡åˆ’', 
                            personality: { rebellious: 2 },
                            consequence: { 
                                stats: { decision: 1, resilience: 1 }, 
                                log: 'ä½ è§‰å¾—æŠ¼é¢˜éƒ½æ˜¯ç„å­¦ï¼Œè¿˜æ˜¯æŒ‰è‡ªå·±çš„èŠ‚å¥æ¥ï¼Œä½†å¿ƒé‡Œè¿˜æ˜¯æœ‰ç‚¹å¥½å¥‡...' 
                            } 
                        }
                    ]
                },
                {
                    id: 'DEBUFF001', stage: 'ç¬”è¯•å¤‡è€ƒ', trigger: (gs) => Math.random() < 0.12 && gs.time.days > 25 && !gs.eventHistory.includes('DEBUFF001'), unique: true,
                    title: 'ğŸ˜µ çªå‘çŠ¶å†µï¼šæ‰‹æœºæˆç˜¾',
                    description: 'æœ€è¿‘åˆ·æ‰‹æœºä¸Šç˜¾äº†ï¼Œæ˜æ˜æ‰“ç®—å­¦ä¹ ï¼Œä½†æ€»æ˜¯å¿ä¸ä½çœ‹å¾®åšã€æŠ–éŸ³ã€‚æ—¶é—´å°±è¿™æ ·æ‚„æ‚„æºœèµ°äº†...',
                    special: 'debuff',
                    choices: [
                        { 
                            text: 'ç‹ å¿ƒå¸è½½æ‰€æœ‰å¨±ä¹APP', 
                            personality: { studious: 2 },
                            consequence: { 
                                stats: { decision: 3, resilience: 2 }, 
                                log: 'ä½ å¿ç—›å¸è½½äº†æ‰€æœ‰å¨±ä¹APPï¼Œå­¦ä¹ æ•ˆç‡æ˜æ˜¾æå‡ï¼' 
                            } 
                        },
                        { 
                            text: 'è®¾ç½®ä½¿ç”¨æ—¶é—´é™åˆ¶', 
                            personality: { cautious: 1 },
                            consequence: { 
                                stats: { decision: 1 }, 
                                log: 'ä½ è®¾ç½®äº†APPä½¿ç”¨é™åˆ¶ï¼Œä½†æ•ˆæœä¸€èˆ¬èˆ¬ã€‚' 
                            } 
                        },
                        { 
                            text: 'ç®—äº†ï¼Œåæ­£ä¹Ÿè¦æ”¾æ¾', 
                            consequence: { 
                                stats: { resilience: 1, professional: -2 }, 
                                log: 'ä½ æ”¾ä»»è‡ªå·±ç»§ç»­åˆ·æ‰‹æœºï¼Œå­¦ä¹ è¿›åº¦æ˜æ˜¾è½åäº†ã€‚',
                                debuff: { name: 'æ‰‹æœºæˆç˜¾', duration: 7, effect: 'phone_addiction' }
                            } 
                        }
                    ]
                },
                {
                    id: 'BUFF003', stage: 'ç¬”è¯•å¤‡è€ƒ', trigger: (gs) => Math.random() < 0.06 && gs.time.days > 35 && !gs.eventHistory.includes('BUFF003'), unique: true,
                    title: 'ğŸ‰ å¹¸è¿äº‹ä»¶ï¼šé‡åˆ°å­¦éœ¸å®¤å‹',
                    description: 'ä½ çš„æ–°å®¤å‹ç«Ÿç„¶æ˜¯å»å¹´ä¸Šå²¸çš„å­¦é•¿ï¼ä»–ä¸»åŠ¨æå‡ºè¦åˆ†äº«ä¸€äº›ç‹¬å®¶çš„å­¦ä¹ èµ„æ–™å’Œç»éªŒï¼Œç®€ç›´æ˜¯å¤©é™å¥½è¿ï¼',
                    special: 'buff',
                    choices: [
                        { 
                            text: 'è™šå¿ƒè¯·æ•™ï¼Œå»ºç«‹å­¦ä¹ å°ç»„', 
                            personality: { social: 2, studious: 1 },
                            consequence: { 
                                stats: { learning: 4, communication: 3, professional: 2 }, 
                                examProgress: { practiceTests: 2 },
                                log: 'å­¦é•¿çš„æŒ‡å¯¼è®©ä½ å¦‚é†é†çŒé¡¶ï¼Œå­¦ä¹ æ•ˆç‡å¤§å¹…æå‡ï¼',
                                buff: { name: 'å­¦éœ¸æŒ‡å¯¼', duration: 10, effect: 'mentor_guidance' }
                            } 
                        },
                        { 
                            text: 'ç¤¼è²Œæ„Ÿè°¢ï¼Œå¶å°”äº¤æµ', 
                            consequence: { 
                                stats: { learning: 2, communication: 1 }, 
                                log: 'ä½ è·å¾—äº†ä¸€äº›æœ‰ç”¨çš„å»ºè®®ï¼Œä½†æ²¡æœ‰å……åˆ†åˆ©ç”¨è¿™ä¸ªæœºä¼šã€‚' 
                            } 
                        }
                    ]
                },
                {
                    id: 'DEBUFF002', stage: 'ç¬”è¯•å¤‡è€ƒ', trigger: (gs) => Math.random() < 0.1 && gs.time.days > 50 && !gs.eventHistory.includes('DEBUFF002'), unique: true,
                    title: 'ğŸ˜´ å›°æ‰°äº‹ä»¶ï¼šä¸¥é‡å¤±çœ ',
                    description: 'æœ€è¿‘å‹åŠ›å¤ªå¤§ï¼Œä½ å¼€å§‹å¤±çœ ã€‚å‡Œæ™¨3ç‚¹è¿˜åœ¨ç¿»æ¥è¦†å»ï¼Œç™½å¤©å­¦ä¹ æ—¶æ˜æ˜æ²‰æ²‰ï¼Œæ•ˆç‡æä½ã€‚',
                    special: 'debuff',
                    choices: [
                        { 
                            text: 'ä¹°è¤ªé»‘ç´ ï¼Œè°ƒæ•´ä½œæ¯', 
                            personality: { cautious: 1 },
                            consequence: { 
                                stats: { resilience: 1 }, 
                                log: 'ä½ å¼€å§‹è°ƒæ•´ä½œæ¯ï¼Œä½†çŸ­æœŸå†…ä»ç„¶å—å¤±çœ å›°æ‰°ã€‚',
                                debuff: { name: 'è½»åº¦å¤±çœ ', duration: 5, effect: 'insomnia' }
                            } 
                        },
                        { 
                            text: 'ç¡¬æ’‘ç€ç»§ç»­å­¦ä¹ ', 
                            personality: { studious: 1 },
                            consequence: { 
                                stats: { resilience: -2, professional: -1 }, 
                                log: 'ä½ å¼ºæ’‘ç€å­¦ä¹ ï¼Œä½†æ•ˆæœå¾ˆå·®ï¼Œèº«ä½“ä¹Ÿå—ä¸äº†ã€‚',
                                debuff: { name: 'ä¸¥é‡å¤±çœ ', duration: 8, effect: 'insomnia' }
                            } 
                        },
                        { 
                            text: 'æ‰¾å¿ƒç†åŒ»ç”Ÿå’¨è¯¢', 
                            personality: { innovative: 1 },
                            consequence: { 
                                stats: { resilience: 2, decision: 1 }, 
                                log: 'ä¸“ä¸šçš„å»ºè®®å¸®ä½ æ‰¾åˆ°äº†å¤±çœ çš„æ ¹æºï¼ŒçŠ¶æ€é€æ¸å¥½è½¬ã€‚' 
                            } 
                        }
                    ]
                },
                {
                    id: 'BUFF004', stage: 'ç¬”è¯•è€ƒè¯•', trigger: (gs) => Math.random() < 0.15 && gs.selectedPath && !gs.eventHistory.includes('BUFF004'), unique: true,
                    title: 'ğŸ€ è¶…çº§å¹¸è¿ï¼šè€ƒè¯•å½“å¤©å¥½è¿çˆ†æ£š',
                    description: 'è€ƒè¯•å½“å¤©ä¸€åˆ‡é¡ºåˆ©ï¼šæå‰åˆ°è¾¾è€ƒåœºã€åº§ä½é çª—é‡‡å…‰å¥½ã€è€ƒè¯•é¢˜ç›®åˆšå¥½éƒ½æ˜¯ä½ é‡ç‚¹å¤ä¹ çš„å†…å®¹ï¼',
                    special: 'buff',
                    choices: [
                        { 
                            text: 'æŠŠæ¡æœºä¼šï¼Œè¶…å¸¸å‘æŒ¥ï¼', 
                            consequence: { 
                                stats: { professional: 3, resilience: 2, decision: 2 }, 
                                examProgress: { writtenTestScore: 25 },
                                log: 'å¥½è¿åŠ æŒä¸‹ï¼Œä½ å‘æŒ¥å‡ºäº†å‰æ‰€æœªæœ‰çš„æ°´å¹³ï¼',
                                buff: { name: 'è¶…å¸¸å‘æŒ¥', duration: 3, effect: 'exam_boost' }
                            } 
                        }
                    ]
                },
                {
                    id: 'DEBUFF003', stage: 'ç¬”è¯•è€ƒè¯•', trigger: (gs) => Math.random() < 0.08 && gs.time.days > 92 && !gs.eventHistory.includes('DEBUFF003'), unique: true,
                    title: 'ğŸ˜° å€’éœ‰äº‹ä»¶ï¼šè€ƒè¯•å½“å¤©çªå‘çŠ¶å†µ',
                    description: 'è€ƒè¯•å½“å¤©ç®€ç›´æ˜¯è¯¸äº‹ä¸é¡ºï¼šé—¹é’Ÿæ²¡å“å·®ç‚¹è¿Ÿåˆ°ã€è€ƒåœºç©ºè°ƒåäº†å¾ˆé—·çƒ­ã€éš”å£è€ƒç”Ÿä¸€ç›´å’³å—½...',
                    special: 'debuff',
                    choices: [
                        { 
                            text: 'è°ƒæ•´å¿ƒæ€ï¼Œä¸“æ³¨è€ƒè¯•', 
                            personality: { resilience: 2 },
                            consequence: { 
                                stats: { resilience: 1, decision: 1 }, 
                                examProgress: { writtenTestScore: -5 },
                                log: 'è™½ç„¶æœ‰å¹²æ‰°ï¼Œä½†ä½ åŠªåŠ›ä¿æŒä¸“æ³¨ï¼Œå½±å“æœ‰é™ã€‚' 
                            } 
                        },
                        { 
                            text: 'å¿ƒæ€å´©äº†ï¼Œå‘æŒ¥å¤±å¸¸', 
                            consequence: { 
                                stats: { resilience: -2, professional: -1 }, 
                                examProgress: { writtenTestScore: -15 },
                                log: 'ä¸€è¿ä¸²çš„æ„å¤–è®©ä½ å¿ƒæ€å´©æºƒï¼Œè€ƒè¯•å‘æŒ¥ä¸¥é‡å¤±å¸¸ã€‚',
                                debuff: { name: 'è€ƒè¯•ç„¦è™‘', duration: 3, effect: 'exam_anxiety' }
                            } 
                        }
                    ]
                },
                // ========== å¤šæ ·åŒ–ç»“å±€é€‰æ‹©äº‹ä»¶ ==========
                {
                    id: 'ENDING_CHOICE', stage: 'èŒä¸šå‘å±•', trigger: (gs) => gs.time.days >= 365, unique: true,
                    title: 'ğŸ¯ äººç”Ÿçš„åå­—è·¯å£',
                    description: 'ç»è¿‡ä¸€å¹´çš„åŠªåŠ›ï¼Œä½ å·²ç»åœ¨èŒåœºç«™ç¨³äº†è„šè·Ÿã€‚ç°åœ¨é¢ä¸´äººç”Ÿçš„é‡è¦é€‰æ‹©ï¼Œæ¯ä¸€æ¡è·¯éƒ½å……æ»¡äº†ä¸åŒçš„å¯èƒ½æ€§...',
                    choices: [
                        {
                            text: 'ğŸ’¼ ç»§ç»­æ·±è€•å…¬åŠ¡å‘˜ä½“ç³»',
                            effects: {
                                gameOver: true,
                                endingType: 'stable_career',
                                log: 'ä½ é€‰æ‹©åœ¨å…¬åŠ¡å‘˜ä½“ç³»ä¸­ç»§ç»­å‘å±•ï¼Œè¿½æ±‚ç¨³å®šè€Œæœ‰æ„ä¹‰çš„èŒä¸šç”Ÿæ¶¯ã€‚'
                            }
                        },
                        {
                            text: 'ğŸ’” ä¸ºäº†çˆ±æƒ…æ”¾å¼ƒä¸€åˆ‡',
                            effects: {
                                gameOver: true,
                                endingType: 'love_sacrifice',
                                log: 'ä½ å†³å®šä¸ºäº†å¿ƒçˆ±çš„äººæ”¾å¼ƒç°æœ‰çš„ä¸€åˆ‡ï¼Œè¿½å¯»çœŸçˆ±ã€‚æ¯•ä¸šåˆ†æ‰‹ï¼Ÿä¸å­˜åœ¨çš„ï¼'
                            }
                        },
                        {
                            text: 'ğŸš€ è¾èŒåˆ›ä¸šè¿½æ¢¦',
                            effects: {
                                gameOver: true,
                                endingType: 'entrepreneur',
                                log: 'ä½ æ¯…ç„¶å†³å®šè¾èŒåˆ›ä¸šï¼Œç”¨è‡ªå·±çš„æƒ³æ³•æ”¹å˜ä¸–ç•Œï¼'
                            }
                        },
                        {
                            text: 'ğŸŒ å‡ºå›½æ·±é€ ',
                            effects: {
                                gameOver: true,
                                endingType: 'study_abroad',
                                log: 'ä½ é€‰æ‹©å‡ºå›½æ·±é€ ï¼Œåœ¨æ›´å¹¿é˜”çš„å¤©åœ°ä¸­å¯»æ‰¾äººç”Ÿçš„å¯èƒ½æ€§ã€‚'
                            }
                        },
                        {
                            text: 'ğŸ  å›å®¶ç»§æ‰¿å®¶ä¸š',
                            effects: {
                                gameOver: true,
                                endingType: 'family_business',
                                log: 'ä½ å†³å®šå›åˆ°å®¶ä¹¡ï¼Œç»§æ‰¿å®¶æ—äº‹ä¸šï¼Œåœ¨ç†Ÿæ‚‰çš„åœŸåœ°ä¸Šä¹¦å†™æ–°çš„ç¯‡ç« ã€‚'
                            }
                        }
                    ]
                },
                // ========== éšæœºè¶£å‘³äº‹ä»¶ ==========
                {
                    id: 'RANDOM001', stage: 'ç¬”è¯•å¤‡è€ƒ', trigger: (gs) => Math.random() < 0.15 && gs.time.days > 10 && !gs.eventHistory.includes('RANDOM001'), unique: true,
                    title: 'ğŸ± çªå‘çŠ¶å†µï¼šé‚»å±…å®¶çš„çŒ«',
                    description: 'é‚»å±…å®¶çš„çŒ«ä¸çŸ¥é“æ€ä¹ˆè·‘åˆ°ä½ å®¶é˜³å°ä¸Šäº†ï¼Œå–µå–µå«ä¸ªä¸åœã€‚ä½ æ­£åœ¨ä¸“å¿ƒå­¦ä¹ ï¼Œè¢«åµå¾—å¿ƒçƒ¦æ„ä¹±ã€‚',
                    special: 'random',
                    choices: [
                        { 
                            text: 'å¼€é—¨è®©çŒ«è¿›æ¥ï¼Œæ’¸çŒ«è§£å‹', 
                            personality: { social: 1 },
                            consequence: { 
                                stats: { resilience: 3, communication: 1 }, 
                                log: 'æ„å¤–çš„æ’¸çŒ«æ—¶å…‰è®©ä½ å¿ƒæƒ…èˆ’ç•…ï¼Œå­¦ä¹ çŠ¶æ€åè€Œæ›´å¥½äº†ã€‚' 
                            } 
                        },
                        { 
                            text: 'æŠŠçŒ«é€å›é‚»å±…å®¶', 
                            personality: { social: 2 },
                            consequence: { 
                                stats: { communication: 2 }, 
                                log: 'ä½ å’Œé‚»å±…èŠäº†å‡ å¥ï¼Œæ„å¤–å‘ç°ä»–ä»¬å®¶å­©å­ä¹Ÿåœ¨å‡†å¤‡å…¬è€ƒã€‚' 
                            } 
                        },
                        { 
                            text: 'å…³çª—æˆ·ï¼Œä¸“å¿ƒå­¦ä¹ ', 
                            personality: { studious: 1 },
                            consequence: { 
                                stats: { professional: 1, resilience: -1 }, 
                                log: 'ä½ åšæŒå­¦ä¹ ï¼Œä½†çŒ«å«å£°è¿˜æ˜¯æœ‰ç‚¹å½±å“å¿ƒæƒ…ã€‚' 
                            } 
                        }
                    ]
                },
                {
                    id: 'RANDOM002', stage: 'å¤‡è€ƒé˜¶æ®µ', trigger: (gs) => Math.random() < 0.1 && gs.time.days > 40 && !gs.eventHistory.includes('RANDOM002'), unique: true,
                    title: 'ğŸ”¥ åå›¾å…¬ä¼—å·çˆ†æ–‡ï¼šã€Šå…¬è€ƒå†…å·ï¼Ÿæˆ‘ç¬‘äº†ã€‹',
                    description: 'åå›¾æ•™è‚²å…¬ä¼—å·ä»Šå¤©æ¨é€äº†ä¸€ç¯‡10ä¸‡+çˆ†æ–‡ï¼æ–‡ç« è¯´ï¼š"åˆ«è¢«ç½‘ä¸Šçš„ç„¦è™‘è´©å–è€…å¿½æ‚ ï¼ŒçœŸæ­£çš„é«˜æ‰‹éƒ½åœ¨é—·å£°å­¦ä¹ ã€‚"è¯„è®ºåŒºç‚¸äº†ï¼šæœ‰äººè¯´"åå›¾è¯´å¾—å¯¹ï¼Œå¿ƒæ€æœ€é‡è¦"ï¼Œä¹Ÿæœ‰äººåé©³"ç«™ç€è¯´è¯ä¸è…°ç–¼"...',
                    special: 'random',
                    choices: [
                        { 
                            text: 'ğŸ’ª åå›¾è¯´å¾—å¯¹ï¼è°ƒæ•´å¿ƒæ€ç»§ç»­å†²', 
                            personality: { resilience: 2, studious: 1 },
                            consequence: { 
                                stats: { resilience: 4, decision: 2, learning: 1 }, 
                                log: 'åå›¾çš„æ–‡ç« è®©ä½ é†é†çŒé¡¶ï¼Œä½ å…³æ³¨äº†å…¬ä¼—å·å¹¶è°ƒæ•´äº†å¿ƒæ€ã€‚',
                                achievement: 'HUATU_FAN'
                            } 
                        },
                        { 
                            text: 'ğŸ¤” è½¬å‘æœ‹å‹åœˆï¼Œæ±‚å¤§å®¶å®‰æ…°', 
                            personality: { social: 2 },
                            consequence: { 
                                stats: { communication: 2, resilience: -1 }, 
                                log: 'ä½ è½¬å‘äº†æ–‡ç« é…æ–‡"å¤ªçœŸå®äº†ğŸ˜­"ï¼Œæ”¶è·äº†æœ‹å‹ä»¬çš„ç‚¹èµå’Œé¼“åŠ±ã€‚' 
                            } 
                        },
                        { 
                            text: 'ğŸ˜¤ éƒ½æ˜¯æ¯’é¸¡æ±¤ï¼Œåˆ é™¤ä¸çœ‹', 
                            personality: { rebellious: 2 },
                            consequence: { 
                                stats: { decision: 1, resilience: -1 }, 
                                log: 'ä½ è§‰å¾—è¿™äº›æ–‡ç« éƒ½åœ¨è´©å–ç„¦è™‘ï¼Œä½†å†…å¿ƒçš„ä¸å®‰è¿˜æ˜¯æŒ¥ä¹‹ä¸å»ã€‚' 
                            } 
                        }
                    ]
                },
                
                // ========== è€ƒè¯•é˜¶æ®µ ==========
                {
                    id: 'E101', stage: 'è€ƒè¯•é˜¶æ®µ', trigger: () => true, unique: true,
                    title: 'ç¬”è¯•å‰å¤œçš„å¤±çœ ',
                    description: 'æ˜å¤©å°±æ˜¯ç¬”è¯•äº†ï¼Œä½ èººåœ¨åºŠä¸Šç¿»æ¥è¦†å»ç¡ä¸ç€ã€‚çª—å¤–æœ‰å·¥åœ°åœ¨æ–½å·¥ï¼Œéš”å£å®¤å‹åœ¨åˆ·æŠ–éŸ³ï¼Œä½ çš„å¿ƒæƒ…äº”å‘³æ‚é™ˆã€‚',
                    choices: [
                        { text: 'èµ·æ¥å†å¤ä¹ ä¸€ä¼šå„¿', 
                          personality: { studious: 1, cautious: 1 },
                          consequence: { stats: { professional: 1, resilience: -1 }, log: 'ä½ åˆå¤ä¹ äº†2å°æ—¶ï¼ŒçŸ¥è¯†ç‚¹æ›´ç‰¢å›ºäº†ï¼Œä½†ç¡çœ ä¸è¶³å¯èƒ½å½±å“æ˜å¤©çš„å‘æŒ¥ã€‚' } },
                        { text: 'å¬éŸ³ä¹æ”¾æ¾ï¼Œå¼ºåˆ¶å…¥ç¡', 
                          personality: { cautious: 2 },
                          consequence: { stats: { resilience: 2 }, log: 'ä½ å¬ç€è½»éŸ³ä¹é€æ¸å…¥ç¡ï¼Œç¬¬äºŒå¤©ç²¾ç¥çŠ¶æ€ä¸é”™ã€‚' } },
                        { text: 'å’Œå®¤å‹èŠå¤©ç¼“è§£ç´§å¼ ', 
                          personality: { social: 2 },
                          consequence: { stats: { communication: 1, resilience: 1 }, log: 'å’Œå®¤å‹èŠäº†èŠè€ƒè¯•çš„äº‹ï¼Œå¿ƒæƒ…æ”¾æ¾äº†ä¸å°‘ã€‚' } }
                    ]
                },
                {
                    id: 'E102', stage: 'è€ƒè¯•é˜¶æ®µ', trigger: (gs) => gs.time.days > 92, unique: true,
                    title: 'ç¬”è¯•è€ƒåœºï¼šè¡Œæµ‹éƒ¨åˆ†',
                    description: 'è€ƒè¯•å¼€å§‹äº†ï¼ç¬¬ä¸€éƒ¨åˆ†æ˜¯è¡Œæµ‹ï¼Œä½ çœ‹åˆ°äº†ä¸€é“æ•°é‡å…³ç³»é¢˜ï¼šä¸€ä¸ªæ°´æ± æœ‰è¿›æ°´ç®¡å’Œå‡ºæ°´ç®¡ï¼Œè¿›æ°´ç®¡æ¯åˆ†é’Ÿè¿›æ°´5å‡ï¼Œå‡ºæ°´ç®¡æ¯åˆ†é’Ÿå‡ºæ°´3å‡ï¼Œæ°´æ± å®¹é‡100å‡ï¼Œé—®å¤šé•¿æ—¶é—´èƒ½æ³¨æ»¡ï¼Ÿ',
                    choices: [
                        { text: 'ç«‹å³è®¡ç®—ï¼š100Ã·(5-3)=50åˆ†é’Ÿ', 
                          consequence: (gs) => {
                            const baseScore = gs.examProgress.practiceTests * 10 + gs.player.stats.professional;
                            return { 
                                examProgress: { writtenTestScore: baseScore + 15 },
                                stats: { professional: 1 },
                                log: 'æ­£ç¡®ï¼ä½ è¿…é€Ÿç®—å‡ºäº†ç­”æ¡ˆï¼Œä¸ºåé¢èŠ‚çœäº†æ—¶é—´ã€‚' 
                            };
                          }},
                        { text: 'ä»”ç»†æ£€æŸ¥é¢˜ç›®ï¼Œæ€•æœ‰é™·é˜±', 
                          consequence: (gs) => {
                            const baseScore = gs.examProgress.practiceTests * 10 + gs.player.stats.professional;
                            return { 
                                examProgress: { writtenTestScore: baseScore + 10 },
                                stats: { decision: 1 },
                                log: 'ä½ ä»”ç»†ç¡®è®¤äº†é¢˜ç›®æ¡ä»¶ï¼Œè™½ç„¶ç­”æ¡ˆæ­£ç¡®ä½†èŠ±è´¹äº†æ›´å¤šæ—¶é—´ã€‚' 
                            };
                          }},
                        { text: 'è·³è¿‡è¿™é¢˜ï¼Œå…ˆåšç®€å•çš„', 
                          consequence: (gs) => {
                            const baseScore = gs.examProgress.practiceTests * 10 + gs.player.stats.professional;
                            return { 
                                examProgress: { writtenTestScore: baseScore + 5 },
                                log: 'ä½ é€‰æ‹©äº†ç­–ç•¥æ€§è·³é¢˜ï¼Œä½†æœ€åæ—¶é—´ä¸å¤Ÿæ²¡èƒ½å›æ¥åšè¿™é“é¢˜ã€‚' 
                            };
                          }}
                    ]
                },
                {
                    id: 'E103', stage: 'è€ƒè¯•é˜¶æ®µ', trigger: (gs) => gs.time.days > 93, unique: true,
                    title: 'ç¬”è¯•è€ƒåœºï¼šç”³è®ºéƒ¨åˆ†',
                    description: 'ç”³è®ºè€ƒè¯•å¼€å§‹äº†ã€‚é¢˜ç›®æ˜¯å…³äº"å¹´è½»äººèººå¹³ç°è±¡"çš„åˆ†æï¼Œè¿™ä¸ªè¯é¢˜ä½ å¾ˆç†Ÿæ‚‰ã€‚æ—¶é—´æœ‰é™ï¼Œä½ éœ€è¦å¿«é€Ÿç»„ç»‡æ€è·¯ã€‚',
                    choices: [
                        { text: 'ä»ç¤¾ä¼šå‹åŠ›è§’åº¦åˆ†æ', 
                          personality: { rebellious: 1 },
                          consequence: (gs) => {
                            const baseScore = gs.examProgress.writtenTestScore || 60;
                            return { 
                                examProgress: { writtenTestScore: baseScore + 20 },
                                stats: { decision: 2, communication: 1 },
                                log: 'ä½ çš„åˆ†ææ·±å…¥ä¸”æœ‰ä¸ªäººè§è§£ï¼Œè€ƒå®˜å¯¹ä½ çš„è§‚ç‚¹å°è±¡æ·±åˆ»ã€‚' 
                            };
                          }},
                        { text: 'å†™å®˜æ–¹æ ‡å‡†ç­”æ¡ˆ', 
                          personality: { traditional: 2, cautious: 1 },
                          consequence: (gs) => {
                            const baseScore = gs.examProgress.writtenTestScore || 60;
                            return { 
                                examProgress: { writtenTestScore: baseScore + 15 },
                                stats: { professional: 1 },
                                log: 'ä½ å†™äº†å¾ˆæ ‡å‡†çš„ç­”æ¡ˆï¼Œä¸­è§„ä¸­çŸ©ï¼Œä½†ç¼ºä¹äº®ç‚¹ã€‚' 
                            };
                          }},
                        { text: 'ç»“åˆè‡ªèº«ç»å†è°ˆæ„Ÿå—', 
                          personality: { innovative: 1, social: 1 },
                          consequence: (gs) => {
                            const baseScore = gs.examProgress.writtenTestScore || 60;
                            return { 
                                examProgress: { writtenTestScore: baseScore + 25 },
                                stats: { communication: 2, resilience: 1 },
                                log: 'ä½ çš„çœŸå®æ„Ÿå—æ‰“åŠ¨äº†è€ƒå®˜ï¼Œæ–‡ç« å¾ˆæœ‰æ„ŸæŸ“åŠ›ã€‚',
                                achievement: 'CONTROVERSIAL_CHOICE'
                            };
                          }}
                    ]
                },
                {
                    id: 'E104', stage: 'è€ƒè¯•é˜¶æ®µ', trigger: (gs) => gs.time.days > 94, unique: true,
                    title: 'ç¬”è¯•ç»“æœ',
                    description: 'ç¬”è¯•æˆç»©å‡ºæ¥äº†ï¼ä½ ç´§å¼ åœ°æŸ¥è¯¢è‡ªå·±çš„åˆ†æ•°...',
                    choices: [
                        {text: 'æŸ¥çœ‹æˆç»©', consequence: (gs) => {
                            const finalScore = gs.examProgress.writtenTestScore || 70;
                            if (finalScore >= 120) {
                                // è®¾ç½®ç¬”è¯•é€šè¿‡æ ‡å¿—å¹¶è½¬æ¢åˆ°é¢è¯•å¤‡è€ƒé˜¶æ®µ
                                gs.examProgress.writtenPassed = true;
                                gs.player.stage = 'é¢è¯•å¤‡è€ƒ';
                                gs.time.days = 100;
                                return { 
                                    log: `æ­å–œï¼ä½ çš„ç¬”è¯•æˆç»©æ˜¯${finalScore}åˆ†ï¼ŒæˆåŠŸè¿›å…¥é¢è¯•ç¯èŠ‚ï¼ç°åœ¨å¼€å§‹å‡†å¤‡é¢è¯•ã€‚`,
                                    achievement: 'PASS_WRITTEN_TEST',
                                    nextStage: true
                                };
                            } else {
                                return { 
                                    log: `å¾ˆé—æ†¾ï¼Œä½ çš„ç¬”è¯•æˆç»©æ˜¯${finalScore}åˆ†ï¼Œæ²¡æœ‰è¾¾åˆ°é¢è¯•åˆ†æ•°çº¿ã€‚ä½†è¿™åªæ˜¯ä¸€æ¬¡å°è¯•ï¼Œç›¸ä¿¡ä½ ä¸‹æ¬¡ä¸€å®šèƒ½æˆåŠŸï¼`,
                                    gameOver: true 
                                };
                            }
                        }}
                    ]
                },
                {
                    id: 'E105', stage: 'é¢è¯•å¤‡è€ƒ', trigger: () => true, unique: true,
                    title: 'é¢è¯•é€šçŸ¥çš„å…´å¥‹ä¸ç´§å¼ ',
                    description: 'æ”¶åˆ°é¢è¯•é€šçŸ¥çš„é‚£ä¸€åˆ»ï¼Œä½ æ¿€åŠ¨å¾—å·®ç‚¹å«å‡ºå£°æ¥ï¼ä½†éšå³è€Œæ¥çš„æ˜¯æ·±æ·±çš„ç´§å¼ ...è·ç¦»é¢è¯•è¿˜æœ‰ä¸€å‘¨ï¼Œä½ éœ€è¦åšå¥½å‡†å¤‡ã€‚',
                    choices: [
                        { text: 'ç–¯ç‹‚åˆ·é¢è¯•é¢˜ï¼ŒèƒŒæ ‡å‡†ç­”æ¡ˆ', 
                          personality: { studious: 2, cautious: 1 },
                          consequence: { stats: { professional: 2, communication: 1 }, examProgress: { mockInterviews: 1 }, log: 'ä½ æ‰¾åˆ°äº†å„ç§é¢è¯•é¢˜åº“ï¼Œç†¬å¤œèƒŒç­”æ¡ˆï¼Œæ„Ÿè§‰èƒ¸æœ‰æˆç«¹ã€‚' } },
                        { text: 'æ‰¾å­¦é•¿å­¦å§æ¨¡æ‹Ÿé¢è¯•', 
                          personality: { social: 2, innovative: 1 },
                          consequence: { stats: { communication: 3, decision: 1 }, examProgress: { mockInterviews: 2 }, log: 'å­¦é•¿å­¦å§ç»™äº†ä½ å¾ˆå¤šå®ç”¨çš„é¢è¯•æŠ€å·§ï¼Œè¿˜æŒ‡å‡ºäº†ä½ çš„è¡¨è¾¾é—®é¢˜ã€‚' } },
                        { text: 'å¯¹ç€é•œå­ç»ƒä¹ è¡¨æƒ…ç®¡ç†', 
                          personality: { cautious: 1 },
                          consequence: { stats: { communication: 2, resilience: 1 }, log: 'ä½ å‘ç°è‡ªå·±ç´§å¼ æ—¶ä¼šçš±çœ‰ï¼Œç»è¿‡ç»ƒä¹ ï¼Œè¡¨æƒ…æ›´è‡ªç„¶äº†ã€‚' } }
                    ]
                },
                {
                    id: 'E106', stage: 'é¢è¯•å¤‡è€ƒ', trigger: (gs) => gs.time.days > 112, unique: true,
                    title: 'é¢è¯•å‰çš„"æœ€åä¸€è¯¾"',
                    description: 'é¢è¯•å‰ä¸€å¤©ï¼Œä½ åˆ·åˆ°äº†ä¸€ä¸ªé¢è¯•åŸ¹è®­æœºæ„çš„"æœ€åä¸€è¯¾"ç›´æ’­ï¼Œè€å¸ˆè¯´è¦æ•™"å¿…è¿‡æŠ€å·§"ã€‚ä½†ä½ å·²ç»å‡†å¤‡å¾—å·®ä¸å¤šäº†ã€‚',
                    choices: [
                        { text: 'è®¤çœŸå¬è¯¾ï¼ŒæŸ¥æ¼è¡¥ç¼º', 
                          personality: { studious: 1, cautious: 1 },
                          consequence: { stats: { professional: 1, communication: 1 }, log: 'ä½ å­¦åˆ°äº†ä¸€äº›ç»†èŠ‚æŠ€å·§ï¼Œæ¯”å¦‚å¦‚ä½•ä¼˜é›…åœ°æ•´ç†æ€è·¯ã€‚' } },
                        { text: 'ä¸å¬äº†ï¼Œç›¸ä¿¡è‡ªå·±çš„å‡†å¤‡', 
                          personality: { cautious: 2 },
                          consequence: { stats: { resilience: 2, decision: 1 }, log: 'ä½ æ²¡æœ‰è¢«ç„¦è™‘è¥é”€å½±å“ï¼Œä¿æŒäº†è‰¯å¥½çš„å¿ƒæ€ã€‚' } },
                        { text: 'è¾¹å¬è¾¹åæ§½ï¼Œè§‰å¾—éƒ½æ˜¯å¥—è·¯', 
                          personality: { rebellious: 1, innovative: 1 },
                          consequence: { stats: { communication: 1, resilience: 1 }, log: 'ä½ å¯¹åŸ¹è®­æœºæ„çš„å¥—è·¯æœ‰äº†æ›´æ¸…é†’çš„è®¤è¯†ã€‚' } }
                    ]
                },
                {
                    id: 'E107', stage: 'é¢è¯•è€ƒè¯•', trigger: (gs) => gs.time.days > 113, unique: true,
                    title: 'é¢è¯•å½“å¤©ï¼šç¬¬ä¸€å°è±¡',
                    description: 'é¢è¯•å½“å¤©ï¼Œä½ æ—©æ—©åˆ°äº†è€ƒç‚¹ã€‚çœ‹åˆ°å…¶ä»–è€ƒç”Ÿéƒ½ç©¿ç€æ­£è£…ï¼Œæœ‰çš„åœ¨èƒŒææ–™ï¼Œæœ‰çš„åœ¨ç»ƒä¹ æ‰‹åŠ¿ã€‚ä½ éœ€è¦è°ƒæ•´å¥½çŠ¶æ€ã€‚',
                    choices: [
                        { text: 'æ‰¾ä¸ªå®‰é™è§’è½å†å¤ä¹ ä¸€ä¸‹', 
                          personality: { studious: 1 },
                          consequence: { stats: { professional: 1 }, log: 'ä½ åˆè¿‡äº†ä¸€éé‡ç‚¹å†…å®¹ï¼Œæ„Ÿè§‰æ›´æœ‰æŠŠæ¡äº†ã€‚' } },
                        { text: 'å’Œå…¶ä»–è€ƒç”ŸèŠå¤©ç¼“è§£ç´§å¼ ', 
                          personality: { social: 2 },
                          consequence: { stats: { communication: 2, resilience: 1 }, log: 'èŠå¤©è®©ä½ æ”¾æ¾äº†ä¸å°‘ï¼Œè¿˜äº¤åˆ°äº†æ–°æœ‹å‹ã€‚' } },
                        { text: 'ç‹¬è‡ªå†¥æƒ³ï¼Œè°ƒæ•´å‘¼å¸', 
                          personality: { cautious: 1 },
                          consequence: { stats: { resilience: 2 }, log: 'æ·±å‘¼å¸è®©ä½ çš„å¿ƒè·³é€æ¸å¹³ç¨³ä¸‹æ¥ã€‚' } }
                    ]
                },
                {
                    id: 'E108', stage: 'é¢è¯•è€ƒè¯•', trigger: (gs) => gs.time.days > 113, unique: true,
                    title: 'é¢è¯•æ­£å¼å¼€å§‹ï¼šç»¼åˆåˆ†æé¢˜',
                    description: 'ä½ è¢«å«åˆ°å·äº†ï¼ååœ¨è€ƒå®˜é¢å‰ï¼Œç¬¬ä¸€é¢˜æ˜¯ï¼š"æœ‰äººè¯´95åæ˜¯èººå¹³çš„ä¸€ä»£ï¼Œä¹Ÿæœ‰äººè¯´95åæ˜¯æœ€æœ‰å¸Œæœ›çš„ä¸€ä»£ï¼Œä½ æ€ä¹ˆçœ‹ï¼Ÿ"',
                    choices: [
                        { text: 'ä»è‡ªèº«ç»å†å‡ºå‘ï¼ŒçœŸè¯šè¡¨è¾¾', 
                          personality: { innovative: 2, social: 1 },
                          consequence: (gs) => {
                            const score = 60 + gs.examProgress.mockInterviews * 10 + gs.player.stats.communication + Math.floor(Math.random() * 15);
                            return {
                                examProgress: { interviewScore: score },
                                stats: { communication: 2, resilience: 1 },
                                log: `ä½ çœŸè¯šåœ°åˆ†äº«äº†è‡ªå·±çš„è§‚ç‚¹å’Œç»å†ï¼Œè€ƒå®˜é¢‘é¢‘ç‚¹å¤´ã€‚ä½ æ„Ÿè§‰å‘æŒ¥å¾—ä¸é”™ã€‚`
                            };
                          }},
                        { text: 'ç”¨æ ‡å‡†ç­”é¢˜æ¡†æ¶å›ç­”', 
                          personality: { traditional: 2, cautious: 1 },
                          consequence: (gs) => {
                            const score = 55 + gs.examProgress.mockInterviews * 8 + gs.player.stats.professional + Math.floor(Math.random() * 10);
                            return {
                                examProgress: { interviewScore: score },
                                stats: { professional: 1 },
                                log: `ä½ æŒ‰ç…§èƒŒè¿‡çš„æ¡†æ¶å›ç­”ï¼Œé€»è¾‘æ¸…æ™°ä½†ç¼ºä¹ä¸ªäººç‰¹è‰²ã€‚`
                            };
                          }},
                        { text: 'ç´§å¼ å¾—æœ‰äº›ç»“å·´', 
                          consequence: (gs) => {
                            const score = 45 + gs.examProgress.mockInterviews * 5 + gs.player.stats.resilience + Math.floor(Math.random() * 10);
                            return {
                                examProgress: { interviewScore: score },
                                stats: { resilience: -1 },
                                log: `ç´§å¼ è®©ä½ çš„è¡¨è¾¾ä¸å¤Ÿæµç•…ï¼Œä½†ä½ åŠªåŠ›è¡¨è¾¾å®Œäº†è‡ªå·±çš„è§‚ç‚¹ã€‚`
                            };
                          }}
                    ]
                },
                {
                    id: 'E109', stage: 'é¢è¯•è€ƒè¯•', trigger: (gs) => gs.time.days > 114, unique: true,
                    title: 'é¢è¯•ç»“æœæ­æ™“',
                    description: 'é¢è¯•ç»“æŸäº†ï¼Œä½ å¿å¿‘ä¸å®‰åœ°ç­‰å¾…ç€ç»“æœ...',
                    choices: [
                        { text: 'æŸ¥çœ‹é¢è¯•ç»“æœ', consequence: (gs) => {
                            const finalScore = gs.examProgress.interviewScore || 60;
                            if (finalScore >= 80) {
                                // é¢è¯•é€šè¿‡ï¼Œè½¬æ¢åˆ°å…¥èŒé€‚åº”é˜¶æ®µ
                                gs.player.stage = 'å…¥èŒé€‚åº”';
                                gs.time.days = 120;
                                return { 
                                    log: `æ­å–œï¼ä½ çš„é¢è¯•æˆç»©æ˜¯${finalScore}åˆ†ï¼ŒæˆåŠŸé€šè¿‡é¢è¯•ï¼ğŸ‰ æ­å–œä¸Šå²¸ï¼ä½ å³å°†å¼€å§‹å…¬åŠ¡å‘˜ç”Ÿæ¶¯ï¼`,
                                    achievement: 'ACE_INTERVIEW',
                                    nextStage: true
                                };
                            } else {
                                return { 
                                    log: `å¾ˆé—æ†¾ï¼Œä½ çš„é¢è¯•æˆç»©æ˜¯${finalScore}åˆ†ï¼Œæ²¡æœ‰é€šè¿‡é¢è¯•ã€‚ä½†è¿™æ¬¡ç»å†è®©ä½ æˆé•¿äº†å¾ˆå¤šï¼Œç›¸ä¿¡ä¸‹æ¬¡ä¸€å®šèƒ½æˆåŠŸï¼`,
                                    gameOver: true 
                                };
                            }
                        }}
                    ]
                },
                
                // ========== å…¥èŒé€‚åº” ==========
                {
                    id: 'E201', stage: 'å…¥èŒé€‚åº”', trigger: () => true, unique: true,
                    title: 'æ–°äººæŠ¥åˆ°',
                    description: 'ä½ å¸¦ç€æ¿€åŠ¨çš„å¿ƒæƒ…æ¥åˆ°å•ä½æŠ¥åˆ°ï¼ŒåŠå…¬å®¤ä¸»ä»»æŠŠä½ ä»‹ç»ç»™äº†ä½ çš„å¯¼å¸ˆâ€”â€”ä¸€ä½ç»éªŒä¸°å¯Œçš„è€åŒå¿—ç‹ç§‘é•¿ã€‚',
                    choices: [
                        { text: 'è°¦è™šè°¨æ…ï¼Œä¸»åŠ¨è¯·æ•™', consequence: { stats: { communication: 2 }, influence: 5, log: 'ä½ ä¸»åŠ¨å‘ç‹ç§‘é•¿é—®å¥½ï¼Œå¹¶è¡¨ç¤ºå¸Œæœ›ä»–å¤šå¤šæŒ‡ç‚¹ã€‚ç‹ç§‘é•¿å¯¹ä½ çš„æ€åº¦å¾ˆæ»¡æ„ã€‚', achievement: 'NEWBIE_ONBOARD' } },
                        { text: 'æ²‰é»˜å¯¡è¨€ï¼Œç­‰å¾…å®‰æ’', consequence: { stats: { communication: -1 }, log: 'ä½ æœ‰äº›æ‹˜è°¨ï¼Œåªæ˜¯ç®€å•åœ°æ‰“äº†æ‹›å‘¼ï¼Œç­‰å¾…ç€ä»»åŠ¡ã€‚', achievement: 'NEWBIE_ONBOARD' } }
                    ]
                },
                {
                    id: 'E202', stage: 'å…¥èŒé€‚åº”', trigger: (gs) => gs.time.days > 125, unique: true,
                    title: 'æ•´ç†æ¡£æ¡ˆ',
                    description: 'ç‹ç§‘é•¿è®©ä½ æ•´ç†ä¸€æ‰¹é™ˆå¹´æ¡£æ¡ˆï¼Œå·¥ä½œç¹çä¸”æ¯ç‡¥ã€‚',
                    choices: [
                        { text: 'è€å¿ƒç»†è‡´ï¼Œä¿è´¨ä¿é‡å®Œæˆ', consequence: { stats: { professional: 2, resilience: 1 }, influence: 8, log: 'ä½ èŠ±äº†ä¸€ä¸‹åˆï¼ŒæŠŠæ¡£æ¡ˆæ•´ç†å¾—äº•äº•æœ‰æ¡ï¼Œç‹ç§‘é•¿çœ‹åˆ°åå¾ˆæ»¡æ„ã€‚' } },
                        { text: 'è§‰å¾—æ˜¯å¤§æå°ç”¨ï¼Œæ•·è¡äº†äº‹', consequence: { stats: { professional: -2 }, influence: -5, log: 'ä½ è§‰å¾—è¿™ç§å·¥ä½œæ²¡æœ‰æŠ€æœ¯å«é‡ï¼Œè‰è‰å®Œæˆäº†äº‹ã€‚ç‹ç§‘é•¿æœ‰äº›ä¸æ»¡ã€‚' } },
                        { text: 'åˆ©ç”¨æœºä¼šå­¦ä¹ æ¡£æ¡ˆé‡Œçš„æ¡ˆä¾‹', consequence: { stats: { professional: 2, learning: 2 }, influence: 10, log: 'ä½ åœ¨æ•´ç†ä¸­å‘ç°äº†è®¸å¤šæœ‰ä»·å€¼çš„è¿‡å¾€æ¡ˆä¾‹ï¼Œæ”¶è·é¢‡ä¸°ã€‚' } }
                    ]
                },
                {
                    id: 'E203', stage: 'å…¥èŒé€‚åº”', trigger: (gs) => gs.time.days > 135,
                    title: 'ç¬¬ä¸€æ¬¡ä¼šè®®',
                    description: 'ä½ å‚åŠ äº†äººç”Ÿä¸­ç¬¬ä¸€æ¬¡æ­£å¼çš„å·¥ä½œä¼šè®®ï¼Œé¢†å¯¼è¯¢é—®å¤§å®¶å¯¹æŸä¸ªæ”¿ç­–çš„çœ‹æ³•ã€‚',
                    choices: [
                        { text: 'ç§¯æå‘è¨€ï¼Œåˆ†äº«è‡ªå·±çš„æƒ³æ³•', consequence: { stats: { communication: 2, decision: 1 }, influence: 10, log: 'ä½ å‹‡æ•¢åœ°è¡¨è¾¾äº†è‡ªå·±çš„è§‚ç‚¹ï¼Œè™½ç„¶æœ‰äº›ç´§å¼ ï¼Œä½†å¾—åˆ°äº†è®¤å¯ã€‚' } },
                        { text: 'è®¤çœŸå€¾å¬ï¼Œæš‚ä¸å‘è¨€', consequence: { stats: { learning: 2 }, log: 'ä½ é€‰æ‹©å…ˆå¬å–å¤§å®¶çš„æ„è§ï¼Œå­¦åˆ°äº†å¾ˆå¤šä¸œè¥¿ã€‚' } },
                        { text: 'å¿ƒä¸åœ¨ç„‰ï¼Œèµ°ç¥äº†', consequence: { stats: { professional: -1 }, influence: -3, log: 'ä½ æœ‰äº›ç´§å¼ ï¼Œæ³¨æ„åŠ›ä¸é›†ä¸­ï¼Œé”™è¿‡äº†ä¸€äº›é‡è¦ä¿¡æ¯ã€‚' } }
                    ]
                },
                {
                    id: 'E204', stage: 'å…¥èŒé€‚åº”', trigger: (gs) => gs.time.days > 145,
                    title: 'åŒäº‹çš„é‚€è¯·',
                    description: 'å‡ ä¸ªå¹´è½»åŒäº‹é‚€è¯·ä½ ä¸€èµ·åƒåˆé¥­ï¼Œè¿™æ˜¯èå…¥é›†ä½“çš„å¥½æœºä¼šã€‚',
                    choices: [
                        { text: 'æ¬£ç„¶æ¥å—ï¼Œä¸»åŠ¨äº¤æµ', consequence: { stats: { communication: 3 }, influence: 8, log: 'ä½ å’ŒåŒäº‹ä»¬èŠå¾—å¾ˆå¼€å¿ƒï¼Œå¤§å®¶å¯¹ä½ çš„å°è±¡å¾ˆå¥½ã€‚' } },
                        { text: 'ç¤¼è²Œå‚ä¸ï¼Œä¿æŒè·ç¦»', consequence: { stats: { communication: 1 }, influence: 3, log: 'ä½ å‚ä¸äº†èšé¤ï¼Œä½†ä¿æŒç€é€‚å½“çš„è·ç¦»ã€‚' } },
                        { text: 'ä»¥å·¥ä½œå¿™ä¸ºç”±å©‰æ‹’', consequence: { stats: { professional: 1, communication: -1 }, log: 'ä½ é€‰æ‹©ç»§ç»­å·¥ä½œï¼Œä½†å¯èƒ½é”™è¿‡äº†å»ºç«‹å‹è°Šçš„æœºä¼šã€‚' } }
                    ]
                },
                {
                    id: 'E205', stage: 'å…¥èŒé€‚åº”', trigger: (gs) => gs.time.days > 155,
                    title: 'ç¬¬ä¸€æ¬¡è¡¨æ‰¬',
                    description: 'ç‹ç§‘é•¿åœ¨ç§‘å®¤ä¼šè®®ä¸Šè¡¨æ‰¬äº†ä½ æœ€è¿‘çš„å·¥ä½œè¡¨ç°ï¼Œä½ æ„Ÿåˆ°å¾ˆé«˜å…´ã€‚',
                    choices: [
                        { text: 'è°¦è™šåœ°è¡¨ç¤ºè¿˜éœ€åŠªåŠ›', consequence: { stats: { communication: 2, resilience: 1 }, influence: 5, log: 'ä½ çš„è°¦è™šæ€åº¦è®©å¤§å®¶æ›´åŠ å–œæ¬¢ä½ ã€‚', achievement: 'FIRST_PRAISE' } },
                        { text: 'æ„Ÿè°¢é¢†å¯¼å’ŒåŒäº‹çš„å¸®åŠ©', consequence: { stats: { communication: 3 }, influence: 8, log: 'ä½ çœŸè¯šåœ°æ„Ÿè°¢äº†å¤§å®¶ï¼Œä½“ç°äº†è‰¯å¥½çš„å›¢é˜Ÿç²¾ç¥ã€‚', achievement: 'FIRST_PRAISE' } },
                        { text: 'å†…å¿ƒå¾—æ„ï¼Œä½†è¡¨é¢å¹³é™', consequence: { stats: { resilience: 1 }, influence: 2, log: 'ä½ åŠªåŠ›ä¿æŒå¹³é™ï¼Œä½†å†…å¿ƒè¿˜æ˜¯å¾ˆå¼€å¿ƒã€‚', achievement: 'FIRST_PRAISE' } }
                    ]
                },
                {
                    id: 'E206', stage: 'å…¥èŒé€‚åº”', trigger: (gs) => gs.time.days > 130,
                    title: 'åŠå…¬å®¤çš„ä»£æ²Ÿ',
                    description: 'ä½ å‘ç°åŠå…¬å®¤é‡Œçš„å‰è¾ˆä»¬è¿˜åœ¨ç”¨ä¼ ç»Ÿçš„å·¥ä½œæ–¹å¼ï¼Œè€Œä½ ç†Ÿæ‚‰çš„æ•°å­—åŒ–å·¥å…·ä»–ä»¬éƒ½ä¸å¤ªä¼šç”¨ã€‚',
                    choices: [
                        { text: 'ä¸»åŠ¨æ•™å¤§å®¶ä½¿ç”¨æ–°å·¥å…·', consequence: { stats: { communication: 3, learning: 1 }, influence: 12, log: 'ä½ è€å¿ƒåœ°æ•™åŒäº‹ä»¬ä½¿ç”¨æ–°å·¥å…·ï¼Œå¤§å®¶éƒ½å¾ˆæ„Ÿæ¿€ã€‚', achievement: 'TREND_SETTER' } },
                        { text: 'é€‚åº”ä¼ ç»Ÿæ–¹å¼ï¼Œä¿æŒä½è°ƒ', consequence: { stats: { resilience: 2 }, influence: 3, log: 'ä½ é€‰æ‹©å…¥ä¹¡éšä¿—ï¼Œä½†æœ‰æ—¶æ„Ÿè§‰æ•ˆç‡ä¸é«˜ã€‚' } },
                        { text: 'ç§ä¸‹ç”¨æ–°æ–¹æ³•ï¼Œå…¬å¼€è·Ÿä¼ ç»Ÿ', consequence: { stats: { decision: 1, professional: 1 }, influence: 5, log: 'ä½ æ‰¾åˆ°äº†å¹³è¡¡ç‚¹ï¼Œæ—¢æé«˜äº†æ•ˆç‡ï¼Œåˆæ²¡æœ‰å¼•èµ·ä¸å¿…è¦çš„å…³æ³¨ã€‚' } }
                    ]
                },
                {
                    id: 'E207', stage: 'å…¥èŒé€‚åº”', trigger: (gs) => gs.time.days > 140,
                    title: 'ç½‘ç»œçƒ­æ¢—è¿›åŠå…¬å®¤',
                    description: 'ä½ æ— æ„ä¸­åœ¨å·¥ä½œç¾¤é‡Œå‘äº†ä¸€ä¸ªå¾ˆç«çš„è¡¨æƒ…åŒ…ï¼Œæ²¡æƒ³åˆ°è¿å¹³æ—¶ä¸¥è‚ƒçš„è€åŒå¿—éƒ½è§‰å¾—å¾ˆæœ‰è¶£ã€‚',
                    choices: [
                        { text: 'é€‚åº¦åˆ†äº«ï¼Œæ´»è·ƒæ°”æ°›', 
                          personality: { social: 2, innovative: 1 },
                          consequence: { stats: { communication: 3, resilience: 1 }, influence: 15, log: 'ä½ æˆäº†åŠå…¬å®¤çš„"å¼€å¿ƒæœ"ï¼Œå¤§å®¶éƒ½å–œæ¬¢ä½ çš„å¹½é»˜ã€‚', achievement: 'MEME_MASTER', triggerEvent: 'CE001' } },
                        { text: 'ç«‹å³é“æ­‰ï¼Œä¿æŒä¸¥è‚ƒ', 
                          personality: { cautious: 2, traditional: 1 },
                          consequence: { stats: { communication: -1, resilience: -1 }, influence: 0, log: 'ä½ è§‰å¾—å¾ˆå°´å°¬ï¼Œé©¬ä¸Šé“æ­‰ï¼Œä½†åŒäº‹ä»¬å…¶å®å¾ˆå–œæ¬¢è¿™ç§è½»æ¾çš„æ°›å›´ã€‚' } },
                        { text: 'è§‚å¯Ÿååº”ï¼Œé€‚åº¦è°ƒæ•´', 
                          personality: { cautious: 1 },
                          consequence: { stats: { decision: 2, communication: 1 }, influence: 8, log: 'ä½ å¾ˆèªæ˜åœ°è§‚å¯Ÿäº†å¤§å®¶çš„ååº”ï¼Œæ‰¾åˆ°äº†åˆé€‚çš„å°ºåº¦ã€‚' } }
                    ]
                },
                // è¿é”äº‹ä»¶ï¼šè¡¨æƒ…åŒ…äº‹ä»¶çš„åç»­
                {
                    id: 'CE001', stage: 'å…¥èŒé€‚åº”', trigger: () => false, // ä¸ä¼šè‡ªåŠ¨è§¦å‘ï¼Œåªèƒ½é€šè¿‡å…¶ä»–äº‹ä»¶è¿é”
                    title: 'æ„å¤–çš„ç½‘ç»œèµ°çº¢',
                    description: 'ä½ å‘çš„é‚£ä¸ªè¡¨æƒ…åŒ…è¢«åŒäº‹è½¬å‘åˆ°äº†æœ‹å‹åœˆï¼Œæ²¡æƒ³åˆ°ä¼ æ’­å¼€æ¥ï¼Œç”šè‡³ä¸Šäº†å¾®åšçƒ­æœï¼#å…¬åŠ¡å‘˜è¡¨æƒ…åŒ…#æˆäº†çƒ­é—¨è¯é¢˜ã€‚',
                    choices: [
                        { text: 'ç§¯æå›åº”ï¼Œä¼ æ’­æ­£èƒ½é‡', 
                          personality: { innovative: 2, social: 1 },
                          consequence: { stats: { communication: 4, decision: 2 }, influence: 50, log: 'ä½ çš„å›åº”è·å¾—äº†ç½‘å‹å¥½è¯„ï¼Œæˆä¸ºäº†æ­£é¢å…¸å‹ï¼', achievement: 'SOCIAL_MEDIA_HERO' } },
                        { text: 'ä½è°ƒå¤„ç†ï¼Œé¿å…ç‚’ä½œ', 
                          personality: { cautious: 2 },
                          consequence: { stats: { resilience: 2 }, influence: 20, log: 'ä½ é€‰æ‹©ä½è°ƒå¤„ç†ï¼Œä½†è¿™ç§è°¦é€Šçš„æ€åº¦åè€Œæ›´å—æ¬¢è¿ã€‚' } },
                        { text: 'è¯·æ±‚åˆ é™¤ï¼Œæ‹…å¿ƒå½±å“å·¥ä½œ', 
                          consequence: { stats: { resilience: -2 }, influence: -10, log: 'ä½ çš„ç´§å¼ ååº”åè€Œå¼•èµ·äº†æ›´å¤šå…³æ³¨ï¼Œé€‚å¾—å…¶åã€‚' } }
                    ]
                },
                {
                    id: 'E208', stage: 'å…¥èŒé€‚åº”', trigger: (gs) => gs.time.days > 165,
                    title: 'åŠ ç­æ–‡åŒ–çš„å†²çª',
                    description: 'ä½ å‘ç°å¾ˆå¤šåŒäº‹éƒ½æœ‰åŠ ç­çš„ä¹ æƒ¯ï¼Œä½†ä½ è§‰å¾—æé«˜æ•ˆç‡æ›´é‡è¦ã€‚ä»Šå¤©åˆæ˜¯ä¸€ä¸ªæœ¬æ¥å¯ä»¥æŒ‰æ—¶å®Œæˆçš„å·¥ä½œæ—¥ã€‚',
                    choices: [
                        { text: 'åšæŒé«˜æ•ˆå·¥ä½œï¼ŒæŒ‰æ—¶ä¸‹ç­', consequence: { stats: { decision: 2, resilience: 2 }, influence: 5, log: 'ä½ åšæŒäº†è‡ªå·±çš„å·¥ä½œç†å¿µï¼Œä½†å¯èƒ½ç»™äººç•™ä¸‹äº†ä¸å¤ŸåŠªåŠ›çš„å°è±¡ã€‚' } },
                        { text: 'é€‚å½“åŠ ç­ï¼Œèå…¥å›¢é˜Ÿ', consequence: { stats: { communication: 2, resilience: -1 }, influence: 8, log: 'ä½ é€‰æ‹©äº†å¦¥åï¼Œä½†å†…å¿ƒè§‰å¾—æœ‰äº›æ— å¥ˆã€‚' } },
                        { text: 'å¸¦å¤´æé«˜æ•ˆç‡ï¼Œæ”¹å˜æ°›å›´', consequence: { stats: { professional: 3, decision: 2 }, influence: 18, log: 'ä½ é€šè¿‡è‡ªå·±çš„è¡ŒåŠ¨å½±å“äº†å›¢é˜Ÿï¼Œå¤§å®¶å¼€å§‹é‡è§†å·¥ä½œæ•ˆç‡ã€‚', achievement: 'BALANCE_MASTER' } }
                    ]
                },
                
                // ========== èƒ½åŠ›æå‡ ==========
                {
                    id: 'E301', stage: 'èƒ½åŠ›æå‡', trigger: () => true, unique: true,
                    title: 'ç‹¬ç«‹è´Ÿè´£é¡¹ç›®',
                    description: 'ç»è¿‡å‡ ä¸ªæœˆçš„é€‚åº”ï¼Œç‹ç§‘é•¿å†³å®šè®©ä½ ç‹¬ç«‹è´Ÿè´£ä¸€ä¸ªå°é¡¹ç›®â€”â€”ç»„ç»‡ä¸€æ¬¡ç¤¾åŒºè°ƒç ”æ´»åŠ¨ã€‚',
                    choices: [
                        { text: 'åˆ¶å®šè¯¦ç»†è®¡åˆ’ï¼Œç³»ç»Ÿæ¨è¿›', consequence: { stats: { professional: 3, decision: 2 }, influence: 15, log: 'ä½ åˆ¶å®šäº†è¯¦ç»†çš„è°ƒç ”è®¡åˆ’ï¼Œé¡¹ç›®è¿›å±•é¡ºåˆ©ã€‚' } },
                        { text: 'è¾¹åšè¾¹å­¦ï¼Œçµæ´»åº”å¯¹', consequence: { stats: { learning: 2, resilience: 2 }, influence: 10, log: 'ä½ åœ¨å®è·µä¸­å­¦ä¹ ï¼Œè™½ç„¶æœ‰äº›æ³¢æŠ˜ï¼Œä½†æœ€ç»ˆå®Œæˆäº†ä»»åŠ¡ã€‚' } },
                        { text: 'æ„Ÿåˆ°å‹åŠ›ï¼Œå¯»æ±‚å¸®åŠ©', consequence: { stats: { communication: 2, professional: 1 }, influence: 8, log: 'ä½ ä¸»åŠ¨å¯»æ±‚åŒäº‹çš„å¸®åŠ©ï¼Œå¤§å®¶éƒ½å¾ˆæ”¯æŒä½ ã€‚' } }
                    ]
                },
                {
                    id: 'E302', stage: 'èƒ½åŠ›æå‡', trigger: (gs) => gs.time.days > 185,
                    title: 'å¤„ç†æŠ•è¯‰',
                    description: 'ä¸€ä½å¸‚æ°‘å¯¹æ”¿åºœæœåŠ¡ä¸æ»¡ï¼Œæƒ…ç»ªæ¿€åŠ¨åœ°æ¥åˆ°ä½ ä»¬ç§‘å®¤æŠ•è¯‰ã€‚ä½œä¸ºå€¼ç­äººå‘˜ï¼Œä½ éœ€è¦å¤„ç†è¿™ä¸ªæƒ…å†µã€‚',
                    choices: [
                        { text: 'è€å¿ƒå€¾å¬ï¼Œè¯¦ç»†è®°å½•', consequence: { stats: { communication: 3, resilience: 1 }, influence: 12, log: 'ä½ è€å¿ƒåœ°å¬å–äº†å¸‚æ°‘çš„æ„è§ï¼Œå¹¶è¯¦ç»†è®°å½•äº†é—®é¢˜ã€‚å¸‚æ°‘çš„æƒ…ç»ªé€æ¸å¹³é™ä¸‹æ¥ã€‚' } },
                        { text: 'è§£é‡Šæ”¿ç­–ï¼ŒåŒ–è§£è¯¯ä¼š', consequence: { stats: { professional: 2, communication: 2 }, influence: 15, log: 'ä½ è¯¦ç»†è§£é‡Šäº†ç›¸å…³æ”¿ç­–ï¼ŒåŒ–è§£äº†å¸‚æ°‘çš„è¯¯ä¼šï¼Œè·å¾—äº†ç†è§£ã€‚' } },
                        { text: 'æ„Ÿåˆ°ç´§å¼ ï¼Œè¯·ç¤ºé¢†å¯¼', consequence: { stats: { resilience: -1, learning: 1 }, influence: 5, log: 'ä½ æ„Ÿåˆ°æœ‰äº›ç´§å¼ ï¼ŒåŠæ—¶è¯·ç¤ºäº†é¢†å¯¼ï¼Œåœ¨æŒ‡å¯¼ä¸‹å¤„ç†äº†é—®é¢˜ã€‚' } }
                    ]
                },
                {
                    id: 'E303', stage: 'èƒ½åŠ›æå‡', trigger: (gs) => gs.time.days > 200,
                    title: 'çªå‘äº‹ä»¶',
                    description: 'è¾–åŒºå†…å‘ç”Ÿäº†ä¸€èµ·çªå‘äº‹ä»¶ï¼Œéœ€è¦ç´§æ€¥åè°ƒå„éƒ¨é—¨å“åº”ã€‚ä½ è¢«ä¸´æ—¶æŒ‡æ´¾ååŠ©å¤„ç†ã€‚',
                    choices: [
                        { text: 'å†·é™åˆ†æï¼Œå¿«é€Ÿè¡ŒåŠ¨', consequence: { stats: { decision: 3, resilience: 2 }, influence: 20, log: 'ä½ å†·é™åœ°åˆ†æäº†æƒ…å†µï¼Œå¿«é€Ÿåè°ƒå„æ–¹èµ„æºï¼Œäº‹ä»¶å¾—åˆ°äº†å¦¥å–„å¤„ç†ã€‚', achievement: 'CRISIS_HANDLER' } },
                        { text: 'æŒ‰éƒ¨å°±ç­ï¼Œç¨³å¦¥å¤„ç†', consequence: { stats: { professional: 2, resilience: 1 }, influence: 12, log: 'ä½ ä¸¥æ ¼æŒ‰ç…§åº”æ€¥é¢„æ¡ˆæ‰§è¡Œï¼Œè™½ç„¶é€Ÿåº¦ä¸å¿«ï¼Œä½†å¤„ç†å¾—å¾ˆç¨³å¦¥ã€‚' } },
                        { text: 'æ„Ÿåˆ°æ…Œä¹±ï¼Œé…åˆä»–äºº', consequence: { stats: { communication: 1, resilience: -1 }, influence: 5, log: 'é¢å¯¹çªå‘æƒ…å†µï¼Œä½ æœ‰äº›æ…Œä¹±ï¼Œä½†åŠªåŠ›é…åˆå…¶ä»–åŒäº‹çš„å·¥ä½œã€‚' } }
                    ]
                },
                {
                    id: 'E304', stage: 'èƒ½åŠ›æå‡', trigger: (gs) => gs.time.days > 220,
                    title: 'åŸ¹è®­æœºä¼š',
                    description: 'å•ä½æä¾›äº†ä¸€ä¸ªå¤–å‡ºåŸ¹è®­çš„æœºä¼šï¼Œå¯ä»¥å­¦ä¹ å…ˆè¿›çš„ç®¡ç†ç†å¿µå’Œå·¥ä½œæ–¹æ³•ã€‚',
                    choices: [
                        { text: 'ç§¯ææŠ¥åï¼Œçæƒœæœºä¼š', consequence: { stats: { learning: 3, professional: 2 }, influence: 10, log: 'ä½ ç§¯ææŠ¥åå‚åŠ åŸ¹è®­ï¼Œå­¦åˆ°äº†å¾ˆå¤šæ–°çŸ¥è¯†å’Œæ–¹æ³•ã€‚' } },
                        { text: 'è®¤ä¸ºå·¥ä½œæ›´é‡è¦ï¼Œæ”¾å¼ƒæœºä¼š', consequence: { stats: { professional: 1, learning: -1 }, influence: 5, log: 'ä½ è®¤ä¸ºå½“å‰å·¥ä½œæ›´é‡è¦ï¼Œæ”¾å¼ƒäº†åŸ¹è®­æœºä¼šã€‚' } },
                        { text: 'çŠ¹è±«ä¸å†³ï¼Œé”™è¿‡æŠ¥å', consequence: { stats: { decision: -1 }, log: 'ä½ çŠ¹è±«äº†å¤ªä¹…ï¼Œé”™è¿‡äº†æŠ¥åæ—¶é—´ã€‚' } }
                    ]
                },
                {
                    id: 'E305', stage: 'èƒ½åŠ›æå‡', trigger: (gs) => gs.time.days > 190,
                    title: 'ç½‘ç»œç›´æ’­é£æ³¢',
                    description: 'ä½ åœ¨å¤„ç†ä¸€ä¸ªå…¬åŠ¡æ—¶ï¼Œè¢«è·¯äººæ‹ä¸‹è§†é¢‘ä¸Šä¼ åˆ°ç½‘ç»œï¼Œæ„å¤–æˆä¸ºçƒ­ç‚¹ã€‚è§†é¢‘ä¸­ä½ çš„ä¸“ä¸šè¡¨ç°è·å¾—äº†å¾ˆå¤šç‚¹èµã€‚',
                    choices: [
                        { text: 'ä½è°ƒå¤„ç†ï¼Œé¿å…ç‚’ä½œ', consequence: { stats: { decision: 2, resilience: 1 }, influence: 8, log: 'ä½ é€‰æ‹©ä½è°ƒå¤„ç†ï¼Œä½†ç½‘å‹ä»¬æ›´åŠ æ¬£èµä½ çš„è°¦é€Šã€‚' } },
                        { text: 'ç§¯æå›åº”ï¼Œä¼ æ’­æ­£èƒ½é‡', consequence: { stats: { communication: 3, decision: 2 }, influence: 25, log: 'ä½ ç§¯æå›åº”ç½‘å‹å…³æ³¨ï¼Œä¼ æ’­äº†æ­£é¢å½¢è±¡ã€‚', achievement: 'SOCIAL_MEDIA_HERO' } },
                        { text: 'è¯·æ±‚åˆ é™¤è§†é¢‘ï¼Œé¿å…å…³æ³¨', consequence: { stats: { resilience: -1 }, influence: 0, log: 'ä½ æ‹…å¿ƒç½‘ç»œå…³æ³¨ä¼šå½±å“å·¥ä½œï¼Œä½†è¿™ç§åšæ³•åè€Œå¼•èµ·äº†ä¸€äº›äº‰è®®ã€‚' } }
                    ]
                },
                {
                    id: 'E306', stage: 'èƒ½åŠ›æå‡', trigger: (gs) => gs.time.days > 210,
                    title: '95åçš„å·¥ä½œç†å¿µ',
                    description: 'åœ¨ä¸€æ¬¡éƒ¨é—¨ä¼šè®®ä¸Šï¼Œä½ æå‡ºäº†ä¸€äº›95åçš„å·¥ä½œç†å¿µï¼Œæ¯”å¦‚"å·¥ä½œæ˜¯ä¸ºäº†æ›´å¥½çš„ç”Ÿæ´»"ï¼Œå¼•èµ·äº†ä¸å°çš„è®¨è®ºã€‚',
                    choices: [
                        { text: 'åšæŒè§‚ç‚¹ï¼Œå¼•å‘æ€è€ƒ', consequence: { stats: { decision: 3, communication: 2 }, influence: 20, log: 'ä½ çš„è§‚ç‚¹å¼•å‘äº†å¤§å®¶çš„æ€è€ƒï¼Œè®©å·¥ä½œæ°›å›´æ›´åŠ å¼€æ”¾ã€‚', achievement: 'CONTROVERSIAL_CHOICE' } },
                        { text: 'é€‚å½“å¦¥åï¼Œæ±‚åŒå­˜å¼‚', consequence: { stats: { communication: 2, resilience: 1 }, influence: 10, log: 'ä½ é€‰æ‹©äº†æ›´æ¸©å’Œçš„è¡¨è¾¾æ–¹å¼ï¼Œä½†ä¹ŸåšæŒäº†è‡ªå·±çš„æ ¸å¿ƒè§‚ç‚¹ã€‚' } },
                        { text: 'ç«‹å³é“æ­‰ï¼Œæ”¶å›è¨€è®º', consequence: { stats: { communication: -2, resilience: -1 }, influence: -5, log: 'ä½ åŒ†å¿™é“æ­‰ï¼Œä½†å†…å¿ƒæ„Ÿåˆ°å¾ˆå§”å±ˆï¼Œè§‰å¾—æ²¡æœ‰è¢«ç†è§£ã€‚' } }
                    ]
                },
                {
                    id: 'E307', stage: 'èƒ½åŠ›æå‡', trigger: (gs) => gs.time.days > 235,
                    title: 'çŸ­è§†é¢‘æ™®æ³•å°è¯•',
                    description: 'ä½ æè®®åˆ¶ä½œçŸ­è§†é¢‘æ¥æ™®åŠæ”¿ç­–çŸ¥è¯†ï¼Œè®©æ›´å¤šå¹´è½»äººäº†è§£æ”¿åºœå·¥ä½œã€‚ä½†ä¸€äº›åŒäº‹è®¤ä¸ºè¿™ç§æ–¹å¼ä¸å¤Ÿä¸¥è‚ƒã€‚',
                    choices: [
                        { text: 'åšæŒåˆ›æ–°ï¼Œåˆ¶ä½œè§†é¢‘', consequence: { stats: { professional: 3, communication: 2, learning: 1 }, influence: 30, log: 'ä½ çš„çŸ­è§†é¢‘è·å¾—äº†å¾ˆå¥½çš„åå“ï¼Œæˆä¸ºæ”¿åŠ¡åˆ›æ–°çš„å…¸å‹æ¡ˆä¾‹ã€‚', achievement: 'INNOVATOR' } },
                        { text: 'å¯»æ±‚æ”¯æŒï¼Œäº‰å–è®¤å¯', consequence: { stats: { communication: 2, decision: 1 }, influence: 15, log: 'ä½ é€šè¿‡åŠªåŠ›äº‰å–åˆ°äº†é¢†å¯¼çš„æ”¯æŒï¼Œé¡¹ç›®å¾—ä»¥æ¨è¿›ã€‚' } },
                        { text: 'æ”¾å¼ƒæƒ³æ³•ï¼Œä¿æŒä¼ ç»Ÿ', consequence: { stats: { resilience: -1, professional: -1 }, influence: 0, log: 'ä½ æ”¾å¼ƒäº†åˆ›æ–°æƒ³æ³•ï¼Œä½†å¿ƒä¸­æ€»è§‰å¾—é”™è¿‡äº†ä»€ä¹ˆã€‚' } }
                    ]
                },
                
                // ========== èŒä¸šå‘å±• ==========
                {
                    id: 'E401', stage: 'èŒä¸šå‘å±•', trigger: () => true, unique: true,
                    title: 'æ™‹å‡æœºä¼š',
                    description: 'ç»è¿‡ä¸€å¹´å¤šçš„åŠªåŠ›å·¥ä½œï¼Œä½ è·å¾—äº†æ™‹å‡çš„æœºä¼šã€‚ä½†ç«äº‰å¾ˆæ¿€çƒˆï¼Œéœ€è¦é€šè¿‡è€ƒæ ¸å’Œé¢è¯•ã€‚',
                    choices: [
                        { text: 'å…¨åŠ›å‡†å¤‡ï¼Œäº‰å–æ™‹å‡', consequence: { stats: { professional: 2, decision: 2 }, influence: 15, log: 'ä½ å…¨åŠ›å‡†å¤‡è€ƒæ ¸ï¼Œå±•ç°äº†å‡ºè‰²çš„èƒ½åŠ›å’Œæ½œåŠ›ã€‚' } },
                        { text: 'é¡ºå…¶è‡ªç„¶ï¼Œä¸å¼ºæ±‚', consequence: { stats: { resilience: 2 }, influence: 5, log: 'ä½ ä¿æŒå¹³å¸¸å¿ƒï¼Œè®¤ä¸ºæœºä¼šåˆé€‚å°±äº‰å–ï¼Œä¸åˆé€‚ä¹Ÿä¸å¼ºæ±‚ã€‚' } },
                        { text: 'æ„Ÿåˆ°å‹åŠ›ï¼Œæ‹…å¿ƒå¤±è´¥', consequence: { stats: { resilience: -2, professional: 1 }, log: 'é¢å¯¹æ™‹å‡æœºä¼šï¼Œä½ æ„Ÿåˆ°å¾ˆå¤§å‹åŠ›ï¼Œæ‹…å¿ƒè‡ªå·±ä¸å¤Ÿä¼˜ç§€ã€‚' } }
                    ]
                },
                {
                    id: 'E402', stage: 'èŒä¸šå‘å±•', trigger: (gs) => gs.time.days > 280,
                    title: 'è·¨éƒ¨é—¨åˆä½œ',
                    description: 'ä½ éœ€è¦ä¸å…¶ä»–éƒ¨é—¨åˆä½œå®Œæˆä¸€ä¸ªé‡è¦é¡¹ç›®ï¼Œè¿™è€ƒéªŒç€ä½ çš„åè°ƒèƒ½åŠ›ã€‚',
                    choices: [
                        { text: 'ä¸»åŠ¨æ²Ÿé€šï¼Œå»ºç«‹è”ç³»', consequence: { stats: { communication: 3, decision: 1 }, influence: 18, log: 'ä½ ä¸»åŠ¨ä¸å„éƒ¨é—¨å»ºç«‹è”ç³»ï¼Œé¡¹ç›®æ¨è¿›å¾—å¾ˆé¡ºåˆ©ã€‚' } },
                        { text: 'ä¸“æ³¨æœ¬èŒï¼Œé…åˆä»–äºº', consequence: { stats: { professional: 2 }, influence: 10, log: 'ä½ ä¸“æ³¨äºè‡ªå·±çš„éƒ¨åˆ†ï¼Œç§¯æé…åˆå…¶ä»–éƒ¨é—¨çš„å·¥ä½œã€‚' } },
                        { text: 'ç­‰å¾…æŒ‡ç¤ºï¼Œè¢«åŠ¨å‚ä¸', consequence: { stats: { decision: -1 }, influence: 3, log: 'ä½ ä¹ æƒ¯ç­‰å¾…ä¸Šçº§æŒ‡ç¤ºï¼Œåœ¨åˆä½œä¸­æ˜¾å¾—æ¯”è¾ƒè¢«åŠ¨ã€‚' } }
                    ]
                },
                {
                    id: 'E403', stage: 'èŒä¸šå‘å±•', trigger: (gs) => gs.time.days > 300,
                    title: 'æ”¿ç­–åˆ›æ–°',
                    description: 'ä½ å‘ç°äº†å·¥ä½œä¸­çš„ä¸€ä¸ªé—®é¢˜ï¼Œå¹¶æƒ³å‡ºäº†æ”¹è¿›çš„æ–¹æ¡ˆã€‚ä½ è€ƒè™‘æ˜¯å¦è¦æå‡ºè¿™ä¸ªå»ºè®®ã€‚',
                    choices: [
                        { text: 'å‹‡æ•¢æå‡ºåˆ›æ–°å»ºè®®', consequence: { stats: { decision: 3, professional: 2 }, influence: 25, log: 'ä½ çš„åˆ›æ–°å»ºè®®å¾—åˆ°äº†é¢†å¯¼çš„é‡è§†ï¼Œå¹¶è¢«é‡‡çº³å®æ–½ã€‚' } },
                        { text: 'å…ˆå®Œå–„æ–¹æ¡ˆå†æå‡º', consequence: { stats: { professional: 2, learning: 1 }, influence: 15, log: 'ä½ èŠ±æ—¶é—´å®Œå–„äº†æ–¹æ¡ˆï¼Œæå‡ºåè·å¾—äº†å¥½è¯„ã€‚' } },
                        { text: 'æ‹…å¿ƒé£é™©ï¼Œä¿æŒç°çŠ¶', consequence: { stats: { resilience: -1 }, influence: 0, log: 'ä½ æ‹…å¿ƒåˆ›æ–°çš„é£é™©ï¼Œé€‰æ‹©ç»´æŒç°çŠ¶ã€‚' } }
                    ]
                },
                {
                    id: 'E404', stage: 'èŒä¸šå‘å±•', trigger: (gs) => gs.time.days > 320,
                    title: 'åª’ä½“å…³æ³¨',
                    description: 'ä½ å‚ä¸çš„ä¸€ä¸ªé¡¹ç›®å—åˆ°äº†åª’ä½“å…³æ³¨ï¼Œè®°è€…æƒ³è¦é‡‡è®¿ä½ ã€‚è¿™æ˜¯å±•ç¤ºå½¢è±¡çš„å¥½æœºä¼šï¼Œä½†ä¹Ÿæœ‰é£é™©ã€‚',
                    choices: [
                        { text: 'æ¥å—é‡‡è®¿ï¼Œå±•ç¤ºæˆæœ', consequence: { stats: { communication: 3, decision: 1 }, influence: 30, log: 'ä½ æ¥å—äº†é‡‡è®¿ï¼Œå¾ˆå¥½åœ°å±•ç¤ºäº†å·¥ä½œæˆæœå’Œæ”¿åºœå½¢è±¡ã€‚' } },
                        { text: 'ä½è°ƒå¤„ç†ï¼Œé¿å…é£å¤´', consequence: { stats: { resilience: 1 }, influence: 10, log: 'ä½ é€‰æ‹©ä½è°ƒå¤„ç†ï¼Œé¿å…æˆä¸ºç„¦ç‚¹ã€‚' } },
                        { text: 'è¯·ç¤ºé¢†å¯¼ï¼Œç­‰å¾…æŒ‡ç¤º', consequence: { stats: { professional: 1 }, influence: 15, log: 'ä½ åŠæ—¶è¯·ç¤ºäº†é¢†å¯¼ï¼Œåœ¨æŒ‡å¯¼ä¸‹å¦¥å–„å¤„ç†äº†åª’ä½“å…³æ³¨ã€‚' } }
                    ]
                },
                {
                    id: 'E405', stage: 'èŒä¸šå‘å±•', trigger: (gs) => gs.time.days > 350,
                    title: 'äººç”Ÿé€‰æ‹©',
                    description: 'ç»è¿‡å‡ å¹´çš„å·¥ä½œï¼Œä½ å¯¹å…¬åŠ¡å‘˜è¿™ä¸ªèŒä¸šæœ‰äº†æ›´æ·±çš„ç†è§£ã€‚ç°åœ¨ä½ éœ€è¦æ€è€ƒæœªæ¥çš„å‘å±•æ–¹å‘ã€‚',
                    choices: [
                        { text: 'ç»§ç»­æ·±è€•ï¼Œæˆä¸ºä¸“å®¶', consequence: { stats: { professional: 3, learning: 2 }, influence: 20, log: 'ä½ å†³å®šåœ¨è¿™ä¸ªé¢†åŸŸç»§ç»­æ·±è€•ï¼Œæˆä¸ºä¸šåŠ¡ä¸“å®¶ã€‚' } },
                        { text: 'æ‹“å±•è§†é‡ï¼Œå…¨é¢å‘å±•', consequence: { stats: { communication: 2, decision: 2, learning: 1 }, influence: 25, log: 'ä½ é€‰æ‹©æ‹“å±•è§†é‡ï¼Œåœ¨å„ä¸ªæ–¹é¢å…¨é¢å‘å±•ã€‚' } },
                        { text: 'ä¿æŒç°çŠ¶ï¼Œç¨³å®šå·¥ä½œ', consequence: { stats: { resilience: 2 }, influence: 10, log: 'ä½ é€‰æ‹©ä¿æŒç°çŠ¶ï¼Œäº«å—ç¨³å®šçš„å·¥ä½œç”Ÿæ´»ã€‚' } }
                    ]
                },
                {
                    id: 'E406', stage: 'èŒä¸šå‘å±•', trigger: (gs) => gs.time.days > 290,
                    title: 'ç½‘çº¢å…¬åŠ¡å‘˜çš„å›°æ‰°',
                    description: 'ç”±äºä¹‹å‰çš„å‡ æ¬¡ç½‘ç»œäº‹ä»¶ï¼Œä½ åœ¨ç½‘ä¸Šæœ‰äº†ä¸€å®šçŸ¥ååº¦ï¼Œè¢«ç½‘å‹ç§°ä¸º"ç½‘çº¢å…¬åŠ¡å‘˜"ã€‚æœ‰åª’ä½“æƒ³è¦æ·±åº¦é‡‡è®¿ä½ ã€‚',
                    choices: [
                        { text: 'æ¥å—é‡‡è®¿ï¼Œåˆ†äº«ç»éªŒ', consequence: { stats: { communication: 3, decision: 2 }, influence: 40, log: 'ä½ çš„é‡‡è®¿å¼•èµ·äº†å¾ˆå¤§åå“ï¼Œæˆä¸ºå¹´è½»å…¬åŠ¡å‘˜çš„ä»£è¡¨ã€‚', achievement: 'MEDIA_STAR' } },
                        { text: 'è°¢ç»é‡‡è®¿ï¼Œä¸“æ³¨å·¥ä½œ', consequence: { stats: { professional: 2, resilience: 1 }, influence: 15, log: 'ä½ é€‰æ‹©ä½è°ƒå·¥ä½œï¼Œä½†ç½‘å‹ä»¬æ›´åŠ æ•¬ä½©ä½ çš„ä¸“ä¸šæ€åº¦ã€‚' } },
                        { text: 'æœ‰é€‰æ‹©åœ°æ¥å—ï¼Œæ§åˆ¶æ›å…‰', consequence: { stats: { decision: 3, communication: 1 }, influence: 25, log: 'ä½ å¾ˆèªæ˜åœ°æ§åˆ¶äº†æ›å…‰åº¦ï¼Œæ—¢ä¼ æ’­äº†æ­£èƒ½é‡åˆä¿æŠ¤äº†è‡ªå·±ã€‚' } }
                    ]
                },
                {
                    id: 'E407', stage: 'èŒä¸šå‘å±•', trigger: (gs) => gs.time.days > 310,
                    title: 'ä»£é™…å†²çªçš„è°ƒè§£',
                    description: 'ä½ è¢«å®‰æ’è°ƒè§£ä¸€ä¸ªå…³äº"å¹´è½»äººèººå¹³"çš„ç¤¾ä¼šçƒ­ç‚¹äº‰è®®ï¼Œéœ€è¦åœ¨ä¸åŒä¸–ä»£ä¹‹é—´æ­å»ºå¯¹è¯æ¡¥æ¢ã€‚',
                    choices: [
                        { text: 'ç«™åœ¨å¹´è½»äººè§’åº¦ï¼Œä¸ºä»–ä»¬å‘å£°', consequence: { stats: { communication: 3, decision: 2 }, influence: 30, log: 'ä½ çš„å‘å£°è·å¾—äº†å¹´è½»äººçš„å¼ºçƒˆè®¤åŒï¼Œæˆä¸ºä»–ä»¬çš„ä»£è¨€äººã€‚', achievement: 'YOUNG_ICON' } },
                        { text: 'ä¿æŒä¸­ç«‹ï¼Œä¿ƒè¿›ç†è§£', consequence: { stats: { communication: 2, resilience: 2, decision: 1 }, influence: 20, log: 'ä½ æˆåŠŸåœ°ä¿ƒè¿›äº†ä¸åŒä¸–ä»£ä¹‹é—´çš„ç†è§£ä¸æ²Ÿé€šã€‚' } },
                        { text: 'ä¼ ç»Ÿè¡¨æ€ï¼Œç»´æŠ¤ç§©åº', consequence: { stats: { professional: 2, resilience: -1 }, influence: 5, log: 'ä½ é€‰æ‹©äº†ä¼ ç»Ÿçš„è¡¨æ€æ–¹å¼ï¼Œä½†å¹´è½»äººå¯¹æ­¤å¹¶ä¸ä¹°è´¦ã€‚' } }
                    ]
                },
                {
                    id: 'E408', stage: 'èŒä¸šå‘å±•', trigger: (gs) => gs.time.days > 330,
                    title: 'ç›´æ’­å¸¦è´§æ”¿ç­–è§£è¯»',
                    description: 'ä¸ºäº†è®©æ›´å¤šäººäº†è§£æ”¿åºœæ”¿ç­–ï¼Œä½ çš„å•ä½è®¡åˆ’å°è¯•"ç›´æ’­å¸¦è´§"å¼çš„æ”¿ç­–è§£è¯»ã€‚ä½ è¢«æ¨èä½œä¸ºä¸»æ’­ã€‚',
                    choices: [
                        { text: 'å‹‡æ•¢å°è¯•ï¼Œåˆ›æ–°ä¼ æ’­', consequence: { stats: { communication: 4, professional: 2, learning: 1 }, influence: 50, log: 'ä½ çš„ç›´æ’­å¤§è·æˆåŠŸï¼Œå¼€åˆ›äº†æ”¿åŠ¡ä¼ æ’­æ–°æ¨¡å¼ã€‚', achievement: 'INNOVATOR' } },
                        { text: 'è°¨æ…å‚ä¸ï¼Œç¨³ä¸­æ±‚è¿›', consequence: { stats: { communication: 2, decision: 1 }, influence: 20, log: 'ä½ è°¨æ…åœ°å‚ä¸äº†é¡¹ç›®ï¼Œæ•ˆæœä¸é”™ä½†æ²¡æœ‰å¤ªå¤§çªç ´ã€‚' } },
                        { text: 'æ‹’ç»å‚ä¸ï¼Œè®¤ä¸ºä¸åˆé€‚', consequence: { stats: { resilience: -1, professional: -1 }, influence: 0, log: 'ä½ æ‹’ç»äº†è¿™ä¸ªæœºä¼šï¼Œä½†åæ¥å‘ç°è¿™ç¡®å®æ˜¯ä¸ªå¥½çš„å°è¯•ã€‚' } }
                    ]
                },
                {
                    id: 'E409', stage: 'èŒä¸šå‘å±•', trigger: (gs) => gs.time.days > 360,
                    title: 'ç¬¬ä¸€æ‰¹95åç§‘é•¿',
                    description: 'ä½ æœ‰æœºä¼šæˆä¸ºå•ä½é‡Œç¬¬ä¸€æ‰¹95åç§‘é•¿ï¼Œè¿™æ„å‘³ç€æ›´å¤šè´£ä»»ï¼Œä¹Ÿæ„å‘³ç€æˆä¸ºå¹´è½»äººçš„æ¦œæ ·ã€‚',
                    choices: [
                        { text: 'å‹‡æ•¢æ¥å—ï¼Œæ‰¿æ‹…è´£ä»»', consequence: { stats: { decision: 4, professional: 3, communication: 2 }, influence: 60, log: 'ä½ æˆä¸ºäº†95åç§‘é•¿ï¼Œå¼€å§‹ç”¨è‡ªå·±çš„æ–¹å¼å½±å“æ›´å¤šäººã€‚', achievement: 'LEADER' } },
                        { text: 'è°¦è®©æœºä¼šï¼Œç»§ç»­ç§¯ç´¯', consequence: { stats: { resilience: 2, learning: 1 }, influence: 10, log: 'ä½ é€‰æ‹©ç»§ç»­ç§¯ç´¯ç»éªŒï¼Œä½†å¯èƒ½é”™è¿‡äº†ä¸€ä¸ªé‡è¦æœºä¼šã€‚' } },
                        { text: 'æ„Ÿåˆ°å‹åŠ›ï¼ŒçŠ¹è±«ä¸å†³', consequence: { stats: { resilience: -2, decision: -1 }, influence: 0, log: 'é¢å¯¹è¿™ä¸ªæœºä¼šï¼Œä½ æ„Ÿåˆ°äº†å¾ˆå¤§å‹åŠ›ï¼Œé™·å…¥äº†çº ç»“ã€‚' } }
                    ]
                }
            ]
        };

        // ----------------------------------------------------
        // 3. æ¸¸æˆæ ¸å¿ƒé€»è¾‘å‡½æ•°
        // ----------------------------------------------------

        // åˆå§‹åŒ–æ–°æ¸¸æˆ
        function initNewGame() {
            const playerName = inputs.playerName.value.trim() || 'æå';
            gameState = {
                player: {
                    name: playerName,
                    stage: 'ç¬”è¯•å¤‡è€ƒ', // ç¬”è¯•å¤‡è€ƒ -> ç¬”è¯•è€ƒè¯• -> é¢è¯•å¤‡è€ƒ -> é¢è¯•è€ƒè¯• -> å…¥èŒé€‚åº” -> èƒ½åŠ›æå‡ -> èŒä¸šå‘å±•
                    stats: {
                        professional: 5,
                        communication: 5,
                        decision: 5,
                        resilience: 5,
                        learning: 5,
                    },
                    influence: 0,
                },
                time: {
                    year: 2024,
                    month: 1,
                    day: 15, // å¯’å‡å¼€å§‹ï¼Œå†³å®šè€ƒå…¬
                    days: 1, // æ€»å¤©æ•°
                    realDate: new Date(2024, 0, 15), // çœŸå®æ—¥æœŸå¯¹åº”
                },
                currentGoals: [], // å½“å‰é˜¶æ®µç›®æ ‡
                examSchedule: { // çœŸå®è€ƒè¯•æ—¶é—´è¡¨
                    nationalExam: {
                        registration: { month: 10, day: 15, year: 2024 }, // å›½è€ƒæŠ¥å
                        writtenTest: { month: 11, day: 26, year: 2024 }, // å›½è€ƒç¬”è¯•
                        interview: { month: 2, day: 25, year: 2025 }, // å›½è€ƒé¢è¯•
                    },
                    provincialExam: {
                        registration: { month: 3, day: 1, year: 2024 }, // çœè€ƒæŠ¥å
                        writtenTest: { month: 3, day: 30, year: 2024 }, // çœè€ƒç¬”è¯•
                        interview: { month: 5, day: 18, year: 2024 }, // çœè€ƒé¢è¯•
                    },
                    institutionExam: {
                        registration: { month: 5, day: 8, year: 2024 }, // äº‹ä¸šå•ä½æŠ¥å
                        writtenTest: { month: 6, day: 15, year: 2024 }, // äº‹ä¸šå•ä½ç¬”è¯•
                        interview: { month: 7, day: 20, year: 2024 }, // äº‹ä¸šå•ä½é¢è¯•
                    }
                },
                selectedPath: null, // é€‰æ‹©çš„è€ƒè¯•è·¯å¾„
                jobLocation: null, // å·¥ä½œåœ°ç‚¹åå¥½
                activeBuffs: [], // å½“å‰ç”Ÿæ•ˆçš„BUFF
                log: [],
                achievements: { ...gameData.achievements }, // æ·±æ‹·è´
                eventHistory: [], // è®°å½•å‘ç”Ÿè¿‡çš„uniqueäº‹ä»¶ID
                choiceHistory: [], // è®°å½•æ‰€æœ‰é€‰æ‹©ï¼Œç”¨äºè§¦å‘å…³è”å‰§æƒ…
                personality: { // æ€§æ ¼ç‰¹å¾ï¼Œæ ¹æ®é€‰æ‹©ç´¯ç§¯
                    innovative: 0,    // åˆ›æ–°å€¾å‘
                    traditional: 0,   // ä¼ ç»Ÿå€¾å‘  
                    social: 0,        // ç¤¾äº¤å€¾å‘
                    studious: 0,      // å­¦ä¹ å€¾å‘
                    rebellious: 0,    // å›é€†å€¾å‘
                    cautious: 0       // è°¨æ…å€¾å‘
                },
                examProgress: { // è€ƒè¯•è¿›åº¦å’Œæˆç»©
                    writtenTestScore: 0,
                    interviewScore: 0,
                    practiceTests: 0,
                    mockInterviews: 0,
                    writtenPassed: false // ç¬”è¯•æ˜¯å¦é€šè¿‡
                }
            };
            
            // è®¾ç½®åˆå§‹ç›®æ ‡
            setStageGoals('ç¬”è¯•å¤‡è€ƒ');
            
            // åˆå§‹æ—¥å¿—
            addLogMessage(`æ¬¢è¿ä½ ï¼Œ${playerName}ï¼ä½ çš„å…¬ä»†ç”Ÿæ¶¯ä»ä»Šå¤©å¼€å§‹ã€‚`);
            addLogMessage(`ä»Šå¤©æ˜¯2024å¹´1æœˆ15æ—¥ï¼Œå¯’å‡åˆšå¼€å§‹ï¼Œä½ å†³å®šå‡†å¤‡å…¬èŒè€ƒè¯•ã€‚`);
            addLogMessage(`ğŸ“‹ å½“å‰é˜¶æ®µç›®æ ‡å·²æ›´æ–°ï¼Œè¯·æŸ¥çœ‹å·¦ä¾§é¢æ¿ï¼`);
            unlockAchievement('FIRST_STEP');
            saveGame();
            startGame();
        }

        // é˜¶æ®µç›®æ ‡ç®¡ç†ç³»ç»Ÿ
        function setStageGoals(stage) {
            gameState.currentGoals = [];
            
            switch(stage) {
                case 'ç¬”è¯•å¤‡è€ƒ':
                    gameState.currentGoals = [
                        { id: 'choose_path', text: 'é€‰æ‹©è€ƒè¯•è·¯å¾„ï¼ˆå›½è€ƒ/çœè€ƒ/äº‹ä¸šå•ä½ï¼‰', completed: false, deadline: '2024å¹´2æœˆåº•', urgent: false },
                        { id: 'study_plan', text: 'åˆ¶å®šå­¦ä¹ è®¡åˆ’', completed: false, deadline: '2024å¹´1æœˆåº•', urgent: true },
                        { id: 'practice_test', text: 'å®Œæˆè‡³å°‘3æ¬¡æ¨¡æ‹Ÿè€ƒè¯•', completed: false, current: 0, target: 3 },
                        { id: 'basic_knowledge', text: 'ä¸“ä¸šèƒ½åŠ›è¾¾åˆ°15åˆ†', completed: false, current: gameState.player.stats.professional, target: 15 }
                    ];
                    break;
                case 'è€ƒè¯•é˜¶æ®µ':
                    gameState.currentGoals = [
                        { id: 'written_test', text: 'é€šè¿‡ç¬”è¯•ï¼ˆéœ€è¦120åˆ†ä»¥ä¸Šï¼‰', completed: false, deadline: getExamDeadline('written') },
                        { id: 'interview_prep', text: 'å®Œæˆé¢è¯•å‡†å¤‡', completed: false, deadline: getExamDeadline('interview') },
                        { id: 'final_interview', text: 'é€šè¿‡é¢è¯•ï¼ˆéœ€è¦80åˆ†ä»¥ä¸Šï¼‰', completed: false, deadline: getExamDeadline('interview') }
                    ];
                    break;
                case 'å…¥èŒé€‚åº”':
                    gameState.currentGoals = [
                        { id: 'onboard', text: 'å®Œæˆå…¥èŒæ‰‹ç»­', completed: false, deadline: 'å…¥èŒå1å‘¨' },
                        { id: 'mentor_relation', text: 'å»ºç«‹è‰¯å¥½çš„å¯¼å¸ˆå…³ç³»', completed: false },
                        { id: 'colleague_network', text: 'èå…¥å›¢é˜Ÿï¼Œå½±å“åŠ›è¾¾åˆ°50', completed: false, current: gameState.player.influence, target: 50 }
                    ];
                    break;
                case 'èƒ½åŠ›æå‡':
                    gameState.currentGoals = [
                        { id: 'innovation_project', text: 'å‚ä¸æˆ–ä¸»å¯¼åˆ›æ–°é¡¹ç›®', completed: false },
                        { id: 'skill_development', text: 'æ‰€æœ‰èƒ½åŠ›è¾¾åˆ°60åˆ†ä»¥ä¸Š', completed: false },
                        { id: 'public_recognition', text: 'è·å¾—å¤–éƒ¨è®¤å¯', completed: false }
                    ];
                    break;
                case 'èŒä¸šå‘å±•':
                    gameState.currentGoals = [
                        { id: 'leadership_role', text: 'è·å¾—é¢†å¯¼èŒä½æœºä¼š', completed: false },
                        { id: 'influence_target', text: 'å½±å“åŠ›è¾¾åˆ°100', completed: false, current: gameState.player.influence, target: 100 },
                        { id: 'mentor_others', text: 'æˆä¸ºä»–äººçš„æ¦œæ ·', completed: false }
                    ];
                    break;
            }
            updateGoalsDisplay();
        }
        
        function getExamDeadline(type) {
            if (!gameState.selectedPath) return 'å¾…é€‰æ‹©è€ƒè¯•è·¯å¾„';
            const schedule = gameState.examSchedule[gameState.selectedPath];
            if (type === 'written') {
                return `${schedule.writtenTest.year}å¹´${schedule.writtenTest.month}æœˆ${schedule.writtenTest.day}æ—¥`;
            } else if (type === 'interview') {
                return `${schedule.interview.year}å¹´${schedule.interview.month}æœˆ${schedule.interview.day}æ—¥`;
            }
            return 'æœªç¡®å®š';
        }
        
        function updateGoal(goalId, completed = true, progress = null) {
            const goal = gameState.currentGoals.find(g => g.id === goalId);
            if (goal) {
                if (completed) {
                    goal.completed = true;
                    showNotification(`ğŸ¯ ç›®æ ‡å®Œæˆï¼š${goal.text}`);
                }
                if (progress !== null && goal.current !== undefined) {
                    goal.current = progress;
                }
                updateGoalsDisplay();
                saveGame();
            }
        }
        
        function checkGoalCompletion() {
            // æ£€æŸ¥å„ç§ç›®æ ‡çš„å®Œæˆæƒ…å†µ
            gameState.currentGoals.forEach(goal => {
                if (goal.completed) return;
                
                switch(goal.id) {
                    case 'basic_knowledge':
                        if (gameState.player.stats.professional >= goal.target) {
                            updateGoal(goal.id, true);
                        } else {
                            goal.current = gameState.player.stats.professional;
                        }
                        break;
                    case 'practice_test':
                        if (gameState.examProgress.practiceTests >= goal.target) {
                            updateGoal(goal.id, true);
                        } else {
                            goal.current = gameState.examProgress.practiceTests;
                        }
                        break;
                    case 'colleague_network':
                    case 'influence_target':
                        if (gameState.player.influence >= goal.target) {
                            updateGoal(goal.id, true);
                        } else {
                            goal.current = gameState.player.influence;
                        }
                        break;
                    case 'skill_development':
                        const allAbove60 = Object.values(gameState.player.stats).every(stat => stat >= 60);
                        if (allAbove60) {
                            updateGoal(goal.id, true);
                        }
                        break;
                }
            });
            updateGoalsDisplay();
        }
        
        function updateGoalsDisplay() {
            const goalsList = document.getElementById('goals-list');
            if (!goalsList || !gameState.currentGoals) return;
            
            goalsList.innerHTML = '';
            
            gameState.currentGoals.forEach(goal => {
                const goalElement = document.createElement('div');
                goalElement.style.marginBottom = '0.6rem';
                goalElement.style.padding = '0.5rem';
                goalElement.style.borderRadius = '6px';
                goalElement.style.backgroundColor = goal.completed ? '#d4edda' : (goal.urgent ? '#fff3cd' : '#f8f9fa');
                goalElement.style.border = `2px solid ${goal.completed ? '#28a745' : (goal.urgent ? '#ffc107' : '#dee2e6')}`;
                goalElement.style.boxShadow = '0 1px 3px rgba(0,0,0,0.1)';
                goalElement.style.transition = 'all 0.2s ease';
                
                // è¿›åº¦æ¡å’Œæ–‡æœ¬
                let progressText = '';
                let progressBar = '';
                if (goal.current !== undefined && goal.target !== undefined) {
                    const percentage = Math.min((goal.current / goal.target) * 100, 100);
                    progressText = `<span style="font-weight: bold; color: ${goal.completed ? '#28a745' : '#495057'};"> ${goal.current}/${goal.target}</span>`;
                    progressBar = `
                        <div style="margin-top: 0.3rem; background: #e9ecef; border-radius: 10px; height: 6px; overflow: hidden;">
                            <div style="background: ${goal.completed ? '#28a745' : '#007bff'}; height: 100%; width: ${percentage}%; transition: width 0.3s ease;"></div>
                        </div>
                    `;
                }
                
                let deadlineText = '';
                if (goal.deadline) {
                    deadlineText = `<div style="margin-top: 0.3rem; font-size: 0.7rem; color: #6c757d; display: flex; align-items: center;"><span style="margin-right: 0.2rem;">â°</span>${goal.deadline}</div>`;
                }
                
                goalElement.innerHTML = `
                    <div style="display: flex; align-items: flex-start; line-height: 1.3;">
                        <span style="margin-right: 0.5rem; font-size: 1rem; margin-top: 0.1rem;">${goal.completed ? 'âœ…' : (goal.urgent ? 'ğŸ”¥' : 'â³')}</span>
                        <div style="flex: 1;">
                            <div style="${goal.completed ? 'text-decoration: line-through; color: #6c757d;' : 'color: #212529; font-weight: 500;'} font-size: 0.8rem;">
                                ${goal.text}${progressText}
                            </div>
                            ${progressBar}
                            ${deadlineText}
                        </div>
                    </div>
                `;
                
                // æ·»åŠ æ‚¬åœæ•ˆæœ
                goalElement.addEventListener('mouseenter', () => {
                    goalElement.style.transform = 'translateY(-1px)';
                    goalElement.style.boxShadow = '0 2px 6px rgba(0,0,0,0.15)';
                });
                goalElement.addEventListener('mouseleave', () => {
                    goalElement.style.transform = 'translateY(0)';
                    goalElement.style.boxShadow = '0 1px 3px rgba(0,0,0,0.1)';
                });
                
                goalsList.appendChild(goalElement);
            });
        }

        // è‡ªåŠ¨æ¨è¿›ç³»ç»Ÿ
        let autoProgressInterval = null;
        let isPaused = false;
        
        function startAutoProgress() {
            if (autoProgressInterval) return;
            
            autoProgressInterval = setInterval(() => {
                if (!isPaused && !gameState.isGameOver) {
                    nextDay();
                }
            }, 1500); // æ¯1.5ç§’æ¨è¿›ä¸€å¤©ï¼Œæå‡æ¸¸æˆèŠ‚å¥
        }
        
        function stopAutoProgress() {
            if (autoProgressInterval) {
                clearInterval(autoProgressInterval);
                autoProgressInterval = null;
            }
        }
        
        function togglePause() {
            isPaused = !isPaused;
            if (isPaused) {
                calendar.progressStatus.textContent = 'â¸ï¸ å·²æš‚åœ';
                buttons.pause.textContent = 'â–¶ï¸ ç»§ç»­';
            } else {
                calendar.progressStatus.textContent = 'â° è‡ªåŠ¨æ¨è¿›ä¸­...';
                buttons.pause.textContent = 'â¸ï¸ æš‚åœ';
            }
        }
        
        // å¼€å§‹æ¸¸æˆ (ä»åŠ è½½æˆ–æ–°æ¸¸æˆ)
        function startGame() {
            screens.start.classList.remove('active');
            screens.main.classList.add('active');
            updateUI();
            
            // ç«‹å³æ˜¾ç¤ºæ¸¸æˆå¯åŠ¨æç¤º
            calendar.progressStatus.textContent = 'ğŸš€ æ¸¸æˆå¯åŠ¨ä¸­...';
            addLogMessage('ğŸ¯ æ¬¢è¿æ¥åˆ°å…¬è€ƒæ¨¡æ‹Ÿå™¨ï¼ä½ çš„å…¬èŒä¹‹è·¯å³å°†å¼€å§‹...', 'success');
            
            // å¯åŠ¨è‡ªåŠ¨æ¨è¿›
            startAutoProgress();
            
            // çŸ­å»¶è¿Ÿåè§¦å‘ç¬¬ä¸€ä¸ªäº‹ä»¶ï¼Œç»™ç”¨æˆ·é€‚åº”æ—¶é—´
            setTimeout(() => {
                calendar.progressStatus.textContent = 'ğŸ“‹ å‡†å¤‡ç¬¬ä¸€ä¸ªäº‹ä»¶...';
                setTimeout(() => {
                    calendar.progressStatus.textContent = 'â° è‡ªåŠ¨æ¨è¿›ä¸­...';
                    triggerEvent('E001'); // ç›´æ¥æŒ‡å®šè§¦å‘ç¬¬ä¸€ä¸ªäº‹ä»¶
                }, 800); // ç»™ç”¨æˆ·800æ¯«ç§’çš„å‡†å¤‡æ—¶é—´
            }, 200); // å…ˆæ˜¾ç¤ºå‡†å¤‡æç¤º
        }
        
        // æ¨è¿›æ¸¸æˆæ—¶é—´
        function nextDay() {
            // æ£€æŸ¥æ¸¸æˆæ˜¯å¦å·²ç»“æŸ
            if (gameState.isGameOver) {
                stopAutoProgress();
                return;
            }
            
            // æ¨è¿›çœŸå®æ—¥æœŸ
            gameState.time.realDate.setDate(gameState.time.realDate.getDate() + 1);
            gameState.time.year = gameState.time.realDate.getFullYear();
            gameState.time.month = gameState.time.realDate.getMonth() + 1;
            gameState.time.day = gameState.time.realDate.getDate();
            gameState.time.days++;
            
            // æ£€æŸ¥é‡è¦æ—¶é—´èŠ‚ç‚¹
            checkImportantDates();
            
            // å¤„ç†BUFF/DEBUFFæ•ˆæœ
            processActiveEffects();
            
            // å¤„ç†äº‹ä»¶é“¾
            processEventChains();
            
            // å®šæœŸæ¸…ç†å·²å®Œæˆçš„äº‹ä»¶é“¾
            if (gameState.time.days % 10 === 0) {
                cleanupEventChains();
            }
            
            // æ£€æŸ¥é˜¶æ®µæ€§äº‹ä»¶
            checkStageProgression();
            
            // éšæœºè§¦å‘ä¸€ä¸ªæ™®é€šäº‹ä»¶ - æé«˜äº‹ä»¶é¢‘ç‡
            let eventChance = 0.9; // åŸºç¡€90%æ¦‚ç‡ï¼Œå¤§å¹…æå‡äº‹ä»¶é¢‘ç‡
            // æ ¹æ®é˜¶æ®µè°ƒæ•´äº‹ä»¶æ¦‚ç‡
            if (gameState.player.stage === 'è€ƒè¯•é˜¶æ®µ') eventChance = 0.95;
            if (gameState.player.stage === 'èƒ½åŠ›æå‡' || gameState.player.stage === 'èŒä¸šå‘å±•') eventChance = 0.92;
            
            if (Math.random() < eventChance) {
                // æš‚åœè‡ªåŠ¨æ¨è¿›ä»¥å¤„ç†äº‹ä»¶
                const wasRunning = !isPaused;
                if (wasRunning) {
                    isPaused = true;
                    calendar.progressStatus.textContent = 'ğŸ“‹ å¤„ç†äº‹ä»¶ä¸­...';
                }
                setTimeout(() => {
                    triggerEvent();
                    // äº‹ä»¶å¤„ç†å®Œåæ¢å¤è‡ªåŠ¨æ¨è¿›
                    setTimeout(() => {
                        if (wasRunning && !gameState.isGameOver) {
                            isPaused = false;
                            calendar.progressStatus.textContent = 'â° è‡ªåŠ¨æ¨è¿›ä¸­...';
                        }
                    }, 600); // å‡å°‘æ¢å¤å»¶è¿Ÿ
                }, 300); // å‡å°‘è§¦å‘å»¶è¿Ÿ
            }
            
            updateUI();
            saveGame();
        }

        // æ£€æŸ¥é‡è¦æ—¶é—´èŠ‚ç‚¹
        function checkImportantDates() {
            if (!gameState.selectedPath) return;
            
            const currentDate = gameState.time.realDate;
            const schedule = gameState.examSchedule[gameState.selectedPath];
            
            // æ£€æŸ¥æŠ¥åæ—¶é—´
            if (isDateMatch(currentDate, schedule.registration)) {
                addLogMessage(`ğŸ”” ä»Šå¤©æ˜¯${getPathName(gameState.selectedPath)}æŠ¥åæ—¥ï¼`, 'success');
                updateGoal('registration', true);
                setTimeout(() => {
                    showNotification('ğŸ“ æŠ¥åçª—å£å·²å¼€å¯ï¼è®°å¾—åŠæ—¶æŠ¥åå“¦ï½');
                }, 1000);
            }
            
            // æ£€æŸ¥ç¬”è¯•æ—¶é—´
            if (isDateMatch(currentDate, schedule.writtenTest)) {
                addLogMessage(`ğŸ“ ä»Šå¤©æ˜¯${getPathName(gameState.selectedPath)}ç¬”è¯•æ—¥ï¼åŠ æ²¹ï¼`, 'success');
                gameState.player.stage = 'è€ƒè¯•é˜¶æ®µ';
                setStageGoals('è€ƒè¯•é˜¶æ®µ');
                setTimeout(() => triggerEvent('E101'), 2000);
            }
            
            // æ£€æŸ¥é¢è¯•æ—¶é—´ - ä¿®å¤ï¼šåªæœ‰ç¬”è¯•é€šè¿‡æ‰èƒ½å‚åŠ é¢è¯•
            if (isDateMatch(currentDate, schedule.interview)) {
                // æ£€æŸ¥æ˜¯å¦ç¬”è¯•é€šè¿‡
                if (!gameState.examProgress.writtenPassed) {
                    addLogMessage(`âŒ ç”±äºç¬”è¯•æœªé€šè¿‡ï¼Œæ— æ³•å‚åŠ ${getPathName(gameState.selectedPath)}é¢è¯•ã€‚`, 'warning');
                    return;
                }
                addLogMessage(`ğŸ¤ ä»Šå¤©æ˜¯${getPathName(gameState.selectedPath)}é¢è¯•æ—¥ï¼`, 'success');
                setTimeout(() => triggerEvent('E105'), 2000);
            }
        }
        
        function isDateMatch(currentDate, targetDate) {
            return currentDate.getFullYear() === targetDate.year &&
                   currentDate.getMonth() + 1 === targetDate.month &&
                   currentDate.getDate() === targetDate.day;
        }
        
        function getPathName(path) {
            const names = {
                'nationalExam': 'å›½å®¶å…¬åŠ¡å‘˜è€ƒè¯•',
                'provincialExam': 'çœçº§å…¬åŠ¡å‘˜è€ƒè¯•',
                'institutionExam': 'äº‹ä¸šå•ä½è€ƒè¯•',
                'grassrootsProgram': 'ä¸‰æ”¯ä¸€æ‰¶é¡¹ç›®'
            };
            return names[path] || 'è€ƒè¯•';
        }

        // å¤„ç†æ¿€æ´»çš„BUFF/DEBUFFæ•ˆæœ
        function processActiveEffects() {
            // ä½¿ç”¨æ–°çš„BUFF/DEBUFFæ›´æ–°ç³»ç»Ÿ
            updateBuffDebuffEffects();
        }

        // æ£€æŸ¥å¹¶æ¨è¿›æ¸¸æˆé˜¶æ®µ
        function checkStageProgression() {
            // ç¬”è¯•å¤‡è€ƒ90å¤©åè‡ªåŠ¨è¿›å…¥ç¬”è¯•è€ƒè¯•é˜¶æ®µ
            if (gameState.player.stage === 'ç¬”è¯•å¤‡è€ƒ' && gameState.time.days >= 90) {
                addLogMessage('ç»è¿‡3ä¸ªæœˆçš„ç´§å¼ å¤ä¹ ï¼Œä½ å³å°†è¿æ¥ç¬”è¯•ã€‚');
                gameState.player.stage = 'ç¬”è¯•è€ƒè¯•';
                setTimeout(() => triggerEvent('E101'), 1000); // è§¦å‘ç¬”è¯•å‰å¤œäº‹ä»¶
            }
            // ç¬”è¯•è€ƒè¯•é˜¶æ®µçš„ç‰¹æ®Šå¤„ç†
            else if (gameState.player.stage === 'ç¬”è¯•è€ƒè¯•') {
                if (gameState.time.days === 92 && !gameState.eventHistory.includes('E102')) {
                    setTimeout(() => triggerEvent('E102'), 1200);
                } else if (gameState.time.days === 93 && !gameState.eventHistory.includes('E103')) {
                    setTimeout(() => triggerEvent('E103'), 1200);
                } else if (gameState.time.days === 94 && !gameState.eventHistory.includes('E104')) {
                    setTimeout(() => triggerEvent('E104'), 1200);
                }
            }
            // é¢è¯•å¤‡è€ƒé˜¶æ®µçš„å…³é”®äº‹ä»¶
            else if (gameState.player.stage === 'é¢è¯•å¤‡è€ƒ') {
                if (gameState.time.days === 105 && !gameState.eventHistory.includes('E105')) {
                    setTimeout(() => triggerEvent('E105'), 500);
                } else if (gameState.time.days === 110 && !gameState.eventHistory.includes('E106')) {
                    setTimeout(() => triggerEvent('E106'), 500);
                } else if (gameState.time.days >= 115) {
                    // è‡ªåŠ¨è¿›å…¥é¢è¯•è€ƒè¯•é˜¶æ®µ
                    gameState.player.stage = 'é¢è¯•è€ƒè¯•';
                    addLogMessage('é¢è¯•å¤‡è€ƒç»“æŸï¼Œç°åœ¨è¦å‚åŠ é¢è¯•äº†ï¼', 'warning');
                    setTimeout(() => triggerEvent('E107'), 1000);
                }
            }
            // é¢è¯•è€ƒè¯•é˜¶æ®µçš„å…³é”®äº‹ä»¶
            else if (gameState.player.stage === 'é¢è¯•è€ƒè¯•') {
                if (gameState.time.days === 116 && !gameState.eventHistory.includes('E108')) {
                    setTimeout(() => triggerEvent('E108'), 500);
                } else if (gameState.time.days === 117 && !gameState.eventHistory.includes('E109')) {
                    setTimeout(() => triggerEvent('E109'), 500);
                }
            }
            // å…¥èŒé€‚åº”é˜¶æ®µçš„å…³é”®äº‹ä»¶
            else if (gameState.player.stage === 'å…¥èŒé€‚åº”') {
                if (gameState.time.days === 125 && !gameState.eventHistory.includes('E201')) {
                    setTimeout(() => triggerEvent('E201'), 500);
                } else if (gameState.time.days >= 180) {
                    advanceStage();
                    setTimeout(() => triggerEvent('E301'), 1000);
                }
            }
            // èƒ½åŠ›æå‡é˜¶æ®µçš„å…³é”®äº‹ä»¶å¼ºåˆ¶è§¦å‘
            else if (gameState.player.stage === 'èƒ½åŠ›æå‡') {
                if (gameState.time.days === 185 && !gameState.eventHistory.includes('E302')) {
                    setTimeout(() => triggerEvent('E302'), 500);
                } else if (gameState.time.days === 200 && !gameState.eventHistory.includes('E303')) {
                    setTimeout(() => triggerEvent('E303'), 500);
                } else if (gameState.time.days === 220 && !gameState.eventHistory.includes('E304')) {
                    setTimeout(() => triggerEvent('E304'), 500);
                } else if (gameState.time.days >= 270) {
                    advanceStage();
                    setTimeout(() => triggerEvent('E401'), 1000);
                }
            }
            // èŒä¸šå‘å±•é˜¶æ®µçš„å…³é”®äº‹ä»¶å’Œç»“å±€è§¦å‘
            else if (gameState.player.stage === 'èŒä¸šå‘å±•') {
                if (gameState.time.days === 280 && !gameState.eventHistory.includes('E402')) {
                    setTimeout(() => triggerEvent('E402'), 500);
                } else if (gameState.time.days === 300 && !gameState.eventHistory.includes('E403')) {
                    setTimeout(() => triggerEvent('E403'), 500);
                } else if (gameState.time.days === 320 && !gameState.eventHistory.includes('E404')) {
                    setTimeout(() => triggerEvent('E404'), 500);
                } else if (gameState.time.days >= 365) {
                    // è§¦å‘å¤šæ ·åŒ–ç»“å±€é€‰æ‹©
                    setTimeout(() => triggerEvent('ENDING_CHOICE'), 1000);
                }
            }
        }
        
        function advanceStage() {
            const stageOrder = ['ç¬”è¯•å¤‡è€ƒ', 'ç¬”è¯•è€ƒè¯•', 'é¢è¯•å¤‡è€ƒ', 'é¢è¯•è€ƒè¯•', 'å…¥èŒé€‚åº”', 'èƒ½åŠ›æå‡', 'èŒä¸šå‘å±•'];
            const currentIndex = stageOrder.indexOf(gameState.player.stage);
            if (currentIndex < stageOrder.length - 1) {
                const nextStage = stageOrder[currentIndex + 1];
                gameState.player.stage = nextStage;
                
                // æ ¹æ®æ–°é˜¶æ®µè§¦å‘ç‰¹å®šäº‹ä»¶æˆ–ç»™äºˆå¥–åŠ±
                if(nextStage === 'ç¬”è¯•è€ƒè¯•') {
                    addLogMessage('ç¬”è¯•å¤‡è€ƒç»“æŸï¼Œå³å°†å‚åŠ ç¬”è¯•ï¼', 'warning');
                    gameState.time.days = 91;
                } else if (nextStage === 'é¢è¯•å¤‡è€ƒ') {
                    addLogMessage('ç¬”è¯•é€šè¿‡ï¼ç°åœ¨å¼€å§‹å‡†å¤‡é¢è¯•ã€‚', 'success');
                    gameState.time.days = 100;
                } else if (nextStage === 'é¢è¯•è€ƒè¯•') {
                    addLogMessage('é¢è¯•å¤‡è€ƒç»“æŸï¼Œå³å°†å‚åŠ é¢è¯•ï¼', 'warning');
                    gameState.time.days = 115;
                } else if (nextStage === 'å…¥èŒé€‚åº”') {
                    addLogMessage('æ­å–œï¼ä½ å·²æˆåŠŸä¸Šå²¸ï¼Œæ­£å¼æˆä¸ºä¸€åå…¬èŒäººå‘˜ï¼', 'success');
                    gameState.time.days = 120;
                } else if (nextStage === 'èƒ½åŠ›æå‡') {
                    addLogMessage('ç»è¿‡é€‚åº”æœŸï¼Œä½ å¼€å§‹æ‰¿æ‹…æ›´å¤šè´£ä»»ï¼Œè¿›å…¥èƒ½åŠ›æå‡é˜¶æ®µã€‚', 'success');
                    gameState.time.days = 180;
                } else if (nextStage === 'èŒä¸šå‘å±•') {
                    addLogMessage('ä½ å·²ç»æˆä¸ºä¸€åæˆç†Ÿçš„å…¬èŒäººå‘˜ï¼Œå¼€å§‹è€ƒè™‘èŒä¸šå‘å±•ã€‚', 'success');
                    gameState.time.days = 270;
                }
                
                // é˜¶æ®µå¥–åŠ±
                gameState.player.influence += 10;
                addLogMessage(`è¿›å…¥æ–°é˜¶æ®µï¼š${nextStage}ï¼Œå½±å“åŠ›+10`, 'success');
            }
        }
        
        // è§¦å‘äº‹ä»¶ - ä¿®å¤ï¼šå‡å°‘äº‹ä»¶å †ç§¯
        function triggerEvent(eventId = null) {
            // è®°å½•äº‹ä»¶è§¦å‘å°è¯•
            if (!eventId) {
                recordEventTriggerAttempt();
            }
            
            let event;
            if (eventId) {
                event = gameData.events.find(e => e.id === eventId);
            } else {
                // é™åˆ¶äº‹ä»¶é˜Ÿåˆ—é•¿åº¦ï¼Œé¿å…å †ç§¯è¿‡å¤š
                if (eventQueue.length >= 2) {
                    return;
                }
                
                // åŠ¨æ€è°ƒæ•´äº‹ä»¶è§¦å‘é¢‘ç‡ï¼ˆåŸºäºæ¸¸æˆé˜¶æ®µå’Œç©å®¶çŠ¶æ€ï¼‰
                const baseTriggerRate = getDynamicTriggerRate();
                if (Math.random() > baseTriggerRate) {
                    return;
                }
                
                // æ£€æŸ¥æ˜¯å¦æœ‰åŸºäºæ€§æ ¼çš„ç‰¹æ®Šäº‹ä»¶
                const personalityEvents = checkPersonalityEvents();
                if (personalityEvents.length > 0) {
                    event = selectEventByWeight(personalityEvents);
                } else {
                    // è¿‡æ»¤å¯è§¦å‘çš„äº‹ä»¶
                    const possibleEvents = gameData.events.filter(e => 
                        e.stage === gameState.player.stage &&
                        (!e.unique || !gameState.eventHistory.includes(e.id)) &&
                        (!e.trigger || e.trigger(gameState)) &&
                        checkEventConditions(e)
                    );
                    
                    if (possibleEvents.length > 0) {
                        event = selectEventByPriority(possibleEvents);
                    }
                }
            }
            
            if (event) {
                // å¦‚æœæœ‰äº‹ä»¶æ­£åœ¨å¤„ç†ï¼ŒåŠ å…¥é˜Ÿåˆ—
                if (isEventActive) {
                    if (eventQueue.length < 3) {
                        eventQueue.push(event);
                    }
                    return;
                }
                
                if(event.unique) {
                    gameState.eventHistory.push(event.id);
                }
                
                // è®°å½•äº‹ä»¶è§¦å‘ç»Ÿè®¡
                updateEventStatistics(event);
                showEventModal(event);
            }
        }
        
        // åŠ¨æ€è·å–äº‹ä»¶è§¦å‘é¢‘ç‡
        function getDynamicTriggerRate() {
            let baseRate = 0.8; // åŸºç¡€80%è§¦å‘ç‡ï¼Œå¤§å¹…æå‡äº‹ä»¶é¢‘ç‡
            
            // æ ¹æ®æ¸¸æˆé˜¶æ®µè°ƒæ•´
            const stageMultipliers = {
                'å‡†å¤‡é˜¶æ®µ': 0.3,
                'ç¬”è¯•é˜¶æ®µ': 0.35,
                'é¢è¯•é˜¶æ®µ': 0.4,
                'å…¥èŒé€‚åº”': 0.3,
                'èƒ½åŠ›æå‡': 0.25,
                'èŒä¸šå‘å±•': 0.2
            };
            baseRate *= (stageMultipliers[gameState.player.stage] || 0.25);
            
            // æ ¹æ®ç©å®¶çŠ¶æ€è°ƒæ•´
            const avgStats = Object.values(gameState.player.stats).reduce((a, b) => a + b, 0) / 5;
            if (avgStats < 30) baseRate *= 1.2; // èƒ½åŠ›ä½æ—¶å¢åŠ äº‹ä»¶é¢‘ç‡
            else if (avgStats > 70) baseRate *= 0.8; // èƒ½åŠ›é«˜æ—¶å‡å°‘äº‹ä»¶é¢‘ç‡
            
            // æ ¹æ®å½±å“åŠ›è°ƒæ•´
            if (gameState.player.influence < 20) baseRate *= 1.1;
            else if (gameState.player.influence > 80) baseRate *= 0.9;
            
            // æ ¹æ®äº‹ä»¶åˆ†æè°ƒæ•´è§¦å‘é¢‘ç‡
            const analysis = getEventAnalysis();
            if (analysis) {
                // å¦‚æœæœ€è¿‘äº‹ä»¶å¤ªå°‘ï¼Œæé«˜è§¦å‘ç‡
                if (analysis.averageEventsPerDay < 0.2) {
                    baseRate *= 1.5;
                }
                // å¦‚æœéœ€è¦æ›´å¤šæ ·æ€§ï¼Œç¨å¾®æé«˜è§¦å‘ç‡
                if (analysis.needsMoreVariety) {
                    baseRate *= 1.3;
                }
                // å¦‚æœæœ€è¿‘äº‹ä»¶å¤ªé¢‘ç¹ï¼Œé™ä½è§¦å‘ç‡
                if (analysis.averageEventsPerDay > 0.5) {
                    baseRate *= 0.7;
                }
            }
            
            return Math.min(Math.max(baseRate, 0.3), 0.95); // é™åˆ¶åœ¨30%-95%ä¹‹é—´ï¼Œå¤§å¹…æå‡äº‹ä»¶é¢‘ç‡
        }
        
        // æ£€æŸ¥äº‹ä»¶é¢å¤–æ¡ä»¶
        function checkEventConditions(event) {
            // æ£€æŸ¥æ—¶é—´æ¡ä»¶
            if (event.timeCondition) {
                const currentDay = gameState.time.days;
                if (event.timeCondition.minDay && currentDay < event.timeCondition.minDay) return false;
                if (event.timeCondition.maxDay && currentDay > event.timeCondition.maxDay) return false;
            }
            
            // æ£€æŸ¥èƒ½åŠ›æ¡ä»¶
            if (event.statRequirement) {
                for (const stat in event.statRequirement) {
                    if (gameState.player.stats[stat] < event.statRequirement[stat]) return false;
                }
            }
            
            // æ£€æŸ¥å½±å“åŠ›æ¡ä»¶
            if (event.influenceRequirement && gameState.player.influence < event.influenceRequirement) {
                return false;
            }
            
            // æ£€æŸ¥æ€§æ ¼ç‰¹å¾æ¡ä»¶
            if (event.personalityRequirement) {
                for (const trait in event.personalityRequirement) {
                    if (gameState.personality[trait] < event.personalityRequirement[trait]) return false;
                }
            }
            
            return true;
        }
        
        // åŸºäºæƒé‡é€‰æ‹©äº‹ä»¶
        function selectEventByWeight(events) {
            const weightedEvents = events.map(event => ({
                event,
                weight: calculateEventWeight(event)
            }));
            
            const totalWeight = weightedEvents.reduce((sum, item) => sum + item.weight, 0);
            let random = Math.random() * totalWeight;
            
            for (const item of weightedEvents) {
                random -= item.weight;
                if (random <= 0) return item.event;
            }
            
            return events[0]; // å¤‡é€‰
        }
        
        // è®¡ç®—äº‹ä»¶æƒé‡
        function calculateEventWeight(event) {
            let weight = event.baseWeight || 1;
            
            // é‡è¦äº‹ä»¶æƒé‡åŠ æˆ
            if (event.important) weight *= 2;
            
            // æ ¹æ®æ€§æ ¼ç‰¹å¾è°ƒæ•´æƒé‡
            if (event.personalityBonus) {
                for (const trait in event.personalityBonus) {
                    const personalityValue = gameState.personality[trait] || 0;
                    weight *= (1 + personalityValue * event.personalityBonus[trait] * 0.1);
                }
            }
            
            // æ ¹æ®ç©å®¶çŠ¶æ€è°ƒæ•´æƒé‡
            if (event.statBonus) {
                for (const stat in event.statBonus) {
                    const statValue = gameState.player.stats[stat] || 0;
                    weight *= (1 + statValue * event.statBonus[stat] * 0.01);
                }
            }
            
            // äº‹ä»¶å†·å´æœºåˆ¶
            const analysis = getEventAnalysis();
            if (analysis && analysis.recentEventIds.includes(event.id)) {
                const recentEvents = analysis.recentEventIds;
                const lastIndex = recentEvents.lastIndexOf(event.id);
                const daysSinceLastTrigger = recentEvents.length - lastIndex;
                
                // æ ¹æ®è·ç¦»ä¸Šæ¬¡è§¦å‘çš„å¤©æ•°è°ƒæ•´æƒé‡
                if (daysSinceLastTrigger < 3) {
                    weight *= 0.1; // 3å¤©å†…å¤§å¹…é™ä½æƒé‡
                } else if (daysSinceLastTrigger < 7) {
                    weight *= 0.5; // 7å¤©å†…é€‚åº¦é™ä½æƒé‡
                }
            }
            
            return Math.max(weight, 0.05);
        }
        
        // æŒ‰ä¼˜å…ˆçº§é€‰æ‹©äº‹ä»¶
        function selectEventByPriority(possibleEvents) {
            // è¿‡æ»¤æ‰æœ€è¿‘è§¦å‘è¿‡çš„äº‹ä»¶ï¼Œé¿å…é‡å¤
            const analysis = getEventAnalysis();
            let filteredEvents = possibleEvents;
            
            if (analysis && analysis.recentEventIds.length > 0) {
                // å¦‚æœæœ‰è¶³å¤Ÿçš„äº‹ä»¶é€‰æ‹©ï¼Œè¿‡æ»¤æ‰æœ€è¿‘5ä¸ªäº‹ä»¶
                const availableEvents = possibleEvents.filter(e => !analysis.recentEventIds.slice(-5).includes(e.id));
                if (availableEvents.length > 0) {
                    filteredEvents = availableEvents;
                }
            }
            
            // åˆ†ç±»äº‹ä»¶
            const importantEvents = filteredEvents.filter(e => e.important);
            const buffEvents = filteredEvents.filter(e => e.special === 'buff');
            const debuffEvents = filteredEvents.filter(e => e.special === 'debuff');
            const normalEvents = filteredEvents.filter(e => !e.special && !e.important);
            const randomEvents = filteredEvents.filter(e => e.special === 'random');
            
            // åŠ¨æ€è°ƒæ•´å„ç±»äº‹ä»¶çš„è§¦å‘æ¦‚ç‡
            const playerCondition = getPlayerCondition();
            
            // æ ¹æ®ç©å®¶çŠ¶æ€å’Œäº‹ä»¶åˆ†æè°ƒæ•´æ¦‚ç‡
            let buffChance = playerCondition === 'poor' ? 0.4 : 0.25;
            let debuffChance = playerCondition === 'excellent' ? 0.1 : 0.15;
            let importantChance = 0.6;
            
            // åº”ç”¨äº‹ä»¶å¹³è¡¡è°ƒæ•´
            const balanceAdjustments = adjustEventBalance();
            if (balanceAdjustments.buffBonus) buffChance *= balanceAdjustments.buffBonus;
            if (balanceAdjustments.debuffPenalty) debuffChance *= balanceAdjustments.debuffPenalty;
            if (balanceAdjustments.importantBonus) importantChance *= balanceAdjustments.importantBonus;
            
            // å¦‚æœéœ€è¦æ›´å¤šæ ·æ€§ï¼Œè°ƒæ•´å„ç±»äº‹ä»¶çš„æ¦‚ç‡
            if (analysis && analysis.needsMoreVariety) {
                // å¢åŠ ä¸å¸¸è§äº‹ä»¶ç±»å‹çš„æ¦‚ç‡
                const eventCounts = analysis.eventDistribution;
                const totalEvents = analysis.totalEvents;
                
                if (totalEvents > 5) {
                    // å¦‚æœæŸç±»äº‹ä»¶æ¯”ä¾‹è¿‡ä½ï¼Œå¢åŠ å…¶æ¦‚ç‡
                    if (eventCounts.buff / totalEvents < 0.2) buffChance *= 1.5;
                    if (eventCounts.debuff / totalEvents < 0.1) debuffChance *= 1.5;
                    if (eventCounts.important / totalEvents < 0.15) importantChance *= 1.3;
                }
            }
            
            // æŒ‰ä¼˜å…ˆçº§é€‰æ‹©
            if (importantEvents.length > 0 && Math.random() < importantChance) {
                return selectEventByWeight(importantEvents);
            } else if (buffEvents.length > 0 && Math.random() < buffChance) {
                return selectEventByWeight(buffEvents);
            } else if (debuffEvents.length > 0 && Math.random() < debuffChance) {
                return selectEventByWeight(debuffEvents);
            } else if (normalEvents.length > 0) {
                return selectEventByWeight(normalEvents);
            } else if (randomEvents.length > 0 && Math.random() < 0.3) {
                return selectEventByWeight(randomEvents);
            }
            
            return null;
        }
        
        // è·å–ç©å®¶å½“å‰çŠ¶æ€
        function getPlayerCondition() {
            const avgStats = Object.values(gameState.player.stats).reduce((a, b) => a + b, 0) / 5;
            if (avgStats < 30) return 'poor';
            if (avgStats > 70) return 'excellent';
            return 'normal';
        }
        
        // æ›´æ–°äº‹ä»¶ç»Ÿè®¡
        function updateEventStatistics(event) {
            if (!gameState.eventStatistics) {
                gameState.eventStatistics = {
                    important: 0,
                    buff: 0,
                    debuff: 0,
                    normal: 0,
                    random: 0,
                    personality: 0,
                    totalEvents: 0,
                    recentEvents: [],
                    triggerAttempts: 0,
                    successfulTriggers: 0
                };
            }
            
            const eventType = event.important ? 'important' : (event.special || 'normal');
            gameState.eventStatistics[eventType] = (gameState.eventStatistics[eventType] || 0) + 1;
            gameState.eventStatistics.totalEvents++;
            gameState.eventStatistics.successfulTriggers++;
            
            // è®°å½•æœ€è¿‘çš„äº‹ä»¶ï¼Œç”¨äºé¿å…é‡å¤
            gameState.eventStatistics.recentEvents.push({
                id: event.id,
                day: gameState.time.days,
                type: eventType,
                title: event.title,
                timestamp: Date.now()
            });
            
            // åªä¿ç•™æœ€è¿‘20ä¸ªäº‹ä»¶è®°å½•
            if (gameState.eventStatistics.recentEvents.length > 20) {
                gameState.eventStatistics.recentEvents.shift();
            }
            
            // è°ƒè¯•ä¿¡æ¯
            if (window.DEBUG_EVENTS) {
                console.log(`[äº‹ä»¶ç³»ç»Ÿ] è§¦å‘äº‹ä»¶: ${event.id} - ${event.title} (ç±»å‹: ${eventType})`);
            }
        }
        
        // è®°å½•äº‹ä»¶è§¦å‘å°è¯•
        function recordEventTriggerAttempt() {
            if (!gameState.eventStatistics) {
                updateEventStatistics({ id: 'init', title: 'åˆå§‹åŒ–', special: 'normal' });
            }
            gameState.eventStatistics.triggerAttempts++;
        }
        
        // è·å–äº‹ä»¶ç³»ç»Ÿæ€§èƒ½æŠ¥å‘Š
        function getEventSystemReport() {
            const analysis = getEventAnalysis();
            if (!analysis) return null;
            
            const stats = gameState.eventStatistics;
            const successRate = stats.triggerAttempts > 0 ? 
                (stats.successfulTriggers / stats.triggerAttempts * 100).toFixed(1) : 0;
            
            return {
                performance: {
                    totalAttempts: stats.triggerAttempts,
                    successfulTriggers: stats.successfulTriggers,
                    successRate: successRate + '%',
                    averageEventsPerDay: analysis.averageEventsPerDay.toFixed(2)
                },
                quality: {
                    eventQuality: analysis.eventQuality,
                    balanceScore: analysis.balanceScore.toFixed(1),
                    varietyScore: analysis.needsMoreVariety ? 'éœ€è¦æ”¹å–„' : 'è‰¯å¥½'
                },
                distribution: analysis.eventDistribution,
                recentEvents: analysis.recentEvents.slice(-5).map(e => ({
                    id: e.id,
                    title: e.title,
                    type: e.type,
                    day: e.day
                }))
            };
        }
        
        // å¼€å‘è€…è°ƒè¯•å·¥å…·
        window.debugEventSystem = function() {
            window.DEBUG_EVENTS = !window.DEBUG_EVENTS;
            console.log(`[äº‹ä»¶ç³»ç»Ÿ] è°ƒè¯•æ¨¡å¼: ${window.DEBUG_EVENTS ? 'å¼€å¯' : 'å…³é—­'}`);
            
            if (window.DEBUG_EVENTS) {
                const report = getEventSystemReport();
                if (report) {
                    console.table(report.performance);
                    console.table(report.quality);
                    console.table(report.distribution);
                    console.log('æœ€è¿‘äº‹ä»¶:', report.recentEvents);
                }
            }
        };
        
        // å¼ºåˆ¶è§¦å‘ç‰¹å®šç±»å‹äº‹ä»¶ï¼ˆè°ƒè¯•ç”¨ï¼‰
        window.forceEventType = function(type) {
            const events = checkPersonalityEvents().concat(
                gameData.events.filter(e => 
                    e.stage === gameState.player.stage &&
                    (!e.unique || !gameState.eventHistory.includes(e.id))
                )
            );
            
            let filteredEvents;
            switch(type) {
                case 'important':
                    filteredEvents = events.filter(e => e.important);
                    break;
                case 'buff':
                    filteredEvents = events.filter(e => e.special === 'buff');
                    break;
                case 'debuff':
                    filteredEvents = events.filter(e => e.special === 'debuff');
                    break;
                case 'personality':
                    filteredEvents = checkPersonalityEvents();
                    break;
                default:
                    filteredEvents = events.filter(e => !e.special && !e.important);
            }
            
            if (filteredEvents.length > 0) {
                const event = selectEventByWeight(filteredEvents);
                showEventModal(event);
                updateEventStatistics(event);
                console.log(`[è°ƒè¯•] å¼ºåˆ¶è§¦å‘${type}äº‹ä»¶:`, event.title);
            } else {
                console.log(`[è°ƒè¯•] æ²¡æœ‰å¯ç”¨çš„${type}äº‹ä»¶`);
            }
        };
        
        // è·å–äº‹ä»¶åˆ†ææ•°æ®
        function getEventAnalysis() {
            if (!gameState.eventStatistics) return null;
            
            const stats = gameState.eventStatistics;
            const recentEventIds = stats.recentEvents.slice(-10).map(e => e.id);
            const recentEvents = stats.recentEvents.slice(-10);
            
            // è®¡ç®—äº‹ä»¶è´¨é‡åˆ†æ•°
            const eventQuality = calculateEventQuality(recentEvents);
            
            return {
                totalEvents: stats.totalEvents,
                eventDistribution: {
                    important: stats.important || 0,
                    buff: stats.buff || 0,
                    debuff: stats.debuff || 0,
                    normal: stats.normal || 0,
                    random: stats.random || 0,
                    personality: stats.personality || 0
                },
                recentEventIds: recentEventIds,
                recentEvents: recentEvents,
                averageEventsPerDay: stats.totalEvents / Math.max(gameState.time.days, 1),
                needsMoreVariety: recentEventIds.length > 5 && new Set(recentEventIds).size < 3,
                eventQuality: eventQuality,
                balanceScore: calculateEventBalance(stats)
            };
        }
        
        // è®¡ç®—äº‹ä»¶è´¨é‡åˆ†æ•°
        function calculateEventQuality(recentEvents) {
            if (recentEvents.length === 0) return 0;
            
            let qualityScore = 0;
            const typeVariety = new Set(recentEvents.map(e => e.type)).size;
            const daySpread = recentEvents.length > 1 ? 
                Math.max(...recentEvents.map(e => e.day)) - Math.min(...recentEvents.map(e => e.day)) : 0;
            
            // ç±»å‹å¤šæ ·æ€§åŠ åˆ†
            qualityScore += typeVariety * 15;
            
            // æ—¶é—´åˆ†å¸ƒåŠ åˆ†
            if (daySpread > 5) qualityScore += 20;
            else if (daySpread > 2) qualityScore += 10;
            
            // é‡è¦äº‹ä»¶æ¯”ä¾‹æ£€æŸ¥
            const importantRatio = recentEvents.filter(e => e.type === 'important').length / recentEvents.length;
            if (importantRatio > 0.1 && importantRatio < 0.4) qualityScore += 15;
            
            return Math.min(qualityScore, 100);
        }
        
        // è®¡ç®—äº‹ä»¶å¹³è¡¡åˆ†æ•°
        function calculateEventBalance(stats) {
            const total = stats.totalEvents;
            if (total < 5) return 50; // äº‹ä»¶å¤ªå°‘ï¼Œè¿”å›ä¸­ç­‰åˆ†æ•°
            
            const distribution = {
                important: (stats.important || 0) / total,
                buff: (stats.buff || 0) / total,
                debuff: (stats.debuff || 0) / total,
                normal: (stats.normal || 0) / total,
                random: (stats.random || 0) / total,
                personality: (stats.personality || 0) / total
            };
            
            // ç†æƒ³åˆ†å¸ƒ
            const idealDistribution = {
                important: 0.2,
                buff: 0.25,
                debuff: 0.15,
                normal: 0.3,
                random: 0.05,
                personality: 0.05
            };
            
            let balanceScore = 100;
            for (const type in idealDistribution) {
                const deviation = Math.abs(distribution[type] - idealDistribution[type]);
                balanceScore -= deviation * 100;
            }
            
            return Math.max(balanceScore, 0);
        }
        
        // äº‹ä»¶å¹³è¡¡è°ƒæ•´ç³»ç»Ÿ
        function adjustEventBalance() {
            const analysis = getEventAnalysis();
            if (!analysis || analysis.totalEvents < 10) return {};
            
            const adjustments = {};
            const distribution = analysis.eventDistribution;
            const total = analysis.totalEvents;
            
            // å¦‚æœé‡è¦äº‹ä»¶å¤ªå°‘ï¼Œå¢åŠ å…¶æƒé‡
            if (distribution.important / total < 0.15) {
                adjustments.importantBonus = 1.5;
            }
            
            // å¦‚æœå¢ç›Šäº‹ä»¶å¤ªå°‘ï¼Œå¢åŠ å…¶æ¦‚ç‡
            if (distribution.buff / total < 0.2) {
                adjustments.buffBonus = 1.3;
            }
            
            // å¦‚æœè´Ÿé¢äº‹ä»¶å¤ªå¤šï¼Œå‡å°‘å…¶æ¦‚ç‡
            if (distribution.debuff / total > 0.25) {
                adjustments.debuffPenalty = 0.7;
            }
            
            // å¦‚æœæ€§æ ¼äº‹ä»¶å¤ªå°‘ï¼Œå¢åŠ å…¶è§¦å‘æ¦‚ç‡
            if (distribution.personality / total < 0.03) {
                adjustments.personalityBonus = 1.4;
            }
            
            return adjustments;
        }
        
        // BUFF/DEBUFF ç®¡ç†ç³»ç»Ÿ
        function applyBuff(buff) {
            if (!gameState.activeBuffs) {
                gameState.activeBuffs = [];
            }
            
            // æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨åŒåBUFF
            const existingBuffIndex = gameState.activeBuffs.findIndex(b => b.name === buff.name);
            
            if (existingBuffIndex !== -1) {
                // å¦‚æœå­˜åœ¨åŒåBUFFï¼Œæ ¹æ®ç­–ç•¥å¤„ç†
                const existingBuff = gameState.activeBuffs[existingBuffIndex];
                if (buff.stackable) {
                    // å¯å åŠ ï¼šå¢å¼ºæ•ˆæœ
                    for (const stat in buff.effect) {
                        existingBuff.effect[stat] = (existingBuff.effect[stat] || 0) + buff.effect[stat];
                    }
                    existingBuff.duration = Math.max(existingBuff.duration, buff.duration);
                    addLogMessage(`âœ¨ å¢ç›Šæ•ˆæœã€Œ${buff.name}ã€å¾—åˆ°å¼ºåŒ–ï¼`, 'success');
                } else {
                    // ä¸å¯å åŠ ï¼šåˆ·æ–°æŒç»­æ—¶é—´
                    existingBuff.duration = buff.duration;
                    existingBuff.startDay = gameState.time.days;
                    addLogMessage(`âœ¨ å¢ç›Šæ•ˆæœã€Œ${buff.name}ã€æŒç»­æ—¶é—´å·²åˆ·æ–°ï¼`, 'success');
                }
            } else {
                // æ·»åŠ æ–°BUFF
                gameState.activeBuffs.push({
                    name: buff.name,
                    duration: buff.duration,
                    effect: buff.effect,
                    startDay: gameState.time.days,
                    stackable: buff.stackable || false
                });
                addLogMessage(`âœ¨ è·å¾—å¢ç›Šæ•ˆæœï¼š${buff.name}ï¼ˆæŒç»­${buff.duration}å¤©ï¼‰`, 'success');
            }
        }
        
        function applyDebuff(debuff) {
            if (!gameState.activeDebuffs) {
                gameState.activeDebuffs = [];
            }
            
            // æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨åŒåDEBUFF
            const existingDebuffIndex = gameState.activeDebuffs.findIndex(d => d.name === debuff.name);
            
            if (existingDebuffIndex !== -1) {
                // å¦‚æœå­˜åœ¨åŒåDEBUFFï¼Œæ ¹æ®ç­–ç•¥å¤„ç†
                const existingDebuff = gameState.activeDebuffs[existingDebuffIndex];
                if (debuff.stackable) {
                    // å¯å åŠ ï¼šå¢å¼ºè´Ÿé¢æ•ˆæœ
                    for (const stat in debuff.effect) {
                        existingDebuff.effect[stat] = (existingDebuff.effect[stat] || 0) + debuff.effect[stat];
                    }
                    existingDebuff.duration = Math.max(existingDebuff.duration, debuff.duration);
                    addLogMessage(`ğŸ’” è´Ÿé¢æ•ˆæœã€Œ${debuff.name}ã€å˜å¾—æ›´ä¸¥é‡ï¼`, 'danger');
                } else {
                    // ä¸å¯å åŠ ï¼šåˆ·æ–°æŒç»­æ—¶é—´
                    existingDebuff.duration = debuff.duration;
                    existingDebuff.startDay = gameState.time.days;
                    addLogMessage(`ğŸ’” è´Ÿé¢æ•ˆæœã€Œ${debuff.name}ã€æŒç»­æ—¶é—´å·²åˆ·æ–°ï¼`, 'danger');
                }
            } else {
                // æ·»åŠ æ–°DEBUFF
                gameState.activeDebuffs.push({
                    name: debuff.name,
                    duration: debuff.duration,
                    effect: debuff.effect,
                    startDay: gameState.time.days,
                    stackable: debuff.stackable || false
                });
                addLogMessage(`ğŸ’” å—åˆ°è´Ÿé¢æ•ˆæœï¼š${debuff.name}ï¼ˆæŒç»­${debuff.duration}å¤©ï¼‰`, 'danger');
            }
        }
        
        // æ›´æ–°BUFF/DEBUFFçŠ¶æ€ï¼ˆæ¯æ—¥è°ƒç”¨ï¼‰
        function updateBuffDebuffEffects() {
            const currentDay = gameState.time.days;
            
            // å¤„ç†BUFF
            if (gameState.activeBuffs) {
                gameState.activeBuffs = gameState.activeBuffs.filter(buff => {
                    const elapsed = currentDay - buff.startDay;
                    if (elapsed >= buff.duration) {
                        addLogMessage(`âœ¨ å¢ç›Šæ•ˆæœã€Œ${buff.name}ã€å·²ç»“æŸ`, 'normal');
                        return false;
                    }
                    return true;
                });
            }
            
            // å¤„ç†DEBUFF
            if (gameState.activeDebuffs) {
                gameState.activeDebuffs = gameState.activeDebuffs.filter(debuff => {
                    const elapsed = currentDay - debuff.startDay;
                    if (elapsed >= debuff.duration) {
                        addLogMessage(`ğŸ’” è´Ÿé¢æ•ˆæœã€Œ${debuff.name}ã€å·²ç»“æŸ`, 'normal');
                        return false;
                    }
                    return true;
                });
            }
        }
        
        // è·å–å½“å‰ç”Ÿæ•ˆçš„BUFF/DEBUFFæ€»æ•ˆæœ
        function getActiveEffects() {
            const effects = {
                knowledge: 0,
                communication: 0,
                professional: 0,
                decision: 0,
                physical: 0
            };
            
            // è®¡ç®—BUFFæ•ˆæœ
            if (gameState.activeBuffs) {
                gameState.activeBuffs.forEach(buff => {
                    for (const stat in buff.effect) {
                        if (effects.hasOwnProperty(stat)) {
                            effects[stat] += buff.effect[stat];
                        }
                    }
                });
            }
            
            // è®¡ç®—DEBUFFæ•ˆæœ
            if (gameState.activeDebuffs) {
                gameState.activeDebuffs.forEach(debuff => {
                    for (const stat in debuff.effect) {
                        if (effects.hasOwnProperty(stat)) {
                            effects[stat] += debuff.effect[stat]; // DEBUFFé€šå¸¸æ˜¯è´Ÿå€¼
                        }
                    }
                });
            }
            
            return effects;
        }
        
        // æ·»åŠ äº‹ä»¶é“¾ç³»ç»Ÿ
        function addEventChain(chainId, events) {
            if (!gameState.eventChains) {
                gameState.eventChains = {};
            }
            gameState.eventChains[chainId] = {
                events: events,
                currentIndex: 0,
                completed: false,
                startDay: gameState.time.days,
                lastTriggerDay: -1,
                active: true
            };
        }
        
        function triggerNextInChain(chainId) {
            if (!gameState.eventChains || !gameState.eventChains[chainId]) return false;
            
            const chain = gameState.eventChains[chainId];
            if (chain.completed || !chain.active || chain.currentIndex >= chain.events.length) return false;
            
            const currentDay = gameState.time.days;
            
            // æ£€æŸ¥æ˜¯å¦å·²ç»åœ¨ä»Šå¤©è§¦å‘è¿‡
            if (chain.lastTriggerDay === currentDay) return false;
            
            const nextEventId = chain.events[chain.currentIndex];
            
            // æ£€æŸ¥äº‹ä»¶æ˜¯å¦å­˜åœ¨
            const eventExists = allEvents.some(e => e.id === nextEventId) || 
                               checkPersonalityEvents().some(e => e.id === nextEventId);
            
            if (!eventExists) {
                console.warn(`äº‹ä»¶é“¾ä¸­çš„äº‹ä»¶ ${nextEventId} ä¸å­˜åœ¨`);
                chain.currentIndex++;
                return false;
            }
            
            chain.currentIndex++;
            chain.lastTriggerDay = currentDay;
            
            if (chain.currentIndex >= chain.events.length) {
                chain.completed = true;
                chain.active = false;
                addToLog(`äº‹ä»¶é“¾ "${chainId}" å·²å®Œæˆ`, 'chain');
            }
            
            // å»¶è¿Ÿè§¦å‘ä¸‹ä¸€ä¸ªäº‹ä»¶
            setTimeout(() => triggerEvent(nextEventId), 3000);
            return true;
        }
        
        // æ£€æŸ¥æ‰€æœ‰æ´»è·ƒçš„äº‹ä»¶é“¾
        function processEventChains() {
            if (!gameState.eventChains) return;
            
            for (const chainId in gameState.eventChains) {
                const chain = gameState.eventChains[chainId];
                if (chain.active && !chain.completed) {
                    triggerNextInChain(chainId);
                }
            }
        }
        
        // æ¸…ç†å·²å®Œæˆçš„äº‹ä»¶é“¾
        function cleanupEventChains() {
            if (!gameState.eventChains) return;
            
            for (const chainId in gameState.eventChains) {
                const chain = gameState.eventChains[chainId];
                if (chain.completed && gameState.time.days - chain.startDay > 30) {
                    delete gameState.eventChains[chainId];
                }
            }
        }
        
        // å¤„ç†ä¸‹ä¸€ä¸ªé˜Ÿåˆ—ä¸­çš„äº‹ä»¶
        function processNextEvent() {
            if (eventQueue.length > 0 && !isEventActive) {
                const nextEvent = eventQueue.shift();
                showEventModal(nextEvent);
            }
        }
        
        // æ£€æŸ¥åŸºäºæ€§æ ¼ç‰¹å¾çš„ç‰¹æ®Šäº‹ä»¶
        function checkPersonalityEvents() {
            const personalityEvents = [];
            const p = gameState.personality;
            const stage = gameState.player.stage;
            
            // åˆ›æ–°å‹æ€§æ ¼äº‹ä»¶
            if (p.innovative >= 5 && stage === 'èƒ½åŠ›æå‡' && !gameState.eventHistory.includes('PE001')) {
                personalityEvents.push({
                    id: 'PE001', title: 'åˆ›æ–°æ€ç»´çš„ç¢°æ’', important: true,
                    baseWeight: 2, personalityBonus: { innovative: 0.2 },
                    description: 'å› ä¸ºä½ ä¸€ç›´ä»¥æ¥çš„åˆ›æ–°è¡¨ç°ï¼Œé¢†å¯¼å†³å®šè®©ä½ å‚ä¸ä¸€ä¸ªæ”¹é©è¯•ç‚¹é¡¹ç›®ã€‚è¿™æ˜¯å±•ç°ä½ åˆ›æ–°èƒ½åŠ›çš„ç»ä½³æœºä¼šï¼',
                    choices: [
                        { text: 'å…¨åŠ›æŠ•å…¥ï¼Œå±•ç°åˆ›æ–°æ½œåŠ›', 
                          consequence: { stats: { professional: 3, decision: 2 }, influence: 25, achievement: 'INNOVATOR', log: 'ä½ çš„åˆ›æ–°æ–¹æ¡ˆè·å¾—äº†ä¸Šçº§é«˜åº¦è®¤å¯ï¼' } },
                        { text: 'è°¨æ…å‚ä¸ï¼Œç¨³å¦¥æ¨è¿›',
                          consequence: { stats: { professional: 1, decision: 1 }, influence: 15, log: 'ä½ é€‰æ‹©äº†ç¨³å¦¥çš„æ–¹å¼ï¼Œè™½ç„¶æˆæœæœ‰é™ä½†æ²¡æœ‰é£é™©ã€‚' } }
                    ]
                });
            }
            
            if (p.innovative >= 7 && stage === 'èŒä¸šå‘å±•' && !gameState.eventHistory.includes('PE001B')) {
                personalityEvents.push({
                    id: 'PE001B', title: 'åˆ›æ–°é¡¹ç›®çš„å»¶ç»­', 
                    baseWeight: 1.5, personalityBonus: { innovative: 0.3 },
                    description: 'ä½ ä¹‹å‰çš„åˆ›æ–°è¡¨ç°è®©ä¸Šçº§å°è±¡æ·±åˆ»ï¼Œç°åœ¨æœ‰ä¸€ä¸ªæ›´å¤§çš„åˆ›æ–°é¡¹ç›®éœ€è¦ä½ æ¥ä¸»å¯¼ã€‚',
                    choices: [
                        { text: 'æ¥å—æŒ‘æˆ˜ï¼Œä¸»å¯¼é¡¹ç›®',
                          consequence: { stats: { professional: 4, decision: 3 }, influence: 35, log: 'ä½ æˆåŠŸä¸»å¯¼äº†é‡è¦åˆ›æ–°é¡¹ç›®ï¼', triggerEvent: 'CE002' } }
                    ]
                });
            }
            
            // ç¤¾äº¤å‹æ€§æ ¼äº‹ä»¶
            if (p.social >= 6 && stage === 'èŒä¸šå‘å±•' && !gameState.eventHistory.includes('PE002')) {
                personalityEvents.push({
                    id: 'PE002', title: 'äººé™…ç½‘ç»œçš„åŠ›é‡',
                    baseWeight: 1.8, personalityBonus: { social: 0.25 },
                    description: 'ä½ å¹³æ—¶è‰¯å¥½çš„äººé™…å…³ç³»å‘æŒ¥äº†ä½œç”¨ï¼æœ‰å‡ ä¸ªéƒ¨é—¨çš„åŒäº‹ä¸»åŠ¨é‚€è¯·ä½ å‚ä¸è·¨éƒ¨é—¨åˆä½œé¡¹ç›®ã€‚',
                    choices: [
                        { text: 'æ¥å—é‚€è¯·ï¼Œå‘æŒ¥åè°ƒä¼˜åŠ¿', 
                          consequence: { stats: { communication: 3, decision: 2 }, influence: 30, achievement: 'TEAM_PLAYER', log: 'ä½ çš„äººé™…åè°ƒèƒ½åŠ›è®©é¡¹ç›®è¿›å±•é¡ºåˆ©ï¼' } },
                        { text: 'å©‰æ‹’é‚€è¯·ï¼Œä¸“æ³¨æœ¬èŒå·¥ä½œ',
                          consequence: { stats: { professional: 2 }, influence: 10, log: 'ä½ é€‰æ‹©ä¸“æ³¨äºæœ¬èŒå·¥ä½œï¼Œè·å¾—äº†ä¸“ä¸šèƒ½åŠ›çš„æå‡ã€‚' } }
                    ]
                });
            }
            
            // å›é€†å‹æ€§æ ¼äº‹ä»¶
            if (p.rebellious >= 4 && stage === 'èƒ½åŠ›æå‡' && !gameState.eventHistory.includes('PE003')) {
                personalityEvents.push({
                    id: 'PE003', title: 'ä¸åŒå£°éŸ³çš„ä»·å€¼',
                    baseWeight: 1.2, personalityBonus: { rebellious: 0.3 },
                    description: 'åœ¨ä¸€æ¬¡ä¼šè®®ä¸Šï¼Œä½ æå‡ºäº†ä¸ä¸»æµè§‚ç‚¹ä¸åŒçš„çœ‹æ³•ã€‚è™½ç„¶å¼•èµ·äº†äº‰è®®ï¼Œä½†ä¹Ÿå¼•å‘äº†æ·±å…¥æ€è€ƒã€‚',
                    choices: [
                        { text: 'åšæŒè‡ªå·±çš„è§‚ç‚¹', 
                          personality: { rebellious: 1 },
                          consequence: { stats: { decision: 3, communication: 1 }, influence: 20, achievement: 'CONTROVERSIAL_CHOICE', log: 'ä½ çš„ä¸åŒè§‚ç‚¹æœ€ç»ˆè¢«è¯æ˜æ˜¯æœ‰ä»·å€¼çš„ï¼' } },
                        { text: 'é€‚å½“å¦¥åï¼Œå¯»æ±‚å¹³è¡¡', 
                          consequence: { stats: { communication: 2, decision: 1 }, influence: 15, log: 'ä½ å­¦ä¼šäº†åœ¨åšæŒåŸåˆ™å’Œçµæ´»å˜é€šä¹‹é—´æ‰¾å¹³è¡¡ã€‚' } }
                    ]
                });
            }
            
            // å‹¤å¥‹å‹æ€§æ ¼äº‹ä»¶
            if (p.studious >= 6 && (stage === 'å‡†å¤‡é˜¶æ®µ' || stage === 'ç¬”è¯•é˜¶æ®µ') && !gameState.eventHistory.includes('PE004')) {
                personalityEvents.push({
                    id: 'PE004', title: 'å‹¤å¥‹çš„å›æŠ¥',
                    baseWeight: 2, personalityBonus: { studious: 0.2 },
                    description: 'ä½ çš„å‹¤å¥‹å­¦ä¹ å¾—åˆ°äº†å›æŠ¥ï¼åœ¨ä¸€æ¬¡æ¨¡æ‹Ÿè€ƒè¯•ä¸­å–å¾—äº†ä¼˜å¼‚æˆç»©ï¼Œè¿™å¤§å¤§å¢å¼ºäº†ä½ çš„ä¿¡å¿ƒã€‚',
                    choices: [
                        { text: 'ç»§ç»­ä¿æŒï¼Œå†æ¥å†å‰',
                          personality: { studious: 1 },
                          consequence: { stats: { knowledge: 4, decision: 2 }, examProgress: { practiceTests: 2 }, 
                                       buff: { name: 'å­¦ä¹ çŠ¶æ€', duration: 7, effect: { knowledge: 2 } },
                                       log: 'ä½ çš„å­¦ä¹ çŠ¶æ€éå¸¸å¥½ï¼Œæ•ˆç‡å¤§å¹…æå‡ï¼' } }
                    ]
                });
            }
            
            // è°¨æ…å‹æ€§æ ¼äº‹ä»¶
            if (p.cautious >= 5 && stage === 'é¢è¯•é˜¶æ®µ' && !gameState.eventHistory.includes('PE005')) {
                personalityEvents.push({
                    id: 'PE005', title: 'è°¨æ…çš„å‡†å¤‡',
                    baseWeight: 1.5, personalityBonus: { cautious: 0.25 },
                    description: 'ä½ è°¨æ…çš„æ€§æ ¼è®©ä½ åœ¨é¢è¯•å‡†å¤‡ä¸Šæ ¼å¤–ç»†è‡´ï¼Œå‘ç°äº†ä¸€äº›å…¶ä»–äººå®¹æ˜“å¿½ç•¥çš„é‡è¦ç»†èŠ‚ã€‚',
                    choices: [
                        { text: 'æ·±å…¥ç ”ç©¶è¿™äº›ç»†èŠ‚',
                          consequence: { stats: { knowledge: 2, communication: 3 }, examProgress: { mockInterviews: 1 },
                                       log: 'ä½ çš„ç»†è‡´å‡†å¤‡è®©é¢è¯•å®˜å°è±¡æ·±åˆ»ï¼' } }
                    ]
                });
            }
            
            // ä¼ ç»Ÿå‹æ€§æ ¼äº‹ä»¶
            if (p.traditional >= 5 && stage === 'å…¥èŒé€‚åº”' && !gameState.eventHistory.includes('PE006')) {
                personalityEvents.push({
                    id: 'PE006', title: 'ä¼ ç»Ÿä»·å€¼çš„ä½“ç°',
                    baseWeight: 1.3, personalityBonus: { traditional: 0.2 },
                    description: 'ä½ å¯¹ä¼ ç»Ÿä»·å€¼çš„åšæŒåœ¨æ–°ç¯å¢ƒä¸­å¾—åˆ°äº†è€åŒäº‹ä»¬çš„è®¤å¯å’Œå°Šé‡ã€‚',
                    choices: [
                        { text: 'ç»§ç»­ä¿æŒä¼ ç»Ÿä½œé£',
                          personality: { traditional: 1 },
                          consequence: { stats: { professional: 2, communication: 2 }, influence: 20,
                                       log: 'ä½ çš„ä¼ ç»Ÿä½œé£èµ¢å¾—äº†åŒäº‹ä»¬çš„ä¿¡ä»»ï¼' } }
                    ]
                });
            }
            
            return personalityEvents;
        }
        
        // æ˜¾ç¤ºäº‹ä»¶æ¨¡æ€æ¡†
        function showEventModal(event) {
            isEventActive = true; // æ ‡è®°äº‹ä»¶æ­£åœ¨å¤„ç†
            
            eventElements.title.textContent = event.title;
            eventElements.description.innerHTML = event.description;
            eventElements.choices.innerHTML = '';
            
            // æ·»åŠ é‡è¦æ€§æç¤ºï¼ˆæ ¹æ®è®¾ç½®å†³å®šï¼‰
            if (event.important && gameSettings.showEventHints) {
                const importantTag = document.createElement('div');
                importantTag.style.cssText = `
                    background: #ff6b6b; color: white; padding: 0.3rem 0.8rem; 
                    border-radius: 15px; font-size: 0.8rem; margin-bottom: 1rem;
                    display: inline-block; animation: pulse 2s infinite;
                `;
                importantTag.innerHTML = 'ğŸ”¥ é‡è¦é€‰æ‹© - éœ€è¦ä»”ç»†è€ƒè™‘';
                eventElements.description.appendChild(importantTag);
            }
            
            // æ·»åŠ é˜Ÿåˆ—æç¤ºï¼ˆæ ¹æ®è®¾ç½®å†³å®šï¼‰
            if (eventQueue.length > 0 && gameSettings.showEventHints) {
                const queueTag = document.createElement('div');
                queueTag.style.cssText = `
                    background: var(--pixel-yellow); color: var(--primary-color); padding: 0.2rem 0.6rem; 
                    border-radius: 10px; font-size: 0.7rem; margin-bottom: 0.5rem;
                    display: inline-block;
                `;
                queueTag.innerHTML = `â³ è¿˜æœ‰${eventQueue.length}ä¸ªäº‹ä»¶ç­‰å¾…å¤„ç†`;
                eventElements.description.appendChild(queueTag);
            }
            
            event.choices.forEach((choice, index) => {
                const button = document.createElement('button');
                button.textContent = choice.text;
                button.classList.add('btn');
                button.onclick = () => handleChoice(choice, event.id);
                eventElements.choices.appendChild(button);
            });
            
            // è®¾ç½®è‡ªåŠ¨é€‰æ‹©å€’è®¡æ—¶ï¼ˆæ ¹æ®è®¾ç½®å†³å®šï¼‰
            if (!event.important && gameSettings.autoRandomChoice) {
                setupAutoChoice(event, 5000); // 5ç§’åè‡ªåŠ¨é€‰æ‹©ï¼Œæå‡æ¸¸æˆèŠ‚å¥
            }
            
            modals.event.classList.add('active');
        }
        
        let autoChoiceTimer = null;
        let countdownInterval = null;
        let eventQueue = []; // äº‹ä»¶é˜Ÿåˆ—
        let isEventActive = false; // æ˜¯å¦æœ‰äº‹ä»¶æ­£åœ¨å¤„ç†
        
        function setupAutoChoice(event, delay) {
            // æ·»åŠ å€’è®¡æ—¶æ˜¾ç¤º
            const countdownDiv = document.createElement('div');
            countdownDiv.id = 'auto-choice-countdown';
            countdownDiv.style.cssText = `
                text-align: center; margin-top: 1rem; color: #6c757d; font-size: 0.9rem;
                background: #f8f9fa; padding: 0.5rem; border-radius: 8px;
            `;
            eventElements.choices.appendChild(countdownDiv);
            
            let timeLeft = delay / 1000;
            
            const updateCountdown = () => {
                if (timeLeft > 0) {
                    countdownDiv.innerHTML = `â° ${timeLeft}ç§’åå°†è‡ªåŠ¨é€‰æ‹©æ¨èé€‰é¡¹ <button onclick="cancelAutoChoice()" style="margin-left: 10px; padding: 2px 8px; border: none; background: #007bff; color: white; border-radius: 3px; cursor: pointer;">å–æ¶ˆè‡ªåŠ¨</button>`;
                    timeLeft--;
                } else {
                    clearInterval(countdownInterval);
                    // éšæœºé€‰æ‹©ä¸€ä¸ªé€‰é¡¹
                    const randomIndex = Math.floor(Math.random() * event.choices.length);
                    const randomChoice = event.choices[randomIndex];
                    handleChoice(randomChoice, event.id);
                }
            };
            
            updateCountdown();
            countdownInterval = setInterval(updateCountdown, 1000);
        }
        
        function cancelAutoChoice() {
            if (countdownInterval) {
                clearInterval(countdownInterval);
                countdownInterval = null;
            }
            const countdownDiv = document.getElementById('auto-choice-countdown');
            if (countdownDiv) {
                countdownDiv.innerHTML = 'â¸ï¸ è‡ªåŠ¨é€‰æ‹©å·²å–æ¶ˆ';
            }
        }
        
        // å¤„ç†ç©å®¶é€‰æ‹©
        function handleChoice(choice, eventId) {
            // æ¸…ç†è‡ªåŠ¨é€‰æ‹©å€’è®¡æ—¶
            if (countdownInterval) {
                clearInterval(countdownInterval);
                countdownInterval = null;
            }
            
            let result;
            if (typeof choice.consequence === 'function') {
                result = choice.consequence(gameState);
            } else {
                result = choice.consequence;
            }

            // è®°å½•é€‰æ‹©å†å²
            gameState.choiceHistory.push({
                eventId: eventId,
                choiceText: choice.text,
                timestamp: gameState.time.days
            });

            // æ›´æ–°æ€§æ ¼ç‰¹å¾
            if (choice.personality) {
                for (const trait in choice.personality) {
                    gameState.personality[trait] += choice.personality[trait];
                }
            }

            // åº”ç”¨åæœ
            if (result.stats) {
                for (const stat in result.stats) {
                    gameState.player.stats[stat] += result.stats[stat];
                    if (gameState.player.stats[stat] > 100) gameState.player.stats[stat] = 100;
                    if (gameState.player.stats[stat] < 0) gameState.player.stats[stat] = 0;
                }
            }
            if (result.influence) {
                gameState.player.influence += result.influence;
                if (gameState.player.influence < 0) gameState.player.influence = 0;
            }
            if (result.examProgress) {
                for (const key in result.examProgress) {
                    gameState.examProgress[key] += result.examProgress[key];
                }
            }
            if (result.selectedPath) {
                gameState.selectedPath = result.selectedPath;
                updateGoal('choose_path', true);
                addLogMessage(`ğŸ“ è€ƒè¯•è·¯å¾„å·²ç¡®å®šï¼ç›¸å…³æ—¶é—´èŠ‚ç‚¹å·²æ›´æ–°ã€‚`, 'success');
                // è§¦å‘èŒä½é€‰æ‹©
                setTimeout(() => triggerEvent('E001_FOLLOW'), 2000);
            }
            if (result.jobLocation) {
                gameState.jobLocation = result.jobLocation;
                addLogMessage(`ğŸ—ºï¸ å·¥ä½œåœ°ç‚¹å€¾å‘å·²ç¡®å®šï¼`, 'success');
            }
            if (result.log) {
                addLogMessage(result.log);
            }
            if (result.achievement) {
                unlockAchievement(result.achievement);
            }
            if (result.nextStage) {
                advanceStage();
            }
            if (result.gameOver) {
                gameOver(result.log || 'æ¸¸æˆç»“æŸ', result.endingType);
            }
            if (result.triggerEvent) {
                // å»¶è¿Ÿè§¦å‘è¿é”äº‹ä»¶
                setTimeout(() => triggerEvent(result.triggerEvent), 2000);
            }
            if (result.notification) {
                showNotification(result.notification);
            }
            if (result.buff) {
                applyBuff(result.buff);
            }
            if (result.debuff) {
                applyDebuff(result.debuff);
            }
            
            modals.event.classList.remove('active');
            isEventActive = false; // æ ‡è®°äº‹ä»¶å¤„ç†å®Œæˆ
            
            checkGoalCompletion(); // æ£€æŸ¥ç›®æ ‡å®Œæˆæƒ…å†µ
            updateUI();
            saveGame();
            
            // å¤„ç†é˜Ÿåˆ—ä¸­çš„ä¸‹ä¸€ä¸ªäº‹ä»¶
            setTimeout(() => processNextEvent(), 1000);
        }
        
        // æ¸¸æˆç»“æŸ
        function gameOver(message, endingType = null) {
            gameState.isGameOver = true;
            stopAutoProgress();
            addLogMessage(message, endingType ? 'success' : 'danger');
            calendar.progressStatus.textContent = 'ğŸ æ¸¸æˆç»“æŸ';
            buttons.pause.textContent = 'æ¸¸æˆç»“æŸ';
            buttons.pause.disabled = true;
            
            // æ˜¾ç¤ºæœ€ç»ˆç»Ÿè®¡
            setTimeout(() => {
                const totalStats = Object.values(gameState.player.stats).reduce((a, b) => a + b, 0);
                const unlockedAchievements = Object.values(gameState.achievements).filter(a => a.unlocked).length;
                
                // æ ¹æ®ç»“å±€ç±»å‹æ˜¾ç¤ºä¸åŒçš„ç»“å±€ä¿¡æ¯
                if (endingType) {
                    addLogMessage(`\n=== ğŸ­ ${getEndingTitle(endingType)} ===`, 'success');
                    addLogMessage(getEndingDescription(endingType), 'normal');
                    addLogMessage('', 'normal'); // ç©ºè¡Œ
                }
                
                addLogMessage(`\n=== æ¸¸æˆæ€»ç»“ ===`, 'normal');
                addLogMessage(`æ¸¸æˆå¤©æ•°ï¼š${gameState.time.days}å¤©`, 'normal');
                addLogMessage(`æœ€ç»ˆé˜¶æ®µï¼š${gameState.player.stage}`, 'normal');
                addLogMessage(`æ€»èƒ½åŠ›å€¼ï¼š${totalStats}`, 'normal');
                addLogMessage(`å½±å“åŠ›ï¼š${gameState.player.influence}`, 'normal');
                addLogMessage(`è§£é”æˆå°±ï¼š${unlockedAchievements}/18`, 'normal');
                
                if (endingType) {
                    addLogMessage(`ç»“å±€ç±»å‹ï¼š${getEndingTitle(endingType)}`, 'success');
                }
                
                addLogMessage(`æ„Ÿè°¢ä½ ä½“éªŒã€Šä»•é€”æ¨¡æ‹Ÿå™¨ã€‹ï¼`, 'success');
            }, 1000);
        }
        
        // è·å–ç»“å±€æ ‡é¢˜
        function getEndingTitle(endingType) {
            const endings = {
                'stable_career': 'ç¨³å®šå‘å±•ç»“å±€',
                'love_sacrifice': 'çˆ±æƒ…è‡³ä¸Šç»“å±€', 
                'entrepreneur': 'åˆ›ä¸šè¿½æ¢¦ç»“å±€',
                'study_abroad': 'æµ·å¤–æ·±é€ ç»“å±€',
                'family_business': 'å›å½’å®¶æ—ç»“å±€'
            };
            return endings[endingType] || 'æœªçŸ¥ç»“å±€';
        }
        
        // è·å–ç»“å±€æè¿°
        function getEndingDescription(endingType) {
            const descriptions = {
                'stable_career': 'ä½ é€‰æ‹©åœ¨å…¬åŠ¡å‘˜ä½“ç³»ä¸­ç¨³æ­¥å‘å±•ï¼Œå‡­å€Ÿæ‰å®çš„ä¸“ä¸šèƒ½åŠ›å’Œè‰¯å¥½çš„äººé™…å…³ç³»ï¼Œé€æ­¥æ™‹å‡ã€‚è™½ç„¶æ²¡æœ‰å¤§èµ·å¤§è½ï¼Œä½†ç”Ÿæ´»å®‰ç¨³å……å®ï¼Œæˆä¸ºäº†åŒäº‹çœ¼ä¸­çš„å¯é ä¼™ä¼´ã€‚å¤šå¹´åå›æœ›ï¼Œä½ ä¸ºè‡ªå·±çš„é€‰æ‹©æ„Ÿåˆ°æ»¡æ„ã€‚',
                'love_sacrifice': 'ä¸ºäº†å¿ƒçˆ±çš„äººï¼Œä½ æ¯…ç„¶æ”¾å¼ƒäº†ç¨³å®šçš„å…¬åŠ¡å‘˜å·¥ä½œã€‚è™½ç„¶å‰è·¯æœªåœï¼Œä½†çˆ±æƒ…çš„åŠ›é‡è®©ä½ å‹‡æ•¢é¢å¯¹ä¸€åˆ‡æŒ‘æˆ˜ã€‚ä½ ä»¬ä¸€èµ·å¥‹æ–—ï¼Œä¸€èµ·æˆé•¿ï¼Œæœ€ç»ˆæ”¶è·äº†æ¯”äº‹ä¸šæ›´çè´µçš„å¹¸ç¦ã€‚æ¯•ä¸šåˆ†æ‰‹ï¼Ÿåœ¨ä½ ä»¬èº«ä¸Šæ°¸è¿œä¸ä¼šå‘ç”Ÿï¼',
                'entrepreneur': 'ä½ è¾å»äº†å…¬åŠ¡å‘˜èŒåŠ¡ï¼ŒæŠ•èº«åˆ›ä¸šå¤§æ½®ã€‚å‡­å€Ÿåœ¨æ”¿åºœéƒ¨é—¨ç§¯ç´¯çš„ç»éªŒå’Œäººè„‰ï¼Œä½ çš„åˆ›ä¸šé¡¹ç›®è·å¾—äº†ä¸é”™çš„å‘å±•ã€‚è™½ç„¶è¿‡ç¨‹å……æ»¡æŒ‘æˆ˜ï¼Œä½†ä½ äº«å—ç€ä¸ºæ¢¦æƒ³æ‹¼æçš„æ¯ä¸€å¤©ã€‚ä½ ç”¨è¡ŒåŠ¨è¯æ˜äº†ï¼šæ¢¦æƒ³ï¼Œæ°¸è¿œä¸å«Œæ™šï¼',
                'study_abroad': 'ä½ é€‰æ‹©å‡ºå›½æ·±é€ ï¼Œåœ¨å¼‚å›½ä»–ä¹¡å¼€å¯äº†äººç”Ÿæ–°ç¯‡ç« ã€‚ä¸åŒçš„æ–‡åŒ–ç¯å¢ƒè®©ä½ çš„è§†é‡æ›´åŠ å¼€é˜”ï¼Œå­¦æœ¯ç ”ç©¶ä¹Ÿå–å¾—äº†ä¸é”™çš„æˆæœã€‚è™½ç„¶ç¦»å®¶ä¸‡é‡Œï¼Œä½†ä½ åœ¨è¿½æ±‚çŸ¥è¯†çš„é“è·¯ä¸Šæ‰¾åˆ°äº†å±äºè‡ªå·±çš„ä»·å€¼ã€‚',
                'family_business': 'ä½ å›åˆ°äº†å®¶ä¹¡ï¼Œæ¥æ‰‹å®¶æ—ä¼ä¸šã€‚è¿ç”¨åœ¨æ”¿åºœéƒ¨é—¨å­¦åˆ°çš„ç®¡ç†ç»éªŒï¼Œä½ ä¸ºå®¶æ—äº‹ä¸šæ³¨å…¥äº†æ–°çš„æ´»åŠ›ã€‚åœ¨ç†Ÿæ‚‰çš„åœŸåœ°ä¸Šï¼Œä½ æ—¢ä¼ æ‰¿äº†å®¶æ—ä¼ ç»Ÿï¼Œåˆå¼€åˆ›äº†å±äºè‡ªå·±çš„äº‹ä¸šç‰ˆå›¾ã€‚'
            };
            return descriptions[endingType] || 'ä½ èµ°å‡ºäº†ä¸€æ¡ç‹¬ç‰¹çš„äººç”Ÿé“è·¯...';
        }

        // ----------------------------------------------------
        // 4. UI æ›´æ–°ä¸äº¤äº’å‡½æ•°
        // ----------------------------------------------------

        // ä¸»UIæ›´æ–°å‡½æ•°
        function updateUI() {
            // è§’è‰²é¢æ¿
            displays.playerName.textContent = gameState.player.name;
            displays.playerStage.textContent = gameState.player.stage;
            
            for (const stat in statsBars) {
                const value = gameState.player.stats[stat];
                statsBars[stat].style.width = `${value}%`;
                // æ ¹æ®æ•°å€¼æ”¹å˜é¢œè‰²
                if (value < 30) statsBars[stat].style.backgroundColor = 'var(--danger-color)';
                else if (value < 60) statsBars[stat].style.backgroundColor = 'var(--warning-color)';
                else statsBars[stat].style.backgroundColor = 'var(--secondary-color)';
            }
            
            // æ¸¸æˆä¿¡æ¯
            displays.gameTime.textContent = `ç¬¬${gameState.time.year}å¹´ ç¬¬${gameState.time.month}æœˆ ç¬¬${gameState.time.day}æ—¥`;
            displays.influence.textContent = gameState.player.influence;
            
            // æ›´æ–°è€ƒè¯•è¿›åº¦æ˜¾ç¤º
            if (document.getElementById('exam-progress')) {
                document.getElementById('exam-progress').textContent = 
                    `ç¬”è¯•: ${gameState.examProgress.practiceTests}æ¬¡ | é¢è¯•: ${gameState.examProgress.mockInterviews}æ¬¡`;
            }
            
            // æ›´æ–°æ€§æ ¼ç‰¹å¾æ˜¾ç¤º
            if (document.getElementById('personality-innovative')) {
                document.getElementById('personality-innovative').textContent = gameState.personality.innovative;
                document.getElementById('personality-social').textContent = gameState.personality.social;
                document.getElementById('personality-studious').textContent = gameState.personality.studious;
                document.getElementById('personality-cautious').textContent = gameState.personality.cautious;
                document.getElementById('personality-rebellious').textContent = gameState.personality.rebellious;
                document.getElementById('personality-traditional').textContent = gameState.personality.traditional;
            }
            
            // æ›´æ–°é€‰æ‹©è·¯å¾„æ˜¾ç¤º
            if (document.getElementById('selected-path')) {
                const pathNames = {
                    'nationalExam': 'å›½å®¶å…¬åŠ¡å‘˜è€ƒè¯•',
                    'provincialExam': 'çœçº§å…¬åŠ¡å‘˜è€ƒè¯•', 
                    'institutionExam': 'äº‹ä¸šå•ä½è€ƒè¯•',
                    'grassrootsProgram': 'ä¸‰æ”¯ä¸€æ‰¶é¡¹ç›®'
                };
                document.getElementById('selected-path').textContent = 
                    gameState.selectedPath ? pathNames[gameState.selectedPath] : 'æœªé€‰æ‹©';
            }
            
            // æ›´æ–°æ—¥å†æ˜¾ç¤º
            if (calendar.year) {
                calendar.year.textContent = gameState.time.year;
                calendar.month.textContent = gameState.time.month;
                calendar.day.textContent = gameState.time.day;
                calendar.totalDays.textContent = gameState.time.days;
            }
            
            // æ›´æ–°BUFF/DEBUFFæ˜¾ç¤º
            updateEffectsDisplay();
            
            // æ›´æ–°ç›®æ ‡æ˜¾ç¤º
            updateGoalsDisplay();
            
            // æ›´æ–°å¡é€šå°äººåŠ¨ç”»
            updateCharacterAnimation();
            
            // æ›´æ–°æ—¥å¿—
        displays.log.scrollTop = displays.log.scrollHeight;
    }

    // æ›´æ–°å¡é€šå°äººåŠ¨ç”»
    function updateCharacterAnimation() {
        const characterBody = document.querySelector('.character-body');
        const characterHead = document.querySelector('.character-head');
        const activityText = document.getElementById('activity-text');
        
        if (!characterBody || !characterHead || !activityText) return;
        
        // æ¸…é™¤æ‰€æœ‰åŠ¨ç”»ç±»
        characterBody.className = 'character-body';
        
        // æ ¹æ®æ¸¸æˆé˜¶æ®µè®¾ç½®ä¸åŒçš„åŠ¨ç”»å’ŒçŠ¶æ€
        const stage = gameState.player.stage;
        const currentDay = gameState.time.days;
        
        switch(stage) {
            case 'ç¬”è¯•å¤‡è€ƒ':
                characterBody.classList.add('studying');
                characterHead.textContent = 'ğŸ¤“';
                activityText.textContent = 'åŠªåŠ›å¤‡è€ƒä¸­...';
                break;
                
            case 'ç¬”è¯•è€ƒè¯•':
                characterBody.classList.add('running');
                characterHead.textContent = 'ğŸ˜°';
                activityText.textContent = 'ç´§å¼ è€ƒè¯•ä¸­...';
                break;
                
            case 'é¢è¯•å¤‡è€ƒ':
                characterBody.classList.add('studying');
                characterHead.textContent = 'ğŸ­';
                activityText.textContent = 'ç»ƒä¹ é¢è¯•ä¸­...';
                break;
                
            case 'é¢è¯•è€ƒè¯•':
                characterBody.classList.add('running');
                characterHead.textContent = 'ğŸ˜…';
                activityText.textContent = 'é¢è¯•è¿›è¡Œä¸­...';
                break;
                
            case 'å…¥èŒé€‚åº”':
                characterBody.classList.add('working');
                characterHead.textContent = 'ğŸ˜Š';
                activityText.textContent = 'é€‚åº”æ–°ç¯å¢ƒ...';
                break;
                
            case 'èƒ½åŠ›æå‡':
                characterBody.classList.add('studying');
                characterHead.textContent = 'ğŸ’ª';
                activityText.textContent = 'æå‡æŠ€èƒ½ä¸­...';
                break;
                
            case 'èŒä¸šå‘å±•':
                characterBody.classList.add('celebrating');
                characterHead.textContent = 'ğŸ˜';
                activityText.textContent = 'äº‹ä¸šæœ‰æˆï¼';
                break;
                
            default:
                characterHead.textContent = 'ğŸ˜Š';
                activityText.textContent = 'å‡†å¤‡ä¸­...';
        }
        
        // æ ¹æ®å½±å“åŠ›è°ƒæ•´è¡¨æƒ…
        const influence = gameState.player.influence;
        if (influence >= 80) {
            characterHead.textContent = 'ğŸ˜';
        } else if (influence >= 60) {
            characterHead.textContent = 'ğŸ˜Š';
        } else if (influence >= 40) {
            characterHead.textContent = 'ğŸ™‚';
        } else if (influence >= 20) {
            characterHead.textContent = 'ğŸ˜';
        } else {
            characterHead.textContent = 'ğŸ˜Ÿ';
        }
        
        // ç‰¹æ®Šäº‹ä»¶æ—¶çš„åŠ¨ç”»
        if (gameState.activeBuffs && gameState.activeBuffs.length > 0) {
            characterBody.classList.add('celebrating');
            activityText.textContent = 'çŠ¶æ€è‰¯å¥½ï¼';
        }
        
        if (gameState.activeDebuffs && gameState.activeDebuffs.length > 0) {
            characterHead.textContent = 'ğŸ˜µ';
            activityText.textContent = 'çŠ¶æ€ä¸ä½³...';
        }
    }
    
    // æ›´æ–°BUFF/DEBUFFæ˜¾ç¤º
    function updateEffectsDisplay() {
        const buffsContainer = document.getElementById('active-buffs');
        const debuffsContainer = document.getElementById('active-debuffs');
        
        // æ˜¾ç¤ºå¢ç›Šæ•ˆæœ
        if (gameState.activeBuffs && gameState.activeBuffs.length > 0) {
            buffsContainer.innerHTML = gameState.activeBuffs.map(buff => {
                const remaining = buff.duration - (gameState.time.days - buff.startDay);
                return `<div style="margin-bottom: 0.3rem; padding: 0.2rem 0.5rem; background: rgba(40, 167, 69, 0.1); border-radius: 4px; border-left: 3px solid var(--success-color);">
                    <div style="font-weight: bold; color: var(--success-color);">${buff.name}</div>
                    <div style="font-size: 0.7rem; opacity: 0.8;">å‰©ä½™ ${remaining} å¤©</div>
                </div>`;
            }).join('');
        } else {
            buffsContainer.innerHTML = '<span style="opacity: 0.6;">æš‚æ— å¢ç›Šæ•ˆæœ</span>';
        }
        
        // æ˜¾ç¤ºè´Ÿé¢æ•ˆæœ
        if (gameState.activeDebuffs && gameState.activeDebuffs.length > 0) {
            debuffsContainer.innerHTML = gameState.activeDebuffs.map(debuff => {
                const remaining = debuff.duration - (gameState.time.days - debuff.startDay);
                return `<div style="margin-bottom: 0.3rem; padding: 0.2rem 0.5rem; background: rgba(220, 53, 69, 0.1); border-radius: 4px; border-left: 3px solid var(--danger-color);">
                    <div style="font-weight: bold; color: var(--danger-color);">${debuff.name}</div>
                    <div style="font-size: 0.7rem; opacity: 0.8;">å‰©ä½™ ${remaining} å¤©</div>
                </div>`;
            }).join('');
        } else {
            debuffsContainer.innerHTML = '<span style="opacity: 0.6;">æš‚æ— è´Ÿé¢æ•ˆæœ</span>';
        }
    }

    // æ·»åŠ æ—¥å¿—æ¡ç›®
        function addLogMessage(message, type = 'normal') {
            const entry = document.createElement('div');
            entry.classList.add('log-entry');
            
            const timeSpan = document.createElement('span');
            timeSpan.classList.add('log-time');
            timeSpan.textContent = `[${gameState.time.year}-${String(gameState.time.month).padStart(2, '0')}-${String(gameState.time.day).padStart(2, '0')}]`;
            
            const messageSpan = document.createElement('span');
            messageSpan.textContent = message;
            
            if (type === 'success') messageSpan.style.color = 'var(--success-color)';
            if (type === 'danger') messageSpan.style.color = 'var(--danger-color)';

            entry.appendChild(timeSpan);
            entry.appendChild(messageSpan);
            displays.log.appendChild(entry);
            
            if (displays.log.children.length > 50) {
                displays.log.removeChild(displays.log.firstChild);
            }
            displays.log.scrollTop = displays.log.scrollHeight;
        }
        
        // æ˜¾ç¤ºæŠ€èƒ½è¯¦æƒ…
        function showSkills() {
            lists.skills.innerHTML = '';
            for (const key in gameData.skills) {
                const skill = gameData.skills[key];
                const value = gameState.player.stats[key];
                const item = document.createElement('div');
                item.classList.add('skill-item');
                item.innerHTML = `
                    <div class="skill-info">
                        <div class="skill-name">${skill.name} (ç­‰çº§ ${Math.floor(value/10)})</div>
                        <div class="skill-bar">
                            <div class="skill-progress" style="width: ${value}%"></div>
                        </div>
                        <div style="font-size: 0.9rem; color: var(--text-color); margin-top: 0.3rem;">${skill.description}</div>
                    </div>
                    <div class="skill-value">${value}/100</div>
                `;
                lists.skills.appendChild(item);
            }
            modals.skills.classList.add('active');
        }
        
        // æ˜¾ç¤ºæˆå°±
        function showAchievements() {
            lists.achievements.innerHTML = '';
            for (const key in gameState.achievements) {
                const ach = gameState.achievements[key];
                const item = document.createElement('div');
                item.classList.add('achievement-item');
                if (ach.unlocked) {
                    item.classList.add('unlocked');
                }
                item.innerHTML = `
                    <span class="achievement-icon">${ach.unlocked ? 'ğŸ†' : 'â“'}</span>
                    <div class="achievement-info">
                        <div class="achievement-title">${ach.unlocked ? ach.name : 'æœªè§£é”çš„æˆå°±'}</div>
                        <div class="achievement-desc">${ach.unlocked ? ach.description : 'å®Œæˆç‰¹å®šç›®æ ‡ä»¥è§£é”ã€‚'}</div>
                    </div>
                `;
                lists.achievements.appendChild(item);
            }
            modals.achievements.classList.add('active');
        }
        
        // æ˜¾ç¤ºè®¾ç½®
        function showSettings() {
            // æ›´æ–°è®¾ç½®é¡¹çš„çŠ¶æ€
            document.getElementById('auto-random-choice').checked = gameSettings.autoRandomChoice;
            document.getElementById('show-event-hints').checked = gameSettings.showEventHints;
            document.getElementById('debug-mode').checked = gameSettings.debugMode;
            
            modals.settings.classList.add('active');
        }
        
        // ä¿å­˜è®¾ç½®
        function saveSettings() {
            gameSettings.autoRandomChoice = document.getElementById('auto-random-choice').checked;
            gameSettings.showEventHints = document.getElementById('show-event-hints').checked;
            gameSettings.debugMode = document.getElementById('debug-mode').checked;
            
            // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
            localStorage.setItem('civilServantSim_gameSettings', JSON.stringify(gameSettings));
            
            showNotification('âš™ï¸ è®¾ç½®å·²ä¿å­˜ï¼');
        }
        
        // åŠ è½½è®¾ç½®
        function loadSettings() {
            const savedSettings = localStorage.getItem('civilServantSim_gameSettings');
            if (savedSettings) {
                gameSettings = { ...gameSettings, ...JSON.parse(savedSettings) };
            }
        }
        
        // è§£é”æˆå°±å¹¶æ˜¾ç¤ºé€šçŸ¥
        function unlockAchievement(key) {
            if (gameState.achievements[key] && !gameState.achievements[key].unlocked) {
                gameState.achievements[key].unlocked = true;
                
                // æ›´æœ‰è¶£çš„æˆå°±é€šçŸ¥æ–‡æ¡ˆ
                const funNotifications = {
                    'FIRST_STEP': 'ğŸ¯ æˆå°±è§£é”ï¼šè¿ˆå‡ºç¬¬ä¸€æ­¥ï¼å…¬è€ƒè·¯ä¸Šï¼Œä½ ä¸æ˜¯ä¸€ä¸ªäººï¼',
                    'PASS_WRITTEN_TEST': 'ğŸ“š æˆå°±è§£é”ï¼šç¬”è¯•è¿‡å…³ï¼å¤§ä½¬å°±æ˜¯ä½ ï¼',
                    'ACE_INTERVIEW': 'ğŸ¤ æˆå°±è§£é”ï¼šé¢è¯•ä¹‹ç‹ï¼å£æ‰æ»¡åˆ†ï¼Œé­…åŠ›æ— æ•Œï¼',
                    'NEWBIE_ONBOARD': 'ğŸŠ æˆå°±è§£é”ï¼šæ–°äººæŠ¥åˆ°ï¼æ¬¢è¿åŠ å…¥å…¬åŠ¡å‘˜å¤§å®¶åº­ï¼',
                    'FIRST_PRAISE': 'â­ æˆå°±è§£é”ï¼šåˆè·èµæ‰¬ï¼è¢«å¤¸çš„æ„Ÿè§‰çœŸå¥½ï½',
                    'CRISIS_HANDLER': 'ğŸ”¥ æˆå°±è§£é”ï¼šå±æœºå¤„ç†è€…ï¼å…³é”®æ—¶åˆ»æ˜¾èº«æ‰‹ï¼',
                    'TEAM_PLAYER': 'ğŸ¤ æˆå°±è§£é”ï¼šå›¢é˜Ÿåˆä½œè€…ï¼å‹è°Šçš„å°èˆ¹è¯´ç¿»å°±ç¿»ï¼Ÿä¸å­˜åœ¨çš„ï¼',
                    'INNOVATOR': 'ğŸ’¡ æˆå°±è§£é”ï¼šåˆ›æ–°å…ˆé”‹ï¼è„‘æ´å¤§å¼€ï¼Œåˆ›æ„æ— é™ï¼',
                    'MEDIA_STAR': 'ğŸ“¸ æˆå°±è§£é”ï¼šåª’ä½“ä¹‹æ˜Ÿï¼ä½ å·²ç»æ˜¯ä¸ªåˆæ ¼çš„"ç½‘çº¢"äº†ï¼',
                    'EXPERT': 'ğŸ“ æˆå°±è§£é”ï¼šä¸šåŠ¡ä¸“å®¶ï¼çŸ¥è¯†å°±æ˜¯åŠ›é‡ï¼',
                    'LEADER': 'ğŸ‘‘ æˆå°±è§£é”ï¼šé¢†å¯¼æ½œè´¨ï¼æœªæ¥å¯æœŸï¼Œå‰é€”æ— é‡ï¼',
                    'PEOPLE_SERVANT': 'â¤ï¸ æˆå°±è§£é”ï¼šäººæ°‘å…¬ä»†ï¼ä¸ºäººæ°‘æœåŠ¡ï¼Œæ°¸è¿œä¸è¿‡æ—¶ï¼',
                    'SOCIAL_MEDIA_HERO': 'ğŸ”¥ æˆå°±è§£é”ï¼šç½‘ç»œçº¢äººï¼ä½ å·²ç»æ˜¯è¿™æ¡è¡—æœ€äº®çš„ä»”ï¼',
                    'CONTROVERSIAL_CHOICE': 'âš¡ æˆå°±è§£é”ï¼šäº‰è®®é€‰æ‹©ï¼æ•¢äºå‘å£°çš„ä½ ï¼Œè¶…é…·çš„ï¼',
                    'MEME_MASTER': 'ğŸ˜‚ æˆå°±è§£é”ï¼šè¡¨æƒ…åŒ…è¾¾äººï¼å¹½é»˜æ„Ÿæ»¡åˆ†ï¼ŒåŠå…¬å®¤å¼€å¿ƒæœï¼',
                    'YOUNG_ICON': 'ğŸŒŸ æˆå°±è§£é”ï¼šå¹´è½»å¶åƒï¼95åçš„éª„å‚²ï¼',
                    'BALANCE_MASTER': 'âš–ï¸ æˆå°±è§£é”ï¼šå¹³è¡¡å¤§å¸ˆï¼å·¥ä½œç”Ÿæ´»ä¸¤ä¸è¯¯ï¼Œäººç”Ÿèµ¢å®¶å°±æ˜¯ä½ ï¼',
                    'TREND_SETTER': 'ğŸš€ æˆå°±è§£é”ï¼šæ½®æµå¼•é¢†è€…ï¼å¼•é¢†æ—¶ä»£ï¼Œä½ å°±æ˜¯é‚£ä¸ªè¶‹åŠ¿ï¼'
                };
                
                const notification = funNotifications[key] || `ğŸ† æˆå°±è§£é”ï¼š${gameState.achievements[key].name}`;
                showNotification(notification);
                saveGame();
            }
        }
        
        function showNotification(message) {
            displays.notification.textContent = message;
            displays.notification.classList.add('show');
            setTimeout(() => {
                displays.notification.classList.remove('show');
            }, 3000);
        }

        // ----------------------------------------------------
        // 5. æ•°æ®å­˜å‚¨ä¸åˆ†äº«
        // ----------------------------------------------------

        // ä¿å­˜æ¸¸æˆ
        function saveGame() {
            localStorage.setItem('civilServantSim_gameState', JSON.stringify(gameState));
        }

        // åŠ è½½æ¸¸æˆ
        function loadGame() {
            const savedState = localStorage.getItem('civilServantSim_gameState');
            if (savedState) {
                gameState = JSON.parse(savedState);
                return true;
            }
            return false;
        }
        
        // é‡ç½®æ¸¸æˆ
        function resetGame() {
            if(confirm('ç¡®å®šè¦é‡ç½®æ¸¸æˆå—ï¼Ÿæ‰€æœ‰è¿›åº¦éƒ½å°†ä¸¢å¤±ã€‚')) {
                localStorage.removeItem('civilServantSim_gameState');
                location.reload();
            }
        }

        // åˆ†äº«åŠŸèƒ½
        async function shareProgress() {
            const shareData = {
                title: 'æˆ‘åœ¨ã€Šä»•é€”æ¨¡æ‹Ÿå™¨ã€‹ä¸­çš„å…¬ä»†ç”Ÿæ¶¯',
                text: `æˆ‘åœ¨ã€Šä»•é€”æ¨¡æ‹Ÿå™¨ã€‹ä¸­æ‰®æ¼”â€œ${gameState.player.name}â€ï¼Œå½“å‰æ˜¯${gameState.player.stage}ï¼Œå½±å“åŠ›å·²è¾¾åˆ°${gameState.player.influence}ã€‚ä½ ä¹Ÿæ¥è¯•è¯•å§ï¼`,
                url: window.location.href
            };
            try {
                if (navigator.share) {
                    await navigator.share(shareData);
                    addLogMessage('æˆåŠŸåˆ†äº«äº†ä½ çš„æ¸¸æˆè¿›åº¦ï¼');
                } else {
                    alert('ä½ çš„æµè§ˆå™¨ä¸æ”¯æŒåˆ†äº«åŠŸèƒ½ã€‚å¯ä»¥æ‰‹åŠ¨æˆªå›¾åˆ†äº«å“¦ï¼');
                }
            } catch (err) {
                addLogMessage('åˆ†äº«è¢«å–æ¶ˆæˆ–å¤±è´¥ã€‚', 'warning');
            }
        }

        // ç«çƒ­åˆ†äº«åŠŸèƒ½ - æ›´æœ‰ä¼ æ’­æ€§
        async function viralShareProgress() {
            const totalStats = Object.values(gameState.player.stats).reduce((a, b) => a + b, 0);
            const unlockedAchievements = Object.values(gameState.achievements).filter(a => a.unlocked).length;
            
            // ç”Ÿæˆå¸å¼•çœ¼çƒçš„åˆ†äº«æ–‡æ¡ˆ
            let shareText = '';
            let hashTags = '';
            
            if (gameState.player.stage === 'å¤‡è€ƒé˜¶æ®µ') {
                shareText = `ğŸ”¥ã€å…¬è€ƒæ—¥è®°ã€‘ç¬¬${gameState.time.days}å¤©ï¼Œæˆ‘åœ¨ã€Šä»•é€”æ¨¡æ‹Ÿå™¨ã€‹é‡Œä½“éªŒå¤‡è€ƒç”Ÿæ´»ï¼å½±å“åŠ›å·²è¾¾${gameState.player.influence}ï¼Œæ„Ÿè§‰è‡ªå·±ç¦»æ¢¦æƒ³è¶Šæ¥è¶Šè¿‘äº†ğŸ’ª`;
                hashTags = '#å…¬è€ƒå¤‡è€ƒ #æ¢¦æƒ³æˆçœŸ #åšæŒä¸æ‡ˆ';
            } else if (gameState.player.stage === 'è€ƒè¯•é˜¶æ®µ') {
                shareText = `ğŸ’¥ã€ä¸Šå²¸å€’è®¡æ—¶ã€‘ã€Šä»•é€”æ¨¡æ‹Ÿå™¨ã€‹è€ƒè¯•è¿›è¡Œä¸­ï¼ç¬”è¯•å·²è¿‡ï¼Œé¢è¯•åœ¨å³ï¼å½±å“åŠ›${gameState.player.influence}ï¼Œä¸ºæ‰€æœ‰è€ƒå…¬äººåŠ æ²¹ï¼ğŸš€`;
                hashTags = '#å…¬è€ƒä¸Šå²¸ #é¢è¯•åŠ æ²¹ #é’æ˜¥æ— æ‚”';
            } else if (gameState.player.stage === 'å…¥èŒé€‚åº”') {
                shareText = `ğŸ‰ã€æˆåŠŸä¸Šå²¸ã€‘æˆ‘åœ¨ã€Šä»•é€”æ¨¡æ‹Ÿå™¨ã€‹é‡Œå½“ä¸Šå…¬åŠ¡å‘˜å•¦ï¼ä»èœé¸Ÿåˆ°èŒåœºæ–°äººï¼Œå½±å“åŠ›${gameState.player.influence}ï¼è¿™å°±æ˜¯ä¼ è¯´ä¸­çš„"ç¨³å®šå·¥ä½œ"å—ï¼Ÿ`;
                hashTags = '#æˆåŠŸä¸Šå²¸ #æ–°äººæŠ¥åˆ° #èŒåœºç”Ÿæ´»';
            } else if (gameState.player.stage === 'èƒ½åŠ›æå‡') {
                shareText = `âš¡ã€èƒ½åŠ›çˆ†è¡¨ã€‘ã€Šä»•é€”æ¨¡æ‹Ÿå™¨ã€‹ç©å‡ºæ–°é«˜åº¦ï¼è§£é”${unlockedAchievements}ä¸ªæˆå°±ï¼Œå½±å“åŠ›${gameState.player.influence}ï¼æˆ‘å¯èƒ½å°±æ˜¯ä¼ è¯´ä¸­çš„"åˆ«äººå®¶çš„å…¬åŠ¡å‘˜"ğŸ˜`;
                hashTags = '#èƒ½åŠ›æå‡ #æˆå°±è§£é” #åˆ«äººå®¶çš„å­©å­';
            } else if (gameState.player.stage === 'èŒä¸šå‘å±•') {
                shareText = `ğŸ‘‘ã€å¤§ä½¬è¯ç”Ÿã€‘ã€Šä»•é€”æ¨¡æ‹Ÿå™¨ã€‹ç»ˆæç©å®¶ï¼å½±å“åŠ›ç ´${gameState.player.influence}ï¼Œè§£é”${unlockedAchievements}ä¸ªæˆå°±ï¼95åå…¬åŠ¡å‘˜å°±æ˜¯è¿™ä¹ˆä¼˜ç§€ï¼å¿«æ¥è†œæ‹œå§ï½`;
                hashTags = '#95åå…¬åŠ¡å‘˜ #èŒåœºå¤§ä½¬ #äººç”Ÿèµ¢å®¶';
            }
            
            // æ·»åŠ è¯é¢˜æ€§å…ƒç´ 
            const controversialPhrases = [
                'ä½ è¿˜åœ¨è¯´å…¬åŠ¡å‘˜å·¥ä½œæ— èŠå—ï¼Ÿ',
                'è¿™å¯èƒ½æ˜¯æœ€çœŸå®çš„å…¬èŒä½“éªŒæ¸¸æˆï¼',
                'æ¯”è¿½å‰§è¿˜ä¸Šç˜¾çš„èŒåœºæ¨¡æ‹Ÿå™¨ï¼',
                'è°è¯´95åä¸èƒ½å½“å¥½å…¬åŠ¡å‘˜ï¼Ÿ',
                'è¿™å±Šå¹´è½»äººçœŸçš„å¤ªä¼˜ç§€äº†ï¼'
            ];
            
            const randomPhrase = controversialPhrases[Math.floor(Math.random() * controversialPhrases.length)];
            shareText += `\n\n${randomPhrase}`;
            
            // å®Œæ•´åˆ†äº«æ–‡æ¡ˆ
            const gameLink = 'https://www.medyi.cn/%E5%85%AC%E8%80%83%E6%A8%A1%E6%8B%9F%E5%99%A8.html';
            const fullShareText = `${shareText}\n\n${hashTags} #ä»•é€”æ¨¡æ‹Ÿå™¨ #å…¬åŠ¡å‘˜ç”Ÿæ´» #95åèŒåœº\n\nğŸ® å¿«æ¥ä½“éªŒï¼š${gameLink}`;
            
            try {
                if (navigator.share) {
                    await navigator.share({
                        title: 'ğŸ”¥ æˆ‘åœ¨ã€Šä»•é€”æ¨¡æ‹Ÿå™¨ã€‹ä¸­çš„ä¼ å¥‡å…¬ä»†ç”Ÿæ¶¯',
                        text: fullShareText,
                        url: window.location.href
                    });
                    addLogMessage('ğŸ‰ ç«çƒ­åˆ†äº«æˆåŠŸï¼ä½ çš„å½±å“åŠ›æš´æ¶¨+10ï¼', 'success');
                    gameState.player.influence += 10;
                    // å¯èƒ½è§£é”ç›¸å…³æˆå°±
                    if (gameState.player.influence >= 50) {
                        unlockAchievement('SOCIAL_MEDIA_HERO');
                    }
                } else {
                    // å¤åˆ¶åˆ°å‰ªè´´æ¿
                    if (navigator.clipboard) {
                        await navigator.clipboard.writeText(fullShareText);
                        showNotification('ğŸ”¥ ç«çƒ­åˆ†äº«æ–‡æ¡ˆå·²å¤åˆ¶ï¼èµ¶ç´§å»ç¤¾äº¤å¹³å°å¼•çˆ†è¯é¢˜å§ï¼');
                    } else {
                        const textArea = document.createElement('textarea');
                        textArea.value = fullShareText;
                        document.body.appendChild(textArea);
                        textArea.select();
                        document.execCommand('copy');
                        document.body.removeChild(textArea);
                        showNotification('ğŸ’¥ çˆ†æ¬¾æ–‡æ¡ˆå·²å¤åˆ¶ï¼å»åˆ¶é€ è¯é¢˜çƒ­ç‚¹å§ï¼');
                    }
                    addLogMessage('ğŸš€ åˆ†äº«æ–‡æ¡ˆå·²ç”Ÿæˆï¼Œå½±å“åŠ›+8ï¼', 'success');
                    gameState.player.influence += 8;
                }
                updateUI();
                saveGame();
            } catch (err) {
                addLogMessage('åˆ†äº«é‡åˆ°å°é—®é¢˜ï¼Œä½†ä½ çš„é­…åŠ›æ— æ³•é˜»æŒ¡ï¼', 'normal');
            }
        }

        // ----------------------------------------------------
        // 6. äº‹ä»¶ç›‘å¬å™¨ç»‘å®š
        // ----------------------------------------------------
        buttons.start.addEventListener('click', initNewGame);
        buttons.pause.addEventListener('click', togglePause);
        buttons.reset.addEventListener('click', resetGame);
        buttons.share.addEventListener('click', viralShareProgress);
        
        buttons.showSkills.addEventListener('click', showSkills);
        buttons.closeSkills.addEventListener('click', () => modals.skills.classList.remove('active'));
        
        buttons.showAchievements.addEventListener('click', showAchievements);
        buttons.closeAchievements.addEventListener('click', () => modals.achievements.classList.remove('active'));
        
        buttons.settings.addEventListener('click', showSettings);
        buttons.closeSettings.addEventListener('click', () => modals.settings.classList.remove('active'));
        
        // è®¾ç½®é¡¹äº‹ä»¶ç›‘å¬å™¨
        document.getElementById('auto-random-choice').addEventListener('change', saveSettings);
        document.getElementById('show-event-hints').addEventListener('change', saveSettings);
        document.getElementById('debug-mode').addEventListener('change', saveSettings);
        
        // ç‚¹å‡»æ¨¡æ€æ¡†èƒŒæ™¯å…³é—­
        Object.values(modals).forEach(modal => {
            modal.addEventListener('click', (e) => {
                if(e.target === modal) {
                    modal.classList.remove('active');
                }
            });
        });

        // ----------------------------------------------------
        // 7. æ¸¸æˆå…¥å£
        // ----------------------------------------------------
        function initialize() {
            loadSettings(); // åŠ è½½è®¾ç½®
            if (loadGame()) {
                // å¦‚æœæœ‰å­˜æ¡£ï¼Œç›´æ¥å¼€å§‹æ¸¸æˆ
                startGame();
            } else {
                // å¦åˆ™æ˜¾ç¤ºå¼€å§‹å±å¹•
                document.getElementById('start-screen').classList.add('active');
            }
        }

        initialize();
    });
    </script>
</body>
</html>