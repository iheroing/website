<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>公考模拟器：我的公仆生涯</title>
    <style>
        /* 1. 全局样式与主题 - 像素风格 */
        :root {
            --primary-color: #1a1a2e;
            --secondary-color: #16213e;
            --accent-color: #0f3460;
            --background-color: #0f0f0f;
            --text-color: #e0e0e0;
            --success-color: #00ff41;
            --warning-color: #ffb000;
            --danger-color: #ff073a;
            --light-gray: #404040;
            --pixel-blue: #007acc;
            --pixel-green: #228b22;
            --pixel-red: #dc143c;
            --pixel-yellow: #ffd700;
            --font-family: 'Courier New', 'Monaco', 'Menlo', monospace;
            --border-radius: 0px;
            --box-shadow: 0 0 0 2px #333, 0 0 0 4px #666;
            --pixel-border: 2px solid #666;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: var(--font-family);
            background: linear-gradient(45deg, #000 25%, #111 25%, #111 50%, #000 50%, #000 75%, #111 75%);
            background-size: 20px 20px;
            color: var(--text-color);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            overflow: hidden;
            image-rendering: pixelated;
            image-rendering: -moz-crisp-edges;
            image-rendering: crisp-edges;
        }

        #game-container {
            width: 100%;
            max-width: 1000px;
            height: 100vh;
            max-height: 800px;
            background: var(--primary-color);
            border: var(--pixel-border);
            box-shadow: var(--box-shadow);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            position: relative;
        }

        #game-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                repeating-linear-gradient(
                    0deg,
                    transparent,
                    transparent 2px,
                    rgba(0, 255, 65, 0.03) 2px,
                    rgba(0, 255, 65, 0.03) 4px
                );
            pointer-events: none;
            z-index: 1000;
        }

        /* 2. 游戏屏幕切换 */
        .screen {
            display: none;
            flex-grow: 1;
            animation: fadeIn 0.5s ease-in-out;
        }

        .screen.active {
            display: flex;
            flex-direction: column;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: scale(0.98); }
            to { opacity: 1; transform: scale(1); }
        }
        
        /* 3. 开始屏幕 (角色创建) */
        #start-screen {
            justify-content: center;
            align-items: center;
            text-align: center;
            padding: 2rem;
            background: var(--primary-color);
            color: var(--text-color);
        }
        #start-screen h1 {
            color: var(--success-color);
            margin-bottom: 1rem;
            font-family: var(--font-family);
            text-transform: uppercase;
            letter-spacing: 2px;
            text-shadow: 0 0 10px var(--success-color);
        }
        #start-screen p {
            margin-bottom: 2rem;
            max-width: 500px;
            color: var(--text-color);
            font-family: var(--font-family);
        }
        .input-group {
            margin-bottom: 1.5rem;
        }
        .input-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: bold;
            color: var(--text-color);
            font-family: var(--font-family);
            text-transform: uppercase;
        }
        #player-name-input {
            width: 100%;
            max-width: 300px;
            padding: 0.8rem;
            border-radius: var(--border-radius);
            border: var(--pixel-border);
            font-size: 1rem;
            font-family: var(--font-family);
            background: linear-gradient(180deg, #222 0%, #111 100%);
            color: var(--text-color);
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.5);
        }
        
        #player-name-input:focus {
            outline: none;
            border-color: var(--success-color);
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.5), 0 0 10px var(--success-color);
        }
        .btn {
            padding: 0.8rem 1.5rem;
            border: 2px solid var(--text-color);
            border-radius: var(--border-radius);
            background: linear-gradient(180deg, var(--pixel-blue) 0%, var(--secondary-color) 100%);
            color: var(--text-color);
            font-size: 1rem;
            font-family: var(--font-family);
            font-weight: bold;
            cursor: pointer;
            transition: all 0.1s;
            text-transform: uppercase;
            letter-spacing: 1px;
            position: relative;
            box-shadow: inset 0 1px 0 rgba(255,255,255,0.2), 
                        inset 0 -1px 0 rgba(0,0,0,0.2),
                        0 2px 4px rgba(0,0,0,0.3);
        }
        .btn:hover {
            background: linear-gradient(180deg, var(--accent-color) 0%, var(--pixel-blue) 100%);
            transform: translateY(-1px);
            box-shadow: inset 0 1px 0 rgba(255,255,255,0.3), 
                        inset 0 -1px 0 rgba(0,0,0,0.3),
                        0 4px 8px rgba(0,0,0,0.4);
        }
        .btn:active {
            transform: translateY(1px);
            box-shadow: inset 0 1px 0 rgba(0,0,0,0.2), 
                        inset 0 -1px 0 rgba(255,255,255,0.1),
                        0 1px 2px rgba(0,0,0,0.2);
        }
        .btn-success { 
            background: linear-gradient(180deg, var(--pixel-green) 0%, var(--success-color) 100%);
            border-color: var(--success-color);
        }
        .btn-success:hover { 
            background: linear-gradient(180deg, var(--success-color) 0%, var(--pixel-green) 100%);
        }
        .btn-danger { 
            background: linear-gradient(180deg, var(--pixel-red) 0%, var(--danger-color) 100%);
            border-color: var(--danger-color);
        }
        .btn-danger:hover { 
            background: linear-gradient(180deg, var(--danger-color) 0%, var(--pixel-red) 100%);
        }

        /* 4. 主游戏界面 */
        #main-game-screen {
            flex-direction: column;
        }
        
        .game-header {
            background: linear-gradient(90deg, var(--secondary-color) 0%, var(--accent-color) 50%, var(--secondary-color) 100%);
            color: var(--text-color);
            padding: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: var(--pixel-border);
            position: relative;
            font-family: var(--font-family);
            text-transform: uppercase;
            letter-spacing: 2px;
            box-shadow: inset 0 2px 4px rgba(255,255,255,0.1), 
                        inset 0 -2px 4px rgba(0,0,0,0.2);
        }
        
        .game-header::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: repeating-linear-gradient(
                90deg,
                var(--success-color) 0px,
                var(--success-color) 4px,
                transparent 4px,
                transparent 8px
            );
        }
        
        .header-left h2 {
            margin: 0;
            font-size: 1.5rem;
            font-weight: bold;
        }
        
        .player-basic-info {
            margin-top: 0.5rem;
            font-size: 0.9rem;
        }
        
        .player-basic-info span {
            margin-right: 1rem;
            padding: 0.25rem 0.5rem;
            background: rgba(255,255,255,0.2);
            border-radius: 15px;
        }
        
        .calendar-widget {
            background: rgba(255,255,255,0.1);
            padding: 1rem;
            border-radius: 10px;
            text-align: center;
            min-width: 200px;
        }
        
        .calendar-date {
            font-size: 1.2rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
        }
        
        .calendar-days {
            font-size: 0.9rem;
            opacity: 0.8;
            margin-bottom: 0.5rem;
        }
        
        .auto-progress {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }
        
        .progress-indicator {
            font-size: 0.8rem;
            opacity: 0.9;
        }
        
        .pause-btn {
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            padding: 0.25rem 0.5rem;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.8rem;
        }
        
        .pause-btn:hover {
            background: rgba(255,255,255,0.3);
        }
        
        .game-main {
            flex: 1;
            display: flex;
            overflow: hidden;
        }
        .left-panel {
            width: 280px;
            background: linear-gradient(180deg, var(--secondary-color) 0%, var(--primary-color) 100%);
            color: var(--text-color);
            padding: 1.5rem;
            border-right: var(--pixel-border);
            display: flex;
            flex-direction: column;
            overflow-y: auto;
            overflow-x: hidden;
            max-height: 100%;
        }
        .character-panel h3 {
            color: var(--success-color);
            border-bottom: 2px solid var(--success-color);
            padding-bottom: 0.5rem;
            margin-bottom: 1rem;
            font-family: var(--font-family);
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        .stat-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.8rem;
            font-size: 0.9rem;
            color: var(--text-color);
            font-family: var(--font-family);
        }
        .stat-item .progress-bar {
            width: 120px;
            height: 16px;
            background: linear-gradient(180deg, #222 0%, #111 100%);
            border: 1px solid var(--light-gray);
            border-radius: var(--border-radius);
            overflow: hidden;
            margin-top: 4px;
            position: relative;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.5);
        }
        .stat-item .progress {
            height: 100%;
            background: linear-gradient(180deg, var(--pixel-green) 0%, var(--success-color) 50%, var(--pixel-green) 100%);
            transition: width 0.3s ease;
            position: relative;
            box-shadow: inset 0 1px 2px rgba(255,255,255,0.3);
        }
        .stat-item .progress::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: repeating-linear-gradient(
                90deg,
                transparent 0px,
                transparent 2px,
                rgba(255,255,255,0.1) 2px,
                rgba(255,255,255,0.1) 4px
            );
        }
        .game-info {
            margin-top: auto;
            font-size: 0.9rem;
        }
        .right-panel {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            padding: 1.5rem;
            background: var(--primary-color);
            color: var(--text-color);
        }
        .game-log-container {
            flex-grow: 1;
            border: var(--pixel-border);
            border-radius: var(--border-radius);
            padding: 1rem;
            overflow-y: auto;
            margin-bottom: 1rem;
            background: linear-gradient(180deg, #111 0%, #000 100%);
            height: 400px;
            scroll-behavior: smooth;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.5);
        }
        .log-entry {
            margin-bottom: 0.75rem;
            padding-bottom: 0.75rem;
            border-bottom: 1px dashed var(--success-color);
            animation: logFadeIn 0.3s;
            color: var(--text-color);
            font-family: var(--font-family);
            font-size: 0.85rem;
        }
        .log-entry:last-child {
            border-bottom: none;
        }
        @keyframes logFadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .log-time {
            font-weight: bold;
            color: var(--pixel-yellow);
            margin-right: 10px;
            font-family: var(--font-family);
        }
        .actions-panel {
            background: linear-gradient(180deg, var(--secondary-color) 0%, var(--accent-color) 100%);
            color: var(--text-color);
            border: var(--pixel-border);
            border-radius: var(--border-radius);
            padding: 1rem;
            box-shadow: var(--box-shadow);
            position: sticky;
            bottom: 0;
            z-index: 10;
        }
        
        .btn-group {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 0.5rem;
        }
        
        .btn-group:last-child {
            margin-bottom: 0;
        }
        
        .btn-group .btn {
            flex: 1;
        }

        /* 5. 模态框 (事件, 技能, 成就) */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at center, rgba(0,0,0,0.8) 0%, rgba(0,0,0,0.9) 100%),
                repeating-linear-gradient(
                    45deg,
                    transparent,
                    transparent 2px,
                    rgba(0,255,65,0.05) 2px,
                    rgba(0,255,65,0.05) 4px
                );
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        .modal.active {
            display: flex;
            animation: pixelFadeIn 0.4s;
        }
        .modal-content {
            background: var(--primary-color);
            color: var(--text-color);
            padding: 2rem;
            border: var(--pixel-border);
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow),
                        0 0 20px rgba(0,255,65,0.3);
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            animation: pixelSlideIn 0.4s ease-out;
            position: relative;
        }
        
        .modal-content::before {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            background: linear-gradient(45deg, var(--success-color), var(--pixel-blue), var(--warning-color), var(--success-color));
            border-radius: var(--border-radius);
            z-index: -1;
            animation: borderGlow 2s linear infinite;
        }
        
        @keyframes borderGlow {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        @keyframes pixelFadeIn {
            0% { opacity: 0; }
            100% { opacity: 1; }
        }
        @keyframes pixelSlideIn {
            0% { 
                opacity: 0; 
                transform: translateY(-30px) scale(0.8); 
                filter: blur(2px);
            }
            50% {
                opacity: 0.7;
                transform: translateY(-10px) scale(1.05);
                filter: blur(1px);
            }
            100% { 
                opacity: 1; 
                transform: translateY(0) scale(1);
                filter: blur(0px);
            }
        }
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--light-gray);
            padding-bottom: 1rem;
            margin-bottom: 1rem;
        }
        .modal-header h2 {
            color: var(--primary-color);
        }
        .modal-body {
            line-height: 1.6;
        }
        .modal-footer {
            margin-top: 1.5rem;
            text-align: right;
            border-top: 1px solid var(--light-gray);
            padding-top: 1rem;
        }
        #event-choices {
            margin-top: 1.5rem;
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }
        #event-choices button {
            width: 100%;
            text-align: left;
            padding: 1rem;
        }
        #skills-list .skill-item, #achievements-list .achievement-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem;
            border-radius: var(--border-radius);
            margin-bottom: 1rem;
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
        }
        #achievements-list .achievement-item.unlocked {
            background-color: #e8f5e9; /* Light green */
            border-color: var(--success-color);
        }
        .achievement-icon {
            font-size: 1.5rem;
            margin-right: 1rem;
        }
        
        /* 6. 通知提示 */
        #notification {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background-color: var(--success-color);
            color: white;
            padding: 1rem 2rem;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            z-index: 2000;
            opacity: 0;
            transition: opacity 0.5s, top 0.5s;
            pointer-events: none;
        }
        #notification.show {
            opacity: 1;
            top: 40px;
        }
        
        /* 7. 响应式布局 */
        @media (max-width: 768px) {
            #game-container {
                height: 100vh;
                max-height: none;
                border-radius: 0;
            }
            #main-game-screen {
                flex-direction: column;
            }
            .left-panel {
                width: 100%;
                border-right: none;
                border-bottom: 1px solid #dee2e6;
                height: auto;
                padding: 1rem;
            }
            .right-panel {
                padding: 1rem;
                flex-grow: 1;
            }
            .actions-panel {
                flex-wrap: wrap;
            }
            .btn {
                font-size: 0.9rem;
            }
        }

    </style>
</head>
<body>

    <div id="game-container">
        <!-- 屏幕1: 角色创建 -->
        <div id="start-screen" class="screen active">
            <h1>公考模拟器：我的公仆生涯</h1>
            <p>从一名普通青年开始，体验备考、工作、成长的完整公职历程。你的每一个选择，都将塑造你的人生道路。准备好了吗？</p>
            <div class="input-group">
                <label for="player-name-input">请输入你的名字：</label>
                <input type="text" id="player-name-input" placeholder="例如：李华" maxlength="10">
            </div>
            <button id="start-game-btn" class="btn btn-success">开启公仆生涯</button>
        </div>

        <!-- 屏幕2: 主游戏界面 -->
        <div id="main-game-screen" class="screen">
            <!-- 游戏头部 -->
            <div class="game-header">
                <div class="header-left">
                    <h2>公考模拟器</h2>
                    <div class="player-basic-info">
                        <span id="player-name-display"></span>
                        <span id="player-stage-display"></span>
                    </div>
                </div>
                <div class="calendar-widget">
                    <div class="calendar-date">
                        <span id="calendar-year">2024</span>年
                        <span id="calendar-month">1</span>月
                        <span id="calendar-day">1</span>日
                    </div>
                    <div class="calendar-days">第<span id="calendar-total-days">1</span>天</div>
                    <div class="auto-progress">
                        <span class="progress-indicator" id="progress-status">⏰ 自动推进中...</span>
                        <button id="pause-btn" class="pause-btn">⏸️ 暂停</button>
                    </div>
                </div>
            </div>
            
            <div class="game-main">
            <div class="left-panel">
                <div class="character-panel">
                    <h3>角色属性</h3>
                    
                    <div class="stat-item">
                        <span><i class="icon">💡</i> 专业能力</span>
                        <div class="progress-bar"><div id="stat-professional" class="progress"></div></div>
                    </div>
                    <div class="stat-item">
                        <span><i class="icon">💬</i> 沟通技巧</span>
                        <div class="progress-bar"><div id="stat-communication" class="progress"></div></div>
                    </div>
                    <div class="stat-item">
                        <span><i class="icon">🧠</i> 决策智慧</span>
                        <div class="progress-bar"><div id="stat-decision" class="progress"></div></div>
                    </div>
                    <div class="stat-item">
                        <span><i class="icon">❤️</i> 抗压能力</span>
                        <div class="progress-bar"><div id="stat-resilience" class="progress"></div></div>
                    </div>
                    <div class="stat-item">
                        <span><i class="icon">📚</i> 学习能力</span>
                        <div class="progress-bar"><div id="stat-learning" class="progress"></div></div>
                    </div>
                </div>

                <div class="goals-panel" style="margin-bottom: 1rem;">
                    <h4 style="color: var(--pixel-yellow); margin-bottom: 0.5rem; font-size: 0.9rem; font-family: var(--font-family); text-transform: uppercase;">📋 当前目标</h4>
                    <div id="goals-list" style="font-size: 0.8rem;">
                        <!-- 目标列表会动态添加到这里 -->
                    </div>
                </div>

                <div class="game-info">
                    <p><strong>当前时间:</strong> <span id="game-time"></span></p>
                    <p><strong>选择路径:</strong> <span id="selected-path">未选择</span></p>
                    <p><strong>影响力:</strong> <span id="influence-display">0</span></p>
                    <p><strong>考试进度:</strong> 
                        <span id="exam-progress">笔试: 0次 | 面试: 0次</span>
                    </p>
                    <div style="margin-top: 0.5rem;">
                        <details>
                            <summary style="cursor: pointer; font-size: 0.8rem;">性格特征 ▼</summary>
                            <div id="personality-display" style="font-size: 0.7rem; margin-top: 0.3rem;">
                                <div>🌟 创新: <span id="personality-innovative">0</span></div>
                                <div>🤝 社交: <span id="personality-social">0</span></div>
                                <div>📚 学习: <span id="personality-studious">0</span></div>
                                <div>⚖️ 谨慎: <span id="personality-cautious">0</span></div>
                                <div>⚡ 叛逆: <span id="personality-rebellious">0</span></div>
                                <div>🏛️ 传统: <span id="personality-traditional">0</span></div>
                            </div>
                        </details>
                    </div>
                </div>
            </div>
            <div class="right-panel">
                <h3 style="color: var(--success-color); font-family: var(--font-family); text-transform: uppercase; border-bottom: 2px solid var(--success-color); padding-bottom: 0.5rem; margin-bottom: 1rem;">工作日志</h3>
                <div id="game-log" class="game-log-container">
                    <!-- 日志条目会动态添加到这里 -->
                </div>
                <div class="actions-panel">
                    <div class="btn-group">
                        <button id="skills-btn" class="btn">查看能力</button>
                        <button id="achievements-btn" class="btn">我的成就</button>
                    </div>
                    <div class="btn-group">
                        <button id="share-btn" class="btn">分享进度</button>
                        <button id="viral-share-btn" class="btn" style="background: linear-gradient(45deg, #ff6b6b, #ffa500);">💥 火热分享</button>
                        <button id="reset-btn" class="btn btn-danger">重置游戏</button>
                    </div>
                </div>
            </div>
            </div>
        </div>

    </div>

    <!-- 模态框: 事件处理 -->
    <div id="event-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="event-title"></h2>
            </div>
            <div class="modal-body">
                <p id="event-description"></p>
                <div id="event-choices">
                    <!-- 选项按钮会动态添加到这里 -->
                </div>
            </div>
        </div>
    </div>

    <!-- 模态框: 技能系统 -->
    <div id="skills-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>能力详情</h2>
            </div>
            <div class="modal-body">
                <div id="skills-list"></div>
                <p style="margin-top: 1rem; text-align: center; color: var(--text-color);">能力点会通过完成重要事件和晋升获得。</p>
            </div>
            <div class="modal-footer">
                <button id="close-skills-btn" class="btn">关闭</button>
            </div>
        </div>
    </div>
    
    <!-- 模态框: 成就系统 -->
    <div id="achievements-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>我的成就</h2>
            </div>
            <div class="modal-body">
                <div id="achievements-list"></div>
            </div>
            <div class="modal-footer">
                <button id="close-achievements-btn" class="btn">关闭</button>
            </div>
        </div>
    </div>
    
    <!-- 通知 -->
    <div id="notification"></div>

    <script>
    document.addEventListener('DOMContentLoaded', () => {

        // ----------------------------------------------------
        // 1. DOM 元素获取
        // ----------------------------------------------------
        const screens = {
            start: document.getElementById('start-screen'),
            main: document.getElementById('main-game-screen'),
        };
        const modals = {
            event: document.getElementById('event-modal'),
            skills: document.getElementById('skills-modal'),
            achievements: document.getElementById('achievements-modal'),
        };
        const inputs = {
            playerName: document.getElementById('player-name-input'),
        };
        const displays = {
            playerName: document.getElementById('player-name-display'),
            playerStage: document.getElementById('player-stage-display'),
            gameTime: document.getElementById('game-time'),
            influence: document.getElementById('influence-display'),
            log: document.getElementById('game-log'),
            notification: document.getElementById('notification'),
        };
        const statsBars = {
            professional: document.getElementById('stat-professional'),
            communication: document.getElementById('stat-communication'),
            decision: document.getElementById('stat-decision'),
            resilience: document.getElementById('stat-resilience'),
            learning: document.getElementById('stat-learning'),
        };
        const eventElements = {
            title: document.getElementById('event-title'),
            description: document.getElementById('event-description'),
            choices: document.getElementById('event-choices'),
        };
        const lists = {
            skills: document.getElementById('skills-list'),
            achievements: document.getElementById('achievements-list'),
        };
        const buttons = {
            start: document.getElementById('start-game-btn'),
            pause: document.getElementById('pause-btn'),
            showSkills: document.getElementById('skills-btn'),
            closeSkills: document.getElementById('close-skills-btn'),
            showAchievements: document.getElementById('achievements-btn'),
            closeAchievements: document.getElementById('close-achievements-btn'),
            share: document.getElementById('share-btn'),
            viralShare: document.getElementById('viral-share-btn'),
            reset: document.getElementById('reset-btn'),
        };
        const calendar = {
            year: document.getElementById('calendar-year'),
            month: document.getElementById('calendar-month'),
            day: document.getElementById('calendar-day'),
            totalDays: document.getElementById('calendar-total-days'),
            progressStatus: document.getElementById('progress-status')
        };

        // ----------------------------------------------------
        // 2. 游戏核心数据结构
        // ----------------------------------------------------
        
        // 游戏状态对象 (玩家数据和游戏进程)
        let gameState = {};

        // 游戏静态数据 (技能、事件、成就定义)
        const gameData = {
            skills: {
                professional: { name: '专业能力', description: '处理本职工作的核心技能，影响工作效率和质量。' },
                communication: { name: '沟通技巧', description: '与同事、领导、群众沟通的能力，决定人际关系和协作效果。' },
                decision: { name: '决策智慧', description: '在复杂情况中分析利弊，做出正确判断的能力。' },
                resilience: { name: '抗压能力', description: '面对压力、挫折和高强度工作时的心理承受力。' },
                learning: { name: '学习能力', description: '快速掌握新知识、新政策、新技能的能力。' },
            },
            achievements: {
                'FIRST_STEP': { name: '迈出第一步', description: '成功报名公职考试，踏上追梦之旅。', unlocked: false },
                'PASS_WRITTEN_TEST': { name: '笔试过关', description: '通过激烈的笔试，证明了你的知识储备。', unlocked: false },
                'ACE_INTERVIEW': { name: '面试之王', description: '在面试中脱颖而出，展现了你的综合素养。', unlocked: false },
                'NEWBIE_ONBOARD': { name: '新人报到', description: '成功入职，成为一名光荣的公职人员。', unlocked: false },
                'FIRST_PRAISE': { name: '初获赞扬', description: '第一次因工作出色受到领导或同事的表扬。', unlocked: false },
                'CRISIS_HANDLER': { name: '危机处理者', description: '成功处理一次突发事件，化解危机。', unlocked: false },
                'TEAM_PLAYER': { name: '团队合作者', description: '在团队合作中表现出色，获得同事认可。', unlocked: false },
                'INNOVATOR': { name: '创新先锋', description: '提出创新建议并被采纳，推动工作改进。', unlocked: false },
                'MEDIA_STAR': { name: '媒体之星', description: '成功接受媒体采访，展示良好的政府形象。', unlocked: false },
                'EXPERT': { name: '业务专家', description: '在专业领域达到很高水平，成为业务骨干。', unlocked: false },
                'LEADER': { name: '领导潜质', description: '展现出优秀的领导能力和管理潜质。', unlocked: false },
                'PEOPLE_SERVANT': { name: '人民公仆', description: '始终坚持为人民服务的理念，获得群众好评。', unlocked: false },
                'SOCIAL_MEDIA_HERO': { name: '网络红人', description: '在社交媒体上获得大量关注和好评。', unlocked: false },
                'CONTROVERSIAL_CHOICE': { name: '争议选择', description: '做出了一个引发热议的决定，但坚持了自己的原则。', unlocked: false },
                'MEME_MASTER': { name: '表情包达人', description: '因为某个瞬间成为网络表情包，意外走红。', unlocked: false },
                'YOUNG_ICON': { name: '年轻偶像', description: '成为年轻人心目中的公职人员典型代表。', unlocked: false },
                'BALANCE_MASTER': { name: '平衡大师', description: '在工作与生活间找到完美平衡，成为同龄人榜样。', unlocked: false },
                'TREND_SETTER': { name: '潮流引领者', description: '在政府工作中引入新潮理念，获得年轻群体认可。', unlocked: false },
                'HUATU_STUDENT': { name: '华图学霸', description: '成为华图教育忠实学员，掌握了核心学习方法。', unlocked: false },
                'HUATU_FAN': { name: '华图铁粉', description: '深度关注华图教育内容，心态和技能双提升。', unlocked: false },
                'GROUP_STAR': { name: '学习群明星', description: '在华图学习群中成为活跃分享者，帮助他人成长。', unlocked: false },
                'CAREER_FOCUSED': { name: '事业型选手', description: '选择挑战高难度工作，专注事业发展。', unlocked: false },
                'FAMILY_FIRST': { name: '顾家暖男/女', description: '将家庭放在首位，做出温暖的人生选择。', unlocked: false },
            },
            // 笔试题库
            writtenTestQuestions: [
                {
                    id: 'Q001', type: '行测', category: '数量关系',
                    question: '小明从家到学校的距离是1200米，他以每分钟60米的速度步行，走了8分钟后发现忘记带作业本，立即原路返回家中取作业本，然后以每分钟80米的速度前往学校。问小明从家出发到到达学校总共用了多少分钟？',
                    options: ['A. 35分钟', 'B. 38分钟', 'C. 41分钟', 'D. 44分钟'],
                    correct: 2, // 选项索引，从0开始
                    explanation: '小明先走了8分钟480米，返回家用时8分钟，然后以80米/分钟走1200米用时15分钟，总计8+8+15=31分钟。等等，让我重新计算...'
                },
                {
                    id: 'Q002', type: '申论', category: '综合分析',
                    question: '请结合材料，分析当前"躺平"现象对青年发展的影响，并提出解决建议。',
                    options: ['A. 完全支持躺平，认为是理性选择', 'B. 理解但不认同，提出积极建议', 'C. 严厉批评，要求立即改正', 'D. 回避问题，不做评价'],
                    correct: 1,
                    explanation: '需要理解年轻人面临的压力，但也要引导积极向上的人生态度。'
                },
                {
                    id: 'Q003', type: '行测', category: '言语理解',
                    question: '互联网时代，信息传播速度极快，但也容易产生________。我们要学会在海量信息中________真相，不能被虚假信息所________。',
                    options: ['A. 误解 寻找 迷惑', 'B. 偏差 识别 误导', 'C. 分歧 发现 欺骗', 'D. 混乱 辨别 蒙蔽'],
                    correct: 1,
                    explanation: '信息传播容易产生偏差，需要识别真相，避免被误导。'
                }
            ],
            // 面试题库
            interviewQuestions: [
                {
                    id: 'I001', type: '综合分析',
                    question: '有人说"90后、95后是垮掉的一代"，也有人说"90后、95后是最有希望的一代"。你怎么看？',
                    keyPoints: ['客观分析', '结合实际', '体现价值观', '逻辑清晰'],
                    difficulty: 2
                },
                {
                    id: 'I002', type: '计划组织',
                    question: '单位要组织一次"青年干部座谈会"，如果让你负责筹备工作，你会怎么做？',
                    keyPoints: ['前期调研', '方案制定', '组织实施', '总结反馈'],
                    difficulty: 1
                },
                {
                    id: 'I003', type: '应急应变',
                    question: '你在窗口服务时，遇到一位老人不会使用智能手机办理业务，非常着急，现场还有很多人排队等候。你怎么办？',
                    keyPoints: ['安抚情绪', '提供帮助', '兼顾效率', '长远考虑'],
                    difficulty: 2
                },
                {
                    id: 'I004', type: '人际沟通',
                    question: '你是新入职的公务员，发现同事工作方式比较传统，而你想推进一些新的工作方法，但遭到了一些阻力。你会怎么处理？',
                    keyPoints: ['理解包容', '沟通协调', '循序渐进', '求同存异'],
                    difficulty: 3
                }
            ],
            // 事件库：这是游戏的核心驱动力
            events: [
                // ========== 备考阶段 ==========
                {
                    id: 'E001', stage: '备考阶段', trigger: () => true, unique: true, important: true,
                    title: '选岗的终极纠结',
                    description: '网上铺天盖地的信息让你眼花缭乱：国考难度大但岗位好、省考相对简单、事业单位稳定、三支一扶能加分...朋友圈里有人晒上岸，有人吐槽996。你的内心开始了激烈的斗争。',
                    choices: [
                        { 
                            text: '国考！一步到位，挑战最高难度', 
                            personality: { innovative: 2, studious: 1 },
                            consequence: { 
                                stats: { decision: 2, resilience: 1 }, 
                                log: '你选择了国考！虽然竞争激烈，但中央部门的吸引力让你决心一搏。',
                                selectedPath: 'nationalExam'
                            }
                        },
                        { 
                            text: '省考比较稳妥，离家近发展也不错', 
                            personality: { cautious: 2, traditional: 1 },
                            consequence: { 
                                stats: { resilience: 2, communication: 1 }, 
                                log: '你选择了省考。在家乡工作，既能照顾家人，发展前景也很好。',
                                selectedPath: 'provincialExam'
                            }
                        },
                        { 
                            text: '事业单位工作生活平衡，适合我', 
                            personality: { cautious: 1, social: 1 },
                            consequence: { 
                                stats: { resilience: 3 }, 
                                log: '你选择了事业单位考试。相对轻松的工作节奏很适合你的人生规划。',
                                selectedPath: 'institutionExam'
                            }
                        },
                        { 
                            text: '先考三支一扶积累经验，再考公务员', 
                            personality: { innovative: 1, social: 2 },
                            consequence: { 
                                stats: { learning: 2, communication: 2 }, 
                                log: '你选择了三支一扶项目。虽然辛苦，但基层经验对未来很有帮助。',
                                selectedPath: 'grassrootsProgram'
                            }
                        }
                    ]
                },
                // 选具体职位事件
                {
                    id: 'E001_FOLLOW', stage: '备考阶段', trigger: (gs) => gs.selectedPath && !gs.jobLocation && gs.time.days > 5, unique: true, important: true,
                    title: '具体职位的选择困难症',
                    description: '确定了考试类型后，现在要选具体职位了。打开职位表，密密麻麻的信息让你眼花缭乱：有的在北京但要求工作经验，有的在老家但是冷门部门，有的薪资高但在西部偏远地区...',
                    choices: [
                        {
                            text: '选择北京/一线城市岗位，拼一把',
                            personality: { innovative: 2, rebellious: 1 },
                            consequence: {
                                stats: { decision: 2, resilience: -1 },
                                influence: 5,
                                log: '你选择了北京的某部委岗位。虽然竞争激烈，但一线城市的发展机会更多。',
                                jobLocation: 'first_tier',
                                permanentChoices: { locationPreference: 'first_tier' }
                            }
                        },
                        {
                            text: '回老家工作，离父母近一些',
                            personality: { traditional: 2, cautious: 1 },
                            consequence: {
                                stats: { resilience: 2, communication: 1 },
                                influence: 3,
                                log: '你选择了家乡的政府部门。虽然发展空间有限，但能照顾家人。',
                                jobLocation: 'hometown',
                                permanentChoices: { locationPreference: 'hometown' }
                            }
                        },
                        {
                            text: '选择西部地区，有地域加分',
                            personality: { innovative: 1, social: 2 },
                            consequence: {
                                stats: { learning: 2, resilience: 2 },
                                influence: 8,
                                log: '你选择了西部某省的职位。虽然条件艰苦，但有加分政策和快速晋升机会。',
                                jobLocation: 'western',
                                permanentChoices: { locationPreference: 'western' }
                            }
                        },
                        {
                            text: '专挑门槛低的岗位，先上岸再说',
                            personality: { cautious: 2 },
                            consequence: {
                                stats: { decision: -1, resilience: 1 },
                                influence: 2,
                                log: '你选择了要求相对较低的岗位。虽然不是理想选择，但上岸概率更大。',
                                jobLocation: 'conservative',
                                permanentChoices: { locationPreference: 'conservative' }
                            }
                        }
                    ]
                },
                // 详细职位选择的现实困境
                {
                    id: 'E001_DETAIL', stage: '备考阶段', trigger: (gs) => gs.jobLocation && !gs.jobType && gs.time.days > 20, unique: true, important: true,
                    title: '职位细节的艰难抉择',
                    description: '你看中了几个具体职位，但每个都有让人纠结的地方。这个选择将影响你未来几年甚至一生的轨迹...',
                    choices: [
                        {
                            text: '税务局：薪资高但工作压力大，经常加班',
                            personality: { studious: 1, resilience: 1 },
                            consequence: {
                                stats: { professional: 2, resilience: -1 },
                                influence: 6,
                                log: '税务工作虽然辛苦，但收入稳定，专业性强。你决定挑战高强度工作。',
                                jobType: 'tax_bureau',
                                permanentChoices: { jobType: 'tax_bureau' },
                                triggerEvent: 'TAX_FOLLOW'
                            }
                        },
                        {
                            text: '教育局：工作稳定但薪资一般，假期多',
                            personality: { social: 2, traditional: 1 },
                            consequence: {
                                stats: { communication: 2, resilience: 2 },
                                influence: 4,
                                log: '教育系统工作规律，假期充足，适合平衡工作生活。',
                                jobType: 'education_bureau',
                                permanentChoices: { jobType: 'education_bureau' }
                            }
                        },
                        {
                            text: '应急管理局：新兴部门发展快，但风险大',
                            personality: { innovative: 2, rebellious: 1 },
                            consequence: {
                                stats: { decision: 3, learning: 2 },
                                influence: 8,
                                log: '新部门意味着更多机会，但也面临更多不确定性。你选择拥抱变化。',
                                jobType: 'emergency_mgmt',
                                permanentChoices: { jobType: 'emergency_mgmt' }
                            }
                        },
                        {
                            text: '街道办：基层工作接地气，但晋升空间有限',
                            personality: { social: 3, traditional: 1 },
                            consequence: {
                                stats: { communication: 3, resilience: 1 },
                                influence: 3,
                                log: '基层工作让你直接服务群众，虽然辛苦但很有意义。',
                                jobType: 'subdistrict_office',
                                permanentChoices: { jobType: 'subdistrict_office' }
                            }
                        }
                    ]
                },
                {
                    id: 'TAX_FOLLOW', stage: '备考阶段', trigger: (gs) => gs.jobType === 'tax_bureau' && !gs.eventHistory.includes('TAX_FOLLOW'), unique: true, important: true,
                    title: '税务局的额外挑战',
                    description: '选择税务局后，你了解到更多内情：这个岗位需要经常出差检查企业，工作强度很大，但专业能力提升很快，而且有不少同龄人...',
                    choices: [
                        {
                            text: '接受挑战，拼事业发展',
                            personality: { studious: 2, innovative: 1 },
                            consequence: {
                                stats: { professional: 3, learning: 2, resilience: -1 },
                                influence: 10,
                                log: '你决心在税务领域深耕，虽然压力大但成长空间广阔。',
                                achievement: 'CAREER_FOCUSED'
                            }
                        },
                        {
                            text: '重新考虑，换个轻松的岗位',
                            personality: { cautious: 2 },
                            consequence: {
                                stats: { decision: -1, resilience: 2 },
                                influence: 2,
                                log: '你觉得生活质量更重要，决定重新选择相对轻松的岗位。',
                                jobType: 'education_bureau'
                            }
                        }
                    ]
                },
                // 薪资vs发展的具体冲突
                {
                    id: 'SALARY_DILEMMA', stage: '备考阶段', trigger: (gs) => gs.jobType && gs.time.days > 35, unique: true, important: true,
                    title: '薪资与发展的两难选择',
                    description: '你同时收到了两个岗位的意向：一个是市中心某委办局的科员，薪资高但晋升慢；另一个是新区管委会的主任科员，薪资一般但发展前景好。朋友们意见不一...',
                    choices: [
                        {
                            text: '选高薪岗位，先解决生活问题',
                            personality: { cautious: 2, traditional: 1 },
                            consequence: {
                                stats: { resilience: 2, professional: 1 },
                                influence: 5,
                                log: '你觉得经济基础决定上层建筑，先有稳定收入再谈发展。',
                                jobSalary: 'high',
                                buff: { name: '经济稳定', duration: 15, effect: 'financial_stability' }
                            }
                        },
                        {
                            text: '选发展岗位，着眼长远未来',
                            personality: { innovative: 2, rebellious: 1 },
                            consequence: {
                                stats: { decision: 3, learning: 2 },
                                influence: 8,
                                log: '你选择投资未来，相信新区的发展潜力和晋升机会。',
                                jobProspects: 'high',
                                buff: { name: '发展潜力', duration: 20, effect: 'career_growth' }
                            }
                        },
                        {
                            text: '继续观望，寻找更好机会',
                            personality: { cautious: 1 },
                            consequence: {
                                stats: { decision: -1, resilience: -1 },
                                influence: 1,
                                log: '你决定再等等，但机会稍纵即逝，可能会错过好岗位。',
                                debuff: { name: '机会成本', duration: 10, effect: 'opportunity_cost' }
                            }
                        }
                    ]
                },
                // 工作地点的家庭考量
                {
                    id: 'FAMILY_LOCATION', stage: '备考阶段', trigger: (gs) => gs.time.days > 50 && !gs.eventHistory.includes('FAMILY_LOCATION'), unique: true, important: true,
                    title: '家庭因素的现实考量',
                    description: '就在你准备最终确定职位时，家里传来消息：奶奶身体不好需要人照顾，女朋友也希望你留在本地发展。但你心仪的岗位在外地，这让你陷入深深的纠结...',
                    choices: [
                        {
                            text: '留在本地，照顾家庭',
                            personality: { traditional: 3, social: 2 },
                            consequence: {
                                stats: { communication: 3, resilience: 1 },
                                influence: 4,
                                log: '家人最重要，你决定留在本地，承担起家庭责任。',
                                familyChoice: 'local',
                                achievement: 'FAMILY_FIRST'
                            }
                        },
                        {
                            text: '追求梦想，异地发展',
                            personality: { innovative: 2, rebellious: 2 },
                            consequence: {
                                stats: { decision: 3, resilience: -2 },
                                influence: 10,
                                log: '你选择追求事业理想，虽然离家远但机会更好。',
                                familyChoice: 'distant',
                                debuff: { name: '思乡之苦', duration: 12, effect: 'homesickness' }
                            }
                        },
                        {
                            text: '寻求平衡，就近选择稍好的岗位',
                            personality: { cautious: 2, social: 1 },
                            consequence: {
                                stats: { decision: 1, communication: 2 },
                                influence: 6,
                                log: '你在家庭和事业间找到平衡点，选择了距离适中的岗位。',
                                familyChoice: 'balanced'
                            }
                        }
                    ]
                },
                {
                    id: 'E002', stage: '备考阶段', trigger: (gs) => gs.selectedPath, unique: true,
                    title: '制定学习计划',
                    description: '距离笔试还有3个月，时间紧迫。面对厚厚的复习资料，你决定制定一个学习计划。',
                    choices: [
                        { text: '科学规划，劳逸结合', consequence: { stats: { learning: 3, resilience: 2 }, log: '你制定了详细的计划，并坚持执行，感觉很有条理。' } },
                        { text: '题海战术，拼命刷题', consequence: { stats: { professional: 3, resilience: -1 }, log: '你疯狂刷题，虽然很累，但感觉专业知识更扎实了。' } },
                        { text: '随缘复习，重在参与', consequence: { stats: { resilience: 3, professional: -2 }, log: '你心态很好，决定佛系备考，压力小了很多。' } }
                    ]
                },
                {
                    id: 'E012', stage: '备考阶段', trigger: (gs) => gs.time.days > 15, unique: true,
                    title: '心态波动',
                    description: '复习遇到了瓶颈，一道难题让你百思不得其解，你感到有些焦虑。',
                    choices: [
                        { text: '向论坛大神请教', consequence: { stats: { communication: 2, professional: 2 }, log: '你在论坛发帖求助，很快得到了解答，茅塞顿开。' } },
                        { text: '出去运动，放松一下', consequence: { stats: { resilience: 2 }, log: '你选择去跑步，大汗淋漓后，心情舒畅多了。' } },
                        { text: '硬着头皮继续钻研', consequence: { stats: { learning: 2, resilience: -1 }, log: '你花了很长时间终于搞懂了，但感觉身心俱疲。' } }
                    ]
                },
                {
                    id: 'E003', stage: '备考阶段', trigger: (gs) => gs.time.days > 30, unique: true,
                    title: '模拟考试',
                    description: '培训机构组织了一次模拟考试，你的成绩不太理想，排名靠后。',
                    choices: [
                        { text: '分析错题，查漏补缺', consequence: { stats: { professional: 2, learning: 1 }, log: '你仔细分析了每道错题，发现了自己的薄弱环节。' } },
                        { text: '调整心态，继续努力', consequence: { stats: { resilience: 2 }, log: '你告诉自己这只是模拟考试，真正的考试还没到。' } },
                        { text: '怀疑自己，考虑放弃', consequence: { stats: { resilience: -2, professional: -1 }, log: '你开始怀疑自己的能力，产生了放弃的念头。' } }
                    ]
                },
                {
                    id: 'E004', stage: '备考阶段', trigger: (gs) => gs.time.days > 45, unique: true,
                    title: '家人的关心',
                    description: '家人看到你每天埋头苦读，既心疼又担心，劝你要注意身体。',
                    choices: [
                        { text: '感谢家人，调整作息', consequence: { stats: { resilience: 2, communication: 1 }, log: '你感谢家人的关心，开始更注意劳逸结合。' } },
                        { text: '表示理解，但坚持现状', consequence: { stats: { professional: 1, resilience: -1 }, log: '你理解家人的担心，但觉得现在不能松懈。' } },
                        { text: '有些烦躁，希望他们别管', consequence: { stats: { communication: -2 }, log: '你觉得家人不理解你的压力，有些烦躁。' } }
                    ]
                },
                {
                    id: 'E005', stage: '备考阶段', trigger: (gs) => gs.time.days > 60, unique: true,
                    title: '朋友的聚会',
                    description: '老同学组织聚会，邀请你参加。你已经很久没有放松过了。',
                    choices: [
                        { text: '参加聚会，放松心情', consequence: { stats: { resilience: 2, communication: 2 }, log: '你和老朋友们聊天，心情轻松了很多。' } },
                        { text: '婉拒邀请，继续复习', consequence: { stats: { professional: 2, communication: -1 }, log: '你觉得时间宝贵，选择继续复习。' } },
                        { text: '纠结犹豫，最后没去', consequence: { stats: { resilience: -1 }, log: '你纠结了很久，最后还是没去，但心里有些遗憾。' } }
                    ]
                },
                {
                    id: 'E006', stage: '备考阶段', trigger: (gs) => gs.time.days > 25, unique: true,
                    title: '🔥 华图直播间的超神级讲师',
                    description: '华图在线APP推送：今晚8点华图教育金牌讲师直播《申论高分秘籍》！你的室友疯狂推荐："兄弟，华图这个老师太强了！去年我朋友就是看他的课上岸的！"弹幕已经沸腾了...',
                    choices: [
                        { 
                            text: '🎯 冲进直播间，准备做笔记！', 
                            personality: { studious: 2, innovative: 1 },
                            consequence: { 
                                stats: { learning: 4, professional: 3, communication: 1 }, 
                                examProgress: { practiceTests: 1 },
                                log: '华图讲师的"万能模板法"让你醍醐灌顶！直播间学到的技巧太实用了！',
                                achievement: 'HUATU_STUDENT'
                            } 
                        },
                        { 
                            text: '📱 先关注华图视频号，看回放', 
                            personality: { cautious: 1 },
                            consequence: { 
                                stats: { learning: 2, decision: 1 }, 
                                log: '你关注了华图教育视频号，课程回放让你可以反复学习重点内容。' 
                            } 
                        },
                        { 
                            text: '😏 网课都是割韭菜，自学更香', 
                            personality: { rebellious: 2 },
                            consequence: { 
                                stats: { decision: 1, resilience: -1 }, 
                                log: '你坚持自学，但后来发现华图讲师提到的考点真的考了...有点后悔。' 
                            } 
                        }
                    ]
                },
                {
                    id: 'E007', stage: '备考阶段', trigger: (gs) => gs.time.days > 40, unique: true,
                    title: '💬 华图学习群的神仙打架',
                    description: '华图教育官方学习群里炸了！有学霸每天晒进度条"今日刷题200道✅"，有人哭诉"申论永远40+怎么破😭"，还有大神在分享"我是这样从30分逆袭到70分的..."群消息99+停不下来！',
                    choices: [
                        { 
                            text: '🤓 化身技术流，分享学习方法', 
                            personality: { social: 2, studious: 1 },
                            consequence: { 
                                stats: { communication: 4, professional: 2, learning: 1 }, 
                                influence: 15,
                                log: '你的"华图课程+错题本"学习法被群友疯狂点赞，还有人私聊要笔记！',
                                achievement: 'GROUP_STAR'
                            } 
                        },
                        { 
                            text: '🔥 当情绪安慰师，鸡汤走起', 
                            personality: { social: 3 },
                            consequence: { 
                                stats: { communication: 3, resilience: 2 }, 
                                log: '你的励志小作文让群里萌新重燃斗志，群主都给你点赞了！' 
                            } 
                        },
                        { 
                            text: '👀 默默潜水，偷学大神经验', 
                            personality: { cautious: 1 },
                            consequence: { 
                                stats: { learning: 2, resilience: -1 }, 
                                log: '你悄悄收藏了大神的复习计划，但群里的焦虑氛围还是有点影响心情。' 
                            } 
                        }
                    ]
                },
                {
                    id: 'E008', stage: '备考阶段', trigger: (gs) => gs.time.days > 50, unique: true,
                    title: '📺 华图教育直播间：今夜无眠刷题大会',
                    description: '华图教育视频号疯了！今晚深夜直播"100道行测秒杀技巧"，主播是华图王牌讲师，弹幕全是"老师牛逼！""这个方法绝了！"你室友激动地摇你："快起来！华图老师在教神仙解题法！"',
                    choices: [
                        { 
                            text: '🌙 熬夜也要学！冲进直播间', 
                            personality: { social: 2, innovative: 1, studious: 2 },
                            consequence: { 
                                stats: { learning: 4, communication: 2, resilience: -1, professional: 3 }, 
                                examProgress: { practiceTests: 2 },
                                log: '华图老师的"秒杀公式"太强了！你疯狂做笔记到凌晨2点，虽然困但超值！',
                                buff: { name: '华图秘技', duration: 5, effect: 'exam_skills' }
                            } 
                        },
                        { 
                            text: '📱 先关注，明天看回放', 
                            personality: { cautious: 2 },
                            consequence: { 
                                stats: { decision: 2, learning: 1 }, 
                                log: '你理智地选择看回放，华图的课程回放功能让你可以慢慢消化。' 
                            } 
                        },
                        { 
                            text: '😴 太晚了，明天专心刷题', 
                            personality: { traditional: 2, cautious: 1 },
                            consequence: { 
                                stats: { resilience: 2, professional: 1 }, 
                                examProgress: { practiceTests: 1 },
                                log: '你坚持早睡早起，但第二天听说错过了超实用的技巧，有点小遗憾。' 
                            } 
                        }
                    ]
                },
                {
                    id: 'E009', stage: '备考阶段', trigger: (gs) => gs.time.days > 30 && gs.examProgress.practiceTests < 2, unique: true,
                    title: '第一次模拟考试',
                    description: '你报名参加了第一次模拟考试。这是检验学习成果的重要机会，但也很紧张。',
                    choices: [
                        { text: '全力以赴，当作真考试', 
                          personality: { studious: 2, cautious: 1 },
                          consequence: (gs) => {
                            const score = Math.floor(Math.random() * 30) + 60 + gs.player.stats.professional / 2;
                            return { 
                                stats: { resilience: 1, professional: 2 }, 
                                examProgress: { practiceTests: 1, writtenTestScore: score },
                                log: `你认真对待模拟考试，获得了${score}分的成绩。这次体验让你更了解考试节奏。` 
                            };
                          }},
                        { text: '随便做做，感受一下', 
                          personality: { cautious: -1 },
                          consequence: { stats: { resilience: -1 }, examProgress: { practiceTests: 1 }, log: '你没有认真对待这次模拟考试，感觉有些浪费了机会。' } },
                        { text: '紧张到发挥失常', 
                          consequence: { stats: { resilience: -2, professional: 1 }, examProgress: { practiceTests: 1 }, log: '紧张让你发挥失常，但这次经历让你明白了心态调整的重要性。' } }
                    ]
                },
                {
                    id: 'E010', stage: '备考阶段', trigger: (gs) => gs.time.month === 2 && gs.time.day > 20, unique: true,
                    title: '距离报名只有一周！',
                    description: '看着日历上圈出的报名日期，你突然意识到只剩一周时间了！朋友圈里已经有人在讨论职位选择，你感到了前所未有的紧迫感。',
                    choices: [
                        { text: '抓紧时间冲刺复习', 
                          personality: { studious: 2 },
                          consequence: { stats: { professional: 3, resilience: -1 }, log: '你开始了疯狂的冲刺复习，每天学习到深夜。' } },
                        { text: '先研究职位表，选好岗位', 
                          personality: { cautious: 2 },
                          consequence: { stats: { decision: 2 }, log: '你花了一天时间仔细研究职位表，选定了几个心仪的岗位。' } },
                        { text: '保持节奏，相信自己', 
                          personality: { cautious: 1 },
                          consequence: { stats: { resilience: 2 }, log: '你没有被紧迫感冲昏头脑，保持了稳定的学习节奏。' } }
                    ]
                },
                {
                    id: 'E011', stage: '备考阶段', trigger: (gs) => gs.time.days > 70, unique: true,
                    title: '🆚 华图在线APP vs 其他刷题软件大战',
                    description: '微博上#刷题软件哪家强#话题冲上热搜！网友分成几派：华图派说"华图在线的解析最详细"，粉笔派反击"粉笔题目最新"，中公派坚持"中公最全面"...你的选择恐惧症犯了！',
                    choices: [
                        { 
                            text: '🎯 华图在线一把梭！相信老牌机构', 
                            personality: { traditional: 1, studious: 2 },
                            consequence: { 
                                stats: { professional: 3, learning: 2, decision: 1 }, 
                                examProgress: { practiceTests: 2 },
                                log: '华图在线的系统性课程体系让你受益匪浅，解析确实很详细！',
                                achievement: 'HUATU_STUDENT'
                            } 
                        },
                        { 
                            text: '🔄 都下载，各家取长补短', 
                            personality: { innovative: 2 },
                            consequence: { 
                                stats: { learning: 2, communication: 1, decision: -1 }, 
                                log: '你成了刷题软件收集家，虽然有点乱但确实学到了各家的精华。' 
                            } 
                        },
                        { 
                            text: '📊 做调研，看评分和口碑', 
                            personality: { cautious: 2, innovative: 1 },
                            consequence: { 
                                stats: { decision: 3, learning: 1 }, 
                                log: '你花了一天时间研究各种测评，最终做出了理性选择。' 
                            } 
                        }
                    ]
                },
                // ========== 特殊BUFF事件 ==========
                {
                    id: 'BUFF001', stage: '备考阶段', trigger: (gs) => Math.random() < 0.1 && gs.time.days > 20 && !gs.eventHistory.includes('BUFF001'), unique: true,
                    title: '💫 今日运势：学习效率爆表',
                    description: '今天不知道怎么回事，注意力特别集中，理解力也很强。连平时最难的题目都能轻松搞定！',
                    special: 'buff',
                    choices: [
                        { 
                            text: '把握机会，疯狂学习！', 
                            consequence: { 
                                stats: { professional: 5, learning: 3 }, 
                                examProgress: { practiceTests: 1 },
                                log: '你抓住了这个绝佳机会，今天的学习效果顶平时三天！',
                                buff: { name: '学习效率提升', duration: 3, effect: 'learning_boost' }
                            } 
                        }
                    ]
                },
                {
                    id: 'BUFF002', stage: '备考阶段', trigger: (gs) => Math.random() < 0.08 && gs.time.days > 30 && !gs.eventHistory.includes('BUFF002'), unique: true,
                    title: '🎉 华图教育押题神话：老师又预测中了！',
                    description: '华图教育公众号炸了！今年模拟考的题目竟然和华图讲师预测的80%重合！网友疯狂转发："华图老师是不是考试出题人的亲戚？""这预测准得离谱！"你赶紧翻出华图的押题资料...',
                    special: 'buff',
                    choices: [
                        { 
                            text: '🔥 立刻关注华图全平台，抱紧大腿！', 
                            personality: { studious: 2, innovative: 1 },
                            consequence: { 
                                stats: { professional: 5, learning: 3, decision: 2 }, 
                                examProgress: { practiceTests: 2 },
                                log: '你火速关注了华图的公众号、视频号、APP，押题资料让你信心爆棚！',
                                buff: { name: '华图押题加持', duration: 8, effect: 'huatu_prediction' },
                                achievement: 'HUATU_FAN'
                            } 
                        },
                        { 
                            text: '📝 理性对待，参考但不依赖', 
                            personality: { cautious: 2 },
                            consequence: { 
                                stats: { professional: 3, decision: 2 }, 
                                log: '你保持理性，把华图的预测作为重要参考，但还是以全面复习为主。',
                                buff: { name: '理性备考', duration: 3, effect: 'rational_study' }
                            } 
                        },
                        { 
                            text: '😤 不信邪，坚持自己的计划', 
                            personality: { rebellious: 2 },
                            consequence: { 
                                stats: { decision: 1, resilience: 1 }, 
                                log: '你觉得押题都是玄学，还是按自己的节奏来，但心里还是有点好奇...' 
                            } 
                        }
                    ]
                },
                {
                    id: 'DEBUFF001', stage: '备考阶段', trigger: (gs) => Math.random() < 0.12 && gs.time.days > 25 && !gs.eventHistory.includes('DEBUFF001'), unique: true,
                    title: '😵 突发状况：手机成瘾',
                    description: '最近刷手机上瘾了，明明打算学习，但总是忍不住看微博、抖音。时间就这样悄悄溜走了...',
                    special: 'debuff',
                    choices: [
                        { 
                            text: '狠心卸载所有娱乐APP', 
                            personality: { studious: 2 },
                            consequence: { 
                                stats: { decision: 3, resilience: 2 }, 
                                log: '你忍痛卸载了所有娱乐APP，学习效率明显提升！' 
                            } 
                        },
                        { 
                            text: '设置使用时间限制', 
                            personality: { cautious: 1 },
                            consequence: { 
                                stats: { decision: 1 }, 
                                log: '你设置了APP使用限制，但效果一般般。' 
                            } 
                        },
                        { 
                            text: '算了，反正也要放松', 
                            consequence: { 
                                stats: { resilience: 1, professional: -2 }, 
                                log: '你放任自己继续刷手机，学习进度明显落后了。',
                                debuff: { name: '手机成瘾', duration: 7, effect: 'phone_addiction' }
                            } 
                        }
                    ]
                },
                {
                    id: 'BUFF003', stage: '备考阶段', trigger: (gs) => Math.random() < 0.06 && gs.time.days > 35 && !gs.eventHistory.includes('BUFF003'), unique: true,
                    title: '🎉 幸运事件：遇到学霸室友',
                    description: '你的新室友竟然是去年上岸的学长！他主动提出要分享一些独家的学习资料和经验，简直是天降好运！',
                    special: 'buff',
                    choices: [
                        { 
                            text: '虚心请教，建立学习小组', 
                            personality: { social: 2, studious: 1 },
                            consequence: { 
                                stats: { learning: 4, communication: 3, professional: 2 }, 
                                examProgress: { practiceTests: 2 },
                                log: '学长的指导让你如醍醐灌顶，学习效率大幅提升！',
                                buff: { name: '学霸指导', duration: 10, effect: 'mentor_guidance' }
                            } 
                        },
                        { 
                            text: '礼貌感谢，偶尔交流', 
                            consequence: { 
                                stats: { learning: 2, communication: 1 }, 
                                log: '你获得了一些有用的建议，但没有充分利用这个机会。' 
                            } 
                        }
                    ]
                },
                {
                    id: 'DEBUFF002', stage: '备考阶段', trigger: (gs) => Math.random() < 0.1 && gs.time.days > 50 && !gs.eventHistory.includes('DEBUFF002'), unique: true,
                    title: '😴 困扰事件：严重失眠',
                    description: '最近压力太大，你开始失眠。凌晨3点还在翻来覆去，白天学习时昏昏沉沉，效率极低。',
                    special: 'debuff',
                    choices: [
                        { 
                            text: '买褪黑素，调整作息', 
                            personality: { cautious: 1 },
                            consequence: { 
                                stats: { resilience: 1 }, 
                                log: '你开始调整作息，但短期内仍然受失眠困扰。',
                                debuff: { name: '轻度失眠', duration: 5, effect: 'insomnia' }
                            } 
                        },
                        { 
                            text: '硬撑着继续学习', 
                            personality: { studious: 1 },
                            consequence: { 
                                stats: { resilience: -2, professional: -1 }, 
                                log: '你强撑着学习，但效果很差，身体也受不了。',
                                debuff: { name: '严重失眠', duration: 8, effect: 'insomnia' }
                            } 
                        },
                        { 
                            text: '找心理医生咨询', 
                            personality: { innovative: 1 },
                            consequence: { 
                                stats: { resilience: 2, decision: 1 }, 
                                log: '专业的建议帮你找到了失眠的根源，状态逐渐好转。' 
                            } 
                        }
                    ]
                },
                {
                    id: 'BUFF004', stage: '考试阶段', trigger: (gs) => Math.random() < 0.15 && gs.selectedPath && !gs.eventHistory.includes('BUFF004'), unique: true,
                    title: '🍀 超级幸运：考试当天好运爆棚',
                    description: '考试当天一切顺利：提前到达考场、座位靠窗采光好、考试题目刚好都是你重点复习的内容！',
                    special: 'buff',
                    choices: [
                        { 
                            text: '把握机会，超常发挥！', 
                            consequence: { 
                                stats: { professional: 3, resilience: 2, decision: 2 }, 
                                examProgress: { writtenTestScore: 25 },
                                log: '好运加持下，你发挥出了前所未有的水平！',
                                buff: { name: '超常发挥', duration: 3, effect: 'exam_boost' }
                            } 
                        }
                    ]
                },
                {
                    id: 'DEBUFF003', stage: '考试阶段', trigger: (gs) => Math.random() < 0.08 && gs.time.days > 92 && !gs.eventHistory.includes('DEBUFF003'), unique: true,
                    title: '😰 倒霉事件：考试当天突发状况',
                    description: '考试当天简直是诸事不顺：闹钟没响差点迟到、考场空调坏了很闷热、隔壁考生一直咳嗽...',
                    special: 'debuff',
                    choices: [
                        { 
                            text: '调整心态，专注考试', 
                            personality: { resilience: 2 },
                            consequence: { 
                                stats: { resilience: 1, decision: 1 }, 
                                examProgress: { writtenTestScore: -5 },
                                log: '虽然有干扰，但你努力保持专注，影响有限。' 
                            } 
                        },
                        { 
                            text: '心态崩了，发挥失常', 
                            consequence: { 
                                stats: { resilience: -2, professional: -1 }, 
                                examProgress: { writtenTestScore: -15 },
                                log: '一连串的意外让你心态崩溃，考试发挥严重失常。',
                                debuff: { name: '考试焦虑', duration: 3, effect: 'exam_anxiety' }
                            } 
                        }
                    ]
                },
                // ========== 随机趣味事件 ==========
                {
                    id: 'RANDOM001', stage: '备考阶段', trigger: (gs) => Math.random() < 0.15 && gs.time.days > 10 && !gs.eventHistory.includes('RANDOM001'), unique: true,
                    title: '🐱 突发状况：邻居家的猫',
                    description: '邻居家的猫不知道怎么跑到你家阳台上了，喵喵叫个不停。你正在专心学习，被吵得心烦意乱。',
                    special: 'random',
                    choices: [
                        { 
                            text: '开门让猫进来，撸猫解压', 
                            personality: { social: 1 },
                            consequence: { 
                                stats: { resilience: 3, communication: 1 }, 
                                log: '意外的撸猫时光让你心情舒畅，学习状态反而更好了。' 
                            } 
                        },
                        { 
                            text: '把猫送回邻居家', 
                            personality: { social: 2 },
                            consequence: { 
                                stats: { communication: 2 }, 
                                log: '你和邻居聊了几句，意外发现他们家孩子也在准备公考。' 
                            } 
                        },
                        { 
                            text: '关窗户，专心学习', 
                            personality: { studious: 1 },
                            consequence: { 
                                stats: { professional: 1, resilience: -1 }, 
                                log: '你坚持学习，但猫叫声还是有点影响心情。' 
                            } 
                        }
                    ]
                },
                {
                    id: 'RANDOM002', stage: '备考阶段', trigger: (gs) => Math.random() < 0.1 && gs.time.days > 40 && !gs.eventHistory.includes('RANDOM002'), unique: true,
                    title: '🔥 华图公众号爆文：《公考内卷？我笑了》',
                    description: '华图教育公众号今天推送了一篇10万+爆文！文章说："别被网上的焦虑贩卖者忽悠，真正的高手都在闷声学习。"评论区炸了：有人说"华图说得对，心态最重要"，也有人反驳"站着说话不腰疼"...',
                    special: 'random',
                    choices: [
                        { 
                            text: '💪 华图说得对！调整心态继续冲', 
                            personality: { resilience: 2, studious: 1 },
                            consequence: { 
                                stats: { resilience: 4, decision: 2, learning: 1 }, 
                                log: '华图的文章让你醍醐灌顶，你关注了公众号并调整了心态。',
                                achievement: 'HUATU_FAN'
                            } 
                        },
                        { 
                            text: '🤔 转发朋友圈，求大家安慰', 
                            personality: { social: 2 },
                            consequence: { 
                                stats: { communication: 2, resilience: -1 }, 
                                log: '你转发了文章配文"太真实了😭"，收获了朋友们的点赞和鼓励。' 
                            } 
                        },
                        { 
                            text: '😤 都是毒鸡汤，删除不看', 
                            personality: { rebellious: 2 },
                            consequence: { 
                                stats: { decision: 1, resilience: -1 }, 
                                log: '你觉得这些文章都在贩卖焦虑，但内心的不安还是挥之不去。' 
                            } 
                        }
                    ]
                },
                
                // ========== 考试阶段 ==========
                {
                    id: 'E101', stage: '考试阶段', trigger: () => true, unique: true,
                    title: '笔试前夜的失眠',
                    description: '明天就是笔试了，你躺在床上翻来覆去睡不着。窗外有工地在施工，隔壁室友在刷抖音，你的心情五味杂陈。',
                    choices: [
                        { text: '起来再复习一会儿', 
                          personality: { studious: 1, cautious: 1 },
                          consequence: { stats: { professional: 1, resilience: -1 }, log: '你又复习了2小时，知识点更牢固了，但睡眠不足可能影响明天的发挥。' } },
                        { text: '听音乐放松，强制入睡', 
                          personality: { cautious: 2 },
                          consequence: { stats: { resilience: 2 }, log: '你听着轻音乐逐渐入睡，第二天精神状态不错。' } },
                        { text: '和室友聊天缓解紧张', 
                          personality: { social: 2 },
                          consequence: { stats: { communication: 1, resilience: 1 }, log: '和室友聊了聊考试的事，心情放松了不少。' } }
                    ]
                },
                {
                    id: 'E102', stage: '考试阶段', trigger: (gs) => gs.time.days > 92, unique: true,
                    title: '笔试考场：行测部分',
                    description: '考试开始了！第一部分是行测，你看到了一道数量关系题：一个水池有进水管和出水管，进水管每分钟进水5升，出水管每分钟出水3升，水池容量100升，问多长时间能注满？',
                    choices: [
                        { text: '立即计算：100÷(5-3)=50分钟', 
                          consequence: (gs) => {
                            const baseScore = gs.examProgress.practiceTests * 10 + gs.player.stats.professional;
                            return { 
                                examProgress: { writtenTestScore: baseScore + 15 },
                                stats: { professional: 1 },
                                log: '正确！你迅速算出了答案，为后面节省了时间。' 
                            };
                          }},
                        { text: '仔细检查题目，怕有陷阱', 
                          consequence: (gs) => {
                            const baseScore = gs.examProgress.practiceTests * 10 + gs.player.stats.professional;
                            return { 
                                examProgress: { writtenTestScore: baseScore + 10 },
                                stats: { decision: 1 },
                                log: '你仔细确认了题目条件，虽然答案正确但花费了更多时间。' 
                            };
                          }},
                        { text: '跳过这题，先做简单的', 
                          consequence: (gs) => {
                            const baseScore = gs.examProgress.practiceTests * 10 + gs.player.stats.professional;
                            return { 
                                examProgress: { writtenTestScore: baseScore + 5 },
                                log: '你选择了策略性跳题，但最后时间不够没能回来做这道题。' 
                            };
                          }}
                    ]
                },
                {
                    id: 'E103', stage: '考试阶段', trigger: (gs) => gs.time.days > 93, unique: true,
                    title: '笔试考场：申论部分',
                    description: '申论考试开始了。题目是关于"年轻人躺平现象"的分析，这个话题你很熟悉。时间有限，你需要快速组织思路。',
                    choices: [
                        { text: '从社会压力角度分析', 
                          personality: { rebellious: 1 },
                          consequence: (gs) => {
                            const baseScore = gs.examProgress.writtenTestScore || 60;
                            return { 
                                examProgress: { writtenTestScore: baseScore + 20 },
                                stats: { decision: 2, communication: 1 },
                                log: '你的分析深入且有个人见解，考官对你的观点印象深刻。' 
                            };
                          }},
                        { text: '写官方标准答案', 
                          personality: { traditional: 2, cautious: 1 },
                          consequence: (gs) => {
                            const baseScore = gs.examProgress.writtenTestScore || 60;
                            return { 
                                examProgress: { writtenTestScore: baseScore + 15 },
                                stats: { professional: 1 },
                                log: '你写了很标准的答案，中规中矩，但缺乏亮点。' 
                            };
                          }},
                        { text: '结合自身经历谈感受', 
                          personality: { innovative: 1, social: 1 },
                          consequence: (gs) => {
                            const baseScore = gs.examProgress.writtenTestScore || 60;
                            return { 
                                examProgress: { writtenTestScore: baseScore + 25 },
                                stats: { communication: 2, resilience: 1 },
                                log: '你的真实感受打动了考官，文章很有感染力。',
                                achievement: 'CONTROVERSIAL_CHOICE'
                            };
                          }}
                    ]
                },
                {
                    id: 'E104', stage: '考试阶段', trigger: (gs) => gs.time.days > 94, unique: true,
                    title: '笔试结果',
                    description: '笔试成绩出来了！你紧张地查询自己的分数...',
                    choices: [
                        { text: '查看成绩', consequence: (gs) => {
                            const finalScore = gs.examProgress.writtenTestScore || 70;
                            if (finalScore >= 120) {
                                return { 
                                    log: `恭喜！你的笔试成绩是${finalScore}分，成功进入面试环节！`,
                                    achievement: 'PASS_WRITTEN_TEST',
                                    nextStage: false,
                                    triggerEvent: 'E105'
                                };
                            } else {
                                return { 
                                    log: `很遗憾，你的笔试成绩是${finalScore}分，没有达到面试分数线。但这只是一次尝试，相信你下次一定能成功！`,
                                    gameOver: true 
                                };
                            }
                        }}
                    ]
                },
                {
                    id: 'E105', stage: '考试阶段', trigger: () => true, unique: true,
                    title: '面试通知的兴奋与紧张',
                    description: '收到面试通知的那一刻，你激动得差点叫出声来！但随即而来的是深深的紧张...距离面试还有一周，你需要做好准备。',
                    choices: [
                        { text: '疯狂刷面试题，背标准答案', 
                          personality: { studious: 2, cautious: 1 },
                          consequence: { stats: { professional: 2, communication: 1 }, examProgress: { mockInterviews: 1 }, log: '你找到了各种面试题库，熬夜背答案，感觉胸有成竹。' } },
                        { text: '找学长学姐模拟面试', 
                          personality: { social: 2, innovative: 1 },
                          consequence: { stats: { communication: 3, decision: 1 }, examProgress: { mockInterviews: 2 }, log: '学长学姐给了你很多实用的面试技巧，还指出了你的表达问题。' } },
                        { text: '对着镜子练习表情管理', 
                          personality: { cautious: 1 },
                          consequence: { stats: { communication: 2, resilience: 1 }, log: '你发现自己紧张时会皱眉，经过练习，表情更自然了。' } }
                    ]
                },
                {
                    id: 'E106', stage: '考试阶段', trigger: (gs) => gs.time.days > 112, unique: true,
                    title: '面试前的"最后一课"',
                    description: '面试前一天，你刷到了一个面试培训机构的"最后一课"直播，老师说要教"必过技巧"。但你已经准备得差不多了。',
                    choices: [
                        { text: '认真听课，查漏补缺', 
                          personality: { studious: 1, cautious: 1 },
                          consequence: { stats: { professional: 1, communication: 1 }, log: '你学到了一些细节技巧，比如如何优雅地整理思路。' } },
                        { text: '不听了，相信自己的准备', 
                          personality: { cautious: 2 },
                          consequence: { stats: { resilience: 2, decision: 1 }, log: '你没有被焦虑营销影响，保持了良好的心态。' } },
                        { text: '边听边吐槽，觉得都是套路', 
                          personality: { rebellious: 1, innovative: 1 },
                          consequence: { stats: { communication: 1, resilience: 1 }, log: '你对培训机构的套路有了更清醒的认识。' } }
                    ]
                },
                {
                    id: 'E107', stage: '考试阶段', trigger: (gs) => gs.time.days > 113, unique: true,
                    title: '面试当天：第一印象',
                    description: '面试当天，你早早到了考点。看到其他考生都穿着正装，有的在背材料，有的在练习手势。你需要调整好状态。',
                    choices: [
                        { text: '找个安静角落再复习一下', 
                          personality: { studious: 1 },
                          consequence: { stats: { professional: 1 }, log: '你又过了一遍重点内容，感觉更有把握了。' } },
                        { text: '和其他考生聊天缓解紧张', 
                          personality: { social: 2 },
                          consequence: { stats: { communication: 2, resilience: 1 }, log: '聊天让你放松了不少，还交到了新朋友。' } },
                        { text: '独自冥想，调整呼吸', 
                          personality: { cautious: 1 },
                          consequence: { stats: { resilience: 2 }, log: '深呼吸让你的心跳逐渐平稳下来。' } }
                    ]
                },
                {
                    id: 'E108', stage: '考试阶段', trigger: (gs) => gs.time.days > 113, unique: true,
                    title: '面试正式开始：综合分析题',
                    description: '你被叫到号了！坐在考官面前，第一题是："有人说95后是躺平的一代，也有人说95后是最有希望的一代，你怎么看？"',
                    choices: [
                        { text: '从自身经历出发，真诚表达', 
                          personality: { innovative: 2, social: 1 },
                          consequence: (gs) => {
                            const score = 60 + gs.examProgress.mockInterviews * 10 + gs.player.stats.communication + Math.floor(Math.random() * 15);
                            return {
                                examProgress: { interviewScore: score },
                                stats: { communication: 2, resilience: 1 },
                                log: `你真诚地分享了自己的观点和经历，考官频频点头。你感觉发挥得不错。`
                            };
                          }},
                        { text: '用标准答题框架回答', 
                          personality: { traditional: 2, cautious: 1 },
                          consequence: (gs) => {
                            const score = 55 + gs.examProgress.mockInterviews * 8 + gs.player.stats.professional + Math.floor(Math.random() * 10);
                            return {
                                examProgress: { interviewScore: score },
                                stats: { professional: 1 },
                                log: `你按照背过的框架回答，逻辑清晰但缺乏个人特色。`
                            };
                          }},
                        { text: '紧张得有些结巴', 
                          consequence: (gs) => {
                            const score = 45 + gs.examProgress.mockInterviews * 5 + gs.player.stats.resilience + Math.floor(Math.random() * 10);
                            return {
                                examProgress: { interviewScore: score },
                                stats: { resilience: -1 },
                                log: `紧张让你的表达不够流畅，但你努力表达完了自己的观点。`
                            };
                          }}
                    ]
                },
                {
                    id: 'E109', stage: '考试阶段', trigger: (gs) => gs.time.days > 114, unique: true,
                    title: '面试结果揭晓',
                    description: '面试结束了，你忐忑不安地等待着结果...',
                    choices: [
                        { text: '查看面试结果', consequence: (gs) => {
                            const finalScore = gs.examProgress.interviewScore || 60;
                            if (finalScore >= 80) {
                                return { 
                                    log: `恭喜！你的面试成绩是${finalScore}分，成功通过面试！`,
                                    achievement: 'ACE_INTERVIEW',
                                    nextStage: true,
                                    notification: '🎉 恭喜上岸！你即将开始公务员生涯！'
                                };
                            } else {
                                return { 
                                    log: `很遗憾，你的面试成绩是${finalScore}分，没有通过面试。但这次经历让你成长了很多，相信下次一定能成功！`,
                                    gameOver: true 
                                };
                            }
                        }}
                    ]
                },
                
                // ========== 入职适应 ==========
                {
                    id: 'E201', stage: '入职适应', trigger: () => true, unique: true,
                    title: '新人报到',
                    description: '你带着激动的心情来到单位报到，办公室主任把你介绍给了你的导师——一位经验丰富的老同志王科长。',
                    choices: [
                        { text: '谦虚谨慎，主动请教', consequence: { stats: { communication: 2 }, influence: 5, log: '你主动向王科长问好，并表示希望他多多指点。王科长对你的态度很满意。', achievement: 'NEWBIE_ONBOARD' } },
                        { text: '沉默寡言，等待安排', consequence: { stats: { communication: -1 }, log: '你有些拘谨，只是简单地打了招呼，等待着任务。', achievement: 'NEWBIE_ONBOARD' } }
                    ]
                },
                {
                    id: 'E202', stage: '入职适应', trigger: (gs) => gs.time.days > 125, unique: true,
                    title: '整理档案',
                    description: '王科长让你整理一批陈年档案，工作繁琐且枯燥。',
                    choices: [
                        { text: '耐心细致，保质保量完成', consequence: { stats: { professional: 2, resilience: 1 }, influence: 8, log: '你花了一下午，把档案整理得井井有条，王科长看到后很满意。' } },
                        { text: '觉得是大材小用，敷衍了事', consequence: { stats: { professional: -2 }, influence: -5, log: '你觉得这种工作没有技术含量，草草完成了事。王科长有些不满。' } },
                        { text: '利用机会学习档案里的案例', consequence: { stats: { professional: 2, learning: 2 }, influence: 10, log: '你在整理中发现了许多有价值的过往案例，收获颇丰。' } }
                    ]
                },
                {
                    id: 'E203', stage: '入职适应', trigger: (gs) => gs.time.days > 135,
                    title: '第一次会议',
                    description: '你参加了人生中第一次正式的工作会议，领导询问大家对某个政策的看法。',
                    choices: [
                        { text: '积极发言，分享自己的想法', consequence: { stats: { communication: 2, decision: 1 }, influence: 10, log: '你勇敢地表达了自己的观点，虽然有些紧张，但得到了认可。' } },
                        { text: '认真倾听，暂不发言', consequence: { stats: { learning: 2 }, log: '你选择先听取大家的意见，学到了很多东西。' } },
                        { text: '心不在焉，走神了', consequence: { stats: { professional: -1 }, influence: -3, log: '你有些紧张，注意力不集中，错过了一些重要信息。' } }
                    ]
                },
                {
                    id: 'E204', stage: '入职适应', trigger: (gs) => gs.time.days > 145,
                    title: '同事的邀请',
                    description: '几个年轻同事邀请你一起吃午饭，这是融入集体的好机会。',
                    choices: [
                        { text: '欣然接受，主动交流', consequence: { stats: { communication: 3 }, influence: 8, log: '你和同事们聊得很开心，大家对你的印象很好。' } },
                        { text: '礼貌参与，保持距离', consequence: { stats: { communication: 1 }, influence: 3, log: '你参与了聚餐，但保持着适当的距离。' } },
                        { text: '以工作忙为由婉拒', consequence: { stats: { professional: 1, communication: -1 }, log: '你选择继续工作，但可能错过了建立友谊的机会。' } }
                    ]
                },
                {
                    id: 'E205', stage: '入职适应', trigger: (gs) => gs.time.days > 155,
                    title: '第一次表扬',
                    description: '王科长在科室会议上表扬了你最近的工作表现，你感到很高兴。',
                    choices: [
                        { text: '谦虚地表示还需努力', consequence: { stats: { communication: 2, resilience: 1 }, influence: 5, log: '你的谦虚态度让大家更加喜欢你。', achievement: 'FIRST_PRAISE' } },
                        { text: '感谢领导和同事的帮助', consequence: { stats: { communication: 3 }, influence: 8, log: '你真诚地感谢了大家，体现了良好的团队精神。', achievement: 'FIRST_PRAISE' } },
                        { text: '内心得意，但表面平静', consequence: { stats: { resilience: 1 }, influence: 2, log: '你努力保持平静，但内心还是很开心。', achievement: 'FIRST_PRAISE' } }
                    ]
                },
                {
                    id: 'E206', stage: '入职适应', trigger: (gs) => gs.time.days > 130,
                    title: '办公室的代沟',
                    description: '你发现办公室里的前辈们还在用传统的工作方式，而你熟悉的数字化工具他们都不太会用。',
                    choices: [
                        { text: '主动教大家使用新工具', consequence: { stats: { communication: 3, learning: 1 }, influence: 12, log: '你耐心地教同事们使用新工具，大家都很感激。', achievement: 'TREND_SETTER' } },
                        { text: '适应传统方式，保持低调', consequence: { stats: { resilience: 2 }, influence: 3, log: '你选择入乡随俗，但有时感觉效率不高。' } },
                        { text: '私下用新方法，公开跟传统', consequence: { stats: { decision: 1, professional: 1 }, influence: 5, log: '你找到了平衡点，既提高了效率，又没有引起不必要的关注。' } }
                    ]
                },
                {
                    id: 'E207', stage: '入职适应', trigger: (gs) => gs.time.days > 140,
                    title: '网络热梗进办公室',
                    description: '你无意中在工作群里发了一个很火的表情包，没想到连平时严肃的老同志都觉得很有趣。',
                    choices: [
                        { text: '适度分享，活跃气氛', 
                          personality: { social: 2, innovative: 1 },
                          consequence: { stats: { communication: 3, resilience: 1 }, influence: 15, log: '你成了办公室的"开心果"，大家都喜欢你的幽默。', achievement: 'MEME_MASTER', triggerEvent: 'CE001' } },
                        { text: '立即道歉，保持严肃', 
                          personality: { cautious: 2, traditional: 1 },
                          consequence: { stats: { communication: -1, resilience: -1 }, influence: 0, log: '你觉得很尴尬，马上道歉，但同事们其实很喜欢这种轻松的氛围。' } },
                        { text: '观察反应，适度调整', 
                          personality: { cautious: 1 },
                          consequence: { stats: { decision: 2, communication: 1 }, influence: 8, log: '你很聪明地观察了大家的反应，找到了合适的尺度。' } }
                    ]
                },
                // 连锁事件：表情包事件的后续
                {
                    id: 'CE001', stage: '入职适应', trigger: () => false, // 不会自动触发，只能通过其他事件连锁
                    title: '意外的网络走红',
                    description: '你发的那个表情包被同事转发到了朋友圈，没想到传播开来，甚至上了微博热搜！#公务员表情包#成了热门话题。',
                    choices: [
                        { text: '积极回应，传播正能量', 
                          personality: { innovative: 2, social: 1 },
                          consequence: { stats: { communication: 4, decision: 2 }, influence: 50, log: '你的回应获得了网友好评，成为了正面典型！', achievement: 'SOCIAL_MEDIA_HERO' } },
                        { text: '低调处理，避免炒作', 
                          personality: { cautious: 2 },
                          consequence: { stats: { resilience: 2 }, influence: 20, log: '你选择低调处理，但这种谦逊的态度反而更受欢迎。' } },
                        { text: '请求删除，担心影响工作', 
                          consequence: { stats: { resilience: -2 }, influence: -10, log: '你的紧张反应反而引起了更多关注，适得其反。' } }
                    ]
                },
                {
                    id: 'E208', stage: '入职适应', trigger: (gs) => gs.time.days > 165,
                    title: '加班文化的冲突',
                    description: '你发现很多同事都有加班的习惯，但你觉得提高效率更重要。今天又是一个本来可以按时完成的工作日。',
                    choices: [
                        { text: '坚持高效工作，按时下班', consequence: { stats: { decision: 2, resilience: 2 }, influence: 5, log: '你坚持了自己的工作理念，但可能给人留下了不够努力的印象。' } },
                        { text: '适当加班，融入团队', consequence: { stats: { communication: 2, resilience: -1 }, influence: 8, log: '你选择了妥协，但内心觉得有些无奈。' } },
                        { text: '带头提高效率，改变氛围', consequence: { stats: { professional: 3, decision: 2 }, influence: 18, log: '你通过自己的行动影响了团队，大家开始重视工作效率。', achievement: 'BALANCE_MASTER' } }
                    ]
                },
                
                // ========== 能力提升 ==========
                {
                    id: 'E301', stage: '能力提升', trigger: () => true, unique: true,
                    title: '独立负责项目',
                    description: '经过几个月的适应，王科长决定让你独立负责一个小项目——组织一次社区调研活动。',
                    choices: [
                        { text: '制定详细计划，系统推进', consequence: { stats: { professional: 3, decision: 2 }, influence: 15, log: '你制定了详细的调研计划，项目进展顺利。' } },
                        { text: '边做边学，灵活应对', consequence: { stats: { learning: 2, resilience: 2 }, influence: 10, log: '你在实践中学习，虽然有些波折，但最终完成了任务。' } },
                        { text: '感到压力，寻求帮助', consequence: { stats: { communication: 2, professional: 1 }, influence: 8, log: '你主动寻求同事的帮助，大家都很支持你。' } }
                    ]
                },
                {
                    id: 'E302', stage: '能力提升', trigger: (gs) => gs.time.days > 185,
                    title: '处理投诉',
                    description: '一位市民对政府服务不满，情绪激动地来到你们科室投诉。作为值班人员，你需要处理这个情况。',
                    choices: [
                        { text: '耐心倾听，详细记录', consequence: { stats: { communication: 3, resilience: 1 }, influence: 12, log: '你耐心地听取了市民的意见，并详细记录了问题。市民的情绪逐渐平静下来。' } },
                        { text: '解释政策，化解误会', consequence: { stats: { professional: 2, communication: 2 }, influence: 15, log: '你详细解释了相关政策，化解了市民的误会，获得了理解。' } },
                        { text: '感到紧张，请示领导', consequence: { stats: { resilience: -1, learning: 1 }, influence: 5, log: '你感到有些紧张，及时请示了领导，在指导下处理了问题。' } }
                    ]
                },
                {
                    id: 'E303', stage: '能力提升', trigger: (gs) => gs.time.days > 200,
                    title: '突发事件',
                    description: '辖区内发生了一起突发事件，需要紧急协调各部门响应。你被临时指派协助处理。',
                    choices: [
                        { text: '冷静分析，快速行动', consequence: { stats: { decision: 3, resilience: 2 }, influence: 20, log: '你冷静地分析了情况，快速协调各方资源，事件得到了妥善处理。', achievement: 'CRISIS_HANDLER' } },
                        { text: '按部就班，稳妥处理', consequence: { stats: { professional: 2, resilience: 1 }, influence: 12, log: '你严格按照应急预案执行，虽然速度不快，但处理得很稳妥。' } },
                        { text: '感到慌乱，配合他人', consequence: { stats: { communication: 1, resilience: -1 }, influence: 5, log: '面对突发情况，你有些慌乱，但努力配合其他同事的工作。' } }
                    ]
                },
                {
                    id: 'E304', stage: '能力提升', trigger: (gs) => gs.time.days > 220,
                    title: '培训机会',
                    description: '单位提供了一个外出培训的机会，可以学习先进的管理理念和工作方法。',
                    choices: [
                        { text: '积极报名，珍惜机会', consequence: { stats: { learning: 3, professional: 2 }, influence: 10, log: '你积极报名参加培训，学到了很多新知识和方法。' } },
                        { text: '认为工作更重要，放弃机会', consequence: { stats: { professional: 1, learning: -1 }, influence: 5, log: '你认为当前工作更重要，放弃了培训机会。' } },
                        { text: '犹豫不决，错过报名', consequence: { stats: { decision: -1 }, log: '你犹豫了太久，错过了报名时间。' } }
                    ]
                },
                {
                    id: 'E305', stage: '能力提升', trigger: (gs) => gs.time.days > 190,
                    title: '网络直播风波',
                    description: '你在处理一个公务时，被路人拍下视频上传到网络，意外成为热点。视频中你的专业表现获得了很多点赞。',
                    choices: [
                        { text: '低调处理，避免炒作', consequence: { stats: { decision: 2, resilience: 1 }, influence: 8, log: '你选择低调处理，但网友们更加欣赏你的谦逊。' } },
                        { text: '积极回应，传播正能量', consequence: { stats: { communication: 3, decision: 2 }, influence: 25, log: '你积极回应网友关注，传播了正面形象。', achievement: 'SOCIAL_MEDIA_HERO' } },
                        { text: '请求删除视频，避免关注', consequence: { stats: { resilience: -1 }, influence: 0, log: '你担心网络关注会影响工作，但这种做法反而引起了一些争议。' } }
                    ]
                },
                {
                    id: 'E306', stage: '能力提升', trigger: (gs) => gs.time.days > 210,
                    title: '95后的工作理念',
                    description: '在一次部门会议上，你提出了一些95后的工作理念，比如"工作是为了更好的生活"，引起了不小的讨论。',
                    choices: [
                        { text: '坚持观点，引发思考', consequence: { stats: { decision: 3, communication: 2 }, influence: 20, log: '你的观点引发了大家的思考，让工作氛围更加开放。', achievement: 'CONTROVERSIAL_CHOICE' } },
                        { text: '适当妥协，求同存异', consequence: { stats: { communication: 2, resilience: 1 }, influence: 10, log: '你选择了更温和的表达方式，但也坚持了自己的核心观点。' } },
                        { text: '立即道歉，收回言论', consequence: { stats: { communication: -2, resilience: -1 }, influence: -5, log: '你匆忙道歉，但内心感到很委屈，觉得没有被理解。' } }
                    ]
                },
                {
                    id: 'E307', stage: '能力提升', trigger: (gs) => gs.time.days > 235,
                    title: '短视频普法尝试',
                    description: '你提议制作短视频来普及政策知识，让更多年轻人了解政府工作。但一些同事认为这种方式不够严肃。',
                    choices: [
                        { text: '坚持创新，制作视频', consequence: { stats: { professional: 3, communication: 2, learning: 1 }, influence: 30, log: '你的短视频获得了很好的反响，成为政务创新的典型案例。', achievement: 'INNOVATOR' } },
                        { text: '寻求支持，争取认可', consequence: { stats: { communication: 2, decision: 1 }, influence: 15, log: '你通过努力争取到了领导的支持，项目得以推进。' } },
                        { text: '放弃想法，保持传统', consequence: { stats: { resilience: -1, professional: -1 }, influence: 0, log: '你放弃了创新想法，但心中总觉得错过了什么。' } }
                    ]
                },
                
                // ========== 职业发展 ==========
                {
                    id: 'E401', stage: '职业发展', trigger: () => true, unique: true,
                    title: '晋升机会',
                    description: '经过一年多的努力工作，你获得了晋升的机会。但竞争很激烈，需要通过考核和面试。',
                    choices: [
                        { text: '全力准备，争取晋升', consequence: { stats: { professional: 2, decision: 2 }, influence: 15, log: '你全力准备考核，展现了出色的能力和潜力。' } },
                        { text: '顺其自然，不强求', consequence: { stats: { resilience: 2 }, influence: 5, log: '你保持平常心，认为机会合适就争取，不合适也不强求。' } },
                        { text: '感到压力，担心失败', consequence: { stats: { resilience: -2, professional: 1 }, log: '面对晋升机会，你感到很大压力，担心自己不够优秀。' } }
                    ]
                },
                {
                    id: 'E402', stage: '职业发展', trigger: (gs) => gs.time.days > 280,
                    title: '跨部门合作',
                    description: '你需要与其他部门合作完成一个重要项目，这考验着你的协调能力。',
                    choices: [
                        { text: '主动沟通，建立联系', consequence: { stats: { communication: 3, decision: 1 }, influence: 18, log: '你主动与各部门建立联系，项目推进得很顺利。' } },
                        { text: '专注本职，配合他人', consequence: { stats: { professional: 2 }, influence: 10, log: '你专注于自己的部分，积极配合其他部门的工作。' } },
                        { text: '等待指示，被动参与', consequence: { stats: { decision: -1 }, influence: 3, log: '你习惯等待上级指示，在合作中显得比较被动。' } }
                    ]
                },
                {
                    id: 'E403', stage: '职业发展', trigger: (gs) => gs.time.days > 300,
                    title: '政策创新',
                    description: '你发现了工作中的一个问题，并想出了改进的方案。你考虑是否要提出这个建议。',
                    choices: [
                        { text: '勇敢提出创新建议', consequence: { stats: { decision: 3, professional: 2 }, influence: 25, log: '你的创新建议得到了领导的重视，并被采纳实施。' } },
                        { text: '先完善方案再提出', consequence: { stats: { professional: 2, learning: 1 }, influence: 15, log: '你花时间完善了方案，提出后获得了好评。' } },
                        { text: '担心风险，保持现状', consequence: { stats: { resilience: -1 }, influence: 0, log: '你担心创新的风险，选择维持现状。' } }
                    ]
                },
                {
                    id: 'E404', stage: '职业发展', trigger: (gs) => gs.time.days > 320,
                    title: '媒体关注',
                    description: '你参与的一个项目受到了媒体关注，记者想要采访你。这是展示形象的好机会，但也有风险。',
                    choices: [
                        { text: '接受采访，展示成果', consequence: { stats: { communication: 3, decision: 1 }, influence: 30, log: '你接受了采访，很好地展示了工作成果和政府形象。' } },
                        { text: '低调处理，避免风头', consequence: { stats: { resilience: 1 }, influence: 10, log: '你选择低调处理，避免成为焦点。' } },
                        { text: '请示领导，等待指示', consequence: { stats: { professional: 1 }, influence: 15, log: '你及时请示了领导，在指导下妥善处理了媒体关注。' } }
                    ]
                },
                {
                    id: 'E405', stage: '职业发展', trigger: (gs) => gs.time.days > 350,
                    title: '人生选择',
                    description: '经过几年的工作，你对公务员这个职业有了更深的理解。现在你需要思考未来的发展方向。',
                    choices: [
                        { text: '继续深耕，成为专家', consequence: { stats: { professional: 3, learning: 2 }, influence: 20, log: '你决定在这个领域继续深耕，成为业务专家。' } },
                        { text: '拓展视野，全面发展', consequence: { stats: { communication: 2, decision: 2, learning: 1 }, influence: 25, log: '你选择拓展视野，在各个方面全面发展。' } },
                        { text: '保持现状，稳定工作', consequence: { stats: { resilience: 2 }, influence: 10, log: '你选择保持现状，享受稳定的工作生活。' } }
                    ]
                },
                {
                    id: 'E406', stage: '职业发展', trigger: (gs) => gs.time.days > 290,
                    title: '网红公务员的困扰',
                    description: '由于之前的几次网络事件，你在网上有了一定知名度，被网友称为"网红公务员"。有媒体想要深度采访你。',
                    choices: [
                        { text: '接受采访，分享经验', consequence: { stats: { communication: 3, decision: 2 }, influence: 40, log: '你的采访引起了很大反响，成为年轻公务员的代表。', achievement: 'MEDIA_STAR' } },
                        { text: '谢绝采访，专注工作', consequence: { stats: { professional: 2, resilience: 1 }, influence: 15, log: '你选择低调工作，但网友们更加敬佩你的专业态度。' } },
                        { text: '有选择地接受，控制曝光', consequence: { stats: { decision: 3, communication: 1 }, influence: 25, log: '你很聪明地控制了曝光度，既传播了正能量又保护了自己。' } }
                    ]
                },
                {
                    id: 'E407', stage: '职业发展', trigger: (gs) => gs.time.days > 310,
                    title: '代际冲突的调解',
                    description: '你被安排调解一个关于"年轻人躺平"的社会热点争议，需要在不同世代之间搭建对话桥梁。',
                    choices: [
                        { text: '站在年轻人角度，为他们发声', consequence: { stats: { communication: 3, decision: 2 }, influence: 30, log: '你的发声获得了年轻人的强烈认同，成为他们的代言人。', achievement: 'YOUNG_ICON' } },
                        { text: '保持中立，促进理解', consequence: { stats: { communication: 2, resilience: 2, decision: 1 }, influence: 20, log: '你成功地促进了不同世代之间的理解与沟通。' } },
                        { text: '传统表态，维护秩序', consequence: { stats: { professional: 2, resilience: -1 }, influence: 5, log: '你选择了传统的表态方式，但年轻人对此并不买账。' } }
                    ]
                },
                {
                    id: 'E408', stage: '职业发展', trigger: (gs) => gs.time.days > 330,
                    title: '直播带货政策解读',
                    description: '为了让更多人了解政府政策，你的单位计划尝试"直播带货"式的政策解读。你被推荐作为主播。',
                    choices: [
                        { text: '勇敢尝试，创新传播', consequence: { stats: { communication: 4, professional: 2, learning: 1 }, influence: 50, log: '你的直播大获成功，开创了政务传播新模式。', achievement: 'INNOVATOR' } },
                        { text: '谨慎参与，稳中求进', consequence: { stats: { communication: 2, decision: 1 }, influence: 20, log: '你谨慎地参与了项目，效果不错但没有太大突破。' } },
                        { text: '拒绝参与，认为不合适', consequence: { stats: { resilience: -1, professional: -1 }, influence: 0, log: '你拒绝了这个机会，但后来发现这确实是个好的尝试。' } }
                    ]
                },
                {
                    id: 'E409', stage: '职业发展', trigger: (gs) => gs.time.days > 360,
                    title: '第一批95后科长',
                    description: '你有机会成为单位里第一批95后科长，这意味着更多责任，也意味着成为年轻人的榜样。',
                    choices: [
                        { text: '勇敢接受，承担责任', consequence: { stats: { decision: 4, professional: 3, communication: 2 }, influence: 60, log: '你成为了95后科长，开始用自己的方式影响更多人。', achievement: 'LEADER' } },
                        { text: '谦让机会，继续积累', consequence: { stats: { resilience: 2, learning: 1 }, influence: 10, log: '你选择继续积累经验，但可能错过了一个重要机会。' } },
                        { text: '感到压力，犹豫不决', consequence: { stats: { resilience: -2, decision: -1 }, influence: 0, log: '面对这个机会，你感到了很大压力，陷入了纠结。' } }
                    ]
                }
            ]
        };

        // ----------------------------------------------------
        // 3. 游戏核心逻辑函数
        // ----------------------------------------------------

        // 初始化新游戏
        function initNewGame() {
            const playerName = inputs.playerName.value.trim() || '李华';
            gameState = {
                player: {
                    name: playerName,
                    stage: '备考阶段', // 备考阶段 -> 考试阶段 -> 入职适应 -> 能力提升 -> 职业发展
                    stats: {
                        professional: 5,
                        communication: 5,
                        decision: 5,
                        resilience: 5,
                        learning: 5,
                    },
                    influence: 0,
                },
                time: {
                    year: 2024,
                    month: 1,
                    day: 15, // 寒假开始，决定考公
                    days: 1, // 总天数
                    realDate: new Date(2024, 0, 15), // 真实日期对应
                },
                currentGoals: [], // 当前阶段目标
                examSchedule: { // 真实考试时间表
                    nationalExam: {
                        registration: { month: 10, day: 15, year: 2024 }, // 国考报名
                        writtenTest: { month: 11, day: 26, year: 2024 }, // 国考笔试
                        interview: { month: 2, day: 25, year: 2025 }, // 国考面试
                    },
                    provincialExam: {
                        registration: { month: 3, day: 1, year: 2024 }, // 省考报名
                        writtenTest: { month: 3, day: 30, year: 2024 }, // 省考笔试
                        interview: { month: 5, day: 18, year: 2024 }, // 省考面试
                    },
                    institutionExam: {
                        registration: { month: 5, day: 8, year: 2024 }, // 事业单位报名
                        writtenTest: { month: 6, day: 15, year: 2024 }, // 事业单位笔试
                        interview: { month: 7, day: 20, year: 2024 }, // 事业单位面试
                    }
                },
                selectedPath: null, // 选择的考试路径
                jobLocation: null, // 工作地点偏好
                activeBuffs: [], // 当前生效的BUFF
                log: [],
                achievements: { ...gameData.achievements }, // 深拷贝
                eventHistory: [], // 记录发生过的unique事件ID
                choiceHistory: [], // 记录所有选择，用于触发关联剧情
                personality: { // 性格特征，根据选择累积
                    innovative: 0,    // 创新倾向
                    traditional: 0,   // 传统倾向  
                    social: 0,        // 社交倾向
                    studious: 0,      // 学习倾向
                    rebellious: 0,    // 叛逆倾向
                    cautious: 0       // 谨慎倾向
                },
                examProgress: { // 考试进度和成绩
                    writtenTestScore: 0,
                    interviewScore: 0,
                    practiceTests: 0,
                    mockInterviews: 0
                }
            };
            
            // 设置初始目标
            setStageGoals('备考阶段');
            
            // 初始日志
            addLogMessage(`欢迎你，${playerName}！你的公仆生涯从今天开始。`);
            addLogMessage(`今天是2024年1月15日，寒假刚开始，你决定准备公职考试。`);
            addLogMessage(`📋 当前阶段目标已更新，请查看左侧面板！`);
            unlockAchievement('FIRST_STEP');
            saveGame();
            startGame();
        }

        // 阶段目标管理系统
        function setStageGoals(stage) {
            gameState.currentGoals = [];
            
            switch(stage) {
                case '备考阶段':
                    gameState.currentGoals = [
                        { id: 'choose_path', text: '选择考试路径（国考/省考/事业单位）', completed: false, deadline: '2024年2月底', urgent: false },
                        { id: 'study_plan', text: '制定学习计划', completed: false, deadline: '2024年1月底', urgent: true },
                        { id: 'practice_test', text: '完成至少3次模拟考试', completed: false, current: 0, target: 3 },
                        { id: 'basic_knowledge', text: '专业能力达到15分', completed: false, current: gameState.player.stats.professional, target: 15 }
                    ];
                    break;
                case '考试阶段':
                    gameState.currentGoals = [
                        { id: 'written_test', text: '通过笔试（需要120分以上）', completed: false, deadline: getExamDeadline('written') },
                        { id: 'interview_prep', text: '完成面试准备', completed: false, deadline: getExamDeadline('interview') },
                        { id: 'final_interview', text: '通过面试（需要80分以上）', completed: false, deadline: getExamDeadline('interview') }
                    ];
                    break;
                case '入职适应':
                    gameState.currentGoals = [
                        { id: 'onboard', text: '完成入职手续', completed: false, deadline: '入职后1周' },
                        { id: 'mentor_relation', text: '建立良好的导师关系', completed: false },
                        { id: 'colleague_network', text: '融入团队，影响力达到50', completed: false, current: gameState.player.influence, target: 50 }
                    ];
                    break;
                case '能力提升':
                    gameState.currentGoals = [
                        { id: 'innovation_project', text: '参与或主导创新项目', completed: false },
                        { id: 'skill_development', text: '所有能力达到60分以上', completed: false },
                        { id: 'public_recognition', text: '获得外部认可', completed: false }
                    ];
                    break;
                case '职业发展':
                    gameState.currentGoals = [
                        { id: 'leadership_role', text: '获得领导职位机会', completed: false },
                        { id: 'influence_target', text: '影响力达到100', completed: false, current: gameState.player.influence, target: 100 },
                        { id: 'mentor_others', text: '成为他人的榜样', completed: false }
                    ];
                    break;
            }
            updateGoalsDisplay();
        }
        
        function getExamDeadline(type) {
            if (!gameState.selectedPath) return '待选择考试路径';
            const schedule = gameState.examSchedule[gameState.selectedPath];
            if (type === 'written') {
                return `${schedule.writtenTest.year}年${schedule.writtenTest.month}月${schedule.writtenTest.day}日`;
            } else if (type === 'interview') {
                return `${schedule.interview.year}年${schedule.interview.month}月${schedule.interview.day}日`;
            }
            return '未确定';
        }
        
        function updateGoal(goalId, completed = true, progress = null) {
            const goal = gameState.currentGoals.find(g => g.id === goalId);
            if (goal) {
                if (completed) {
                    goal.completed = true;
                    showNotification(`🎯 目标完成：${goal.text}`);
                }
                if (progress !== null && goal.current !== undefined) {
                    goal.current = progress;
                }
                updateGoalsDisplay();
                saveGame();
            }
        }
        
        function checkGoalCompletion() {
            // 检查各种目标的完成情况
            gameState.currentGoals.forEach(goal => {
                if (goal.completed) return;
                
                switch(goal.id) {
                    case 'basic_knowledge':
                        if (gameState.player.stats.professional >= goal.target) {
                            updateGoal(goal.id, true);
                        } else {
                            goal.current = gameState.player.stats.professional;
                        }
                        break;
                    case 'practice_test':
                        if (gameState.examProgress.practiceTests >= goal.target) {
                            updateGoal(goal.id, true);
                        } else {
                            goal.current = gameState.examProgress.practiceTests;
                        }
                        break;
                    case 'colleague_network':
                    case 'influence_target':
                        if (gameState.player.influence >= goal.target) {
                            updateGoal(goal.id, true);
                        } else {
                            goal.current = gameState.player.influence;
                        }
                        break;
                    case 'skill_development':
                        const allAbove60 = Object.values(gameState.player.stats).every(stat => stat >= 60);
                        if (allAbove60) {
                            updateGoal(goal.id, true);
                        }
                        break;
                }
            });
            updateGoalsDisplay();
        }
        
        function updateGoalsDisplay() {
            const goalsList = document.getElementById('goals-list');
            if (!goalsList || !gameState.currentGoals) return;
            
            goalsList.innerHTML = '';
            
            gameState.currentGoals.forEach(goal => {
                const goalElement = document.createElement('div');
                goalElement.style.marginBottom = '0.5rem';
                goalElement.style.padding = '0.3rem';
                goalElement.style.borderRadius = '4px';
                goalElement.style.backgroundColor = goal.completed ? '#e8f5e8' : (goal.urgent ? '#fff3cd' : '#f8f9fa');
                goalElement.style.border = `1px solid ${goal.completed ? '#28a745' : (goal.urgent ? '#ffc107' : '#dee2e6')}`;
                
                let progressText = '';
                if (goal.current !== undefined && goal.target !== undefined) {
                    progressText = ` (${goal.current}/${goal.target})`;
                }
                
                let deadlineText = '';
                if (goal.deadline) {
                    deadlineText = `<br><small style="color: #6c757d;">⏰ ${goal.deadline}</small>`;
                }
                
                goalElement.innerHTML = `
                    <div style="display: flex; align-items: center;">
                        <span style="margin-right: 0.5rem;">${goal.completed ? '✅' : '⏳'}</span>
                        <span style="flex: 1; ${goal.completed ? 'text-decoration: line-through; color: #6c757d;' : ''}">${goal.text}${progressText}</span>
                    </div>
                    ${deadlineText}
                `;
                
                goalsList.appendChild(goalElement);
            });
        }

        // 自动推进系统
        let autoProgressInterval = null;
        let isPaused = false;
        
        function startAutoProgress() {
            if (autoProgressInterval) return;
            
            autoProgressInterval = setInterval(() => {
                if (!isPaused && !gameState.isGameOver) {
                    nextDay();
                }
            }, 2000); // 每2秒推进一天
        }
        
        function stopAutoProgress() {
            if (autoProgressInterval) {
                clearInterval(autoProgressInterval);
                autoProgressInterval = null;
            }
        }
        
        function togglePause() {
            isPaused = !isPaused;
            if (isPaused) {
                calendar.progressStatus.textContent = '⏸️ 已暂停';
                buttons.pause.textContent = '▶️ 继续';
            } else {
                calendar.progressStatus.textContent = '⏰ 自动推进中...';
                buttons.pause.textContent = '⏸️ 暂停';
            }
        }
        
        // 开始游戏 (从加载或新游戏)
        function startGame() {
            screens.start.classList.remove('active');
            screens.main.classList.add('active');
            updateUI();
            
            // 启动自动推进
            startAutoProgress();
            
            // 触发第一个事件
            setTimeout(() => triggerEvent(), 500);
        }
        
        // 推进游戏时间
        function nextDay() {
            // 检查游戏是否已结束
            if (gameState.isGameOver) {
                stopAutoProgress();
                return;
            }
            
            // 推进真实日期
            gameState.time.realDate.setDate(gameState.time.realDate.getDate() + 1);
            gameState.time.year = gameState.time.realDate.getFullYear();
            gameState.time.month = gameState.time.realDate.getMonth() + 1;
            gameState.time.day = gameState.time.realDate.getDate();
            gameState.time.days++;
            
            // 检查重要时间节点
            checkImportantDates();
            
            // 处理BUFF/DEBUFF效果
            processActiveEffects();
            
            // 检查阶段性事件
            checkStageProgression();
            
            // 随机触发一个普通事件
            let eventChance = 0.5; // 基础50%概率
            // 根据阶段调整事件概率
            if (gameState.player.stage === '考试阶段') eventChance = 0.7;
            if (gameState.player.stage === '能力提升' || gameState.player.stage === '职业发展') eventChance = 0.6;
            
            if (Math.random() < eventChance) {
                // 暂停自动推进以处理事件
                const wasRunning = !isPaused;
                if (wasRunning) {
                    isPaused = true;
                    calendar.progressStatus.textContent = '📋 处理事件中...';
                }
                setTimeout(() => {
                    triggerEvent();
                    // 事件处理完后恢复自动推进
                    setTimeout(() => {
                        if (wasRunning && !gameState.isGameOver) {
                            isPaused = false;
                            calendar.progressStatus.textContent = '⏰ 自动推进中...';
                        }
                    }, 1000);
                }, 500);
            }
            
            updateUI();
            saveGame();
        }

        // 检查重要时间节点
        function checkImportantDates() {
            if (!gameState.selectedPath) return;
            
            const currentDate = gameState.time.realDate;
            const schedule = gameState.examSchedule[gameState.selectedPath];
            
            // 检查报名时间
            if (isDateMatch(currentDate, schedule.registration)) {
                addLogMessage(`🔔 今天是${getPathName(gameState.selectedPath)}报名日！`, 'success');
                updateGoal('registration', true);
                setTimeout(() => {
                    showNotification('📝 报名窗口已开启！记得及时报名哦～');
                }, 1000);
            }
            
            // 检查笔试时间
            if (isDateMatch(currentDate, schedule.writtenTest)) {
                addLogMessage(`📝 今天是${getPathName(gameState.selectedPath)}笔试日！加油！`, 'success');
                gameState.player.stage = '考试阶段';
                setStageGoals('考试阶段');
                setTimeout(() => triggerEvent('E101'), 2000);
            }
            
            // 检查面试时间
            if (isDateMatch(currentDate, schedule.interview)) {
                addLogMessage(`🎤 今天是${getPathName(gameState.selectedPath)}面试日！`, 'success');
                setTimeout(() => triggerEvent('E105'), 2000);
            }
        }
        
        function isDateMatch(currentDate, targetDate) {
            return currentDate.getFullYear() === targetDate.year &&
                   currentDate.getMonth() + 1 === targetDate.month &&
                   currentDate.getDate() === targetDate.day;
        }
        
        function getPathName(path) {
            const names = {
                'nationalExam': '国家公务员考试',
                'provincialExam': '省级公务员考试',
                'institutionExam': '事业单位考试',
                'grassrootsProgram': '三支一扶项目'
            };
            return names[path] || '考试';
        }

        // 处理激活的BUFF/DEBUFF效果
        function processActiveEffects() {
            // 初始化每日效果记录
            if (!gameState.dailyEffectsApplied) {
                gameState.dailyEffectsApplied = {};
            }
            
            const today = gameState.time.days;
            if (gameState.dailyEffectsApplied[today]) {
                return; // 今天已经处理过效果了
            }
            
            // 处理BUFF效果
            if (gameState.activeBuffs) {
                gameState.activeBuffs = gameState.activeBuffs.filter(buff => {
                    const daysActive = gameState.time.days - buff.startDay;
                    if (daysActive >= buff.duration) {
                        addLogMessage(`✨ ${buff.name} 效果已结束`, 'normal');
                        return false; // 移除过期的BUFF
                    }
                    
                    // 应用BUFF效果 (每天最多一次)
                    switch(buff.effect) {
                        case 'learning_boost':
                            // 学习效率提升，每天有概率获得额外学习点数
                            if (Math.random() < 0.3) {
                                gameState.player.stats.learning += 1;
                                if (gameState.player.stats.learning > 100) gameState.player.stats.learning = 100;
                                addLogMessage(`✨ ${buff.name} 提升了学习能力`, 'success');
                            }
                            break;
                        case 'exam_preview':
                            // 考试预判，在实际考试中有加成
                            break;
                        case 'mentor_guidance':
                            // 学霸指导，全方位能力提升
                            if (Math.random() < 0.25) {
                                const statNames = ['learning', 'professional', 'communication'];
                                const stat = statNames[Math.floor(Math.random() * 3)];
                                gameState.player.stats[stat] += 1;
                                if (gameState.player.stats[stat] > 100) gameState.player.stats[stat] = 100;
                                addLogMessage(`✨ ${buff.name} 提升了${stat === 'learning' ? '学习' : stat === 'professional' ? '专业' : '沟通'}能力`, 'success');
                            }
                            break;
                        case 'exam_boost':
                            // 超常发挥，考试期间能力加成
                            break;
                        case 'financial_stability':
                            // 经济稳定，减少焦虑，提升抗压能力
                            if (Math.random() < 0.3) {
                                gameState.player.stats.resilience += 1;
                                if (gameState.player.stats.resilience > 100) gameState.player.stats.resilience = 100;
                            }
                            break;
                        case 'career_growth':
                            // 发展潜力，提升学习和决策能力
                            if (Math.random() < 0.25) {
                                const stat = ['learning', 'decision'][Math.floor(Math.random() * 2)];
                                gameState.player.stats[stat] += 1;
                                if (gameState.player.stats[stat] > 100) gameState.player.stats[stat] = 100;
                            }
                            break;
                        case 'exam_skills':
                            // 华图秘技，考试技巧大幅提升
                            if (Math.random() < 0.4) {
                                gameState.player.stats.professional += 1;
                                gameState.player.stats.learning += 1;
                                if (gameState.player.stats.professional > 100) gameState.player.stats.professional = 100;
                                if (gameState.player.stats.learning > 100) gameState.player.stats.learning = 100;
                                addLogMessage(`✨ 华图秘技发挥效果，考试技巧持续提升！`, 'success');
                            }
                            break;
                        case 'huatu_prediction':
                            // 华图押题加持，大幅提升考试成功率
                            if (Math.random() < 0.5) {
                                gameState.player.stats.professional += 2;
                                gameState.player.stats.decision += 1;
                                if (gameState.player.stats.professional > 100) gameState.player.stats.professional = 100;
                                if (gameState.player.stats.decision > 100) gameState.player.stats.decision = 100;
                                addLogMessage(`🎯 华图押题命中！专业能力和判断力双提升！`, 'success');
                            }
                            break;
                        case 'rational_study':
                            // 理性备考，稳步提升各项能力
                            if (Math.random() < 0.3) {
                                const stats = ['professional', 'learning', 'decision'];
                                const randomStat = stats[Math.floor(Math.random() * stats.length)];
                                gameState.player.stats[randomStat] += 1;
                                if (gameState.player.stats[randomStat] > 100) gameState.player.stats[randomStat] = 100;
                            }
                            break;
                        default:
                            break;
                    }
                    return true; // 保留有效的BUFF
                });
            }
            
            // 处理DEBUFF效果
            if (gameState.activeDebuffs) {
                gameState.activeDebuffs = gameState.activeDebuffs.filter(debuff => {
                    const daysActive = gameState.time.days - debuff.startDay;
                    if (daysActive >= debuff.duration) {
                        addLogMessage(`💔 ${debuff.name} 负面效果已结束`, 'success');
                        return false; // 移除过期的DEBUFF
                    }
                    
                    // 应用DEBUFF效果
                    switch(debuff.effect) {
                        case 'phone_addiction':
                            // 手机成瘾，降低学习效率
                            if (Math.random() < 0.3) {
                                gameState.player.stats.learning -= 1;
                                if (gameState.player.stats.learning < 0) gameState.player.stats.learning = 0;
                            }
                            break;
                        case 'insomnia':
                            // 失眠，降低抗压能力和学习效率
                            if (Math.random() < 0.4) {
                                gameState.player.stats.resilience -= 1;
                                if (gameState.player.stats.resilience < 0) gameState.player.stats.resilience = 0;
                            }
                            if (Math.random() < 0.2) {
                                gameState.player.stats.learning -= 1;
                                if (gameState.player.stats.learning < 0) gameState.player.stats.learning = 0;
                            }
                            break;
                        case 'exam_anxiety':
                            // 考试焦虑，影响决策能力和抗压能力
                            if (Math.random() < 0.3) {
                                gameState.player.stats.decision -= 1;
                                gameState.player.stats.resilience -= 1;
                                if (gameState.player.stats.decision < 0) gameState.player.stats.decision = 0;
                                if (gameState.player.stats.resilience < 0) gameState.player.stats.resilience = 0;
                            }
                            break;
                        case 'opportunity_cost':
                            // 机会成本，错失机会带来的焦虑
                            if (Math.random() < 0.2) {
                                gameState.player.stats.decision -= 1;
                                if (gameState.player.stats.decision < 0) gameState.player.stats.decision = 0;
                            }
                            break;
                        case 'homesickness':
                            // 思乡之苦，影响心情和抗压能力
                            if (Math.random() < 0.25) {
                                gameState.player.stats.resilience -= 1;
                                gameState.player.stats.communication -= 1;
                                if (gameState.player.stats.resilience < 0) gameState.player.stats.resilience = 0;
                                if (gameState.player.stats.communication < 0) gameState.player.stats.communication = 0;
                            }
                            break;
                        default:
                            break;
                    }
                    return true; // 保留有效的DEBUFF
                });
            }
            
            // 标记今天已处理过效果
            gameState.dailyEffectsApplied[today] = true;
        }

        // 检查并推进游戏阶段
        function checkStageProgression() {
            // 备考90天后自动进入考试阶段
            if (gameState.player.stage === '备考阶段' && gameState.time.days >= 90) {
                addLogMessage('经过3个月的紧张复习，你即将迎来笔试。');
                gameState.player.stage = '考试阶段';
                setTimeout(() => triggerEvent('E101'), 1000); // 触发笔试前夜事件
            }
            // 考试阶段的特殊处理 - 自动推进笔试和面试流程
            else if (gameState.player.stage === '考试阶段') {
                if (gameState.time.days === 92 && !gameState.eventHistory.includes('E102')) {
                    setTimeout(() => triggerEvent('E102'), 1200);
                } else if (gameState.time.days === 93 && !gameState.eventHistory.includes('E103')) {
                    setTimeout(() => triggerEvent('E103'), 1200);
                } else if (gameState.time.days === 94 && !gameState.eventHistory.includes('E104')) {
                    setTimeout(() => triggerEvent('E104'), 1200);
                }
            }
            // 入职适应阶段180天后自动进入能力提升阶段
            else if (gameState.player.stage === '入职适应' && gameState.time.days >= 180) {
                advanceStage();
                setTimeout(() => triggerEvent('E301'), 1000);
            }
            // 能力提升阶段270天后自动进入职业发展阶段
            else if (gameState.player.stage === '能力提升' && gameState.time.days >= 270) {
                advanceStage();
                setTimeout(() => triggerEvent('E401'), 1000);
            }
        }
        
        function advanceStage() {
            const stageOrder = ['备考阶段', '考试阶段', '入职适应', '能力提升', '职业发展'];
            const currentIndex = stageOrder.indexOf(gameState.player.stage);
            if (currentIndex < stageOrder.length - 1) {
                const nextStage = stageOrder[currentIndex + 1];
                gameState.player.stage = nextStage;
                
                // 根据新阶段触发特定事件或给予奖励
                if(nextStage === '考试阶段') {
                    addLogMessage('笔试通过！你已进入面试环节。', 'success');
                    // 自动推进时间到面试准备阶段
                    gameState.time.days = 105;
                } else if (nextStage === '入职适应') {
                    addLogMessage('恭喜！你已成功上岸，正式成为一名公职人员！', 'success');
                    // 自动推进时间到入职阶段
                    gameState.time.days = 120;
                } else if (nextStage === '能力提升') {
                    addLogMessage('经过适应期，你开始承担更多责任，进入能力提升阶段。', 'success');
                    gameState.time.days = 180;
                } else if (nextStage === '职业发展') {
                    addLogMessage('你已经成为一名成熟的公职人员，开始考虑职业发展。', 'success');
                    gameState.time.days = 270;
                }
                
                // 阶段奖励
                gameState.player.influence += 10;
                addLogMessage(`进入新阶段：${nextStage}，影响力+10`, 'success');
            }
        }
        
        // 触发事件
        function triggerEvent(eventId = null) {
            let event;
            if (eventId) {
                event = gameData.events.find(e => e.id === eventId);
            } else {
                // 检查是否有基于性格的特殊事件
                const personalityEvents = checkPersonalityEvents();
                if (personalityEvents.length > 0) {
                    event = personalityEvents[Math.floor(Math.random() * personalityEvents.length)];
                } else {
                    // 过滤可触发的事件
                    const possibleEvents = gameData.events.filter(e => 
                        e.stage === gameState.player.stage &&
                        (!e.unique || !gameState.eventHistory.includes(e.id)) &&
                        (!e.trigger || e.trigger(gameState))
                    );
                    
                    if (possibleEvents.length > 0) {
                        // 优先级排序：重要事件 > BUFF/DEBUFF > 普通事件 > 随机事件
                        const importantEvents = possibleEvents.filter(e => e.important);
                        const buffEvents = possibleEvents.filter(e => e.special === 'buff');
                        const debuffEvents = possibleEvents.filter(e => e.special === 'debuff');
                        const normalEvents = possibleEvents.filter(e => !e.special && !e.important);
                        const randomEvents = possibleEvents.filter(e => e.special === 'random');
                        
                        // 按优先级选择事件类型
                        if (importantEvents.length > 0) {
                            event = importantEvents[Math.floor(Math.random() * importantEvents.length)];
                        } else if (buffEvents.length > 0 && Math.random() < 0.3) {
                            event = buffEvents[Math.floor(Math.random() * buffEvents.length)];
                        } else if (debuffEvents.length > 0 && Math.random() < 0.2) {
                            event = debuffEvents[Math.floor(Math.random() * debuffEvents.length)];
                        } else if (normalEvents.length > 0) {
                            event = normalEvents[Math.floor(Math.random() * normalEvents.length)];
                        } else if (randomEvents.length > 0 && Math.random() < 0.4) {
                            event = randomEvents[Math.floor(Math.random() * randomEvents.length)];
                        }
                    }
                }
            }
            
            if (event) {
                // 如果有事件正在处理，加入队列
                if (isEventActive) {
                    eventQueue.push(event);
                    return;
                }
                
                if(event.unique) {
                    gameState.eventHistory.push(event.id);
                }
                showEventModal(event);
            }
        }
        
        // 处理下一个队列中的事件
        function processNextEvent() {
            if (eventQueue.length > 0 && !isEventActive) {
                const nextEvent = eventQueue.shift();
                showEventModal(nextEvent);
            }
        }
        
        // 检查基于性格特征的特殊事件
        function checkPersonalityEvents() {
            const personalityEvents = [];
            const p = gameState.personality;
            
            // 基于不同性格特征触发特殊事件
            if (p.innovative >= 5 && gameState.player.stage === '能力提升' && !gameState.eventHistory.includes('PE001')) {
                personalityEvents.push({
                    id: 'PE001', title: '创新思维的碰撞',
                    description: '因为你一直以来的创新表现，领导决定让你参与一个改革试点项目。这是展现你创新能力的绝佳机会！',
                    choices: [
                        { text: '全力投入，展现创新潜力', 
                          consequence: { stats: { professional: 3, decision: 2 }, influence: 25, achievement: 'INNOVATOR', log: '你的创新方案获得了上级高度认可！' } }
                    ]
                });
            }
            
            if (p.social >= 6 && gameState.player.stage === '职业发展' && !gameState.eventHistory.includes('PE002')) {
                personalityEvents.push({
                    id: 'PE002', title: '人际网络的力量',
                    description: '你平时良好的人际关系发挥了作用！有几个部门的同事主动邀请你参与跨部门合作项目。',
                    choices: [
                        { text: '接受邀请，发挥协调优势', 
                          consequence: { stats: { communication: 3, decision: 2 }, influence: 30, achievement: 'TEAM_PLAYER', log: '你的人际协调能力让项目进展顺利！' } }
                    ]
                });
            }
            
            if (p.rebellious >= 4 && gameState.player.stage === '能力提升' && !gameState.eventHistory.includes('PE003')) {
                personalityEvents.push({
                    id: 'PE003', title: '不同声音的价值',
                    description: '在一次会议上，你提出了与主流观点不同的看法。虽然引起了争议，但也引发了深入思考。',
                    choices: [
                        { text: '坚持自己的观点', 
                          personality: { rebellious: 1 },
                          consequence: { stats: { decision: 3, communication: 1 }, influence: 20, achievement: 'CONTROVERSIAL_CHOICE', log: '你的不同观点最终被证明是有价值的！' } },
                        { text: '适当妥协，寻求平衡', 
                          consequence: { stats: { communication: 2, decision: 1 }, influence: 15, log: '你学会了在坚持原则和灵活变通之间找平衡。' } }
                    ]
                });
            }
            
            return personalityEvents;
        }
        
        // 显示事件模态框
        function showEventModal(event) {
            isEventActive = true; // 标记事件正在处理
            
            eventElements.title.textContent = event.title;
            eventElements.description.innerHTML = event.description;
            eventElements.choices.innerHTML = '';
            
            // 添加重要性提示
            if (event.important) {
                const importantTag = document.createElement('div');
                importantTag.style.cssText = `
                    background: #ff6b6b; color: white; padding: 0.3rem 0.8rem; 
                    border-radius: 15px; font-size: 0.8rem; margin-bottom: 1rem;
                    display: inline-block; animation: pulse 2s infinite;
                `;
                importantTag.innerHTML = '🔥 重要选择 - 需要仔细考虑';
                eventElements.description.appendChild(importantTag);
            }
            
            // 添加队列提示
            if (eventQueue.length > 0) {
                const queueTag = document.createElement('div');
                queueTag.style.cssText = `
                    background: var(--pixel-yellow); color: var(--primary-color); padding: 0.2rem 0.6rem; 
                    border-radius: 10px; font-size: 0.7rem; margin-bottom: 0.5rem;
                    display: inline-block;
                `;
                queueTag.innerHTML = `⏳ 还有${eventQueue.length}个事件等待处理`;
                eventElements.description.appendChild(queueTag);
            }
            
            event.choices.forEach((choice, index) => {
                const button = document.createElement('button');
                button.textContent = choice.text;
                button.classList.add('btn');
                button.onclick = () => handleChoice(choice, event.id);
                eventElements.choices.appendChild(button);
            });
            
            // 设置自动选择倒计时
            if (!event.important) {
                setupAutoChoice(event, 8000); // 8秒后自动选择
            }
            
            modals.event.classList.add('active');
        }
        
        let autoChoiceTimer = null;
        let countdownInterval = null;
        let eventQueue = []; // 事件队列
        let isEventActive = false; // 是否有事件正在处理
        
        function setupAutoChoice(event, delay) {
            // 添加倒计时显示
            const countdownDiv = document.createElement('div');
            countdownDiv.id = 'auto-choice-countdown';
            countdownDiv.style.cssText = `
                text-align: center; margin-top: 1rem; color: #6c757d; font-size: 0.9rem;
                background: #f8f9fa; padding: 0.5rem; border-radius: 8px;
            `;
            eventElements.choices.appendChild(countdownDiv);
            
            let timeLeft = delay / 1000;
            
            const updateCountdown = () => {
                if (timeLeft > 0) {
                    countdownDiv.innerHTML = `⏰ ${timeLeft}秒后将自动选择推荐选项 <button onclick="cancelAutoChoice()" style="margin-left: 10px; padding: 2px 8px; border: none; background: #007bff; color: white; border-radius: 3px; cursor: pointer;">取消自动</button>`;
                    timeLeft--;
                } else {
                    clearInterval(countdownInterval);
                    // 自动选择第一个选项（通常是推荐选项）
                    const recommendedChoice = event.choices[0];
                    handleChoice(recommendedChoice, event.id);
                }
            };
            
            updateCountdown();
            countdownInterval = setInterval(updateCountdown, 1000);
        }
        
        function cancelAutoChoice() {
            if (countdownInterval) {
                clearInterval(countdownInterval);
                countdownInterval = null;
            }
            const countdownDiv = document.getElementById('auto-choice-countdown');
            if (countdownDiv) {
                countdownDiv.innerHTML = '⏸️ 自动选择已取消';
            }
        }
        
        // 处理玩家选择
        function handleChoice(choice, eventId) {
            // 清理自动选择倒计时
            if (countdownInterval) {
                clearInterval(countdownInterval);
                countdownInterval = null;
            }
            
            let result;
            if (typeof choice.consequence === 'function') {
                result = choice.consequence(gameState);
            } else {
                result = choice.consequence;
            }

            // 记录选择历史
            gameState.choiceHistory.push({
                eventId: eventId,
                choiceText: choice.text,
                timestamp: gameState.time.days
            });

            // 更新性格特征
            if (choice.personality) {
                for (const trait in choice.personality) {
                    gameState.personality[trait] += choice.personality[trait];
                }
            }

            // 应用后果
            if (result.stats) {
                for (const stat in result.stats) {
                    gameState.player.stats[stat] += result.stats[stat];
                    if (gameState.player.stats[stat] > 100) gameState.player.stats[stat] = 100;
                    if (gameState.player.stats[stat] < 0) gameState.player.stats[stat] = 0;
                }
            }
            if (result.influence) {
                gameState.player.influence += result.influence;
                if (gameState.player.influence < 0) gameState.player.influence = 0;
            }
            if (result.examProgress) {
                for (const key in result.examProgress) {
                    gameState.examProgress[key] += result.examProgress[key];
                }
            }
            if (result.selectedPath) {
                gameState.selectedPath = result.selectedPath;
                updateGoal('choose_path', true);
                addLogMessage(`📝 考试路径已确定！相关时间节点已更新。`, 'success');
                // 触发职位选择
                setTimeout(() => triggerEvent('E001_FOLLOW'), 2000);
            }
            if (result.jobLocation) {
                gameState.jobLocation = result.jobLocation;
                addLogMessage(`🗺️ 工作地点倾向已确定！`, 'success');
            }
            if (result.log) {
                addLogMessage(result.log);
            }
            if (result.achievement) {
                unlockAchievement(result.achievement);
            }
            if (result.nextStage) {
                advanceStage();
            }
            if (result.gameOver) {
                gameOver(result.log || '游戏结束');
            }
            if (result.triggerEvent) {
                // 延迟触发连锁事件
                setTimeout(() => triggerEvent(result.triggerEvent), 2000);
            }
            if (result.notification) {
                showNotification(result.notification);
            }
            if (result.buff) {
                // 处理BUFF效果
                if (!gameState.activeBuffs) {
                    gameState.activeBuffs = [];
                }
                gameState.activeBuffs.push({
                    name: result.buff.name,
                    duration: result.buff.duration,
                    effect: result.buff.effect,
                    startDay: gameState.time.days
                });
                addLogMessage(`✨ 获得增益效果：${result.buff.name}（持续${result.buff.duration}天）`, 'success');
            }
            if (result.debuff) {
                // 处理DEBUFF效果
                if (!gameState.activeDebuffs) {
                    gameState.activeDebuffs = [];
                }
                gameState.activeDebuffs.push({
                    name: result.debuff.name,
                    duration: result.debuff.duration,
                    effect: result.debuff.effect,
                    startDay: gameState.time.days
                });
                addLogMessage(`💔 受到负面效果：${result.debuff.name}（持续${result.debuff.duration}天）`, 'danger');
            }
            
            modals.event.classList.remove('active');
            isEventActive = false; // 标记事件处理完成
            
            checkGoalCompletion(); // 检查目标完成情况
            updateUI();
            saveGame();
            
            // 处理队列中的下一个事件
            setTimeout(() => processNextEvent(), 1000);
        }
        
        // 游戏结束
        function gameOver(message) {
            gameState.isGameOver = true;
            stopAutoProgress();
            addLogMessage(message, 'danger');
            calendar.progressStatus.textContent = '🏁 游戏结束';
            buttons.pause.textContent = '游戏结束';
            buttons.pause.disabled = true;
            
            // 显示最终统计
            setTimeout(() => {
                const totalStats = Object.values(gameState.player.stats).reduce((a, b) => a + b, 0);
                const unlockedAchievements = Object.values(gameState.achievements).filter(a => a.unlocked).length;
                addLogMessage(`\n=== 游戏总结 ===`, 'normal');
                addLogMessage(`游戏天数：${gameState.time.days}天`, 'normal');
                addLogMessage(`最终阶段：${gameState.player.stage}`, 'normal');
                addLogMessage(`总能力值：${totalStats}`, 'normal');
                addLogMessage(`影响力：${gameState.player.influence}`, 'normal');
                addLogMessage(`解锁成就：${unlockedAchievements}/18`, 'normal');
                addLogMessage(`感谢你体验《公考模拟器》！`, 'success');
            }, 1000);
        }

        // ----------------------------------------------------
        // 4. UI 更新与交互函数
        // ----------------------------------------------------

        // 主UI更新函数
        function updateUI() {
            // 角色面板
            displays.playerName.textContent = gameState.player.name;
            displays.playerStage.textContent = gameState.player.stage;
            
            for (const stat in statsBars) {
                const value = gameState.player.stats[stat];
                statsBars[stat].style.width = `${value}%`;
                // 根据数值改变颜色
                if (value < 30) statsBars[stat].style.backgroundColor = 'var(--danger-color)';
                else if (value < 60) statsBars[stat].style.backgroundColor = 'var(--warning-color)';
                else statsBars[stat].style.backgroundColor = 'var(--secondary-color)';
            }
            
            // 游戏信息
            displays.gameTime.textContent = `第${gameState.time.year}年 第${gameState.time.month}月 第${gameState.time.day}日`;
            displays.influence.textContent = gameState.player.influence;
            
            // 更新考试进度显示
            if (document.getElementById('exam-progress')) {
                document.getElementById('exam-progress').textContent = 
                    `笔试: ${gameState.examProgress.practiceTests}次 | 面试: ${gameState.examProgress.mockInterviews}次`;
            }
            
            // 更新性格特征显示
            if (document.getElementById('personality-innovative')) {
                document.getElementById('personality-innovative').textContent = gameState.personality.innovative;
                document.getElementById('personality-social').textContent = gameState.personality.social;
                document.getElementById('personality-studious').textContent = gameState.personality.studious;
                document.getElementById('personality-cautious').textContent = gameState.personality.cautious;
                document.getElementById('personality-rebellious').textContent = gameState.personality.rebellious;
                document.getElementById('personality-traditional').textContent = gameState.personality.traditional;
            }
            
            // 更新选择路径显示
            if (document.getElementById('selected-path')) {
                const pathNames = {
                    'nationalExam': '国家公务员考试',
                    'provincialExam': '省级公务员考试', 
                    'institutionExam': '事业单位考试',
                    'grassrootsProgram': '三支一扶项目'
                };
                document.getElementById('selected-path').textContent = 
                    gameState.selectedPath ? pathNames[gameState.selectedPath] : '未选择';
            }
            
            // 更新日历显示
            if (calendar.year) {
                calendar.year.textContent = gameState.time.year;
                calendar.month.textContent = gameState.time.month;
                calendar.day.textContent = gameState.time.day;
                calendar.totalDays.textContent = gameState.time.days;
            }
            
            // 更新目标显示
            updateGoalsDisplay();
            
            // 更新日志
            displays.log.scrollTop = displays.log.scrollHeight;
        }

        // 添加日志条目
        function addLogMessage(message, type = 'normal') {
            const entry = document.createElement('div');
            entry.classList.add('log-entry');
            
            const timeSpan = document.createElement('span');
            timeSpan.classList.add('log-time');
            timeSpan.textContent = `[${gameState.time.year}-${String(gameState.time.month).padStart(2, '0')}-${String(gameState.time.day).padStart(2, '0')}]`;
            
            const messageSpan = document.createElement('span');
            messageSpan.textContent = message;
            
            if (type === 'success') messageSpan.style.color = 'var(--success-color)';
            if (type === 'danger') messageSpan.style.color = 'var(--danger-color)';

            entry.appendChild(timeSpan);
            entry.appendChild(messageSpan);
            displays.log.appendChild(entry);
            
            if (displays.log.children.length > 50) {
                displays.log.removeChild(displays.log.firstChild);
            }
            displays.log.scrollTop = displays.log.scrollHeight;
        }
        
        // 显示技能详情
        function showSkills() {
            lists.skills.innerHTML = '';
            for (const key in gameData.skills) {
                const skill = gameData.skills[key];
                const value = gameState.player.stats[key];
                const item = document.createElement('div');
                item.classList.add('skill-item');
                item.innerHTML = `
                    <div>
                        <strong>${skill.name} (等级 ${Math.floor(value/10)})</strong>
                        <p style="font-size: 0.8rem; color: var(--text-color);">${skill.description}</p>
                    </div>
                    <strong>${value} / 100</strong>
                `;
                lists.skills.appendChild(item);
            }
            modals.skills.classList.add('active');
        }
        
        // 显示成就
        function showAchievements() {
            lists.achievements.innerHTML = '';
            for (const key in gameState.achievements) {
                const ach = gameState.achievements[key];
                const item = document.createElement('div');
                item.classList.add('achievement-item');
                if (ach.unlocked) {
                    item.classList.add('unlocked');
                }
                item.innerHTML = `
                    <span class="achievement-icon">${ach.unlocked ? '🏆' : '❓'}</span>
                    <div>
                        <strong>${ach.unlocked ? ach.name : '未解锁的成就'}</strong>
                        <p style="font-size: 0.8rem; color: var(--text-color);">${ach.unlocked ? ach.description : '完成特定目标以解锁。'}</p>
                    </div>
                `;
                lists.achievements.appendChild(item);
            }
            modals.achievements.classList.add('active');
        }
        
        // 解锁成就并显示通知
        function unlockAchievement(key) {
            if (gameState.achievements[key] && !gameState.achievements[key].unlocked) {
                gameState.achievements[key].unlocked = true;
                
                // 更有趣的成就通知文案
                const funNotifications = {
                    'FIRST_STEP': '🎯 成就解锁：迈出第一步！公考路上，你不是一个人！',
                    'PASS_WRITTEN_TEST': '📚 成就解锁：笔试过关！大佬就是你！',
                    'ACE_INTERVIEW': '🎤 成就解锁：面试之王！口才满分，魅力无敌！',
                    'NEWBIE_ONBOARD': '🎊 成就解锁：新人报到！欢迎加入公务员大家庭！',
                    'FIRST_PRAISE': '⭐ 成就解锁：初获赞扬！被夸的感觉真好～',
                    'CRISIS_HANDLER': '🔥 成就解锁：危机处理者！关键时刻显身手！',
                    'TEAM_PLAYER': '🤝 成就解锁：团队合作者！友谊的小船说翻就翻？不存在的！',
                    'INNOVATOR': '💡 成就解锁：创新先锋！脑洞大开，创意无限！',
                    'MEDIA_STAR': '📸 成就解锁：媒体之星！你已经是个合格的"网红"了！',
                    'EXPERT': '🎓 成就解锁：业务专家！知识就是力量！',
                    'LEADER': '👑 成就解锁：领导潜质！未来可期，前途无量！',
                    'PEOPLE_SERVANT': '❤️ 成就解锁：人民公仆！为人民服务，永远不过时！',
                    'SOCIAL_MEDIA_HERO': '🔥 成就解锁：网络红人！你已经是这条街最亮的仔！',
                    'CONTROVERSIAL_CHOICE': '⚡ 成就解锁：争议选择！敢于发声的你，超酷的！',
                    'MEME_MASTER': '😂 成就解锁：表情包达人！幽默感满分，办公室开心果！',
                    'YOUNG_ICON': '🌟 成就解锁：年轻偶像！95后的骄傲！',
                    'BALANCE_MASTER': '⚖️ 成就解锁：平衡大师！工作生活两不误，人生赢家就是你！',
                    'TREND_SETTER': '🚀 成就解锁：潮流引领者！引领时代，你就是那个趋势！'
                };
                
                const notification = funNotifications[key] || `🏆 成就解锁：${gameState.achievements[key].name}`;
                showNotification(notification);
                saveGame();
            }
        }
        
        function showNotification(message) {
            displays.notification.textContent = message;
            displays.notification.classList.add('show');
            setTimeout(() => {
                displays.notification.classList.remove('show');
            }, 3000);
        }

        // ----------------------------------------------------
        // 5. 数据存储与分享
        // ----------------------------------------------------

        // 保存游戏
        function saveGame() {
            localStorage.setItem('civilServantSim_gameState', JSON.stringify(gameState));
        }

        // 加载游戏
        function loadGame() {
            const savedState = localStorage.getItem('civilServantSim_gameState');
            if (savedState) {
                gameState = JSON.parse(savedState);
                return true;
            }
            return false;
        }
        
        // 重置游戏
        function resetGame() {
            if(confirm('确定要重置游戏吗？所有进度都将丢失。')) {
                localStorage.removeItem('civilServantSim_gameState');
                location.reload();
            }
        }

        // 分享功能
        async function shareProgress() {
            const shareData = {
                title: '我在《公考模拟器》中的公仆生涯',
                text: `我在《公考模拟器》中扮演“${gameState.player.name}”，当前是${gameState.player.stage}，影响力已达到${gameState.player.influence}。你也来试试吧！`,
                url: window.location.href
            };
            try {
                if (navigator.share) {
                    await navigator.share(shareData);
                    addLogMessage('成功分享了你的游戏进度！');
                } else {
                    alert('你的浏览器不支持分享功能。可以手动截图分享哦！');
                }
            } catch (err) {
                addLogMessage('分享被取消或失败。', 'warning');
            }
        }

        // 火热分享功能 - 更有传播性
        async function viralShareProgress() {
            const totalStats = Object.values(gameState.player.stats).reduce((a, b) => a + b, 0);
            const unlockedAchievements = Object.values(gameState.achievements).filter(a => a.unlocked).length;
            
            // 生成吸引眼球的分享文案
            let shareText = '';
            let hashTags = '';
            
            if (gameState.player.stage === '备考阶段') {
                shareText = `🔥【公考日记】第${gameState.time.days}天，我在《公考模拟器》里体验备考生活！影响力已达${gameState.player.influence}，感觉自己离梦想越来越近了💪`;
                hashTags = '#公考备考 #梦想成真 #坚持不懈';
            } else if (gameState.player.stage === '考试阶段') {
                shareText = `💥【上岸倒计时】《公考模拟器》考试进行中！笔试已过，面试在即！影响力${gameState.player.influence}，为所有考公人加油！🚀`;
                hashTags = '#公考上岸 #面试加油 #青春无悔';
            } else if (gameState.player.stage === '入职适应') {
                shareText = `🎉【成功上岸】我在《公考模拟器》里当上公务员啦！从菜鸟到职场新人，影响力${gameState.player.influence}！这就是传说中的"稳定工作"吗？`;
                hashTags = '#成功上岸 #新人报到 #职场生活';
            } else if (gameState.player.stage === '能力提升') {
                shareText = `⚡【能力爆表】《公考模拟器》玩出新高度！解锁${unlockedAchievements}个成就，影响力${gameState.player.influence}！我可能就是传说中的"别人家的公务员"😎`;
                hashTags = '#能力提升 #成就解锁 #别人家的孩子';
            } else if (gameState.player.stage === '职业发展') {
                shareText = `👑【大佬诞生】《公考模拟器》终极玩家！影响力破${gameState.player.influence}，解锁${unlockedAchievements}个成就！95后公务员就是这么优秀！快来膜拜吧～`;
                hashTags = '#95后公务员 #职场大佬 #人生赢家';
            }
            
            // 添加话题性元素
            const controversialPhrases = [
                '你还在说公务员工作无聊吗？',
                '这可能是最真实的公职体验游戏！',
                '比追剧还上瘾的职场模拟器！',
                '谁说95后不能当好公务员？',
                '这届年轻人真的太优秀了！'
            ];
            
            const randomPhrase = controversialPhrases[Math.floor(Math.random() * controversialPhrases.length)];
            shareText += `\n\n${randomPhrase}`;
            
            // 完整分享文案
            const fullShareText = `${shareText}\n\n${hashTags} #公考模拟器 #公务员生活 #95后职场`;
            
            try {
                if (navigator.share) {
                    await navigator.share({
                        title: '🔥 我在《公考模拟器》中的传奇公仆生涯',
                        text: fullShareText,
                        url: window.location.href
                    });
                    addLogMessage('🎉 火热分享成功！你的影响力暴涨+10！', 'success');
                    gameState.player.influence += 10;
                    // 可能解锁相关成就
                    if (gameState.player.influence >= 50) {
                        unlockAchievement('SOCIAL_MEDIA_HERO');
                    }
                } else {
                    // 复制到剪贴板
                    if (navigator.clipboard) {
                        await navigator.clipboard.writeText(fullShareText);
                        showNotification('🔥 火热分享文案已复制！赶紧去社交平台引爆话题吧！');
                    } else {
                        const textArea = document.createElement('textarea');
                        textArea.value = fullShareText;
                        document.body.appendChild(textArea);
                        textArea.select();
                        document.execCommand('copy');
                        document.body.removeChild(textArea);
                        showNotification('💥 爆款文案已复制！去制造话题热点吧！');
                    }
                    addLogMessage('🚀 分享文案已生成，影响力+8！', 'success');
                    gameState.player.influence += 8;
                }
                updateUI();
                saveGame();
            } catch (err) {
                addLogMessage('分享遇到小问题，但你的魅力无法阻挡！', 'normal');
            }
        }

        // ----------------------------------------------------
        // 6. 事件监听器绑定
        // ----------------------------------------------------
        buttons.start.addEventListener('click', initNewGame);
        buttons.pause.addEventListener('click', togglePause);
        buttons.reset.addEventListener('click', resetGame);
        buttons.share.addEventListener('click', shareProgress);
        buttons.viralShare.addEventListener('click', viralShareProgress);
        
        buttons.showSkills.addEventListener('click', showSkills);
        buttons.closeSkills.addEventListener('click', () => modals.skills.classList.remove('active'));
        
        buttons.showAchievements.addEventListener('click', showAchievements);
        buttons.closeAchievements.addEventListener('click', () => modals.achievements.classList.remove('active'));
        
        // 点击模态框背景关闭
        Object.values(modals).forEach(modal => {
            modal.addEventListener('click', (e) => {
                if(e.target === modal) {
                    modal.classList.remove('active');
                }
            });
        });

        // ----------------------------------------------------
        // 7. 游戏入口
        // ----------------------------------------------------
        function initialize() {
            if (loadGame()) {
                // 如果有存档，直接开始游戏
                startGame();
            } else {
                // 否则显示开始屏幕
                document.getElementById('start-screen').classList.add('active');
            }
        }

        initialize();
    });
    </script>
</body>
</html>